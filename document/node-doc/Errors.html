<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Errors.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Errors"><meta property="og:description" content="Errors Node.js 中的错误（Errors）处理是编程中非常重要的部分，因为它能帮助你理解哪些地方出了问题，并且如何去修复这些问题。在 Node.js v21.7.1 中，错误处理遵循一些基本原则和模式。 首先，让我们了解什么是错误（Error）。在编程中，错误通常指的是程序运行时出现的问题，比如尝试读取一个不存在的文件，或是尝试调用一个未定..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Errors","description":"Errors Node.js 中的错误（Errors）处理是编程中非常重要的部分，因为它能帮助你理解哪些地方出了问题，并且如何去修复这些问题。在 Node.js v21.7.1 中，错误处理遵循一些基本原则和模式。 首先，让我们了解什么是错误（Error）。在编程中，错误通常指的是程序运行时出现的问题，比如尝试读取一个不存在的文件，或是尝试调用一个未定..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Errors | hanekawa-shiki</title><meta name="description" content="Errors Node.js 中的错误（Errors）处理是编程中非常重要的部分，因为它能帮助你理解哪些地方出了问题，并且如何去修复这些问题。在 Node.js v21.7.1 中，错误处理遵循一些基本原则和模式。 首先，让我们了解什么是错误（Error）。在编程中，错误通常指的是程序运行时出现的问题，比如尝试读取一个不存在的文件，或是尝试调用一个未定...">
    <link rel="stylesheet" href="/assets/css/styles.a84c0532.css">
    <link rel="preload" href="/assets/js/runtime~app.be370b10.js" as="script"><link rel="preload" href="/assets/css/styles.a84c0532.css" as="style"><link rel="preload" href="/assets/js/4485.e6fe7c7b.js" as="script"><link rel="preload" href="/assets/js/app.bf6f64e3.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="博客主页"><!--[--><span class="font-icon icon home" style=""></span><!--]-->博客主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="学习笔记"><!--[--><span class="font-icon icon framework" style=""></span>学习笔记<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">前端框架</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3笔记"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3笔记<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="React笔记"><!--[--><span class="font-icon icon react" style=""></span><!--]-->React笔记<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="文档"><!--[--><span class="font-icon icon framework" style=""></span>文档<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">搬运</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.js文档"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.js文档<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.js文档"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.js文档<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Errors</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 804 分钟</span><meta property="timeRequired" content="PT804M"></span><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 241190 字</span><meta property="wordCount" content="241190"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#error-propagation-and-interception">Error propagation and interception</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误传播-error-propagation">错误传播 (Error Propagation)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误拦截-error-interception">错误拦截 (Error Interception)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-error">Class: Error</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-创建和抛出一个错误">示例 1：创建和抛出一个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-捕获和处理错误">示例 2：捕获和处理错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-自定义错误类型">示例 3：自定义错误类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#new-error-message-options">new Error(message[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-capturestacktrace-targetobject-constructoropt">Error.captureStackTrace(targetObject[, constructorOpt])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-stacktracelimit">Error.stackTraceLimit</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-cause">error.cause</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-创建带有原因的错误">例子 1：创建带有原因的错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-在异步操作中使用-error-cause">例子 2：在异步操作中使用 error.cause</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-code">error.code</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-message">error.message</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误对象-error-object">错误对象 (Error object)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用示例">实际运用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-stack">error.stack</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-assertionerror">Class: AssertionError</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-rangeerror">Class: RangeError</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-数组长度错误">例子 1：数组长度错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-数字精度溢出">例子 2：数字精度溢出</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-递归层数过深">例子 3：递归层数过深</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-referenceerror">Class: ReferenceError</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-未声明的变量">示例 1：未声明的变量</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-属性拼写错误">示例 2：属性拼写错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-严格模式下删除不允许删除的变量">示例 3：严格模式下删除不允许删除的变量</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-syntaxerror">Class: SyntaxError</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-括号不匹配">示例 1：括号不匹配</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-意外的标记">示例 2：意外的标记</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-关键字用法错误">示例 3：关键字用法错误</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-systemerror">Class: SystemError</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-address">error.address</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-code-1">error.code</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-dest">error.dest</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-尝试写入一个只读的文件">例子 1：尝试写入一个只读的文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-尝试移动一个不存在的文件">例子 2：尝试移动一个不存在的文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-errno">error.errno</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释error-errno">解释error.errno</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-info">error.info</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-自定义错误信息">例子 1: 自定义错误信息</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-捕获系统错误">例子 2: 捕获系统错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-扩展第三方库错误">例子 3: 扩展第三方库错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-message-1">error.message</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-path">error.path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-读取文件时发生错误">示例 1：读取文件时发生错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-写入文件时发生错误">示例 2：写入文件时发生错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-检查文件状态时发生错误">示例 3：检查文件状态时发生错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-port">error.port</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-创建-http-服务器">示例 1：创建 HTTP 服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-连接-tcp-客户端">示例 2：连接 TCP 客户端</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-syscall">error.syscall</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-文件操作错误">例子 1：文件操作错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-网络请求问题">例子 2：网络请求问题</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#重要的点">重要的点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#common-system-errors">Common system errors</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#class-typeerror">Class: TypeError</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#实例解释">实例解释：</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-错误的参数类型">1. 错误的参数类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-使用内置方法时参数类型不正确">2. 使用内置方法时参数类型不正确</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-调用不存在的函数或属性">3. 调用不存在的函数或属性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论">结论</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#exceptions-vs-errors">Exceptions vs. errors</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#openssl-errors">OpenSSL errors</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-https-服务器证书问题">实例 1：HTTPS 服务器证书问题</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-客户端-ssl-握手失败">实例 2：客户端 SSL 握手失败</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-3-加密操作异常">实例 3：加密操作异常</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-opensslerrorstack">error.opensslErrorStack</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-function">error.function</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例解释-1">实例解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用-error-function">使用 error.function</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-library">error.library</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-reason">error.reason</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例-1-网络请求错误">例 1: 网络请求错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例-2-数据库查询错误">例 2: 数据库查询错误</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#node-js-error-codes">Node.js error codes</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abort-err">ABORT_ERR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-access-denied">ERR_ACCESS_DENIED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-尝试读取受保护的文件">例子 1：尝试读取受保护的文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-尝试写入不可写目录">例子 2：尝试写入不可写目录</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-尝试监听一个没有权限的端口">例子 3：尝试监听一个没有权限的端口</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-ambiguous-argument">ERR_AMBIGUOUS_ARGUMENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-arg-not-iterable">ERR_ARG_NOT_ITERABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-assertion">ERR_ASSERTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-async-callback">ERR_ASYNC_CALLBACK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误示例">错误示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#正确示例">正确示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-async-type">ERR_ASYNC_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-回调函数中的不当类型">示例 1：回调函数中的不当类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-promise-的错误用法">示例 2：Promise 的错误用法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-async-await-的错误用法">示例 3：Async/Await 的错误用法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-brotli-compression-failed">ERR_BROTLI_COMPRESSION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-brotli-invalid-param">ERR_BROTLI_INVALID_PARAM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-使用-brotli-压缩数据">示例 1：使用 Brotli 压缩数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-产生err-brotli-invalid-param错误">示例 2：产生ERR_BROTLI_INVALID_PARAM错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免err-brotli-invalid-param错误">如何避免ERR_BROTLI_INVALID_PARAM错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-buffer-context-not-available">ERR_BUFFER_CONTEXT_NOT_AVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-buffer-out-of-bounds">ERR_BUFFER_OUT_OF_BOUNDS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-读取越界">实例 1: 读取越界</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-写入越界">实例 2: 写入越界</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#避免错误的技巧">避免错误的技巧</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-buffer-too-large">ERR_BUFFER_TOO_LARGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-创建一个过大的-buffer">示例 1: 创建一个过大的 Buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-分配较大但合理的-buffer">示例 2: 分配较大但合理的 Buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景举例">使用场景举例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-cannot-watch-sigint">ERR_CANNOT_WATCH_SIGINT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-child-closed-before-reply">ERR_CHILD_CLOSED_BEFORE_REPLY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-子进程正常工作">示例 1：子进程正常工作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-子进程异常退出-可能导致-err-child-closed-before-reply">示例 2：子进程异常退出（可能导致 ERR_CHILD_CLOSED_BEFORE_REPLY）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-child-process-ipc-required">ERR_CHILD_PROCESS_IPC_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么-ipc-管道很重要">为什么 IPC 管道很重要？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-使用-child-process-fork">示例：使用 child_process.fork()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误场景示例">错误场景示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-child-process-stdio-maxbuffer">ERR_CHILD_PROCESS_STDIO_MAXBUFFER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-closed-message-port">ERR_CLOSED_MESSAGE_PORT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-console-writable-stream">ERR_CONSOLE_WRITABLE_STREAM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-construct-call-invalid">ERR_CONSTRUCT_CALL_INVALID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-construct-call-required">ERR_CONSTRUCT_CALL_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-不正确地调用构造函数">示例 1：不正确地调用构造函数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-内置对象的错误使用">示例 2：内置对象的错误使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-context-not-initialized">ERR_CONTEXT_NOT_INITIALIZED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-custom-engine-not-supported">ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-ecdh-invalid-format">ERR_CRYPTO_ECDH_INVALID_FORMAT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-ecdh-invalid-public-key">ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-engine-unknown">ERR_CRYPTO_ENGINE_UNKNOWN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-fips-forced">ERR_CRYPTO_FIPS_FORCED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-fips">什么是 FIPS？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-fips-forced-错误解释">ERR_CRYPTO_FIPS_FORCED 错误解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-1">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-fips-unavailable">ERR_CRYPTO_FIPS_UNAVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-hash-finalized">ERR_CRYPTO_HASH_FINALIZED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-hash-update-failed">ERR_CRYPTO_HASH_UPDATE_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#故障原因">故障原因：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际使用举例">实际使用举例：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-incompatible-key">ERR_CRYPTO_INCOMPATIBLE_KEY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-incompatible-key-options">ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-使用错误的密钥类型进行签名">示例 1：使用错误的密钥类型进行签名</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-使用非法密钥格式进行加密">示例 2：使用非法密钥格式进行加密</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-initialization-failed">ERR_CRYPTO_INITIALIZATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-1">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-1">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-auth-tag">ERR_CRYPTO_INVALID_AUTH_TAG</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-2">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-counter">ERR_CRYPTO_INVALID_COUNTER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-curve">ERR_CRYPTO_INVALID_CURVE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-digest">ERR_CRYPTO_INVALID_DIGEST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-创建哈希值">例子 1：创建哈希值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-捕获无效算法名称错误">例子 2：捕获无效算法名称错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-iv">ERR_CRYPTO_INVALID_IV</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-jwk">ERR_CRYPTO_INVALID_JWK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-使用-jwk-生成密钥">实例 1：使用 JWK 生成密钥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-验证-json-web-token-jwt">实例 2：验证 JSON Web Token (JWT)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-key-object-type">ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景-密钥和-node-js-的加密模块">背景：密钥和 Node.js 的加密模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误情况-err-crypto-invalid-key-object-type">错误情况：ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-2">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-1">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-keylen">ERR_CRYPTO_INVALID_KEYLEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-使用-crypto-createcipheriv-创建一个加密器实例">实例 1：使用 crypto.createCipheriv 创建一个加密器实例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-使用-crypto-pbkdf2-函数来生成一个安全的键">实例 2：使用 crypto.pbkdf2 函数来生成一个安全的键</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-keypair">ERR_CRYPTO_INVALID_KEYPAIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误-err-crypto-invalid-keypair">错误：ERR_CRYPTO_INVALID_KEYPAIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-2">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-keytype">ERR_CRYPTO_INVALID_KEYTYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-加密数据">示例 1: 加密数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-解密数据">示例 2: 解密数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-messagelen">ERR_CRYPTO_INVALID_MESSAGELEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#加密模块的基本知识">加密模块的基本知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-err-crypto-invalid-messagelen">什么是 ERR_CRYPTO_INVALID_MESSAGELEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-3">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-scrypt-params">ERR_CRYPTO_INVALID_SCRYPT_PARAMS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-state">ERR_CRYPTO_INVALID_STATE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-invalid-tag-length">ERR_CRYPTO_INVALID_TAG_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-job-init-failed">ERR_CRYPTO_JOB_INIT_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-jwk-unsupported-curve">ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-jwk-unsupported-key-type">ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-operation-failed">ERR_CRYPTO_OPERATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-pbkdf2-error">ERR_CRYPTO_PBKDF2_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-scrypt-invalid-parameter">ERR_CRYPTO_SCRYPT_INVALID_PARAMETER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-scrypt-not-supported">ERR_CRYPTO_SCRYPT_NOT_SUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-sign-key-required">ERR_CRYPTO_SIGN_KEY_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-timing-safe-equal-length">ERR_CRYPTO_TIMING_SAFE_EQUAL_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-unknown-cipher">ERR_CRYPTO_UNKNOWN_CIPHER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-unknown-cipher-的含义">[ERR_CRYPTO_UNKNOWN_CIPHER] 的含义</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-4">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-unknown-dh-group">ERR_CRYPTO_UNKNOWN_DH_GROUP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-unsupported-operation">ERR_CRYPTO_UNSUPPORTED_OPERATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-不支持的方法或算法">示例 1：不支持的方法或算法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-使用了不被支持的选项或配置">示例 2：使用了不被支持的选项或配置</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-3">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-debugger-error">ERR_DEBUGGER_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-debugger-startup-error">ERR_DEBUGGER_STARTUP_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-dlopen-disabled">ERR_DLOPEN_DISABLED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-dlopen-failed">ERR_DLOPEN_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-5">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-dir-closed">ERR_DIR_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-dir-concurrent-operation">ERR_DIR_CONCURRENT_OPERATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-dns-set-servers-failed">ERR_DNS_SET_SERVERS_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-domain-callback-not-available">ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-domain-cannot-set-uncaught-exception-capture">ERR_DOMAIN_CANNOT_SET_UNCAUGHT_EXCEPTION_CAPTURE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#process-setuncaughtexceptioncapturecallback">process.setUncaughtExceptionCaptureCallback()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#domain-模块">domain 模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误原因">错误原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误">如何避免这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-3">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-duplicate-startup-snapshot-main-function">ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-encoding-invalid-encoded-data">ERR_ENCODING_INVALID_ENCODED_DATA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-buffer-到字符串的转换">例子 1：Buffer 到字符串的转换</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-url-编码">例子 2：URL 编码</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误">如何处理这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-encoding-not-supported">ERR_ENCODING_NOT_SUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-读取文件">例子 1：读取文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-写入文件">例子 2：写入文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-使用-buffer">例子 3：使用 Buffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-1">如何处理这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-eval-esm-cannot-print">ERR_EVAL_ESM_CANNOT_PRINT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-event-recursion">ERR_EVENT_RECURSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-execution-environment-not-available">ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-falsy-value-rejection">ERR_FALSY_VALUE_REJECTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-feature-unavailable-on-platform">ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-dir-to-non-dir">ERR_FS_CP_DIR_TO_NON_DIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-eexist">ERR_FS_CP_EEXIST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#文件系统模块-fs">文件系统模块(fs)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#拷贝操作">拷贝操作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误情况">错误情况</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-6">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-einval">ERR_FS_CP_EINVAL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例解释-2">实例解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#几个可能导致-err-fs-cp-einval-错误的场景">几个可能导致 ERR_FS_CP_EINVAL 错误的场景：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-body-not-allowed">ERR_HTTP_BODY_NOT_ALLOWED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-get-请求发送消息体">示例 1：GET 请求发送消息体</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-delete-请求发送消息体">示例 2：DELETE 请求发送消息体</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误">如何解决这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-content-length-mismatch">ERR_HTTP_CONTENT_LENGTH_MISMATCH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释">解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-7">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误-1">如何避免这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-fifo-pipe">ERR_FS_CP_FIFO_PIPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-8">实际运用的例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-non-dir-to-dir">ERR_FS_CP_NON_DIR_TO_DIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-socket">ERR_FS_CP_SOCKET</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-symlink-to-subdirectory">ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-cp-unknown">ERR_FS_CP_UNKNOWN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-eisdir">ERR_FS_EISDIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-file-too-large">ERR_FS_FILE_TOO_LARGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-fs-invalid-symlink-type">ERR_FS_INVALID_SYMLINK_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-headers-sent">ERR_HTTP_HEADERS_SENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-invalid-header-value">ERR_HTTP_INVALID_HEADER_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-设置-http-响应头部">例子 1：设置 HTTP 响应头部</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-设置自定义头部">例子 2：设置自定义头部</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-invalid-status-code">ERR_HTTP_INVALID_STATUS_CODE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-request-timeout">ERR_HTTP_REQUEST_TIMEOUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-socket-assigned">ERR_HTTP_SOCKET_ASSIGNED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-错误地尝试修改已发送的响应头">示例 1：错误地尝试修改已发送的响应头</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-错误地尝试多次发送响应">示例 2：错误地尝试多次发送响应</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-socket-encoding">ERR_HTTP_SOCKET_ENCODING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-trailer-invalid">ERR_HTTP_TRAILER_INVALID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-http-trailer">什么是 HTTP Trailer？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么情况下会遇到-err-http-trailer-invalid-错误">什么情况下会遇到 ERR_HTTP_TRAILER_INVALID 错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-4">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误-2">如何避免这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-altsvc-invalid-origin">ERR_HTTP2_ALTSVC_INVALID_ORIGIN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-2-和-altsvc-帧">HTTP/2 和 ALTSVC 帧</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-altsvc-invalid-origin-错误">ERR_HTTP2_ALTSVC_INVALID_ORIGIN 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-5">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理错误">处理错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-altsvc-length">ERR_HTTP2_ALTSVC_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-connect-authority">ERR_HTTP2_CONNECT_AUTHORITY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-connect-path">ERR_HTTP2_CONNECT_PATH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例演示">实例演示</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-connect-scheme">ERR_HTTP2_CONNECT_SCHEME</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-error">ERR_HTTP2_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-goaway-session">ERR_HTTP2_GOAWAY_SESSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-header-single-value">ERR_HTTP2_HEADER_SINGLE_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-headers-after-respond">ERR_HTTP2_HEADERS_AFTER_RESPOND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-headers-sent">ERR_HTTP2_HEADERS_SENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-info-status-not-allowed">ERR_HTTP2_INFO_STATUS_NOT_ALLOWED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-connection-headers">ERR_HTTP2_INVALID_CONNECTION_HEADERS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-header-value">ERR_HTTP2_INVALID_HEADER_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-info-status">ERR_HTTP2_INVALID_INFO_STATUS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-origin">ERR_HTTP2_INVALID_ORIGIN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-packed-settings-length">ERR_HTTP2_INVALID_PACKED_SETTINGS_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-pseudoheader">ERR_HTTP2_INVALID_PSEUDOHEADER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-session">ERR_HTTP2_INVALID_SESSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-setting-value">ERR_HTTP2_INVALID_SETTING_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-invalid-stream">ERR_HTTP2_INVALID_STREAM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-max-pending-settings-ack">ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-9">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-nested-push">ERR_HTTP2_NESTED_PUSH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-no-mem">ERR_HTTP2_NO_MEM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-no-socket-manipulation">ERR_HTTP2_NO_SOCKET_MANIPULATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-origin-length">ERR_HTTP2_ORIGIN_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-out-of-streams">ERR_HTTP2_OUT_OF_STREAMS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-payload-forbidden">ERR_HTTP2_PAYLOAD_FORBIDDEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-ping-cancel">ERR_HTTP2_PING_CANCEL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-ping-length">ERR_HTTP2_PING_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-pseudoheader-not-allowed">ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-push-disabled">ERR_HTTP2_PUSH_DISABLED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-send-file">ERR_HTTP2_SEND_FILE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-send-file-noseek">ERR_HTTP2_SEND_FILE_NOSEEK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-session-error">ERR_HTTP2_SESSION_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基本概念">基本概念</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-session-error-1">ERR_HTTP2_SESSION_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-6">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理-err-http2-session-error">处理 ERR_HTTP2_SESSION_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-settings-cancel">ERR_HTTP2_SETTINGS_CANCEL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-socket-bound">ERR_HTTP2_SOCKET_BOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-socket-unbound">ERR_HTTP2_SOCKET_UNBOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-status-101">ERR_HTTP2_STATUS_101</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-status-invalid">ERR_HTTP2_STATUS_INVALID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-stream-cancel">ERR_HTTP2_STREAM_CANCEL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-stream-error">ERR_HTTP2_STREAM_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-stream-self-dependency">ERR_HTTP2_STREAM_SELF_DEPENDENCY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-too-many-custom-settings">ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-http2-too-many-custom-settings错误">什么是ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-10">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-too-many-invalid-frames">ERR_HTTP2_TOO_MANY_INVALID_FRAMES</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-trailers-already-sent">ERR_HTTP2_TRAILERS_ALREADY_SENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-trailers-not-ready">ERR_HTTP2_TRAILERS_NOT_READY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-unsupported-protocol">ERR_HTTP2_UNSUPPORTED_PROTOCOL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-连接不支持-http-2-的服务器">例子 1：连接不支持 HTTP/2 的服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-错误的协议使用">例子 2：错误的协议使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决办法">解决办法：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-illegal-constructor">ERR_ILLEGAL_CONSTRUCTOR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-错误地使用-promise-构造函数">实例 1：错误地使用 Promise 构造函数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-试图实例化内置的-math-对象">实例 2：试图实例化内置的 Math 对象</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-3-试图继承内置对象-error-的错误用法">实例 3：试图继承内置对象 Error 的错误用法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-attribute-type-incompatible">ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-attribute-missing">ERR_IMPORT_ATTRIBUTE_MISSING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-attribute-unsupported">ERR_IMPORT_ATTRIBUTE_UNSUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-incompatible-option-pair">ERR_INCOMPATIBLE_OPTION_PAIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-input-type-not-allowed">ERR_INPUT_TYPE_NOT_ALLOWED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-already-activated">ERR_INSPECTOR_ALREADY_ACTIVATED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-already-connected">ERR_INSPECTOR_ALREADY_CONNECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-closed">ERR_INSPECTOR_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-command">ERR_INSPECTOR_COMMAND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-和-v8-引擎">Node.js 和 V8 引擎</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#调试器-inspector">调试器（Inspector）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子">例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-2">如何处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-not-active">ERR_INSPECTOR_NOT_ACTIVE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-not-available">ERR_INSPECTOR_NOT_AVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-not-connected">ERR_INSPECTOR_NOT_CONNECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-inspector-not-worker">ERR_INSPECTOR_NOT_WORKER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-internal-assertion">ERR_INTERNAL_ASSERTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-address-family">ERR_INVALID_ADDRESS_FAMILY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-arg-type">ERR_INVALID_ARG_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-arg-value">ERR_INVALID_ARG_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-async-id">ERR_INVALID_ASYNC_ID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-11">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-2">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-buffer-size">ERR_INVALID_BUFFER_SIZE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-char">ERR_INVALID_CHAR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-文件名包含非法字符">例子 1：文件名包含非法字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-url-包含非法字符">例子 2：URL 包含非法字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理方法">处理方法：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-cursor-pos">ERR_INVALID_CURSOR_POS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-1">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-3">如何处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-fd">ERR_INVALID_FD</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-fd-type">ERR_INVALID_FD_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-12">实际运用的例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-file-url-host">ERR_INVALID_FILE_URL_HOST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-file-url-path">ERR_INVALID_FILE_URL_PATH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-handle-type">ERR_INVALID_HANDLE_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-错误地使用定时器">例子 1：错误地使用定时器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-错误地操作流">例子 2：错误地操作流</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-http-token">ERR_INVALID_HTTP_TOKEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-ip-address">ERR_INVALID_IP_ADDRESS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-mime-syntax">ERR_INVALID_MIME_SYNTAX</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-设置-http-响应内容类型">示例 1: 设置 HTTP 响应内容类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-使用-mime-类型解析库">示例 2: 使用 MIME 类型解析库</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-4">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-module">ERR_INVALID_MODULE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-模块文件不存在">例子 1：模块文件不存在</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-语法错误">例子 2：语法错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-混淆模块系统">例子 3：混淆模块系统</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-module-specifier">ERR_INVALID_MODULE_SPECIFIER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-错误的文件路径">示例 1: 错误的文件路径</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-不支持的-url-协议">示例 2: 不支持的 URL 协议</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-3-相对路径问题">示例 3: 相对路径问题</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-object-define-property">ERR_INVALID_OBJECT_DEFINE_PROPERTY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#正确的使用方式">正确的使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误的使用方式导致-err-invalid-object-define-property">错误的使用方式导致 ERR_INVALID_OBJECT_DEFINE_PROPERTY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-package-config">ERR_INVALID_PACKAGE_CONFIG</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-package-target">ERR_INVALID_PACKAGE_TARGET</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-无效的文件路径">例子 1：无效的文件路径</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-违反模块封装原则">例子 2：违反模块封装原则</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-performance-mark">ERR_INVALID_PERFORMANCE_MARK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-protocol">ERR_INVALID_PROTOCOL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-repl-eval-config">ERR_INVALID_REPL_EVAL_CONFIG</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-repl-input">ERR_INVALID_REPL_INPUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-return-property">ERR_INVALID_RETURN_PROPERTY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-return-property-value">ERR_INVALID_RETURN_PROPERTY_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-return-value">ERR_INVALID_RETURN_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-state">ERR_INVALID_STATE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-sync-fork-input">ERR_INVALID_SYNC_FORK_INPUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-this">ERR_INVALID_THIS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-错误的-this-使用">例子 1：错误的 this 使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-类构造器中的错误-this-使用">例子 2：类构造器中的错误 this 使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-严格模式下误用-this">例子 3：严格模式下误用 this</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-tuple">ERR_INVALID_TUPLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-uri">ERR_INVALID_URI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-http-请求错误的-uri">例子 1：HTTP 请求错误的 URI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-url-模块解析错误的-uri">例子 2：URL 模块解析错误的 URI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-url">ERR_INVALID_URL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-url-scheme">ERR_INVALID_URL_SCHEME</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-ipc-channel-closed">ERR_IPC_CHANNEL_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-ipc-disconnected">ERR_IPC_DISCONNECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-ipc-one-pipe">ERR_IPC_ONE_PIPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-ipc-sync-fork">ERR_IPC_SYNC_FORK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-loader-chain-incomplete">ERR_LOADER_CHAIN_INCOMPLETE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-assert-integrity">ERR_MANIFEST_ASSERT_INTEGRITY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-dependency-missing">ERR_MANIFEST_DEPENDENCY_MISSING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-integrity-mismatch">ERR_MANIFEST_INTEGRITY_MISMATCH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-7">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理这个错误的方法">处理这个错误的方法：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-invalid-resource-field">ERR_MANIFEST_INVALID_RESOURCE_FIELD</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-invalid-specifier">ERR_MANIFEST_INVALID_SPECIFIER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-parse-policy">ERR_MANIFEST_PARSE_POLICY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-tdz">ERR_MANIFEST_TDZ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-manifest-unknown-onerror">ERR_MANIFEST_UNKNOWN_ONERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-memory-allocation-failed">ERR_MEMORY_ALLOCATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-message-target-context-unavailable">ERR_MESSAGE_TARGET_CONTEXT_UNAVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-method-not-implemented">ERR_METHOD_NOT_IMPLEMENTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-http-服务器响应方法未实现">例子 1：HTTP 服务器响应方法未实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-类中的方法未实现">例子 2：类中的方法未实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-args">ERR_MISSING_ARGS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-文件操作">实例 1: 文件操作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-http-服务器">实例 2: HTTP 服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-3-事件监听">实例 3: 事件监听</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-option">ERR_MISSING_OPTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例解释与示例">实例解释与示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-passphrase">ERR_MISSING_PASSPHRASE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-创建-https-服务器">例子 1：创建 HTTPS 服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-使用-crypto-模块加密数据">例子 2：使用 crypto 模块加密数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理这个错误">处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-platform-for-worker">ERR_MISSING_PLATFORM_FOR_WORKER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-module-not-found">ERR_MODULE_NOT_FOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-8">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-multiple-callback">ERR_MULTIPLE_CALLBACK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-文件读取错误">例子 1: 文件读取错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-错误的回调使用">例子 2: 错误的回调使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误处理建议">错误处理建议</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-cons-function">ERR_NAPI_CONS_FUNCTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-cons-function-1">ERR_NAPI_CONS_FUNCTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-invalid-dataview-args">ERR_NAPI_INVALID_DATAVIEW_ARGS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-invalid-typedarray-alignment">ERR_NAPI_INVALID_TYPEDARRAY_ALIGNMENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-invalid-typedarray-length">ERR_NAPI_INVALID_TYPEDARRAY_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-tsfn-call-js">ERR_NAPI_TSFN_CALL_JS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-tsfn-get-undefined">ERR_NAPI_TSFN_GET_UNDEFINED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-tsfn-start-idle-loop">ERR_NAPI_TSFN_START_IDLE_LOOP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-tsfn-stop-idle-loop">ERR_NAPI_TSFN_STOP_IDLE_LOOP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-not-building-snapshot">ERR_NOT_BUILDING_SNAPSHOT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-not-in-single-executable-application">ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-not-supported-in-snapshot">ERR_NOT_SUPPORTED_IN_SNAPSHOT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-no-crypto">ERR_NO_CRYPTO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-no-icu">ERR_NO_ICU</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-non-context-aware-disabled">ERR_NON_CONTEXT_AWARE_DISABLED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#上下文感知原生模块是什么">上下文感知原生模块是什么？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会禁用非上下文感知的原生模块">为什么会禁用非上下文感知的原生模块？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误-1">如何解决这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例">实例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-out-of-range">ERR_OUT_OF_RANGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1">例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-package-import-not-defined">ERR_PACKAGE_IMPORT_NOT_DEFINED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-错误的导入">示例 1：错误的导入</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-修复错误">示例 2：修复错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-package-path-not-exported">ERR_PACKAGE_PATH_NOT_EXPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-parse-args-invalid-option-value">ERR_PARSE_ARGS_INVALID_OPTION_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-错误的布尔标志">实例 1：错误的布尔标志</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-错误的数字选项">实例 2：错误的数字选项</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-3-超出范围的值">实例 3：超出范围的值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-4">如何处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-parse-args-unexpected-positional">ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#正确的参数使用方式">正确的参数使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#导致错误的情况">导致错误的情况</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何修复错误">如何修复错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-parse-args-unknown-option">ERR_PARSE_ARGS_UNKNOWN_OPTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-performance-invalid-timestamp">ERR_PERFORMANCE_INVALID_TIMESTAMP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#正确使用时间戳的例子">正确使用时间戳的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#导致err-performance-invalid-timestamp的例子">导致ERR_PERFORMANCE_INVALID_TIMESTAMP的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误-3">如何避免这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-performance-measure-invalid-options">ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-proto-access">ERR_PROTO_ACCESS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-require-esm">ERR_REQUIRE_ESM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-err-require-esm-错误">什么是 [ERR_REQUIRE_ESM] 错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会出现这个错误">为什么会出现这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误-2">如何解决这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-9">实际例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-script-execution-interrupted">ERR_SCRIPT_EXECUTION_INTERRUPTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-script-execution-timeout">ERR_SCRIPT_EXECUTION_TIMEOUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-http-请求超时">例子 1：HTTP 请求超时</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-自定义脚本超时">例子 2：自定义脚本超时</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-server-already-listen">ERR_SERVER_ALREADY_LISTEN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-server-not-running">ERR_SERVER_NOT_RUNNING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-关闭一个未启动的服务器">示例 1：关闭一个未启动的服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-重复关闭一个已经关闭的服务器">示例 2：重复关闭一个已经关闭的服务器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-single-executable-application-asset-not-found">ERR_SINGLE_EXECUTABLE_APPLICATION_ASSET_NOT_FOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-already-bound">ERR_SOCKET_ALREADY_BOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-bad-buffer-size">ERR_SOCKET_BAD_BUFFER_SIZE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-创建-tcp-服务器和客户端">示例 1：创建 TCP 服务器和客户端</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-设置-udp-套接字的缓冲区">示例 2：设置 UDP 套接字的缓冲区</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-bad-port">ERR_SOCKET_BAD_PORT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例说明">实例说明</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-bad-type">ERR_SOCKET_BAD_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-错误地使用-tcp-socket">例子 1：错误地使用 TCP Socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-在-http-服务器中使用非法的-socket-类型">例子 2：在 HTTP 服务器中使用非法的 socket 类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误-3">如何解决这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-buffer-size">ERR_SOCKET_BUFFER_SIZE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-14">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-closed">ERR_SOCKET_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-tcp-服务器和客户端">示例 1：TCP 服务器和客户端</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-http-服务器请求">示例 2：HTTP 服务器请求</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-closed-before-connection">ERR_SOCKET_CLOSED_BEFORE_CONNECTION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-http-客户端请求">示例 1: HTTP 客户端请求</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-websocket-连接">示例 2: WebSocket 连接</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理错误-1">处理错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-connection-timeout">ERR_SOCKET_CONNECTION_TIMEOUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-1-http-请求">实例 1: HTTP 请求</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例-2-tcp-客户端">实例 2: TCP 客户端</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-dgram-is-connected">ERR_SOCKET_DGRAM_IS_CONNECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-dgram-not-connected">ERR_SOCKET_DGRAM_NOT_CONNECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-未连接时发送数据">示例 1：未连接时发送数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-正确使用-connect-方法">示例 2：正确使用 connect() 方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-dgram-not-running">ERR_SOCKET_DGRAM_NOT_RUNNING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#发生场景">发生场景：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1">示例：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-1">结论：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-sri-parse">ERR_SRI_PARSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-already-finished">ERR_STREAM_ALREADY_FINISHED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-cannot-pipe">ERR_STREAM_CANNOT_PIPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-destroyed">ERR_STREAM_DESTROYED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#可写流示例">可写流示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#可读流示例">可读流示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免err-stream-destroyed错误">如何避免ERR_STREAM_DESTROYED错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-null-values">ERR_STREAM_NULL_VALUES</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-写入流中不接受-null-值">示例 1：写入流中不接受 null 值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-正确使用-objectmode-接受-null-值">示例 2：正确使用 objectMode 接受 null 值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-premature-close">ERR_STREAM_PREMATURE_CLOSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-写入流中的错误">示例 1：写入流中的错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-2-读取流中的错误">示例 2：读取流中的错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结和解决方案">总结和解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-push-after-eof">ERR_STREAM_PUSH_AFTER_EOF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-unshift-after-end-event">ERR_STREAM_UNSHIFT_AFTER_END_EVENT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-wrap">ERR_STREAM_WRAP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-write-after-end">ERR_STREAM_WRITE_AFTER_END</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-synthetic">ERR_SYNTHETIC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#详细解释">详细解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-system-error">ERR_SYSTEM_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-err-system-error">什么是 ERR_SYSTEM_ERROR？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-system-error-的原因">ERR_SYSTEM_ERROR 的原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-15">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理-err-system-error">处理 ERR_SYSTEM_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tap-lexer-error">ERR_TAP_LEXER_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tap-parser-error">ERR_TAP_PARSER_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tap-validation-error">ERR_TAP_VALIDATION_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-test-failure">ERR_TEST_FAILURE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-alpn-callback-invalid-result">ERR_TLS_ALPN_CALLBACK_INVALID_RESULT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-alpn-callback-with-protocols">ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls">TLS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#alpn">ALPN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-alpn-callback-with-protocols错误">ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用">实际运用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-cert-altname-format">ERR_TLS_CERT_ALTNAME_FORMAT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-cert-altname-invalid">ERR_TLS_CERT_ALTNAME_INVALID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-16">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#原因">原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-5">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-dh-param-size">ERR_TLS_DH_PARAM_SIZE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-handshake-timeout">ERR_TLS_HANDSHAKE_TIMEOUT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-invalid-context">ERR_TLS_INVALID_CONTEXT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-17">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-invalid-protocol-method">ERR_TLS_INVALID_PROTOCOL_METHOD</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-invalid-protocol-version">ERR_TLS_INVALID_PROTOCOL_VERSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-invalid-state">ERR_TLS_INVALID_STATE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-protocol-version-conflict">ERR_TLS_PROTOCOL_VERSION_CONFLICT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-psk-set-identiy-hint-failed">ERR_TLS_PSK_SET_IDENTIY_HINT_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-renegotiation-disabled">ERR_TLS_RENEGOTIATION_DISABLED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-required-server-name">ERR_TLS_REQUIRED_SERVER_NAME</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-session-attack">ERR_TLS_SESSION_ATTACK</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-sni-from-server">ERR_TLS_SNI_FROM_SERVER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-trace-events-category-required">ERR_TRACE_EVENTS_CATEGORY_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-trace-events-unavailable">ERR_TRACE_EVENTS_UNAVAILABLE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误概述">错误概述</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是跟踪事件">什么是跟踪事件？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#出现err-trace-events-unavailable的原因">出现ERR_TRACE_EVENTS_UNAVAILABLE的原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何正常使用跟踪事件">如何正常使用跟踪事件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-10">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#应对错误">应对错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-transform-already-transforming">ERR_TRANSFORM_ALREADY_TRANSFORMING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-transform-with-length-0">ERR_TRANSFORM_WITH_LENGTH_0</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tty-init-failed">ERR_TTY_INIT_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unavailable-during-exit">ERR_UNAVAILABLE_DURING_EXIT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例-1-尝试在退出时设置一个计时器">示例 1：尝试在退出时设置一个计时器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unescaped-characters">ERR_UNESCAPED_CHARACTERS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-url-中的非法字符">例子 1：URL 中的非法字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-http-请求头中的非法字符">例子 2：HTTP 请求头中的非法字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3-文件路径中的非法字符">例子 3：文件路径中的非法字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unhandled-error">ERR_UNHANDLED_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-builtin-module">ERR_UNKNOWN_BUILTIN_MODULE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-credential">ERR_UNKNOWN_CREDENTIAL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-encoding">ERR_UNKNOWN_ENCODING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是编码">什么是编码？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会出现err-unknown-encoding错误">为什么会出现ERR_UNKNOWN_ENCODING错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-11">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-3">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-file-extension">ERR_UNKNOWN_FILE_EXTENSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-module-format">ERR_UNKNOWN_MODULE_FORMAT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-module-format错误的含义">ERR_UNKNOWN_MODULE_FORMAT错误的含义</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-18">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误-4">如何解决这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-signal">ERR_UNKNOWN_SIGNAL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-19">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这种错误">如何处理这种错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unsupported-dir-import">ERR_UNSUPPORTED_DIR_IMPORT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-1">解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-20">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-4">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unsupported-esm-url-scheme">ERR_UNSUPPORTED_ESM_URL_SCHEME</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-21">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unsupported-resolve-request">ERR_UNSUPPORTED_RESOLVE_REQUEST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景">背景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unsupported-resolve-request-错误出现的场景">ERR_UNSUPPORTED_RESOLVE_REQUEST 错误出现的场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-2">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-1">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-use-after-close">ERR_USE_AFTER_CLOSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-3">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#避免该错误">避免该错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-valid-performance-entry-type">ERR_VALID_PERFORMANCE_ENTRY_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#performance-api-简介">Performance API 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-valid-performance-entry-type-错误">ERR_VALID_PERFORMANCE_ENTRY_TYPE 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-12">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#小结">小结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-dynamic-import-callback-missing-flag">ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基础知识">基础知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误解释">错误解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-13">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-6">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-2">结论</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-dynamic-import-callback-missing">ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景知识">背景知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-dynamic-import-callback-missing错误">ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#示例场景">示例场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免该错误">如何避免该错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结语">结语</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-already-linked">ERR_VM_MODULE_ALREADY_LINKED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#es-modules-esm">ES Modules（ESM）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#virtual-machine-vm-模块">Virtual Machine（VM）模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#链接-linking">链接（Linking）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-already-linked-错误">ERR_VM_MODULE_ALREADY_LINKED 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-14">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-cached-data-rejected">ERR_VM_MODULE_CACHED_DATA_REJECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-vm-模块">什么是 VM 模块？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#缓存编译过的模块">缓存编译过的模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误-err-vm-module-cached-data-rejected">错误：ERR_VM_MODULE_CACHED_DATA_REJECTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-22">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-cannot-create-cached-data">ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-node-js-简介">1. Node.js 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-vm-模块简介">2. VM 模块简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-缓存数据简介">3. 缓存数据简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误解释-err-vm-module-cannot-create-cached-data">错误解释：ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-4">实际运用例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-5">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-different-context">ERR_VM_MODULE_DIFFERENT_CONTEXT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-简介">Node.js 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vm-模块和上下文-context">VM 模块和上下文（Context）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释err-vm-module-different-context">解释ERR_VM_MODULE_DIFFERENT_CONTEXT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实例演示-1">实例演示</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-3">结论</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-link-failure">ERR_VM_MODULE_LINK_FAILURE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vm-模块">VM 模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#es-modules-esm-1">ES Modules（ESM）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-link-failure错误">ERR_VM_MODULE_LINK_FAILURE错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-15">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理建议">处理建议</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-not-module">ERR_VM_MODULE_NOT_MODULE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-2">解释：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-23">实际运用的例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-2">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-status">ERR_VM_MODULE_STATUS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#简介">简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vm-模块-1">VM 模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#es-modules">ES Modules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-status-错误">ERR_VM_MODULE_STATUS 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-5">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-6">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-wasi-already-started">ERR_WASI_ALREADY_STARTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用示例-1">实际运用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-wasi-not-started">ERR_WASI_NOT_STARTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-webassembly-response">ERR_WEBASSEMBLY_RESPONSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基础知识-1">基础知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-webassembly-response错误">ERR_WEBASSEMBLY_RESPONSE错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-6">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决办法-1">解决办法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-init-failed">ERR_WORKER_INIT_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-node-js">什么是 Node.js？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-中的-worker-threads">Node.js 中的 Worker Threads</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-worker-init-failed">什么是ERR_WORKER_INIT_FAILED?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-24">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-5">如何处理这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-invalid-exec-argv">ERR_WORKER_INVALID_EXEC_ARGV</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-3">解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际应用的例子">实际应用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-3">如何解决</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-not-running">ERR_WORKER_NOT_RUNNING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-node-js-1">什么是 Node.js?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-worker-threads">什么是 Worker Threads?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-not-running-错误解释">ERR_WORKER_NOT_RUNNING 错误解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用示例-2">实际运用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-4">结论</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-out-of-memory">ERR_WORKER_OUT_OF_MEMORY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-path">ERR_WORKER_PATH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-16">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-unserializable-error">ERR_WORKER_UNSERIALIZABLE_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2">例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方案">解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-unsupported-operation">ERR_WORKER_UNSUPPORTED_OPERATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解-err-worker-unsupported-operation">理解 ERR_WORKER_UNSUPPORTED_OPERATION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-25">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#应对策略">应对策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-zlib-initialization-failed">ERR_ZLIB_INITIALIZATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-zlib">什么是 zlib?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-zlib-initialization-failed-1">ERR_ZLIB_INITIALIZATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-26">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hpe-header-overflow">HPE_HEADER_OVERFLOW</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-协议基础">HTTP 协议基础</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-和-http">Node.js 和 HTTP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#头部溢出-header-overflow">头部溢出（Header Overflow）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么有这个错误">为什么有这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-7">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决或避免这个错误">如何解决或避免这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hpe-chunk-extensions-overflow">HPE_CHUNK_EXTENSIONS_OVERFLOW</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-协议基础-1">HTTP 协议基础</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-和-http-1">Node.js 和 HTTP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hpe-chunk-extensions-overflow-错误">HPE_CHUNK_EXTENSIONS_OVERFLOW 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#应对策略-1">应对策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hpe-unexpected-content-length">HPE_UNEXPECTED_CONTENT_LENGTH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-4">解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-27">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-6">如何处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#module-not-found">MODULE_NOT_FOUND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-17">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-7">解决方法</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#legacy-node-js-error-codes">Legacy Node.js error codes</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-legacy-node-js-error-codes">什么是 Legacy Node.js Error Codes?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么需要了解它们">为什么需要了解它们？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-28">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-cannot-transfer-object">ERR_CANNOT_TRANSFER_OBJECT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-cannot-transfer-object">什么是ERR_CANNOT_TRANSFER_OBJECT？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-18">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-8">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-crypto-hash-digest-no-utf16">ERR_CRYPTO_HASH_DIGEST_NO_UTF16</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会有这样的限制">为什么会有这样的限制？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际的运用例子">实际的运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方案-1">解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-frame-error">ERR_HTTP2_FRAME_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-2-简介">HTTP/2 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#关于-err-http2-frame-error">关于 ERR_HTTP2_FRAME_ERROR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-9">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-5">结论</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-headers-object">ERR_HTTP2_HEADERS_OBJECT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景知识-1">背景知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-headers-object-错误">ERR_HTTP2_HEADERS_OBJECT 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-10">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误-4">如何避免这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-header-required">ERR_HTTP2_HEADER_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解-http-2-和头部">理解 HTTP/2 和头部</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会发生-err-http2-header-required-错误">为什么会发生 ERR_HTTP2_HEADER_REQUIRED 错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-29">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方案-2">解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-info-headers-after-respond">ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-2-简介-1">HTTP/2 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#信息头-info-headers">信息头（INFO HEADERS）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-info-headers-after-respond-错误">ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-9">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-stream-closed">ERR_HTTP2_STREAM_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-http-2-1">什么是 HTTP/2？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http2-stream-closed-错误">ERR_HTTP2_STREAM_CLOSED 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用示例-3">实际运用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-4">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-http-invalid-char">ERR_HTTP_INVALID_CHAR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-http-invalid-char">什么是ERR_HTTP_INVALID_CHAR？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#http-头部中允许的字符">HTTP 头部中允许的字符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-11">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#小结-1">小结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-index-out-of-range">ERR_INDEX_OUT_OF_RANGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-1-buffer-操作">例子 1：Buffer 操作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-2-typedarray-操作">例子 2：TypedArray 操作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理此错误">处理此错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-opt-value">ERR_INVALID_OPT_VALUE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-err-invalid-opt-value-错误">解释 ERR_INVALID_OPT_VALUE 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-31">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-7">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-opt-value-encoding">ERR_INVALID_OPT_VALUE_ENCODING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基础概念">基础概念</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-opt-value-encoding-错误">ERR_INVALID_OPT_VALUE_ENCODING 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-19">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-8">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-invalid-transfer-object">ERR_INVALID_TRANSFER_OBJECT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-20">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-9">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-assertion-type-failed">ERR_IMPORT_ASSERTION_TYPE_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际应用示例">实际应用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#另一个例子-导入-css-作为构造样式表">另一个例子：导入 CSS 作为构造样式表</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#小结-2">小结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-assertion-type-missing">ERR_IMPORT_ASSERTION_TYPE_MISSING</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-esm">什么是 ESM？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#导入断言是什么">导入断言是什么？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-assertion-type-missing-解释">ERR_IMPORT_ASSERTION_TYPE_MISSING 解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-21">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-import-assertion-type-unsupported">ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误解释-1">错误解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#导入断言是什么-1">导入断言是什么？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-12">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-10">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-10">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-message-port-in-transfer-list">ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-32">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-missing-transferable-in-transfer-list">ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-cons-prototype-object">ERR_NAPI_CONS_PROTOTYPE_OBJECT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景知识-2">背景知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-napi-cons-prototype-object错误">ERR_NAPI_CONS_PROTOTYPE_OBJECT错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-33">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-network-import-bad-response">ERR_NETWORK_IMPORT_BAD_RESPONSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-34">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决这个错误-5">如何解决这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-network-import-disallowed">ERR_NETWORK_IMPORT_DISALLOWED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-5">解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-35">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-5">如何解决</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-no-longer-supported">ERR_NO_LONGER_SUPPORTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-operation-failed">ERR_OPERATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-36">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-outofmemory">ERR_OUTOFMEMORY</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-37">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-11">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-parse-history-data">ERR_PARSE_HISTORY_DATA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-err-parse-history-data">解释 ERR_PARSE_HISTORY_DATA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-13">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-cannot-send">ERR_SOCKET_CANNOT_SEND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基本概念-1">基本概念</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-socket-cannot-send-1">ERR_SOCKET_CANNOT_SEND</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-38">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理方法-1">处理方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stderr-close">ERR_STDERR_CLOSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误代码-err-stderr-close">错误代码：ERR_STDERR_CLOSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-7">如何处理这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stdout-close">ERR_STDOUT_CLOSE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-stdout-close错误">什么是ERR_STDOUT_CLOSE错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用例子-14">实际运用例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-8">如何处理这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-12">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-stream-read-not-implemented">ERR_STREAM_READ_NOT_IMPLEMENTED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-renegotiation-failed">ERR_TLS_RENEGOTIATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-和重新协商的基础">TLS 和重新协商的基础</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-tls-renegotiation-failed-1">ERR_TLS_RENEGOTIATION_FAILED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际应用示例-1">实际应用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理方式">处理方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-transferring-externalized-sharedarraybuffer">ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-简介-1">Node.js 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sharedarraybuffer-简介">SharedArrayBuffer 简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误-err-transferring-externalized-sharedarraybuffer">错误：ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方法-11">解决方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-stdin-type">ERR_UNKNOWN_STDIN_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#标准输入-stdin">标准输入（stdin）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么会出现err-unknown-stdin-type错误">为什么会出现ERR_UNKNOWN_STDIN_TYPE错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-22">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-6">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#小结-3">小结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-unknown-stream-type">ERR_UNKNOWN_STREAM_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#流的类型">流的类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释-err-unknown-stream-type">解释 ERR_UNKNOWN_STREAM_TYPE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-39">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-v8breakiterator">ERR_V8BREAKITERATOR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释err-v8breakiterator错误">解释ERR_V8BREAKITERATOR错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-40">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何解决-7">如何解决？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-value-out-of-range">ERR_VALUE_OUT_OF_RANGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解err-value-out-of-range">理解ERR_VALUE_OUT_OF_RANGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-23">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理">如何处理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-not-linked">ERR_VM_MODULE_NOT_LINKED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-not-linked-错误">[ERR_VM_MODULE_NOT_LINKED] 错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-vm-module-linking-errored">ERR_VM_MODULE_LINKING_ERRORED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基本概念-2">基本概念</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是err-vm-module-linking-errored错误">什么是ERR_VM_MODULE_LINKING_ERRORED错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用的例子-41">实际运用的例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-6">结论</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-worker-unsupported-extension">ERR_WORKER_UNSUPPORTED_EXTENSION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-workers">Node.js Workers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误解释-2">错误解释</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际例子-24">实际例子</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何避免这个错误-5">如何避免这个错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-zlib-binding-closed">ERR_ZLIB_BINDING_CLOSED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解zlib">理解zlib</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-zlib-binding-closed错误">ERR_ZLIB_BINDING_CLOSED错误</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#实际运用示例-4">实际运用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解决方案-3">解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结-13">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#err-cpu-usage">ERR_CPU_USAGE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是-err-cpu-usage-错误">什么是 ERR_CPU_USAGE 错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#错误产生的场景">错误产生的场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#例子-3">例子：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如何处理这个错误-9">如何处理这个错误？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#结论-7">结论</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="errors" tabindex="-1"><a class="header-anchor" href="#errors"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errors" target="_blank" rel="noopener noreferrer">Errors</a></span></a></h1><p>Node.js 中的错误（Errors）处理是编程中非常重要的部分，因为它能帮助你理解哪些地方出了问题，并且如何去修复这些问题。在 Node.js v21.7.1 中，错误处理遵循一些基本原则和模式。</p><p>首先，让我们了解什么是错误（Error）。在编程中，错误通常指的是程序运行时出现的问题，比如尝试读取一个不存在的文件，或是尝试调用一个未定义的函数等。这些情况会导致程序抛出（throw）一个错误，如果这个错误没有被妥善处理（catch），程序可能就会崩溃（crash）。</p><p>Node.js 里的错误大体可以分为以下几类：</p><ol><li><strong>标准的 JavaScript 错误</strong>: 如 <code>SyntaxError</code>, <code>ReferenceError</code> 和 <code>TypeError</code> 等。</li><li><strong>系统错误</strong>: 这类错误通常是由底层操作系统触发的，比如试图打开一个不存在的文件时会产生一个 <code>ENOENT</code> 错误。</li><li><strong>用户自定义的错误</strong>: 开发者可以创建自己的错误类型，以满足特定程序的需求。</li><li><strong>断言错误</strong>: 当 Node.js 的 <code>assert</code> 模块中的一个断言失败时，会抛出这种类型的错误。</li></ol><h3 id="实际例子" tabindex="-1"><a class="header-anchor" href="#实际例子"><span>实际例子</span></a></h3><h4 id="_1-标准的-javascript-错误" tabindex="-1"><a class="header-anchor" href="#_1-标准的-javascript-错误"><span>1. 标准的 JavaScript 错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> addNumbers</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">x</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> y</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> x</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> ||</span><span style="color:#81A1C1;"> typeof</span><span style="color:#D8DEE9;"> y</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TypeError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Arguments must be numbers</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> x</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> y</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> addNumbers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">b</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 传入非数字类型参数</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: Arguments must be numbers</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们定义了一个简单的函数 <code>addNumbers</code> 来加两个数。如果传入的参数类型不正确，我们抛出一个 <code>TypeError</code>。我们用 <code>try...catch</code> 包裹函数调用来捕获并处理错误。</p><h4 id="_2-系统错误" tabindex="-1"><a class="header-anchor" href="#_2-系统错误"><span>2. 系统错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/non-existent-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ENOENT: no such file or directory, open &#39;/path/to/non-existent-file&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用 Node.js 的 <code>fs</code> 模块来异步读取一个文件。如果文件不存在，回调函数第一个参数 <code>err</code> 会包含一个系统错误对象。此处 <code>err.message</code> 包含了错误的具体信息。</p><h4 id="_3-用户自定义的错误" tabindex="-1"><a class="header-anchor" href="#_3-用户自定义的错误"><span>3. 用户自定义的错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> InvalidInputError</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Error</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">InvalidInputError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> processUserInput</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">input</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">expected input</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> InvalidInputError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Input is invalid</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 处理输入...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  processUserInput</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">wrong input</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;"> instanceof</span><span style="color:#D8DEE9FF;"> InvalidInputError) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Caught a user-defined error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们创建了一个名为 <code>InvalidInputError</code> 的自定义错误类，然后在 <code>processUserInput</code> 函数中抛出该错误。同样使用 <code>try...catch</code> 结构进行捕获。</p><h4 id="_4-断言错误" tabindex="-1"><a class="header-anchor" href="#_4-断言错误"><span>4. 断言错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> assert</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">assert</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> divide</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">x</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> y</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">notStrictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">y</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Divisor cannot be zero</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> x</span><span style="color:#81A1C1;"> /</span><span style="color:#D8DEE9;"> y</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> divide</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: Divisor cannot be zero</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们通过 <code>assert</code> 模块确保除数不为零。如果违反了断言，将会抛出一个断言错误，并通过 <code>try...catch</code> 捕获。</p><p>通过这些例子，你应该对 Node.js 中的错误有了初步的理解。重要的是学会如何合理地使用错误处理来增强你的程序的健壮性。记住，预防和处理错误是编写优质、稳定代码不可或缺的环节。</p><h2 id="error-propagation-and-interception" tabindex="-1"><a class="header-anchor" href="#error-propagation-and-interception"><span><a href="https://nodejs.org/docs/latest/api/errors.html#error-propagation-and-interception" target="_blank" rel="noopener noreferrer">Error propagation and interception</a></span></a></h2><p>在 Node.js 中，错误处理是一个关键的概念，因为它有助于创建可靠和健壮的应用程序。错误传播（Error propagation）和拦截（interception）是指在代码执行过程中如何处理错误：当程序遇到问题时，如何将错误信息“传播”出去，并且如何在合适的地方“拦截”这些错误并进行处理。</p><h3 id="错误传播-error-propagation" tabindex="-1"><a class="header-anchor" href="#错误传播-error-propagation"><span>错误传播 (Error Propagation)</span></a></h3><p>错误传播通常是指通过抛出（throwing）异常或返回错误值的方式，将错误从发生位置传递到可以处理它的代码区域。在同步代码中，你会使用 <code>throw</code> 关键字来抛出错误；而在异步代码中，则通过回调函数的第一个参数返回错误。</p><h4 id="同步代码中的错误传播示例" tabindex="-1"><a class="header-anchor" href="#同步代码中的错误传播示例"><span>同步代码中的错误传播示例：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> divide</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">b</span><span style="color:#81A1C1;"> ===</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cannot divide by zero</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> /</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> divide</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 拦截并处理错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果尝试除以零，函数 <code>divide</code> 就会抛出一个错误。这个错误需要被<code>try..catch</code>结构所捕获，否则程序就会崩溃。</p><h4 id="异步代码中的错误传播示例" tabindex="-1"><a class="header-anchor" href="#异步代码中的错误传播示例"><span>异步代码中的错误传播示例：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 拦截并处理错误</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 正常处理文件数据</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里使用了 Node.js 的内置 <code>fs</code> 模块来异步读取文件。如果出现错误（如文件不存在），错误对象 <code>err</code> 将非空，并在回调函数中首先被检查。</p><h3 id="错误拦截-error-interception" tabindex="-1"><a class="header-anchor" href="#错误拦截-error-interception"><span>错误拦截 (Error Interception)</span></a></h3><p>错误拦截是指实际处理错误的过程。在上述的同步代码示例中，我们用 <code>try..catch</code> 来拦截错误。在异步代码中，通常通过检查回调函数的第一个参数（通常命名为 <code>err</code>）来拦截错误。</p><p>还有一种拦截异步错误的方法是使用 Promises 和 async/await。Promises 支持 <code>.then()</code> 用于处理成功的结果，和 <code>.catch()</code> 用于拦截并处理错误。</p><h4 id="promises-示例" tabindex="-1"><a class="header-anchor" href="#promises-示例"><span>Promises 示例：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> promise</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 模拟一项异步操作</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> success</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">random</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 0.5</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">success</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Operation succeeded</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Operation failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">promise</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 处理成功结果</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 拦截并处理错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个 Promise 的示例中，我们基于一个随机条件决定是解决（<code>resolve</code>）Promise 还是拒绝（<code>reject</code>）它。如果操作失败，错误将被 <code>.catch()</code> 方法拦截并处理。</p><h4 id="async-await-示例" tabindex="-1"><a class="header-anchor" href="#async-await-示例"><span>async/await 示例：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> asyncFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> someAsyncOperation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这是一个返回Promise的函数</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 拦截并处理错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">asyncFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个 <code>async/await</code> 示例中，我们使用 <code>await</code> 关键字等待异步操作（返回 Promise 的函数）。如果这个异步操作失败，错误将由相关的 <code>catch</code> 代码块拦截。这使得异步代码看起来更像是同步代码，同时也便于理解和维护。</p><p>总结起来，Node.js 中的错误传播和拦截是确保代码优雅处理异常情况的重要机制，无论是在同步代码还是异步操作中。明白了这些概念后，你能够更好地编写出健壮、可靠的 Node.js 应用程序。</p><h2 id="class-error" tabindex="-1"><a class="header-anchor" href="#class-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-error" target="_blank" rel="noopener noreferrer">Class: Error</a></span></a></h2><p>在 Node.js 中，<code>Error</code> 是一个内置的类，用于表示程序中出现的错误。当 Node.js 运行时遇到问题时，例如尝试访问未定义的变量或执行无效操作时，它就会抛出一个错误（Error），这通常会导致程序停止执行，并提供错误信息帮助你定位问题。</p><p>以下是关于<code>Error</code>类的一些基本点：</p><ol><li><strong>创建错误</strong>: 你可以通过使用 <code>new Error(message)</code> 来创建一个错误对象，其中 <code>message</code> 是描述错误的字符串。</li><li><strong>捕获错误</strong>: 在 JavaScript 中通常使用 <code>try...catch</code> 语句来捕获和处理错误。</li><li><strong>错误属性</strong>: 错误对象有几个内置属性，最常用的包括： <ul><li><code>message</code>: 提供关于错误的详细信息的字符串。</li><li><code>stack</code>: 一个代表代码运行时调用堆栈的字符串，这对于调试是非常有用的。</li></ul></li></ol><p>让我们举几个例子来理解<code>Error</code>类的使用：</p><h3 id="示例-1-创建和抛出一个错误" tabindex="-1"><a class="header-anchor" href="#示例-1-创建和抛出一个错误"><span>示例 1：创建和抛出一个错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个错误对象但不立即抛出</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myError</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops! Something went wrong.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 当某个条件不满足时抛出错误</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">userLoggedIn</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#D8DEE9;"> myError</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将中断程序执行并显示错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="示例-2-捕获和处理错误" tabindex="-1"><a class="header-anchor" href="#示例-2-捕获和处理错误"><span>示例 2：捕获和处理错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试执行可能导致错误的代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">someInvalidJson</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 如果上面的代码抛出错误，控制流程将跳转到这里</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 可以在此处添加更多错误处理的代码</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="示例-3-自定义错误类型" tabindex="-1"><a class="header-anchor" href="#示例-3-自定义错误类型"><span>示例 3：自定义错误类型</span></a></h3><p>虽然<code>Error</code>类本身很有用，但有时你可能想要创建特定类型的错误。在 JavaScript 中，你可以通过扩展<code>Error</code>类来实现这一点。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ValidationError</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Error</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 调用父类的构造函数</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ValidationError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置错误名称</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用自定义错误</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> validateEmail</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">email</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">email</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">includes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">@</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ValidationError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Email must contain @ symbol.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  validateEmail</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">testexample.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;"> instanceof</span><span style="color:#D8DEE9FF;"> ValidationError) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 特定的错误处理逻辑</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Validation failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 其他类型错误的处理逻辑</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，我们创建了一个名为<code>ValidationError</code>的新类，它扩展了<code>Error</code>类。我们可以使用这个新的错误类型来提供更具体的错误消息，并且在<code>try...catch</code>块中，我们可以检测错误的类型并据此采取不同的处理策略。</p><p>总之，在 Node.js 和 JavaScript 编程中，了解如何使用<code>Error</code>类及其派生类是非常重要的，因为它能够帮助你开发健壮、易于调试的应用程序代码。</p><h3 id="new-error-message-options" tabindex="-1"><a class="header-anchor" href="#new-error-message-options"><span><a href="https://nodejs.org/docs/latest/api/errors.html#new-errormessage-options" target="_blank" rel="noopener noreferrer">new Error(message[, options])</a></span></a></h3><p>好的，我来给你解释一下 Node.js 中的 <code>new Error(message[, options])</code> 是如何工作的。</p><p>在编程中，错误处理是非常重要的一部分。它帮助我们了解程序中出现了什么问题，并且可以适当地做出反应。Node.js 中的 <code>Error</code> 对象是一个内置的对象类型，用于表示在程序执行过程中发生的错误。</p><p>当你创建一个 <code>Error</code> 对象时，可以传入一个字符串 <code>message</code> 作为错误信息，这个信息通常会描述发生了什么错误。此外，从 Node.js v10.0.0 开始，你还可以传入一个 <code>options</code> 对象，用于提供更多有关错误的信息。</p><p>让我们来看几个例子：</p><p><strong>例子 1：简单的错误创建</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个错误对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myError</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops! Something went wrong.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 输出错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myError</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &quot;Oops! Something went wrong.&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个新的错误对象，并给它传递了一个描述性的消息 <code>&#39;Oops! Something went wrong.&#39;</code>，然后我们把这个错误消息打印到控制台上。</p><p><strong>例子 2：使用错误选项参数</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个带有选项的错误对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myDetailedError</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid user input</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  cause</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">User entered a negative number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 输出错误信息以及错误原因</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myDetailedError</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &quot;Invalid user input&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myDetailedError</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cause</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &quot;User entered a negative number&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在第二个例子中，我们不仅仅传递了一个错误消息，还通过 <code>options</code> 对象传递了一个 <code>cause</code> 属性，它提供了导致错误的具体原因：用户输入了一个负数。这样我们就能提供更详细的错误信息，对于调试和错误处理来说非常有用。</p><p><strong>例子 3：捕获并处理错误</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里有一些可能会抛出错误的代码</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to connect to database</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 错误被捕获，并进行处理</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用了 <code>try...catch</code> 语句，这是处理错误的常见方法。在 <code>try</code> 块中，如果发生任何错误（在这里我们人为地通过 <code>throw</code> 关键字抛出了一个错误），它会被 <code>catch</code> 块捕获。然后我们可以在 <code>catch</code> 块中处理错误，比如打印一个错误日志。</p><p>总结一下，<code>new Error(message[, options])</code> 在 Node.js 中是用来创建一个包含错误信息的对象，你可以为它提供一个描述性的消息，也可以提供选项来包含更多的错误上下文。这有助于开发者理解和处理程序中的异常情况。</p><h3 id="error-capturestacktrace-targetobject-constructoropt" tabindex="-1"><a class="header-anchor" href="#error-capturestacktrace-targetobject-constructoropt"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorcapturestacktracetargetobject-constructoropt" target="_blank" rel="noopener noreferrer">Error.captureStackTrace(targetObject[, constructorOpt])</a></span></a></h3><p><code>Error.captureStackTrace(targetObject[, constructorOpt])</code> 是 Node.js 中的一个方法，用于为目标对象创建 <code>.stack</code> 属性，这个属性包含了一个字符串表示的堆栈追踪。这个方法通常用于自定义错误类型的时候，让开发者能够获取到错误发生时的函数调用栈信息。</p><p>解释一下什么是“堆栈追踪”（Stack Trace）：当程序出错或者抛出异常时，堆栈追踪会显示出错点以及导致错误的函数调用序列。这有助于开发者快速定位问题所在，因为它显示了代码在出错时正在执行的路径。</p><p>参数说明：</p><ul><li><code>targetObject</code>: 这是将要被添加 <code>.stack</code> 属性的对象。</li><li><code>constructorOpt</code> (可选): 如果提供这个参数，堆栈追踪会从这个构造函数开始记录，而不是从 <code>Error.captureStackTrace</code> 函数开始。这样可以去除堆栈中与错误创建无关的部分。</li></ul><p>实际运用的例子：</p><p>假设你正在创建一个自定义错误类型，比如一个叫 <code>MyCustomError</code> 的类，你希望每当这个错误被创建时，它都能够捕获当前的堆栈追踪信息。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyCustomError</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Error</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 设置该错误的名称为自定义的错误名</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">MyCustomError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 捕获堆栈追踪信息并存储到 .stack 属性</span></span>
<span class="line"><span style="color:#D8DEE9;">    Error</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">captureStackTrace</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> MyCustomError</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> problematicFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里发生了一些问题，并且我们需要抛出自定义错误</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyCustomError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Something went wrong!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试运行可能出错的函数</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  problematicFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 当错误被捕获时，可以看到 .stack 属性保存了错误发生时的堆栈信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，当 <code>problematicFunction</code> 抛出一个 <code>MyCustomError</code> 类型的错误时，通过 <code>Error.captureStackTrace</code> 方法，我们可以确保 <code>MyCustomError</code> 实例中拥有 <code>.stack</code> 属性，该属性包含了导致错误的函数调用序列。这样，在 <code>catch</code> 语句块中打印错误的堆栈信息 (<code>error.stack</code>) 可以帮助我们追踪错误产生的原因。</p><p>总结来说，<code>Error.captureStackTrace</code> 是一个非常有用的工具，它允许我们自定义错误处理过程中保留详细的调用栈信息，从而更容易地调试和理解代码中的错误。</p><h3 id="error-stacktracelimit" tabindex="-1"><a class="header-anchor" href="#error-stacktracelimit"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorstacktracelimit" target="_blank" rel="noopener noreferrer">Error.stackTraceLimit</a></span></a></h3><p>Node.js 中的 <code>Error.stackTraceLimit</code> 属性用于设置当一个错误发生时，错误堆栈追踪中可以显示的最大帧数。&quot;帧&quot;在这里指的是调用栈中的函数调用。</p><p>默认情况下，Node.js 会记录所有堆栈帧，但是这可能会产生很长的错误消息，并且可能包含一些不必要的信息。通过设置 <code>Error.stackTraceLimit</code>，你可以限制这些帧的数量。</p><p>例如，如果你将 <code>Error.stackTraceLimit</code> 设置为 <code>10</code>，那么当错误发生时，Node.js 就只会提供错误发生点的前 10 帧的信息。</p><p>来看一个例子：</p><p>假设你有一个函数调用的序列，它们依次互相调用，如 A 调用 B，B 调用 C，以此类推。如果在最内层的函数（比如 Z）出现了错误，那么错误堆栈通常会显示从 Z 一直回溯到 A 的所有函数调用。如果这个调用链非常长，可能会造成堆栈信息冗长难以阅读。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 默认情况下，stackTraceLimit 是无限的</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stackTraceLimit</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出 Infinity</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> functionA</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  functionB</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> functionB</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  functionC</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> functionC</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  functionA</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，如果 <code>functionC</code> 抛出一个错误，正常情况下你会在控制台上看到从 <code>functionC</code> 到 <code>functionA</code> 的完整调用堆栈。但如果你认为这些信息太多了，你可以设置 <code>Error.stackTraceLimit</code> 来限制堆栈帧数量。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 设置 stackTraceLimit 为 3</span></span>
<span class="line"><span style="color:#D8DEE9;">Error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stackTraceLimit</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 3</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  functionA</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将只显示最顶部的3个堆栈帧</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置之后，即使实际的调用堆栈可能非常深，错误信息也只会显示最近的 3 次函数调用。这样做可以让你更容易地查看和理解错误的原因，尤其是在处理复杂应用程序时。</p><p>需要注意的是，修改 <code>Error.stackTraceLimit</code> 会影响应用程序中所有错误的堆栈追踪输出，所以请根据实际需求慎重设置该值。</p><h3 id="error-cause" tabindex="-1"><a class="header-anchor" href="#error-cause"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorcause" target="_blank" rel="noopener noreferrer">error.cause</a></span></a></h3><p>当然可以为您解释 Node.js v21.7.1 中的 <code>error.cause</code> 特性。</p><p>在 JavaScript 编程中，错误处理是一个重要的部分，它让我们能够理解程序中什么地方出了问题，并且能够有策略地处理这些问题。通常情况下，当程序遇到错误时，会抛出（throw）一个错误对象（Error object），这个错误对象包含了描述错误的消息以及其他有用的信息。</p><p><code>error.cause</code> 是 Node.js 在错误(Error)对象中引入的一个属性，它提供了一种方式来存储和传递关于错误原因的额外信息。这使得开发者能够更容易地追踪和调试错误链，尤其是在多层错误处理的情况下。</p><p>在没有 <code>error.cause</code> 的情况下，如果你想要捕捉一个错误，并且创建一个新的错误来代替原来的错误，而又不想丢失原来错误的上下文信息，你往往不得不自己手动管理这些信息。</p><p>现在，具体来看 <code>error.cause</code> 的使用方法：</p><h3 id="例子-1-创建带有原因的错误" tabindex="-1"><a class="header-anchor" href="#例子-1-创建带有原因的错误"><span>例子 1：创建带有原因的错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> performCalculation</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 这里是可能会抛出错误的代码</span></span>
<span class="line"><span style="color:#616E88;">    // 例如，尝试除以零:</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1</span><span style="color:#81A1C1;"> /</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#88C0D0;">isFinite</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Attempt to divide by zero</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 抛出一个新的错误，并附带原始错误的信息（作为原因）</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Calculation failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> cause</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  performCalculation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印新的错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cause</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印原始错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果在 <code>performCalculation</code> 函数内部发生错误（比如除以零），我们首先捕获这个错误，然后抛出一个新的错误并将原始错误作为原因传递给新错误。</p><h3 id="例子-2-在异步操作中使用-error-cause" tabindex="-1"><a class="header-anchor" href="#例子-2-在异步操作中使用-error-cause"><span>例子 2：在异步操作中使用 <code>error.cause</code></span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs/promises</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> readFileContent</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> content</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> content</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果读取文件失败，则抛出新的错误，同时保留导致失败的原因</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Failed to read the file: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">filename</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> cause</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> run</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> readFileContent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistent.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印新的错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cause</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印原始引起错误的异常对象</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">run</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果尝试读取文件时出现错误（例如文件不存在），我们将捕获这个错误，并且抛出一个包含原始错误的新错误。</p><p>通过使用 <code>error.cause</code>，我们可以更简洁有力地处理和转发错误，同时也保留了原始错误的所有相关信息，使得后续的调试和错误跟踪变得更加容易。这对于构建健壮和可维护的 Node.js 应用程序非常有用。</p><h3 id="error-code" tabindex="-1"><a class="header-anchor" href="#error-code"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorcode" target="_blank" rel="noopener noreferrer">error.code</a></span></a></h3><p><code>error.code</code> 在 Node.js 中是一个非常重要的属性，它存在于 Error 对象上。在 Node.js 里，当发生错误时，通常会创建一个 Error 对象来表示这个错误。这个对象包含了几个描述错误的属性，其中 <code>error.code</code> 就是用来表示具体的错误代码。</p><p><code>error.code</code> 的主要作用是提供一个更精确的错误类型，用于识别错误的原因，并根据不同的错误代码执行不同的处理逻辑。每一个 <code>error.code</code> 都对应了一个特定的字符串值，这个值通常是大写字母和下划线组成的，非常容易识别。</p><p>几个常见的 <code>error.code</code> 示例：</p><ol><li><p><code>ENOENT</code>: 这个错误码代表 &quot;No such file or directory&quot;（没有这样的文件或目录）。这通常在尝试读取、写入或操作一个不存在的文件或目录时发生。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 检查错误码</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ENOENT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件不存在</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>EACCES</code>: 这个错误码代表 &quot;Permission denied&quot;（权限被拒绝）。如果你尝试访问你没有权限的文件或目录，就会出现这种错误。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/protected/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 检查错误码</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EACCES</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">没有写入权限</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件写入成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>ECONNRESET</code>: 这个错误码代表 &quot;Connection reset by peer&quot;（连接被对端重置）。在网络编程中，如果远程对端突然关闭了连接，你会遇到这个错误。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> request</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 检查错误码</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECONNRESET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">连接被对方重置</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>通过检查 <code>error.code</code>，你可以为用户提供更有针对性的错误信息，也可以决定程序是否需要重试操作、记录日志、抛出异常等。</p><p>了解和使用 <code>error.code</code> 可以帮助你编写更健壮、更易于调试的 Node.js 应用程序。记住，错误处理是编程中的重要部分，而合理地使用 <code>error.code</code> 是掌握好错误处理的关键之一。</p><h3 id="error-message" tabindex="-1"><a class="header-anchor" href="#error-message"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errormessage" target="_blank" rel="noopener noreferrer">error.message</a></span></a></h3><p>在 Node.js 中，<code>error.message</code>是错误对象的一个属性，它提供了关于错误的详细描述。当你在代码中遇到问题时，Node.js 会生成一个 Error 对象，这个对象包含了一些用来诊断问题的信息，比如错误消息（<code>message</code>）、错误类型（<code>name</code>）和堆栈追踪（<code>stack</code>）。</p><h3 id="错误对象-error-object" tabindex="-1"><a class="header-anchor" href="#错误对象-error-object"><span>错误对象 (Error object)</span></a></h3><p>JavaScript 中的标准错误对象有几种不同的形式，最常见的包括 <code>Error</code>, <code>SyntaxError</code>, <code>ReferenceError</code>, 和其他一些内置的错误类型。每种错误类型都可以提供自定义的错误消息。下面是创建自定义错误对象并设置其消息的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个普通的错误对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">出现了一个错误！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: 出现了一个错误！</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这行代码中，<code>new Error(&#39;出现了一个错误！&#39;)</code> 创建了一个新的错误对象，并将 <code>&#39;出现了一个错误！&#39;</code> 这个字符串作为错误消息传递给这个对象。然后，我们通过访问 <code>error.message</code> 来打印出这个错误消息。</p><h3 id="实际运用示例" tabindex="-1"><a class="header-anchor" href="#实际运用示例"><span>实际运用示例</span></a></h3><ol><li><p><strong>文件读取错误处理</strong></p><p>当你尝试读取一个不存在的文件时，Node.js 将提供一个包含错误消息的错误对象：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">不存在的文件.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ENOENT: no such file or directory, open &#39;不存在的文件.txt&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果读取文件失败，回调函数的第一个参数<code>err</code>将是一个错误对象。通过检查这个对象的<code>message</code>属性，你能够得知发生了什么错误，例如文件不存在。</p></li><li><p><strong>网络请求错误处理</strong></p><p>当你使用 Node.js 发送 HTTP 请求时，如果遇到问题（例如连接失败），你将接收到一个错误对象：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://不存在的网址.com/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理响应...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出错误消息，例如：getaddrinfo ENOTFOUND 不存在的网址.com</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，如果请求失败，<code>.on(&#39;error&#39;, ...)</code> 事件监听器会捕捉到错误对象，并且我们可以打印出错误消息以了解细节。</p></li><li><p><strong>自定义错误处理</strong></p><p>你也可以在你的程序里创建自定义的错误并设置相应的消息：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> doSomething</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> condition</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">condition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">自定义条件不满足！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 如果条件满足则继续执行函数...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  doSomething</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: 自定义条件不满足！</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们通过关键词<code>throw</code>主动抛出一个错误，在<code>try...catch</code>结构中捕获这个错误，并输出错误消息。</p></li></ol><p>总而言之，<code>error.message</code>是错误处理中非常重要的部分，它提供了发生错误时的具体信息，帮助开发者定位和解决问题。在实际编码过程中，恰当地使用错误消息可以让你更高效地调试代码和处理异常情况。</p><h3 id="error-stack" tabindex="-1"><a class="header-anchor" href="#error-stack"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorstack" target="_blank" rel="noopener noreferrer">error.stack</a></span></a></h3><p>Node.js 中的 <code>error.stack</code> 属性是一个字符串，它表示当一个错误(Error)对象被创建时，JavaScript 引擎在哪一行代码上抛出了这个错误。这个栈跟踪(stack trace)包含了错误发生的位置信息，通常用于调试目的，因为它帮助开发者快速定位问题所在的源文件和行号。</p><p>每当在 Node.js 中发生错误，并且这个错误被捕获（例如使用 <code>try...catch</code> 语句），你都可以访问这个错误对象的 <code>.stack</code> 属性来获取错误的堆栈跟踪。</p><p>下面是一个简单的例子来说明如何使用 <code>error.stack</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设你有一个函数，它会在某些条件下抛出错误</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> riskyOperation</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">出错啦！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试执行可能会抛出错误的操作</span></span>
<span class="line"><span style="color:#88C0D0;">  riskyOperation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 错误被捕获，此时可以打印错误的堆栈跟踪</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当上述代码执行时，<code>riskyOperation</code> 函数抛出一个错误，然后在 <code>catch</code> 块中被捕获。<code>error.stack</code> 被用来打印错误的堆栈跟踪，通常输出看起来类似于这样：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error: 出错啦！</span></span>
<span class="line"><span>    at riskyOperation (/path/to/file.js:2:11)</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/path/to/file.js:6:5)</span></span>
<span class="line"><span>    at Module._compile (module.js:652:30)</span></span>
<span class="line"><span>    at Object.Module._extensions..js (module.js:663:10)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个输出显示了错误信息（&quot;Error: 出错啦！&quot;）以及错误发生的具体位置。第一行显示错误是在文件 <code>/path/to/file.js</code> 的第 2 行第 11 列抛出的。</p><p>实际应用中，你可能会遇到更复杂的情况，比如异步编程或者网络请求，这时候理解错误发生的上下文非常重要。例如，如果你在处理 HTTP 请求时遇到了一个错误，你可能想要知道是哪个请求导致的问题。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 假设这里有一段可能会抛出错误的代码</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">url</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">        throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">故意制造的错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 错误发生了，打印堆栈跟踪并返回一个错误信息给客户端</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在服务器端打印堆栈跟踪</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">500</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器内部错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器运行在 http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个 HTTP 服务器的例子中，当用户访问 <code>/error</code> 路径时，我们故意抛出一个错误。如果这个错误发生了，我们不仅在控制台打印出错误的堆栈跟踪，而且还返回了一个 &#39;服务器内部错误&#39; 的响应给客户端。这样的错误处理使得我们能够更好地理解问题所在，同时确保用户得到了一些反馈，而不是留在一个无响应的状态。</p><p>通过这个属性，Node.js 开发者可以更有效地调试他们的程序，尤其是在大型项目或复杂系统中。</p><h2 id="class-assertionerror" tabindex="-1"><a class="header-anchor" href="#class-assertionerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-assertionerror" target="_blank" rel="noopener noreferrer">Class: AssertionError</a></span></a></h2><p><code>AssertionError</code> 是 Node.js 中的一个特殊的错误类型，它用于表示断言失败的情况。在编程中，“断言”是一种检查代码是否按预期工作的方式。如果你设置了一个断言，并且这个条件为假（false），那么会抛出一个<code>AssertionError</code>错误。</p><p>在 Node.js 中，通常使用<code>assert</code>模块来进行断言操作。这个模块包含了一系列的函数，可以帮助你验证代码行为。如果你的程序中有任何违反你的预期的地方，<code>assert</code>模块可以让你立即知道。</p><p>下面是一个简单的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> assert</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">assert</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">x</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> y</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> x</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> y</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的情况，不会抛出错误</span></span>
<span class="line"><span style="color:#D8DEE9;">assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">strictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1加2应该等于3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的情况，会抛出AssertionError</span></span>
<span class="line"><span style="color:#D8DEE9;">assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">strictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 4</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">期望1加2等于4，但这不正确</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中：</p><ul><li>我们首先引入了 Node.js 内置的<code>assert</code>模块。</li><li>接着定义了一个加法函数<code>add</code>。</li><li>然后我们使用<code>assert.strictEqual</code>方法来验证<code>add</code>函数的输出是否符合我们的预期。</li><li>第一个<code>assert.strictEqual</code>不会抛出错误，因为<code>add(1, 2)</code>的结果确实是<code>3</code>。</li><li>第二个<code>assert.strictEqual</code>会抛出<code>AssertionError</code>，因为<code>add(1, 2)</code>的结果是<code>3</code>，而不是预期中的<code>4</code>。此时，会显示提供的错误信息：&quot;期望 1 加 2 等于 4，但这不正确&quot;。</li></ul><p><code>AssertionError</code>对象还包含了一些额外的属性，比如<code>message</code>，<code>actual</code>和<code>expected</code>，分别用来描述错误消息、实际的值，以及期望的值。</p><p>当你在写测试代码时，经常会用到断言。它是自动化测试的一部分，可以帮助你保证你的函数或模块表现得像你设计的那样。如果一个断言失败，它会告诉你哪里出现了问题，这样你就可以去修复它。</p><h2 id="class-rangeerror" tabindex="-1"><a class="header-anchor" href="#class-rangeerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-rangeerror" target="_blank" rel="noopener noreferrer">Class: RangeError</a></span></a></h2><p>Node.js 中的 <code>RangeError</code> 是一个表示错误的对象，当一个值不在其允许的范围内时，就会抛出这个错误。</p><p>想象一下你有一个可以调节音量的电视遥控器，音量的范围从 0（静音）到 100（最大音量）。如果你尝试将音量设置为 101，这显然是不可能的，因为音量只能在 0 到 100 之间。在编程中，当你遇到类似的情况时，就可能会产生一个 <code>RangeError</code>。</p><p>在 JavaScript 和 Node.js 中，<code>RangeError</code> 继承自 <code>Error</code> 类，所以它具备了标准错误对象的所有特性，比如错误消息、堆栈追踪等。</p><p>下面是一些实际场景中可能会遇到 <code>RangeError</code> 的例子：</p><h3 id="例子-1-数组长度错误" tabindex="-1"><a class="header-anchor" href="#例子-1-数组长度错误"><span>例子 1：数组长度错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> arr</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里尝试创建一个数组，但长度为-1是不合法的。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在上面的代码中，数组的长度必须是一个非负整数，所以尝试用一个负数来创建数组会导致 <code>RangeError</code>。</p><h3 id="例子-2-数字精度溢出" tabindex="-1"><a class="header-anchor" href="#例子-2-数字精度溢出"><span>例子 2：数字精度溢出</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Number</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MAX_VALUE </span><span style="color:#81A1C1;">*</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试计算超出 JavaScript 数值能够表示的最大值。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在这个例子中，我们尝试进行一个计算，结果超出了 JavaScript 可以表示的最大数字值 <code>Number.MAX_VALUE</code>。当这种情况发生时，你将得到一个 <code>RangeError</code>，因为结果不在有效的数字范围内。</p><h3 id="例子-3-递归层数过深" tabindex="-1"><a class="header-anchor" href="#例子-3-递归层数过深"><span>例子 3：递归层数过深</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> recursiveFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  recursiveFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 函数调用自身，没有终止条件。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#88C0D0;">recursiveFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果一个函数反复调用自己（即递归），而没有任何终止条件，最终它会因为&quot;调用栈溢出&quot;而抛出 <code>RangeError</code>。每次函数调用自身时，都会在调用栈中添加一个新的层级，并且每个函数调用都需要一定的内存空间。如果递归深度超出了 JavaScript 引擎所能处理的范围，就会发生溢出。</p><p><code>RangeError</code> 通常表明程序中存在逻辑错误，比如一个参数值超出了预期范围或者算法中的边界条件没有正确处理。当你在开发过程中遇到 <code>RangeError</code>，你应该检查引发问题的代码，并确保所有的值都在它们应该在的范围内。</p><h2 id="class-referenceerror" tabindex="-1"><a class="header-anchor" href="#class-referenceerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-referenceerror" target="_blank" rel="noopener noreferrer">Class: ReferenceError</a></span></a></h2><p>当然，我会尽力解释给你听。</p><p>Node.js 中的<code>ReferenceError</code>是一种错误，它表示试图访问一个未定义的变量。在 JavaScript(也就是 Node.js 使用的语言)中，如果你尝试读取或写入一个不存在的变量，就会抛出这个错误。</p><p>让我们来看一些实际的例子：</p><h3 id="示例-1-未声明的变量" tabindex="-1"><a class="header-anchor" href="#示例-1-未声明的变量"><span>示例 1：未声明的变量</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设我们直接尝试打印一个没有声明的变量</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">mysteriousVariable</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试打印一个名为<code>mysteriousVariable</code>的变量，但是因为我们之前并没有创建（声明）这个变量，所以运行这段代码会导致一个<code>ReferenceError</code>，错误信息可能会告诉你<code>mysteriousVariable is not defined</code>，意思就是这个变量没有被定义。</p><h3 id="示例-2-属性拼写错误" tabindex="-1"><a class="header-anchor" href="#示例-2-属性拼写错误"><span>示例 2：属性拼写错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> someObject</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  validProperty</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 123</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 我们尝试访问someObject里一个不存在的属性</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">someObject</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">invalidProperty</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>虽然在这个例子中我们不会得到<code>ReferenceError</code>（因为访问不存在的对象属性会返回<code>undefined</code>），但如果我们尝试对这个<code>undefined</code>的属性执行一些操作，比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">someObject</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">invalidProperty</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">subProperty</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 456</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在我们尝试给<code>invalidProperty</code>的<code>subProperty</code>属性赋值，但是由于<code>invalidProperty</code>本身就是未定义的，这将导致<code>ReferenceError</code>。</p><h3 id="示例-3-严格模式下删除不允许删除的变量" tabindex="-1"><a class="header-anchor" href="#示例-3-严格模式下删除不允许删除的变量"><span>示例 3：严格模式下删除不允许删除的变量</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">use strict</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">var</span><span style="color:#D8DEE9;"> notAllowedToDelete</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">You can&#39;t delete me!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">delete</span><span style="color:#D8DEE9;"> notAllowedToDelete</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在严格模式下，这将抛出ReferenceError</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们启用了 JavaScript 的严格模式（通过在文件或函数顶部添加<code>&#39;use strict&#39;;</code>）。在严格模式下，尝试删除不可删除的变量会导致<code>ReferenceError</code>。</p><p>在编程中，遇到<code>ReferenceError</code>通常是因为打字错误、忘记声明变量、错误地理解作用域规则或者错误地使用某些特性（例如在严格模式下删除变量）。修复这类错误通常涉及检查变量是否已经正确声明和初始化，以及确保你没有尝试访问任何超出当前作用域的变量。</p><h2 id="class-syntaxerror" tabindex="-1"><a class="header-anchor" href="#class-syntaxerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-syntaxerror" target="_blank" rel="noopener noreferrer">Class: SyntaxError</a></span></a></h2><p>在编程中，一个<code>SyntaxError</code>是一种特定类型的错误，用来指示代码中存在语法问题。在 Node.js 中，<code>SyntaxError</code>对象也代表了这样的错误情况。</p><p>当你在写 Node.js 代码时，如果 JavaScript 解释器遇到了它不理解的代码，它将无法继续执行，并会抛出一个<code>SyntaxError</code>。这通常意味着你的代码中有打字错误、缺失字符、错误的命令或者不恰当的使用某些编程结构。</p><p>下面通过几个例子来具体说明<code>SyntaxError</code>：</p><h3 id="示例-1-括号不匹配" tabindex="-1"><a class="header-anchor" href="#示例-1-括号不匹配"><span>示例 1：括号不匹配</span></a></h3><p>假设你想要写一个简单的函数来打印&quot;Hello, World!&quot;，但是你忘记了闭合括号：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> sayHello</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码中，<code>console.log</code>调用缺少了一个闭合圆括号<code>)</code>。当你试图运行这段代码时，Node.js 将抛出一个<code>SyntaxError</code>，类似于：</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>SyntaxError: missing ) after argument list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="示例-2-意外的标记" tabindex="-1"><a class="header-anchor" href="#示例-2-意外的标记"><span>示例 2：意外的标记</span></a></h3><p>你可能会在对象的属性之间放错了标点符号，比如逗号（,）和分号（;）：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    age</span><span style="color:#D8DEE9FF;">: </span><span style="color:#B48EAD;">25</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>name</code>属性后错误地使用了分号而不是逗号。这会导致<code>SyntaxError</code>，错误信息可能如下：</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>SyntaxError: Unexpected token ;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="示例-3-关键字用法错误" tabindex="-1"><a class="header-anchor" href="#示例-3-关键字用法错误"><span>示例 3：关键字用法错误</span></a></h3><p>如果你尝试使用保留关键字作为变量名，比如<code>return</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> return</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">I&#39;m a return value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>return</code>是一个 JavaScript 中的保留关键字，用来从函数返回值。使用它作为变量名会导致<code>SyntaxError</code>，报错信息如下：</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>SyntaxError: Unexpected token return</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>为了修复<code>SyntaxError</code>，需要检查报错信息提示的位置和原因，然后修改代码以正确地符合 JavaScript 的语法规则。对于新手来说，遇到<code>SyntaxError</code>很常见，但随着经验的积累，你将更容易发现并避免这类错误。</p><h2 id="class-systemerror" tabindex="-1"><a class="header-anchor" href="#class-systemerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-systemerror" target="_blank" rel="noopener noreferrer">Class: SystemError</a></span></a></h2><p>Node.js 中的 <code>SystemError</code> 是一种特殊类型的错误，它代表系统层面的异常。在编程时，你会遇到各种各样的错误，这些错误通常分为两大类：编程错误（例如，使用未定义的变量）和运行时错误（例如，尝试连接一个不存在的服务器）。<code>SystemError</code> 属于后者，指的是在 Node.js 运行环境与操作系统交互过程中出现的问题。</p><p>那么什么是 <code>Class: SystemError</code> 呢？简单来说，这是 Node.js 提供的一个错误类，用来表示与底层系统交互时发生的错误，比如网络通信错误、文件操作错误等。每个 <code>SystemError</code> 都有几个属性，可以提供关于错误的更多信息，比如：</p><ul><li><code>code</code>：一个标识错误类型的字符串，如 <code>&#39;ECONNREFUSED&#39;</code> 表示连接被服务器拒绝。</li><li><code>message</code>：错误描述的字符串。</li><li><code>errno</code>：一个数字，表示错误的具体编号。</li><li><code>syscall</code>：触发错误的系统调用名称，如 <code>&#39;read&#39;</code> 或 <code>&#39;write&#39;</code>。</li><li><code>path</code>：相关联的文件路径，如果错误与文件系统操作有关的话。</li></ul><p>以下是一些 <code>SystemError</code> 的实际例子及解释：</p><ol><li><p><strong>文件读取错误</strong>：<br> 假设你正在尝试读取一个不存在的文件。当你使用 Node.js 的 <code>fs</code> 模块读取该文件时会发生错误，这将导致一个 <code>SystemError</code>。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里的 err 就是一个 SystemError</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果文件不存在，你将看到包含一个错误码 <code>&#39;ENOENT&#39;</code> 的 <code>SystemError</code>，表明文件或目录在给定的路径上不存在。</p></li><li><p><strong>网络请求错误</strong>：<br> 假如你的代码试图连接一个服务器，但服务器没有响应。这可能会产生一个 <code>SystemError</code>。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://some.nonexistent.server.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这段代码不会执行，因为服务器无法连接。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里的 err 可能是一个 SystemError，例如 ECONNREFUSED</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果服务器无法连接，你可能会得到一个带有 <code>&#39;ECONNREFUSED&#39;</code> 错误码的 <code>SystemError</code>，表示连接被拒绝。</p></li><li><p><strong>DNS 解析错误</strong>：<br> 当你尝试查询一个域名对应的 IP 地址，但域名不存在或 DNS 服务器无法解析时，也会发生 <code>SystemError</code>。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dns</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dns</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">dns</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">lookup</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistent.domain.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里的 err 可能是一个 SystemError，例如 ENOTFOUND</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">address</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>在处理 <code>SystemError</code> 时，检查 <code>err.code</code> 属性可以帮助你确定错误的类型并相应地作出反应。了解错误的具体原因也可以帮助你调试程序，并为用户提供更有用的错误信息。记住，<code>SystemError</code> 是告诉你程序与底层系统交互出现问题的方式，通过了解这些错误，你可以编写更健壮、更易于调试的代码。</p><h3 id="error-address" tabindex="-1"><a class="header-anchor" href="#error-address"><span><a href="https://nodejs.org/docs/latest/api/errors.html#erroraddress" target="_blank" rel="noopener noreferrer">error.address</a></span></a></h3><p>Node.js 中的<code>error.address</code>是一个属性，它提供了当网络相关错误发生时，错误所涉及网络操作的 IP 地址信息。这个属性对于调试网络问题是非常有用的，因为它可以帮助你快速定位问题发生的位置。</p><p>举几个实际运用的例子：</p><ol><li><strong>TCP 服务器监听错误</strong>：<br> 当你使用 Node.js 创建一个 TCP 服务器，并尝试在一个被占用的端口上监听时，可能会遇到<code>EADDRINUSE</code>错误。这种情况下，<code>error.address</code>会包含尝试绑定的 IP 地址。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EADDRINUSE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法绑定到IP：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">，端口被占用。</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设8080端口已经被其他服务占用。</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>UDP 套接字错误</strong>：<br> 如果你正在编写一个需要发送或接收 UDP 数据包的应用程序，并且在绑定到一个特定地址时出现错误，<code>error.address</code>会提供导致错误的 IP 地址。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EADDRNOTAVAIL</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">指定的地址无效: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试绑定到一个无效的IP地址。</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bind</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1234</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">999.999.999.999</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>HTTP 请求错误</strong>：<br> 当使用 HTTP 模块发送请求并且无法连接到目标服务器时，例如服务器 IP 不可达，那么在错误对象上就会有<code>error.address</code>属性包含尝试连接的 IP 地址。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">不存在的服务器.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestOptions</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">在尝试连接到地址：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">address</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">时出错</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这些例子中，每当出现网络错误时，都会触发一个错误事件，你可以通过监听这个事件来获取错误对象。如果错误和网络地址有关，那么可以通过访问<code>error.address</code>属性获取到出错时尝试连接或者绑定的 IP 地址，这样就能够更容易地诊断和解决网络问题。</p><h3 id="error-code-1" tabindex="-1"><a class="header-anchor" href="#error-code-1"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorcode_1" target="_blank" rel="noopener noreferrer">error.code</a></span></a></h3><p><code>error.code</code> 在 Node.js 中是一个错误对象的属性，它提供了一个特定的错误码，用于标识发生了什么类型的错误。这个码通常是一个字符串，通过这个错误码，你可以快速了解错误的性质，比如它是由网络问题引起的、文件系统操作失败还是其他原因。</p><p>当在 Node.js 中进行操作，比如读取文件、访问网络资源或者使用某些 API 时，如果出现错误，Node.js 会生成一个包含各种信息的错误对象。这个对象中的 <code>code</code> 属性就是帮助你理解和处理错误的关键之一。</p><p>下面举几个实际运用的例子：</p><ol><li><strong>文件操作错误</strong>：<br> 假设你尝试读取一个不存在的文件，Node.js 的文件系统模块（<code>fs</code>）将会产生一个错误对象，该对象的 <code>code</code> 属性可能就会是 <code>&#39;ENOENT&#39;</code>，表示 &quot;No such file or directory&quot;（没有这样的文件或目录）。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">someNonExistentFile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印 &quot;An error occurred: ENOENT&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>网络请求错误</strong>：<br> 当你使用 Node.js 发起一个网络请求，但是目标服务器不可达时，可能会得到一个错误对象，其 <code>code</code> 属性可能是 <code>&#39;ENOTFOUND&#39;</code> 或 <code>&#39;ECONNREFUSED&#39;</code>。这分别表示找不到主机，以及连接被拒绝。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://nonexistentwebsite.example</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 正常的响应处理...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印出错误码</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>DNS 解析错误</strong>：<br> 如果你尝试解析一个域名，但是这个域名不存在或者 DNS 服务器无法解析它，那么就会收到一个错误对象，其 <code>code</code> 属性可能是 <code>&#39;ENOTFOUND&#39;</code>。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dns</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dns</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">dns</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">lookup</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistentdomain.example</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> family</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能会打印 &quot;An error occurred: ENOTFOUND&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Address:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过这些例子，你可以看到 <code>error.code</code> 是如何在实际编程中提供有关错误原因的直接信息的。当你遇到错误时，查阅 Node.js 文档中的错误代码列表能帮助你更好地理解和解决问题。</p><h3 id="error-dest" tabindex="-1"><a class="header-anchor" href="#error-dest"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errordest" target="_blank" rel="noopener noreferrer">error.dest</a></span></a></h3><p>在 Node.js 中，<code>error.dest</code>是一个属性，它与文件系统相关的错误对象上使用。当你进行文件操作时，像读取、写入、重命名文件等，而这些操作出错了，Node.js 会生成一个错误对象（通常是一个<code>Error</code>类型）。如果这个错误是因为无法访问目标路径，例如，目标路径不存在或者没有相应权限，<code>error.dest</code>属性就会包含那个无法访问的路径作为字符串。</p><p>以下是一些实际运用的例子，展示了如何在 Node.js 中遇到包含<code>error.dest</code>属性的错误对象：</p><h3 id="例子-1-尝试写入一个只读的文件" tabindex="-1"><a class="header-anchor" href="#例子-1-尝试写入一个只读的文件"><span>例子 1：尝试写入一个只读的文件</span></a></h3><p>假设我们有一个只读的文件 <code>readonly-file.txt</code>，尝试对其进行写入操作：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">readonly-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">新内容</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">发生错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">dest</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法写入的文件路径: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">dest</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件写入成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果由于某种原因（比如文件是只读的），写入操作失败了，那么回调函数将接收到一个错误对象，这个对象可能包含一个<code>dest</code>属性，表示了出问题的文件路径。</p><h3 id="例子-2-尝试移动一个不存在的文件" tabindex="-1"><a class="header-anchor" href="#例子-2-尝试移动一个不存在的文件"><span>例子 2：尝试移动一个不存在的文件</span></a></h3><p>下面是尝试重命名一个不存在的文件的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">rename</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistent-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">new-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">发生错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">dest</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法重命名到的文件路径: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">dest</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件重命名成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果原始文件不存在，尝试重命名时就会触发错误，并且<code>error.dest</code>会包含新的文件名 <code>&#39;new-file.txt&#39;</code>，说明这次操作希望将文件移动到的目标路径。</p><p>要注意的是，不是所有的文件系统错误都会有<code>dest</code>属性。该属性只在错误对象表示目标路径相关问题时才会出现。所以，在处理错误时，最好检查一下<code>dest</code>属性是否存在。</p><p>以上就是<code>error.dest</code>在 Node.js 中的作用和一些实际例子。简单来说，当你在进行涉及到目标路径的文件系统操作时，如果遇到错误，可以通过<code>error.dest</code>来获取到相关的目标路径信息。</p><h3 id="error-errno" tabindex="-1"><a class="header-anchor" href="#error-errno"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorerrno" target="_blank" rel="noopener noreferrer">error.errno</a></span></a></h3><p><code>error.errno</code> 是 Node.js 中一个特殊的属性，它存在于由系统操作引起的错误对象上。在 Node.js 中，当进行如文件操作、网络请求等涉及到系统级别调用的操作时，如果出现错误，Node.js 会创建一个包含具体错误信息的错误对象（Error object）。这个错误对象里，<code>errno</code> 属性就是一个表示特定错误代码的属性。</p><h3 id="解释error-errno" tabindex="-1"><a class="header-anchor" href="#解释error-errno"><span>解释<code>error.errno</code></span></a></h3><p><code>errno</code> 实际上是一个数字或字符串，代表了错误的具体类型。这个值来源于底层系统调用的返回值，通常与操作系统的错误码对应。例如，在 Unix 系统中，每种错误类型，比如“文件未找到”或“拒绝访问”，都有一个特定的错误编号。</p><p>Node.js 内部使用这些错误码，使开发者能够更精确地了解到底发生了哪种错误，并据此做出相应的处理。</p><h3 id="实际运用例子" tabindex="-1"><a class="header-anchor" href="#实际运用例子"><span>实际运用例子</span></a></h3><ol><li><p><strong>文件读取错误处理</strong>：</p><p>假设你尝试读取一个不存在的文件，Node.js 的文件系统（fs）模块会报一个错误给你。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试读取一个不存在的文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 输出错误的errno属性</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error number:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">errno</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 处理错误</span></span>
<span class="line"><span style="color:#81A1C1;">    switch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      case</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ENOENT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File does not exist</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">        break;</span></span>
<span class="line"><span style="color:#81A1C1;">      default</span><span style="color:#ECEFF4;">:</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An unknown error occurred</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果文件不存在，你将会在控制台看到类似 <code>Error number: -2</code>（errno 的值依操作系统而异）以及 <code>File does not exist</code> 的输出。</p></li><li><p><strong>网络请求错误处理</strong>：</p><p>当你向一个服务器发送请求，但是连接失败时，例如因为服务器地址错误或者网络问题，你会得到一个错误对象，其中包含了 <code>errno</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送一个网络请求到一个不存在的地址</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://nonexistent.domain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 接收数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 数据接收完毕</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">explanation</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 输出错误的errno属性</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error number:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">errno</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 处理错误</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码试图从一个不存在的域名获取数据，执行后你可能会在控制台看到类似 <code>Error number: ENOTFOUND</code> 和相应的错误消息。</p></li></ol><p>通过这些例子，我们可以看到<code>error.errno</code>属性在错误处理中的作用：它帮助我们识别并根据不同的错误类型来做出反应。在编程过程中，适当地处理这些错误可以提高应用程序的稳定性和用户体验。</p><h3 id="error-info" tabindex="-1"><a class="header-anchor" href="#error-info"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorinfo" target="_blank" rel="noopener noreferrer">error.info</a></span></a></h3><p>在 Node.js 中，当一个错误发生时，通常会生成一个错误对象（Error object）。这个错误对象包含了关于错误的一些基本信息，比如一个消息字符串和一个代表错误栈的<code>stack</code>属性。从 Node.js v21.7.1 版本开始，错误对象可以包含一个新的属性叫作<code>error.info</code>。这个属性是一个对象，里面包含了额外的、关于错误的上下文信息。</p><p>现在让我们通过几个实际的例子来看一下<code>error.info</code>是如何使用的。</p><h3 id="例子-1-自定义错误信息" tabindex="-1"><a class="header-anchor" href="#例子-1-自定义错误信息"><span>例子 1: 自定义错误信息</span></a></h3><p>想象一下，你正在编写一个文件读取功能的代码。如果文件不存在或者无法访问，你可能会抛出一个错误，并且你想同时提供一些额外信息，比如文件名和尝试访问它的路径。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> readFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> filename</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistent.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Additional info:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果<code>readFile</code>函数遇到错误，它会向错误对象<code>err</code>添加一个<code>info</code>属性。该属性包含一个对象，里面有一个<code>filename</code>键，其值是传递给<code>readFile</code>的文件名。当错误被捕获时，你不仅可以查看错误消息，还可以查看额外的上下文信息。</p><h3 id="例子-2-捕获系统错误" tabindex="-1"><a class="header-anchor" href="#例子-2-捕获系统错误"><span>例子 2: 捕获系统错误</span></a></h3><p>操作系统层面的错误，比如网络错误、文件系统错误等，也可以利用<code>error.info</code>来提供更多信息。例如，如果你尝试监听一个已经被占用的端口，Node.js 将会抛出一个<code>EADDRINUSE</code>错误，并且可能会在<code>error.info</code>中提供额外信息，比如端口号和地址。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Additional info:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假设端口 3000 已经被另一个应用程序占用，启动服务器时将会抛出一个错误。错误对象<code>err</code>可能会有一个<code>info</code>属性，其中包括尝试绑定的端口号和地址。</p><h3 id="例子-3-扩展第三方库错误" tabindex="-1"><a class="header-anchor" href="#例子-3-扩展第三方库错误"><span>例子 3: 扩展第三方库错误</span></a></h3><p>当使用第三方库时，这些库可能也会返回错误。你可以选择捕获这些错误并为它们添加<code>info</code>属性，以便提供更多的调试信息。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> someThirdPartyFunction</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some-third-party-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  someThirdPartyFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> timestamp</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Date</span><span style="color:#D8DEE9FF;">() </span><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Additional info:</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">info</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，当捕获来自某个第三方函数的错误时，我们添加了一个<code>info</code>属性包含当前的时间戳。这样可以帮助我们知道错误发生的确切时间。</p><p>总结一下，<code>error.info</code>是一个非常实用的属性，它允许你为错误对象附加额外的信息，这可以帮助开发者更好地理解和调试程序中出现的错误。</p><h3 id="error-message-1" tabindex="-1"><a class="header-anchor" href="#error-message-1"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errormessage_1" target="_blank" rel="noopener noreferrer">error.message</a></span></a></h3><p>好的，让我们来谈谈 Node.js 中的 <code>error.message</code>。</p><p>在编程中，错误处理是一个非常重要的部分。当代码运行发生问题时，通常会产生一个错误（Error）对象，这个对象包含了描述错误的各种信息。<code>error.message</code> 是这些信息中的一部分，它是一个字符串属性，提供了关于错误的具体描述。</p><p>在 Node.js 中，当你创建一个新的错误对象时，可以传递一个消息字符串给它的构造函数。这个消息就会被设置为该错误对象的 <code>message</code> 属性。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个新的 Error 对象，并传入错误消息</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Oops! Something went wrong.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 打印错误消息</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: Oops! Something went wrong.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，<code>error.message</code> 可以用来提供更多的上下文信息和详细说明，帮助开发者理解和调试程序。比如，在文件操作、网络请求或数据库交互出现问题时，<code>error.message</code> 会告诉你具体是什么出错了。</p><p>例子 1：读取文件时出现错误</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试读取一个不存在的文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error reading file:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里 err.message 可能会输出 &quot;Error reading file: ENOENT: no such file or directory, open &#39;/path/to/nonexistent/file&#39;&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例子 2：网络请求失败</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发起一个可能会失败的 HTTPS 请求</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://nonexistent.domain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">statusCode:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里 err.message 可能会输出 &quot;Request failed: getaddrinfo ENOTFOUND nonexistent.domain&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例子 3：数据库查询出错</p><p>假设你使用某种数据库模块进行查询：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> db</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some-database-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 执行一个查询，可能会失败</span></span>
<span class="line"><span style="color:#D8DEE9;">db</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">query</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SELECT * FROM non_existent_table</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> results</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Database query error:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里 err.message 可能会告诉你表不存在或者查询语句有错误等</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">results</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>概括来说，<code>error.message</code> 是一个很有用的特性，因为它为错误提供了易于理解的描述，使得找出问题和解决问题变得更容易。在开发 Node.js 应用程序时，合理地利用这个属性可以显著提高你的调试效率。</p><h3 id="error-path" tabindex="-1"><a class="header-anchor" href="#error-path"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorpath" target="_blank" rel="noopener noreferrer">error.path</a></span></a></h3><p><code>error.path</code> 是 Node.js 中一个错误对象的属性，它提供了导致错误发生时涉及的文件系统路径的详细信息。当你在使用 Node.js 进行文件操作（如读取、写入、修改文件等）时，如果出现一个与文件系统相关的错误，Node.js 会生成一个错误对象，这个错误对象可能包含一个 <code>.path</code> 属性，用于指示引起问题的具体文件或目录路径。</p><p>让我们来看几个例子来更好地理解 <code>error.path</code> 的作用：</p><h3 id="示例-1-读取文件时发生错误" tabindex="-1"><a class="header-anchor" href="#示例-1-读取文件时发生错误"><span>示例 1：读取文件时发生错误</span></a></h3><p>假设你试图读取一个不存在的文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/non-existent-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error path:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出导致错误的文件路径</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 这里处理读取到的数据</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>/path/to/non-existent-file.txt</code> 这个文件不存在，那么 <code>readFile</code> 方法会产生一个错误，并且在回调函数的 <code>err</code> 参数中返回。此时你可以通过 <code>err.message</code> 来获取错误的描述信息，而 <code>err.path</code> 会给出导致错误的具体文件路径，即 <code>/path/to/non-existent-file.txt</code>。</p><h3 id="示例-2-写入文件时发生错误" tabindex="-1"><a class="header-anchor" href="#示例-2-写入文件时发生错误"><span>示例 2：写入文件时发生错误</span></a></h3><p>再比如，你尝试写入到一个无权限访问的文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/protected-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Some content</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error path:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The file was saved!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果因为权限问题无法写入到 <code>/path/to/protected-file.txt</code> 文件，<code>writeFile</code> 方法会触发一个错误。<code>err.message</code> 将提供错误详情，而 <code>err.path</code> 则会告诉你是哪个文件的写入操作失败了。</p><h3 id="示例-3-检查文件状态时发生错误" tabindex="-1"><a class="header-anchor" href="#示例-3-检查文件状态时发生错误"><span>示例 3：检查文件状态时发生错误</span></a></h3><p>最后一个例子，假设你想检查一个文件的状态，但是该文件被删除了：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stat</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/deleted-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stats</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error path:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 这里可以处理文件状态信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>/path/to/deleted-file.txt</code> 文件已经被删除，<code>fs.stat</code> 方法将会产生一个错误，你可以通过 <code>err.message</code> 获取错误信息，并且 <code>err.path</code> 将显示文件路径 <code>/path/to/deleted-file.txt</code>，从而让你知道是哪个文件发生了问题。</p><p>总结一下，<code>error.path</code> 主要在文件操作过程中遇到错误时提供帮助，它让你知道错误是由哪个文件或目录路径引起的，便于调试和解决问题。</p><h3 id="error-port" tabindex="-1"><a class="header-anchor" href="#error-port"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorport" target="_blank" rel="noopener noreferrer">error.port</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它使得开发者可以使用 JavaScript 来编写服务端代码。Node.js 被设计成模块化的，有着丰富的内置模块库及第三方模块库。</p><p>在 Node.js 中，错误处理是非常重要的部分，因为良好的错误处理能够提升应用程序的健壮性和可靠性。Node.js 提供了一系列标准的错误类型，比如 <code>RangeError</code>, <code>TypeError</code>, <code>SyntaxError</code> 等，其中每种错误类型都代表了不同的错误情况。</p><p><code>error.port</code> 其实不是 Node.js 的一个特定功能或方法，而是指当你在 Node.js 程序中遇到与网络端口相关的问题时可能会抛出的错误属性。在 Node.js 官方文档中，这个通常被用来指示那些涉及网络操作中无效端口的错误。端口号应该是一个介于 0 到 65535 之间的整数（包括 0 和 65535）。如果指定的端口号超出这个范围，就可能引发一个 <code>RangeError</code> 错误，并且这个 <code>RangeError</code> 错误对象可能会有一个 <code>port</code> 属性，说明了出错的端口号。</p><p>让我们举几个例子来说明这个概念。</p><h3 id="示例-1-创建-http-服务器" tabindex="-1"><a class="header-anchor" href="#示例-1-创建-http-服务器"><span>示例 1：创建 HTTP 服务器</span></a></h3><p>当你尝试创建一个 HTTP 服务器并监听一个无效的端口时：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试在一个无效端口监听 (例如：-1是无效的端口)</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_BAD_PORT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无效的端口: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试监听端口 <code>-1</code>，这会引发一个 <code>RangeError</code>，因为 <code>-1</code> 不是一个有效的端口号。错误对象 <code>err</code> 会有一个 <code>port</code> 属性，指明出错的端口号。</p><h3 id="示例-2-连接-tcp-客户端" tabindex="-1"><a class="header-anchor" href="#示例-2-连接-tcp-客户端"><span>示例 2：连接 TCP 客户端</span></a></h3><p>当你尝试使用 Node.js 的 <code>net</code> 模块去连接到一个 TCP 服务器，但是提供了一个无效的端口时：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试连接到一个无效端口 (例如：70000是无效的端口)</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">70000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">连接成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_BAD_PORT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无效的端口: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>connect</code> 方法接收了一个无效的端口 <code>70000</code>，它不在允许的范围内，所以会抛出一个带有 <code>port</code> 属性的 <code>RangeError</code> 错误。</p><p>总结起来，<code>error.port</code> 是指当一些 Node.js 的 API 对于端口参数的要求没有得到满足时，会抛出一个包含 <code>port</code> 属性的错误对象。这个属性可以帮助开发者迅速定位并解决端口相关的问题。</p><h3 id="error-syscall" tabindex="-1"><a class="header-anchor" href="#error-syscall"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorsyscall" target="_blank" rel="noopener noreferrer">error.syscall</a></span></a></h3><p>在 Node.js 中，<code>error.syscall</code> 是一个属性，它出现在由 Node.js 抛出的错误对象上。这个属性表示引发错误时正在尝试执行的底层系统调用的名称。系统调用是程序向操作系统请求服务的方式，例如打开文件、读写数据或者发送网络请求。</p><p>当在 Node.js 程序中发生错误，并且这个错误与系统调用直接相关时，Node.js 将生成一个包含几个有用属性的错误对象，其中 <code>error.syscall</code> 就是一个重要属性。这有助于开发者理解错误发生的上下文和原因。</p><p>让我们通过一些实例来更好地理解 <code>error.syscall</code>：</p><h3 id="例子-1-文件操作错误" tabindex="-1"><a class="header-anchor" href="#例子-1-文件操作错误"><span>例子 1：文件操作错误</span></a></h3><p>假设你正在使用 Node.js 的 <code>fs</code> 模块读取一个不存在的文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error code:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">System call:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">syscall</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果这个文件不存在，你会收到一个错误。这个错误对象可能会包含类似如下信息：</p><ul><li><code>err.code</code>: <code>&#39;ENOENT&#39;</code>（表示“没有这样的文件或目录”）</li><li><code>err.syscall</code>: <code>&#39;read&#39;</code>（表示引起错误的系统调用是尝试读取文件）</li></ul><h3 id="例子-2-网络请求问题" tabindex="-1"><a class="header-anchor" href="#例子-2-网络请求问题"><span>例子 2：网络请求问题</span></a></h3><p>想象一下，你正在创建一个 HTTP 客户端，尝试连接到一个服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/nonexistentpage</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理响应...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">System call:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">syscall</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果请求失败了，比如说因为网络问题或者找不到服务器，那么错误事件会被触发，错误对象也会包含像这样的信息：</p><ul><li><code>err.message</code>: 错误描述（例如：“getaddrinfo ENOTFOUND <a href="http://example.com" target="_blank" rel="noopener noreferrer">example.com</a>”）</li><li><code>err.syscall</code>: <code>&#39;getaddrinfo&#39;</code>（表示试图获取地址信息但失败了）</li></ul><h3 id="重要的点" tabindex="-1"><a class="header-anchor" href="#重要的点"><span>重要的点</span></a></h3><ul><li><code>error.syscall</code> 提供了出错时正在进行的系统调用信息。</li><li>这可以帮助开发者定位问题所在，理解错误的具体原因。</li><li><code>error.syscall</code> 是 Node.js 错误处理的一个方面，通常与其他属性（如 <code>error.code</code> 和 <code>error.message</code>）一起提供错误的完整画面。</li></ul><p>通过查看 <code>error.syscall</code>，可以更加精确地知道出了什么问题，进而找到解决方案。例如，在第一个例子中，如果你发现 <code>syscall</code> 是 <code>&#39;read&#39;</code>，并且 <code>code</code> 是 <code>&#39;ENOENT&#39;</code>，就很清楚问题在于文件不存在。在第二个例子中，如果 <code>syscall</code> 是 <code>&#39;getaddrinfo&#39;</code>，可能说明 DNS 解析出了问题或者服务器地址不正确。</p><h3 id="common-system-errors" tabindex="-1"><a class="header-anchor" href="#common-system-errors"><span><a href="https://nodejs.org/docs/latest/api/errors.html#common-system-errors" target="_blank" rel="noopener noreferrer">Common system errors</a></span></a></h3><p>Node.js 是一个基于 Chrome 的 V8 引擎的 JavaScript 运行环境，它允许开发者在服务器端运行 JavaScript 代码。当你在 Node.js 中编写代码时，有时候会遇到一些系统错误。这些错误通常是由底层操作系统的系统调用失败引起的。</p><p>在 Node.js v21.7.1 的文档中，&quot;Common system errors&quot; 指的是那些经常出现的、与系统操作相关的错误码。以下是一些常见的系统错误以及通俗易懂的解释和例子：</p><ol><li><p><code>EACCES</code> (Permission denied):<br> 这个错误表示你试图执行一个操作却没有足够的权限。比如，如果你尝试监听一个低于 1024 端口的网络服务而不是以 root 用户运行 Node.js，你可能会看到这个错误。</p><p><strong>例子</strong>：尝试在 Linux 上以普通用户身份监听 80 端口。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">80</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:80/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码会抛出 EACCES 错误，因为非 root 用户无法监听 80 端口。</p></li><li><p><code>EADDRINUSE</code> (Address already in use):<br> 当你尝试绑定一个网络地址（IP 和端口）来监听请求，但是这个地址已经被另一个程序使用时，就会出现这个错误。</p><p><strong>例子</strong>：如果你有两个 Node.js 程序，都尝试监听同一个端口，第二个尝试启动的程序将会收到 EADDRINUSE 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设一个程序已经在监听 3000 端口</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> app</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> express</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Application is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>ENOTFOUND</code> (Not found):<br> 这个错误表明在 DNS 解析中没有找到任何结果。通常会在尝试连接或查询一个不存在的域名时出现。</p><p><strong>例子</strong>：尝试连接到一个不存在的域名。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://a.domain.that.does.not.exist.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Got response: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Got error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码会抛出 ENOTFOUND 错误，因为指定的域名无法解析。</p></li><li><p><code>ECONNREFUSED</code> (Connection refused):<br> 当你尝试与一个服务器建立 TCP 连接，但是目标服务器拒绝连接请求时，就会出现这个错误。这通常是因为目标端口上没有应用程序在监听或者被防火墙拦截了。</p><p><strong>例子</strong>：尝试连接到一个关闭的端口或服务器不可达的 IP 地址。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 9999</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行这段代码可能会得到 ECONNREFUSED 错误，因为很可能没有服务在监听 9999 端口。</p></li></ol><p>理解这些错误对于 Node.js 开发很重要，因为它们帮助你诊断和解决应用程序中可能出现的问题。每次遇到这样的错误时，你都应该检查你的代码以确定失败的原因，并采取适当的措施来处理错误。</p><h2 id="class-typeerror" tabindex="-1"><a class="header-anchor" href="#class-typeerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#class-typeerror" target="_blank" rel="noopener noreferrer">Class: TypeError</a></span></a></h2><p><code>TypeError</code> 是 JavaScript 中一种特殊的错误类型，表示值不是预期的类型时抛出的错误。在 Node.js 中，当你使用 API 或者写代码时，如果你传入了错误的参数类型，Node.js 就可能抛出一个 <code>TypeError</code>。</p><p>比如说，我们有一个函数需要一个字符串作为输入，如果你传入了一个数字而不是字符串，那么这个函数可能就会抛出一个 <code>TypeError</code>。</p><h2 id="实例解释" tabindex="-1"><a class="header-anchor" href="#实例解释"><span>实例解释：</span></a></h2><h3 id="_1-错误的参数类型" tabindex="-1"><a class="header-anchor" href="#_1-错误的参数类型"><span>1. 错误的参数类型</span></a></h3><p>假设我们有一个函数，它要求接收一个字符串参数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> sayHello</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">string</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TypeError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">name must be a string</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">!</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个函数检查传入的 <code>name</code> 是否为字符串类型，如果不是，则抛出 <code>TypeError</code>。</p><p>如果你调用 <code>sayHello(123)</code>，因为 <code>123</code> 是一个数字而不是一个字符串，所以会抛出以下错误信息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>TypeError: name must be a string</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-使用内置方法时参数类型不正确" tabindex="-1"><a class="header-anchor" href="#_2-使用内置方法时参数类型不正确"><span>2. 使用内置方法时参数类型不正确</span></a></h3><p>许多内置的 JavaScript 方法和对象都要求使用特定类型的参数。例如，数组的 <code>.push()</code> 方法要求你传入想要添加到数组中的元素。如果你尝试向 <code>.push()</code> 传入非法的参数（比如一个函数），那么会抛出 <code>TypeError</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> numbers</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">numbers</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确使用：向数组添加字符串 &#39;4&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">numbers</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确使用：向数组添加一个空对象 {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 下面这行会抛出 TypeError，因为 null 不是一个有效的参数</span></span>
<span class="line"><span style="color:#D8DEE9;">numbers</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-调用不存在的函数或属性" tabindex="-1"><a class="header-anchor" href="#_3-调用不存在的函数或属性"><span>3. 调用不存在的函数或属性</span></a></h3><p>当你尝试调用一个对象上不存在的方法时，也会抛出 <code>TypeError</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">someNonExistentMethod</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>因为 <code>obj</code> 上没有名为 <code>someNonExistentMethod</code> 的方法，所以运行上面的代码会得到类似这样的错误信息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>TypeError: obj.someNonExistentMethod is not a function</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="结论" tabindex="-1"><a class="header-anchor" href="#结论"><span>结论</span></a></h3><p>总结来说，在 Node.js 中，<code>TypeError</code> 表示因为数据类型不匹配而无法执行某项操作时抛出的错误。它通常发生在你传递了错误类型的参数给函数、尝试在不能使用的地方使用某个值，或访问了一个未定义的对象属性或方法时。这种错误通常意味着你需要检查你的代码逻辑，以确保你正在使用正确的数据类型。</p><p>当你遇到 <code>TypeError</code> 时，仔细阅读错误消息，它会告诉你哪个变量或参数是错误的类型，然后你可以回去检查并修正代码。</p><h2 id="exceptions-vs-errors" tabindex="-1"><a class="header-anchor" href="#exceptions-vs-errors"><span><a href="https://nodejs.org/docs/latest/api/errors.html#exceptions-vs-errors" target="_blank" rel="noopener noreferrer">Exceptions vs. errors</a></span></a></h2><p>在 Node.js 中，“异常”和“错误”是两个经常被使用的概念，尽管它们经常互换使用，但它们有不同的意义。</p><p><strong>错误（Errors）</strong><br> 错误通常指代码运行中遇到的预期问题。例如，当你尝试读取一个不存在的文件、连接到不可用的服务器或者当一个 API 调用返回了非成功状态时，这些都可以认为是错误。在 Node.js 中，这些情况通常通过回调函数的第一个参数（err）来表示，或者在 Promises 中作为 reject 的原因。错误表示一些可能出错的操作失败了，但它是程序正常运行的一部分，并且应该被妥善地处理。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试读取一个不存在的文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/non-existent-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 此处进行错误处理，比如返回错误信息给用户</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>异常（Exceptions）</strong><br> 异常则是指程序中没有被捕获的错误，它们通常是因为编程错误（bug），如引用了未定义的变量、调用了 null 对象的方法等。这类错误会导致程序的异常终止，除非你通过 try...catch 结构捕获这些异常并进行处理。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 引用了一个未定义的变量，将会抛出异常</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">notDefinedVariable</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">捕获到异常:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果没有 try...catch 块包围上面的代码，程序将会抛出一个未捕获的异常并退出。</p><p>在 Node.js 中，如果主进程监听了<code>uncaughtException</code>事件，可以捕捉到未被捕获的异常，但这并不是推荐的做法，因为应用可能会处于一个不确定的状态。更好的做法是尽可能在适当的地方处理所有可能的错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">uncaughtException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">未捕获的异常:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结：错误(Error)通常是开发者预料之内的，应该在代码中妥善处理；而异常(Exception)则往往是开发者没有考虑到的情况，通常是程序 bug 导致的，应该在编写代码时就尽量避免。</p><h2 id="openssl-errors" tabindex="-1"><a class="header-anchor" href="#openssl-errors"><span><a href="https://nodejs.org/docs/latest/api/errors.html#openssl-errors" target="_blank" rel="noopener noreferrer">OpenSSL errors</a></span></a></h2><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它常用于创建网络应用程序，例如网页服务器、API 服务或实时通信系统。在 Node.js 的应用程序中，经常需要处理安全数据传输，比如 HTTPS 请求或使用加密技术保护数据。为了实现这些功能，Node.js 使用了一个名为 OpenSSL 的开源工具库。</p><p>OpenSSL 提供了各种密码学函数，包括创建加密连接（如 SSL/TLS 协议）、数字签名和证书管理等。当你在 Node.js 中运用这些功能时，可能会遇到与 OpenSSL 相关的错误。</p><p>在 Node.js v21.7.1 的文档中，“OpenSSL errors”指的是与使用 OpenSSL 库时产生的错误信息。这些错误可能涉及网络通信、证书验证、加密解密操作等方面。如果发生了 OpenSSL 错误，Node.js 会抛出一个 Error 对象，里面包含了导致错误的具体原因。</p><p>下面是一些涉及 OpenSSL 错误的例子：</p><h3 id="实例-1-https-服务器证书问题" tabindex="-1"><a class="header-anchor" href="#实例-1-https-服务器证书问题"><span>实例 1：HTTPS 服务器证书问题</span></a></h3><p>假设你正在创建一个 HTTPS 服务器来提供加密的网络连接，代码可能如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你的 <code>server-key.pem</code> 或者 <code>server-cert.pem</code> 文件有问题，比如证书不匹配、过期或被篡改，Node.js 将无法启动 HTTPS 服务器，并可能抛出一个 OpenSSL 相关的错误。</p><h3 id="实例-2-客户端-ssl-握手失败" tabindex="-1"><a class="header-anchor" href="#实例-2-客户端-ssl-握手失败"><span>实例 2：客户端 SSL 握手失败</span></a></h3><p>当客户端尝试与服务器建立 SSL/TLS 加密连接时，可能会发生握手失败的情况。以下是示意性的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">encrypted.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 443</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果服务器的 SSL 证书验证失败，或者服务器不支持客户端的加密方法，那么 <code>error</code> 事件将会被触发，并且 e 会是一个包含了 OpenSSL 错误信息的对象。</p><h3 id="实例-3-加密操作异常" tabindex="-1"><a class="header-anchor" href="#实例-3-加密操作异常"><span>实例 3：加密操作异常</span></a></h3><p>在对数据进行加密操作时，如果使用了不正确的算法参数或密钥，将会产生错误，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipher</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-secret-key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data to encrypt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encryption failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果密钥长度不正确或给定的算法名称不存在，<code>createCipher</code> 方法将抛出一个错误，该错误可能是由 OpenSSL 触发的。</p><p>总结起来，在 Node.js 中处理 OpenSSL 错误时，重要的是要注意错误回调中提供的信息。理解和诊断错误消息可以帮助你找到问题的根本原因，并采取相应的措施来解决问题。</p><h3 id="error-opensslerrorstack" tabindex="-1"><a class="header-anchor" href="#error-opensslerrorstack"><span><a href="https://nodejs.org/docs/latest/api/errors.html#erroropensslerrorstack" target="_blank" rel="noopener noreferrer">error.opensslErrorStack</a></span></a></h3><p>Node.js 是一个使用 JavaScript 构建服务器端应用程序和命令行工具的平台。在 Node.js 中，有时你会处理与网络通信、安全性等相关的问题，这些问题可能涉及到 OpenSSL。OpenSSL 是一个开源的软件库，它提供了加密功能，包括安全套接层(SSL) 和传输层安全(TLS) 协议的实现，这些都是保护网络通信不被监听或篡改的标准技术。</p><p><code>error.opensslErrorStack</code> 是 Node.js 的错误对象的一个属性，当出现与 OpenSSL 相关的错误时，这个属性会被填充。换句话说，当 Node.js 在执行涉及 OpenSSL 的操作（如创建 HTTPS 服务器或者签名数据）时遇到错误，Node.js 会生成一个包含 <code>opensslErrorStack</code> 属性的错误对象，这个属性包含了 OpenSSL 错误堆栈的详细信息。</p><p>这样做的目的是为了帮助开发人员更好地理解在底层发生了什么错误，以便于调试和修正代码。OpenSSL 错误堆栈通常包含一系列错误消息，这些消息表示了出错过程中的多个步骤。</p><p>让我们来看一些实际运用的例子：</p><ol><li><p><strong>创建 HTTPS 服务器时的错误</strong>：<br> 假设你正在尝试使用 Node.js 创建一个 HTTPS 服务器，并且你需要加载 SSL 证书。如果证书文件有问题，例如文件损坏或格式错误，Node.js 将无法创建服务器，并将生成一个包含 opensslErrorStack 属性的错误对象。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 引入 https 模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取 SSL 证书文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试创建 HTTPS 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  https</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTPS server creation failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">opensslErrorStack</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">OpenSSL Error Stack:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">opensslErrorStack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>签名数据时的错误</strong>：<br> 当你尝试对数据进行数字签名以确保数据的完整性和来源验证时，如果提供给 OpenSSL 的信息不正确，比如私钥错误，你也会遇到错误，并且 <code>opensslErrorStack</code> 属性会包含错误详情。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 引入 crypto 模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试用一个私钥签名数据</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/privateKey.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data to sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Signature:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> signature</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Signing failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">opensslErrorStack</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">OpenSSL Error Stack:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">opensslErrorStack</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>在上述例子中，如果出现错误，<code>catch</code> 代码块会捕获异常，通过打印 <code>err.message</code>，可以得知错误的一般信息。如果存在 <code>err.opensslErrorStack</code>，它会提供一个错误堆栈数组，其中包含了由 OpenSSL 返回的底层错误信息，这对于诊断问题非常有帮助。</p><h3 id="error-function" tabindex="-1"><a class="header-anchor" href="#error-function"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorfunction" target="_blank" rel="noopener noreferrer">error.function</a></span></a></h3><p>好的，让我来帮你理解 Node.js 中的 <code>error.function</code> 属性。</p><p>在 Node.js 中，错误（Error）是一种用于表示运行时问题的对象。当 JavaScript 代码运行中发生异常（比如某个函数无法按预期执行），Node.js 就会抛出一个错误对象。这个错误对象通常会包含几个有用的属性，帮助开发者了解和调试问题。</p><p>其中一个属性就是 <code>error.function</code>。这个属性指向了产生错误时正在被调用的函数（如果可以识别的话）。这个特性在 v15.9.0 版本引入后，能够帮助更精确地定位错误的来源。</p><h3 id="实例解释-1" tabindex="-1"><a class="header-anchor" href="#实例解释-1"><span>实例解释</span></a></h3><p>假设我们有这样一个简单的 Node.js 应用程序：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> ||</span><span style="color:#81A1C1;"> typeof</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid arguments</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> startApplication</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">startApplication</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们定义了两个函数 <code>add</code> 和 <code>startApplication</code>。<code>add</code> 函数预期接收两个数字类型的参数，将它们相加并返回结果。如果参数不是数字，它会抛出错误。<code>startApplication</code> 函数负责启动应用程序，并且尝试用错误的参数类型调用 <code>add</code> 函数（字符串 &#39;a&#39; 和数字 2），导致 <code>add</code> 函数抛出一个错误。</p><p>如果我们在 Node.js 的早期版本中运行这段代码，在错误栈中可能很难看出是哪个函数触发了错误。但是从 v15.9.0 开始，我们可以通过 <code>error.function</code> 属性得知具体是哪个函数出现了问题。在我们的例子中，错误对象的 <code>error.function</code> 属性会指向 <code>add</code> 函数，因为就是在该函数中抛出了错误。</p><h3 id="使用-error-function" tabindex="-1"><a class="header-anchor" href="#使用-error-function"><span>使用 error.function</span></a></h3><p>如果你想要在代码中捕获错误并打印出是哪个函数出错了，可以这样写：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  startApplication</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred in function:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">function</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error message:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码使用了 <code>try...catch</code> 语句来捕获可能发生的任何错误。如果 <code>startApplication</code> 函数中的代码抛出了错误，那么这个错误将被 <code>catch</code> 块捕获。然后，我们可以访问到 <code>error.function.name</code> 来获取触发错误的函数名称，并显示出来。</p><p>请注意，虽然 <code>error.function</code> 在很多情况下非常有用，但并不是所有的错误都会有这个属性。有些错误可能是由于非函数级的操作导致的，例如语法错误或系统层面的问题，在这类情况下，<code>error.function</code> 可能是未定义的。</p><h3 id="error-library" tabindex="-1"><a class="header-anchor" href="#error-library"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorlibrary" target="_blank" rel="noopener noreferrer">error.library</a></span></a></h3><p>在 Node.js 中，错误处理是编程中非常重要的一个部分，因为它可以帮助你理解代码中出现的问题，并且确保程序能够优雅地处理这些问题。<code>error.library</code> 是 Node.js 文档中提到的一个标识符，它通常用于表示错误来源自 Node.js 的底层库。</p><p>当 Node.js 的内部库发生错误时，会创建一个 <code>Error</code> 对象来描述这个错误。这个 <code>Error</code> 对象会有多种属性，其中包括但不限于：</p><ul><li><code>message</code>：描述错误的文字信息。</li><li><code>name</code>：错误名字，如 <code>TypeError</code>, <code>RangeError</code> 等。</li><li><code>stack</code>：错误堆栈跟踪，显示错误发生的位置。</li><li><code>code</code>：一个字符串，表示特定类型的错误代码。</li></ul><p>Node.js 中的 <code>error.code</code> 属性可以包含很多不同的值，比如 <code>ENOTFOUND</code>, <code>ECONNREFUSED</code>, <code>EACCES</code> 等，这些都是具体的错误代码，它们能够告诉你错误的性质。</p><h3 id="实际运用的例子" tabindex="-1"><a class="header-anchor" href="#实际运用的例子"><span>实际运用的例子</span></a></h3><p><strong>文件系统操作时遇到的权限错误</strong></p><p>假设你正在尝试使用 Node.js 的 <code>fs</code> 模块来读取一个文件，但是你的应用程序没有足够的权限来访问这个文件。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/secret-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 这里我们检查了错误，并打印出相关信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果出现权限错误，你可能会得到一个包含 <code>EACCES</code> 错误代码的 <code>Error</code> 对象。这表明你的应用需要更高的权限才能读取该文件。</p><p><strong>网络请求时的连接被拒绝错误</strong></p><p>另一个例子是你可能在进行网络请求时遇到错误。例如，你正在尝试连接到一个服务器，但是服务器拒绝了你的连接请求。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...处理响应...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里我们捕获了错误，并打印出相关信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error message: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果服务器不可达或拒绝连接，你可能会收到一个包含 <code>ENOTFOUND</code> 或者 <code>ECONNREFUSED</code> 错误代码的 <code>Error</code> 对象。</p><p>在这两个例子中，通过检查 <code>Error</code> 对象的 <code>code</code> 属性，你可以获取关于错误的详细信息，并据此决定如何处理这些错误。例如，如果错误代码是 <code>EACCES</code>，你可能需要检查文件的权限设置；如果错误代码是 <code>ENOTFOUND</code> 或 <code>ECONNREFUSED</code>，你可能需要检查网络连接或服务器地址是否正确。</p><h3 id="error-reason" tabindex="-1"><a class="header-anchor" href="#error-reason"><span><a href="https://nodejs.org/docs/latest/api/errors.html#errorreason" target="_blank" rel="noopener noreferrer">error.reason</a></span></a></h3><p><code>error.reason</code> 是 Node.js v21.7.1 及更高版本中 <code>Error</code> 类的一个属性。这个属性在创建错误对象时不会自动出现，而是你可以在自定义错误时使用它来存储额外的信息或者上下文，这能帮助开发者更好地理解和处理错误。</p><p>在 Node.js 中，当你抛出一个错误时，通常会使用 <code>Error</code> 对象，就像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Something went wrong!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然而，有时仅仅提供错误消息可能不足以充分描述问题，尤其是当错误涉及到复杂的操作或者多层次的函数调用时。这时候，<code>error.reason</code> 就派上了用场，它允许你附加关于错误原因的额外详细信息。</p><p>这里有几个实际应用的例子：</p><h3 id="例-1-网络请求错误" tabindex="-1"><a class="header-anchor" href="#例-1-网络请求错误"><span>例 1: 网络请求错误</span></a></h3><p>假设你正在编写一个函数，该函数负责从远程 API 获取数据。如果网络请求失败，你可能想要知道具体原因（例如网络断开、服务端错误等）。使用 <code>error.reason</code> 可以包含这些详细信息：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fetch</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node-fetch</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> fetchData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> response</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> fetch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ok</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 如果响应状态不是2xx</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to fetch data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">HTTP status code: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">status</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">json</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 解析JSON并返回</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出基本的错误信息</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Reason: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出额外的错误原因信息</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#616E88;">    // 处理错误...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">fetchData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://some-api.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例-2-数据库查询错误" tabindex="-1"><a class="header-anchor" href="#例-2-数据库查询错误"><span>例 2: 数据库查询错误</span></a></h3><p>如果你在查询数据库时遇到错误，使用 <code>error.reason</code> 可以帮助存储关于数据库查询失败的额外信息。比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> db</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some-database-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> queryDatabase</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">query</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parameters</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> db</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">execute</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">query</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parameters</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">originalError</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Database query failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      message</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> originalError</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">      code</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> originalError</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">queryDatabase</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SELECT * FROM users WHERE id = ?</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#D8DEE9;">userId</span><span style="color:#D8DEE9FF;">])</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">        `</span><span style="color:#A3BE8C;">Reason: Code=</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">, Message=</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">reason</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#616E88;">    // 处理错误...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这两个示例中，我们都看到了如何使用 <code>error.reason</code> 来携带更多与错误相关的上下文信息。这对于调试和错误处理非常有用，因为它能够给出导致错误的更深层次的原因。</p><h2 id="node-js-error-codes" tabindex="-1"><a class="header-anchor" href="#node-js-error-codes"><span><a href="https://nodejs.org/docs/latest/api/errors.html#nodejs-error-codes" target="_blank" rel="noopener noreferrer">Node.js error codes</a></span></a></h2><p>好的，Node.js 错误代码是一套标准化的代码，用来表示程序运行过程中可能遇到的各种错误类型。每个错误代码都对应具体的错误情况，这样开发者就能更快地定位和理解问题。</p><p>在 Node.js 中，当出现错误时，通常会抛出一个<code>Error</code>对象。这个<code>Error</code>对象可能会包含几个不同的属性，其中最常见的是<code>message</code>和<code>stack</code>，分别代表错误信息和错误发生时的调用栈。但在 Node.js 中，还有一个特殊的属性叫做<code>code</code>，它代表了一个特定的错误代码。</p><p>Node.js 错误代码通常是一个字符串，由大写字母和下划线组成。例如：</p><ul><li><code>EACCES</code>: 表示权限被拒绝。如果你尝试访问或操作一个没有正确权限的文件或目录，可能会遇到这个错误。</li><li><code>ENOENT</code>: 表示文件或目录不存在。当你尝试读取或操作一个不存在的文件时，就会得到这个错误。</li><li><code>EADDRINUSE</code>: 表示地址已在使用。比如，在启动服务器监听时，如果指定的端口已经被其他进程占用，就会抛出这个错误。</li></ul><p>举例来说：</p><ol><li>权限被拒绝（<code>EACCES</code>）:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试写入一个只读文件，这将导致EACCES错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/read-only-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EACCES</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">错误：没有权限写入文件</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>文件或目录不存在（<code>ENOENT</code>）:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/non-existent-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ENOENT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">错误：文件不存在</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">未知错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>地址已在使用（<code>EADDRINUSE</code>）:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设端口3000已被其他服务占用</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EADDRINUSE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">错误：端口3000已被占用！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">未知错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器正在监听端口3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过检查错误的<code>code</code>属性，我们可以提供更具针对性的错误处理逻辑，甚至给用户更清晰的反馈。大多数的 Node.js 核心 APIs 都遵循这样的错误处理模式，这也使得跨模块的错误处理成为可能，因为错误代码是一种共享的、标准化的方式来识别和描述错误。</p><h3 id="abort-err" tabindex="-1"><a class="header-anchor" href="#abort-err"><span><a href="https://nodejs.org/docs/latest/api/errors.html#abort_err" target="_blank" rel="noopener noreferrer">ABORT_ERR</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时，它可以让你在服务器端运行 JavaScript 代码。在 Node.js 中，处理错误是一个重要的部分，因为正确地处理错误可以让你的应用更加健壮和用户友好。</p><p><code>ABORT_ERR</code> 是 Node.js 中一种特定类型的错误，它属于 <code>DOMException</code> 错误的一种。通常情况下，<code>DOMException</code> 错误用于浏览器环境，但是 Node.js 模拟了这样的错误类型，以提供与浏览器中相似的编程体验。</p><p><code>ABORT_ERR</code> 表示操作被中止的错误。在 Node.js 的某些场景中，当一个操作被故意停止或取消时，就可能会出现这种错误。例如，如果你使用了支持 AbortController API 的 API（如 <code>fetch</code>），并且通过一个 <code>AbortSignal</code> 来取消一个请求或其他异步操作，那么如果该操作响应取消信号，则可能会抛出 <code>ABORT_ERR</code> 错误。</p><p>实际的例子：</p><ol><li>取消 HTTP 请求：<br> 假设你正在使用支持 <code>AbortController</code> 的 HTTP 客户端库（例如 node-fetch）来发送 HTTP 请求。你希望能够在必要时取消这个请求，比如用户想要停止下载或者应用程序需要在超时时终止请求。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fetch</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node-fetch</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> AbortController</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">abort-controller</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 AbortController 实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> controller</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> AbortController</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signal</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> controller</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">signal</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送一个 HTTP 请求</span></span>
<span class="line"><span style="color:#88C0D0;">fetch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> signal</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">json</span><span style="color:#D8DEE9FF;">())</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AbortError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 如果捕获到 ABORT_ERR 错误，表示请求被中止</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The request was aborted.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 处理其他类型的错误</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Request failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在某个条件下，我们决定取消这个请求</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  controller</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将导致上面的 fetch 调用抛出一个 ABORT_ERR 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 5000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设5秒后取消请求</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>使用 Streams：<br> 在 Node.js 中，当你使用流式（Streams）接口进行数据传输时，也可能会遇到 <code>ABORT_ERR</code>。如果流被用户中断或由于某种原因需要提前关闭流，这时可能需要处理这种错误。</li></ol><p>例如，假设你有一个大型文件的下载任务，但中途用户取消了下载：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> AbortController</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">abort-controller</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 AbortController 实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> controller</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> AbortController</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signal</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> controller</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">signal</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个文件读取流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">large-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> signal</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理文件数据</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AbortError</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 用户取消下载操作</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File streaming was aborted by the user.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设在用户界面有一个取消按钮，当点击时调用以下函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> onCancelButtonClick</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  controller</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将导致读取流抛出一个 ABORT_ERR 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上两个例子中，我们可以看到 <code>ABORT_ERR</code> 用于标识一个操作因为被取消而没有成功完成。正确地捕获和处理这类错误对于开发一个可靠且用户友好的应用程序非常重要。</p><h3 id="err-access-denied" tabindex="-1"><a class="header-anchor" href="#err-access-denied"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_access_denied" target="_blank" rel="noopener noreferrer">ERR_ACCESS_DENIED</a></span></a></h3><p><code>ERR_ACCESS_DENIED</code> 是 Node.js 中一个特定类型的错误，表示当你试图进行某项操作但是被系统拒绝访问时所抛出的错误。通常这种错误与权限有关，比如你可能没有足够的权限来读取一个文件、写入一个文件或者执行一个网络请求等。</p><p>在 Node.js v21.7.1 的文档中，<code>ERR_ACCESS_DENIED</code> 错误表明了对于某个资源的访问被操作系统拒绝了。下面我会举几个实际例子来说明这个错误可能在什么情况下发生：</p><h3 id="例子-1-尝试读取受保护的文件" tabindex="-1"><a class="header-anchor" href="#例子-1-尝试读取受保护的文件"><span>例子 1：尝试读取受保护的文件</span></a></h3><p>假设你有一个受操作系统保护的文件，像是只有管理员权限才能读取的文件。如果你的 Node.js 应用程序试图以普通用户身份去读取这个文件，你可能会遇到 <code>ERR_ACCESS_DENIED</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/protected-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法读取文件: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 如果是权限问题，可能会打印:</span></span>
<span class="line"><span style="color:#616E88;">    // 无法读取文件: Access denied</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-2-尝试写入不可写目录" tabindex="-1"><a class="header-anchor" href="#例子-2-尝试写入不可写目录"><span>例子 2：尝试写入不可写目录</span></a></h3><p>如果你的应用试图写入一个只读文件系统的目录，或者当前用户没有写权限的目录，你也可能会收到 <code>ERR_ACCESS_DENIED</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/read-only-directory/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法写入文件: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里可能会输出：</span></span>
<span class="line"><span style="color:#616E88;">    // 无法写入文件: Access denied</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件写入成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-3-尝试监听一个没有权限的端口" tabindex="-1"><a class="header-anchor" href="#例子-3-尝试监听一个没有权限的端口"><span>例子 3：尝试监听一个没有权限的端口</span></a></h3><p>在网络编程中，监听低于 1024 的端口号通常需要管理员权限（root）。如果你尝试以普通用户身份监听这样的端口，将抛出 <code>ERR_ACCESS_DENIED</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">80</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法监听端口: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 输出可能是：</span></span>
<span class="line"><span style="color:#616E88;">    // 无法监听端口: Access denied</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器启动成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上就是 <code>ERR_ACCESS_DENIED</code> 错误的一些常见场景。要解决这类问题，通常需要检查和修改文件或资源的权限设置，或者以更高权限运行你的 Node.js 程序（例如使用管理员账户）。但请注意，以更高权限运行程序可能带来安全风险，因此必须谨慎操作。</p><h3 id="err-ambiguous-argument" tabindex="-1"><a class="header-anchor" href="#err-ambiguous-argument"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_ambiguous_argument" target="_blank" rel="noopener noreferrer">ERR_AMBIGUOUS_ARGUMENT</a></span></a></h3><p><code>ERR_AMBIGUOUS_ARGUMENT</code>是在 Node.js 中遇到的一个错误类型，它表示函数或方法收到了一个含糊不清的参数，使得该函数或方法无法决定如何处理这个参数。在编程中，我们常常需要给函数传递参数，以便它能执行特定的操作。当函数预期接收一个明确的参数，而实际上却得到了可能有多种解释的参数时，就会抛出<code>ERR_AMBIGUOUS_ARGUMENT</code>错误。</p><p>举一个简单但具体的例子来说明：</p><p>假设我们有一个 Node.js 的文件处理函数，它需要一个标志来表明是要删除还是备份一个文件。如果这个标志既可以是字符串<code>&#39;delete&#39;</code>也可以是布尔值<code>true</code>，那么传入的参数可能就会让函数产生混淆。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">action</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">action</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">delete</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件将被删除</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 删除文件的代码逻辑</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">action</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">backup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件将被备份</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 备份文件的代码逻辑</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 如果&#39;action&#39;参数既不是&#39;delete&#39;也不是&#39;backup&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">ERR_AMBIGUOUS_ARGUMENT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">The action argument is ambiguous.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用这个函数</span></span>
<span class="line"><span style="color:#88C0D0;">handleFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">delete</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正常工作，打印 &quot;文件将被删除&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">handleFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">backup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正常工作，打印 &quot;文件将被备份&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 抛出 `ERR_AMBIGUOUS_ARGUMENT` 错误，因为 true 既不是 &#39;delete&#39; 也不是 &#39;backup&#39;</span></span>
<span class="line"><span style="color:#88C0D0;">handleFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，当我们试图用<code>true</code>调用<code>handleFile</code>函数时，函数不知道这意味着什么，因为它没有办法判断<code>true</code>是指删除文件还是备份文件。结果，就会抛出一个错误告诉调用者这个参数是含糊不清的。</p><p>在 Node.js 的官方文档中，通常会列出每个 API 可能抛出的错误类型，以及导致这些错误的原因。对于<code>ERR_AMBIGUOUS_ARGUMENT</code>，查阅官方文档可以了解具体是哪个 API 或场景下可能会抛出这类错误，从而帮助开发者更准确地使用 API 并处理潜在的问题。</p><p>请注意，Node.js 版本更新过程中可能会增加新的错误类型或改变现有错误处理机制，所以最好的实践是查阅当前使用的 Node.js 版本的官方文档获取最新和最准确的信息。</p><h3 id="err-arg-not-iterable" tabindex="-1"><a class="header-anchor" href="#err-arg-not-iterable"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_arg_not_iterable" target="_blank" rel="noopener noreferrer">ERR_ARG_NOT_ITERABLE</a></span></a></h3><p><code>ERR_ARG_NOT_ITERABLE</code> 是 Node.js 中的一个错误类型，它会在你尝试对一个不是可迭代对象（即不能用于循环的对象）进行迭代操作时抛出。在 JavaScript 中，一个可迭代对象指的是可以使用如 <code>for...of</code> 循环来遍历其元素的对象。</p><p><strong>什么是可迭代对象？</strong><br> 一般来说，数组、字符串、Map 和 Set 都是可迭代的对象，因为它们内部都实现了一个叫做 <code>[Symbol.iterator]</code> 的方法，这个方法会返回一个迭代器对象，通过这个迭代器对象可以逐个访问集合中的元素。</p><p><strong>出现 ERR_ARG_NOT_ITERABLE 错误常见的情况：</strong></p><ul><li>尝试对一个非迭代对象如普通对象 <code>{}</code> 使用 <code>for...of</code>。</li><li>在需要提供可迭代对象的函数或构造函数中传入了非可迭代的参数。</li></ul><p><strong>例子 1：使用 <code>for...of</code> 循环遍历非可迭代对象：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> age</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 25</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误示范：尝试遍历一个普通对象</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> item</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> obj</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 这里会抛出 ERR_ARG_NOT_ITERABLE 错误，因为 obj 不是可迭代的。</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试使用 <code>for...of</code> 循环来遍历一个普通对象 <code>obj</code>，但是因为普通对象并没有实现 <code>[Symbol.iterator]</code> 方法，所以它不是可迭代的，这就会导致 <code>ERR_ARG_NOT_ITERABLE</code> 错误。</p><p><strong>例子 2：向构造函数传入非可迭代对象：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 错误示范：尝试用一个非可迭代对象创建一个新的 Set</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> mySet</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Set</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> a</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> b</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里期望传入一个可迭代对象</span></span>
<span class="line"><span style="color:#616E88;">  // 上面的代码会抛出 ERR_ARG_NOT_ITERABLE 错误，因为普通对象 { a: 1, b: 2 } 不是可迭代的。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试使用一个普通对象 <code>{ a: 1, b: 2 }</code> 来初始化一个新的 <code>Set</code> 对象。然而，<code>Set</code> 构造函数期待的是一个可迭代对象，因此当它接收到一个非可迭代对象时，就会抛出 <code>ERR_ARG_NOT_ITERABLE</code> 错误。</p><p>要修复这些错误，确保你只在需要可迭代对象的地方使用可迭代对象。例如，如果你想遍历对象的属性，你可以使用 <code>Object.keys()</code> 或者 <code>Object.entries()</code> 等方法将对象的键或键值对转换成数组形式，然后再进行遍历：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> age</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 25</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确示范：使用 Object.keys() 获取所有的键，并遍历它们</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">keys</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：name, age</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 或者使用 Object.entries() 获取键值对数组，并遍历它们</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> [</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> value</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">entries</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> value</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：name Alice, age 25</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总之，当你看到 <code>ERR_ARG_NOT_ITERABLE</code> 错误时，检查你的代码是否在试图迭代一个非可迭代对象，并对代码进行相应的调整。</p><h3 id="err-assertion" tabindex="-1"><a class="header-anchor" href="#err-assertion"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_assertion" target="_blank" rel="noopener noreferrer">ERR_ASSERTION</a></span></a></h3><p>Node.js 中的<code>ERR_ASSERTION</code>错误是一个特定类型的错误，它通常在代码中使用 assert 模块时遇到。<code>assert</code> 模块是 Node.js 核心模块之一，它提供了一种简单的方式来测试表达式是否为真。如果你用 <code>assert</code> 检查一个表达式，并且那个表达式评估为 <code>false</code>，那么 <code>assert</code> 会抛出 <code>ERR_ASSERTION</code> 错误。</p><p>举个例子，假设你正在写一个函数来计算两个数字的和，并且想确保结果总是正确的。你可以使用 <code>assert</code> 模块来断言你的结果是否符合预期：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> assert</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">assert</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 我们期望 3 和 4 的和是 7</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 4</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用assert来检查这个条件是否为真</span></span>
<span class="line"><span style="color:#D8DEE9;">assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">strictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 7</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">3 加 4 应该等于 7</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码将不会有任何问题，因为<code>3+4</code>确实等于<code>7</code>。但是，假如我们改变了加法函数，使其出错：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 故意的错误：结果应该是 a + b，但这里返回了 a * b</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 4</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这次 assertion 将失败，并且抛出 ERR_ASSERTION 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">strictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 7</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">3 加 4 应该等于 7</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在执行上述代码时，<code>add(3, 4)</code> 实际返回的是 <code>12</code> 而不是 <code>7</code>。<code>assert.strictEqual</code> 方法会检查 <code>result</code> 是否严格等于 <code>7</code>，由于不相等，所以会抛出一个 <code>AssertionError</code>，并且输出我们提供的错误信息 <code>&#39;3 加 4 应该等于 7&#39;</code>。</p><p>在实际应用中，<code>assert</code> 模块常用于单元测试。单元测试是开发过程中的测试阶段，开发者会写小的测试来检查代码的各个部分（称为“单元”）是否如预期般运行。在这些单元测试中，<code>assert</code> 常被用来验证代码逻辑。</p><p>比如说，你可能有一个购物车对象，需要保证添加商品后，购物车内商品的数量是正确的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> assert</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">assert</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> ShoppingCart</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">products</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  addProduct</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">product</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">products</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">product</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  getNumberOfProducts</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">products</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 测试添加商品功能</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cart</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ShoppingCart</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">cart</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addProduct</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Book</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">cart</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addProduct</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> id</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Pen</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 断言购物车中的商品数量应该是 2</span></span>
<span class="line"><span style="color:#D8DEE9;">assert</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">strictEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">cart</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getNumberOfProducts</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">购物车中应该有两件商品</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你试图添加了两个产品，但是写错了<code>addProduct</code>方法导致没有正确添加，那么<code>getNumberOfProducts()</code>返回的值将不是 2，<code>assert.strictEqual</code>就会抛出一个<code>ERR_ASSERTION</code>错误，提示你代码中存在问题，需要修正。</p><h3 id="err-async-callback" tabindex="-1"><a class="header-anchor" href="#err-async-callback"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_async_callback" target="_blank" rel="noopener noreferrer">ERR_ASYNC_CALLBACK</a></span></a></h3><p>在 Node.js 中，错误是一种让程序员知道出现了问题的机制。<code>ERR_ASYNC_CALLBACK</code> 是 Node.js 中一种特定类型的错误代码，它通常表示在使用异步函数时出现了问题。异步函数是指那些并不立即完成其任务，而是在将来某个时间点完成，并且通常需要回调函数来处理结果的函数。</p><p>错误 <code>ERR_ASYNC_CALLBACK</code> 会发生在你试图调用一个异步函数但没有提供正确的回调函数时。一个回调函数通常是一个传递给另一个函数以在稍后执行的函数。在 Node.js 中，很多库和内置模块都依赖于这种异步及回调的模式来处理耗时的操作，比如文件读写或网络请求。</p><p>举例来说：</p><h3 id="错误示例" tabindex="-1"><a class="header-anchor" href="#错误示例"><span>错误示例</span></a></h3><p>假设我们有一个简单的异步操作，比如读取文件内容，我们可以使用 Node.js 内置的<code>fs</code>模块来实现：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试异步地读取文件，但忘记传入回调函数</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">somefile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码尝试读取名为<code>somefile.txt</code>的文件，但是我们没有提供一个回调函数来处理读取操作完成后的情况，也就是说我们不知道何时文件读取完成，以及是否成功。这会导致 Node.js 抛出<code>ERR_ASYNC_CALLBACK</code>错误，告诉我们我们忘记提供必要的回调函数参数。</p><h3 id="正确示例" tabindex="-1"><a class="header-anchor" href="#正确示例"><span>正确示例</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 提供回调函数来处理文件读取后的结果</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">somefile.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果有错误发生，比如文件不存在，会进入这里</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 输出文件内容</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述正确的示例中，我们提供了一个回调函数作为<code>fs.readFile</code>的第二个参数。当文件读取完毕时，无论成功或失败，这个回调函数都会被调用。如果有错误发生（例如文件不存在），<code>err</code>参数会包含错误信息。否则，<code>err</code>会是<code>null</code>，而<code>data</code>参数会包含文件的内容。</p><p>总结一下，<code>ERR_ASYNC_CALLBACK</code>错误是告诉你在进行异步操作时忘记提供回调函数，或者提供的回调函数格式不对。确保在进行异步编程时始终提供正确的回调函数，这样你的代码才能按预期运行。</p><h3 id="err-async-type" tabindex="-1"><a class="header-anchor" href="#err-async-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_async_type" target="_blank" rel="noopener noreferrer">ERR_ASYNC_TYPE</a></span></a></h3><p><code>ERR_ASYNC_TYPE</code> 是 Node.js 中的一个错误代码，它指示在使用异步操作（如读写文件、数据库交互或网络通信等）时出现了不适当的类型。这个错误通常和回调函数、Promises 或者 async/await 等异步编程模式相关联。</p><p>为了理解 <code>ERR_ASYNC_TYPE</code>，我们首先需要知道在 Node.js 中进行异步操作时，你通常会使用以下几种方式：</p><ol><li>回调函数（Callback Functions）</li><li>Promises</li><li>Async/Await（基于 Promises）</li></ol><p>当你使用这些方法不正确地处理数据类型时，就可能遇到 <code>ERR_ASYNC_TYPE</code> 错误。</p><p>让我们通过几个实际的例子来进一步说明：</p><h3 id="示例-1-回调函数中的不当类型" tabindex="-1"><a class="header-anchor" href="#示例-1-回调函数中的不当类型"><span>示例 1：回调函数中的不当类型</span></a></h3><p>假设你正在使用传统的回调方式来读取文件内容：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的使用，提供了一个字符串而不是一个函数作为回调</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">我不是函数</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>fs.readFile</code> 函数期望接收到一个函数作为它的第三个参数（即回调函数），但是由于错误地提供了一个字符串 <code>&#39;我不是函数&#39;</code>，Node.js 将抛出 <code>ERR_ASYNC_TYPE</code> 错误，因为它期待的是一个函数类型。</p><h3 id="示例-2-promise-的错误用法" tabindex="-1"><a class="header-anchor" href="#示例-2-promise-的错误用法"><span>示例 2：Promise 的错误用法</span></a></h3><p>如果你在使用 Promise 时尝试将一个非函数值作为<code>.then</code>或<code>.catch</code>的处理器，同样会导致 <code>ERR_ASYNC_TYPE</code> 错误发生：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个Promise</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> promise</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">成功</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用.then链接，但传入的不是函数</span></span>
<span class="line"><span style="color:#D8DEE9;">promise</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这里应该是个函数</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的 Promise 链中，<code>.then</code>方法期望得到一个函数来处理前面 Promise 的结果，但是这里传入了字符串 <code>&#39;这里应该是个函数&#39;</code>，这将引发 <code>ERR_ASYNC_TYPE</code> 错误。</p><h3 id="示例-3-async-await-的错误用法" tabindex="-1"><a class="header-anchor" href="#示例-3-async-await-的错误用法"><span>示例 3：Async/Await 的错误用法</span></a></h3><p>现代 JavaScript 支持 async/await 来处理异步操作，这使得代码看起来像是同步执行的，但如果你错误地处理了返回类型，则也会出现 <code>ERR_ASYNC_TYPE</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> getData</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> someAsyncOperation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设someAsyncOperation是一个异步函数</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的调用</span></span>
<span class="line"><span style="color:#88C0D0;">getData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">我应该没有参数</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在此例中，<code>getData</code> 函数不应该接受任何参数，但在调用时错误地传入了一个字符串，虽然这种情况下可能不会直接抛出 <code>ERR_ASYNC_TYPE</code> 错误，但如果 <code>someAsyncOperation</code> 内部检查参数类型，并且预期是一个特定的类型，那么传递错误的参数类型可以触发 <code>ERR_ASYNC_TYPE</code>。</p><p>这种错误通常很容易修复，只需确保你传递给异步操作的参数是正确的类型即可。在开发过程中，尤其在处理异步代码时，要注意函数签名和预期的参数类型，以避免此类问题。</p><h3 id="err-brotli-compression-failed" tabindex="-1"><a class="header-anchor" href="#err-brotli-compression-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_brotli_compression_failed" target="_blank" rel="noopener noreferrer">ERR_BROTLI_COMPRESSION_FAILED</a></span></a></h3><p>Node.js 是一个基于 Chrome 的 V8 引擎的 JavaScript 运行环境，让我们可以在服务器端执行 JavaScript 代码。在 Node.js 中，我们经常需要对数据进行压缩，以减少数据的大小，加快传输速度。Brotli 是一种压缩算法，被用来在网络中传输数据时压缩数据。</p><p>当你在 Node.js v21.7.1 或者其他版本使用 Brotli 算法压缩数据时，可能会遇到<code>ERR_BROTLI_COMPRESSION_FAILED</code>这个错误。这个错误表示尝试使用 Brotli 算法压缩数据失败了。出现这个错误，可能有几个不同的原因：</p><ol><li>你传递给压缩函数的数据可能是不合法的或者格式有问题。</li><li>可能是 Node.js 环境中存在一个 bug，导致压缩失败。</li><li>系统资源不足，比如内存不够，导致无法完成压缩操作。</li></ol><p>举个例子，如果你正在编写一个 Web 服务，想要把发送给用户浏览器的文件进行压缩，你可能会用到<code>zlib</code>模块中的 Brotli 相关功能。代码可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">zlib</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">request</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设你想发送的文件是example.txt</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> brotli</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createBrotliCompress</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建一个Brotli压缩流</span></span>
<span class="line"><span style="color:#D8DEE9;">    response</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">br</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置响应头告知浏览器内容使用了Brotli压缩</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    readStream</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">brotli</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 把读取流通过Brotli压缩</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">response</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 然后把压缩后的数据流向响应</span></span>
<span class="line"><span style="color:#ECEFF4;">      .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_BROTLI_COMPRESSION_FAILED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">          // 这里处理Brotli压缩失败的错误</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Brotli compression failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，如果由于某些原因 Brotli 压缩失败了，那么<code>.on(&#39;error&#39;, ...)</code>部分将会捕获这个错误，并在控制台输出错误信息。处理这种错误的方式可能包括返回一个未压缩的版本的文件、记录错误日志供以后分析或者重试压缩过程。</p><p>处理<code>ERR_BROTLI_COMPRESSION_FAILED</code>错误的策略会根据你的应用程序和上下文而有所不同。关键是确保你的程序能够优雅地处理这种情况，不会因为压缩失败就崩溃或者影响用户体验。</p><h3 id="err-brotli-invalid-param" tabindex="-1"><a class="header-anchor" href="#err-brotli-invalid-param"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_brotli_invalid_param" target="_blank" rel="noopener noreferrer">ERR_BROTLI_INVALID_PARAM</a></span></a></h3><p>Node.js 中的<code>ERR_BROTLI_INVALID_PARAM</code>错误是一个特定类型的异常，它发生在使用 Brotli 压缩算法时提供了非法或无效的参数。Brotli 是一种通用的压缩算法，它可以用在网络传输和文件存储中，以减少数据大小。在 Node.js 中，使用 Brotli 可以帮助你更高效地处理网络请求和响应。</p><p>当你尝试使用 Node.js 内置的<code>zlib</code>模块进行 Brotli 压缩或解压缩操作，并且传递了不正确的参数给这个模块时，你会遇到<code>ERR_BROTLI_INVALID_PARAM</code>错误。例如，你可能指定了一个不存在的配置选项，或者为一个期望数字类型的选项提供了一个字符串类型的值。</p><p>下面来通过一些实际的代码例子来说明这个错误和如何避免它。</p><h3 id="示例-1-使用-brotli-压缩数据" tabindex="-1"><a class="header-anchor" href="#示例-1-使用-brotli-压缩数据"><span>示例 1：使用 Brotli 压缩数据</span></a></h3><p>首先，让我们看一个正常工作的 Brotli 压缩示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">zlib</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这是我们要压缩的数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> input</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">zlib</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">brotliCompress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> compressed</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">压缩过程中出错:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">压缩后的数据:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> compressed</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码将输入的字符串<code>&quot;Hello World&quot;</code>使用 Brotli 算法压缩，并输出压缩后的结果。如果一切正常，你会在控制台看到编码后的压缩数据。</p><h3 id="示例-2-产生err-brotli-invalid-param错误" tabindex="-1"><a class="header-anchor" href="#示例-2-产生err-brotli-invalid-param错误"><span>示例 2：产生<code>ERR_BROTLI_INVALID_PARAM</code>错误</span></a></h3><p>现在，假设我们在调用<code>brotliCompress</code>函数时，提供了一个无效的参数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">zlib</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这是我们要压缩的数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> input</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里我们故意提供了一个无效的参数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> mode</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">invalid_mode</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;mode&#39; 应该是一个数字</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">zlib</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">brotliCompress</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> compressed</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">压缩过程中出错:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 输出错误信息，可能会显示 ERR_BROTLI_INVALID_PARAM</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">压缩后的数据:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> compressed</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，我们尝试传递了一个名为<code>mode</code>的选项，并给它赋予了一个无效的值<code>&#39;invalid_mode&#39;</code>（正确的值应该是一个预定义的数字）。因此，在运行时，代码会抛出<code>ERR_BROTLI_INVALID_PARAM</code>错误。</p><h3 id="如何避免err-brotli-invalid-param错误" tabindex="-1"><a class="header-anchor" href="#如何避免err-brotli-invalid-param错误"><span>如何避免<code>ERR_BROTLI_INVALID_PARAM</code>错误？</span></a></h3><p>要避免这个错误，你需要确保按照 Node.js 文档中的规定提供正确的参数。以下是一些建议：</p><ol><li>阅读官方文档，确保理解每个参数的合法值。</li><li>对于枚举值或具有特定范围的参数，请检查是否传递了允许的值。</li><li>编写代码时，请认真检查变量类型和值。</li><li>在可行的情况下，添加参数验证逻辑，确保在调用之前捕获错误。</li></ol><p>总之，每当使用 Node.js 的 API 时，都应该仔细阅读相关文档并遵循其参数规范，这样才能避免<code>ERR_BROTLI_INVALID_PARAM</code>这类由参数不正确所引起的错误。</p><h3 id="err-buffer-context-not-available" tabindex="-1"><a class="header-anchor" href="#err-buffer-context-not-available"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_buffer_context_not_available" target="_blank" rel="noopener noreferrer">ERR_BUFFER_CONTEXT_NOT_AVAILABLE</a></span></a></h3><p><code>ERR_BUFFER_CONTEXT_NOT_AVAILABLE</code> 是一个错误类型，它指示在 Node.js 中发生了一个特定的问题，即当试图使用 <code>Buffer</code> 实例而其相关的上下文不可用时，这个错误就会被抛出。</p><p>在 Node.js 中，<code>Buffer</code> 对象是用来处理二进制数据的。它是一个全局构造函数，可以直接使用，不需要导入任何模块。你可以理解为 <code>Buffer</code> 是一段内存空间，它可以存储多种格式的数据（例如：字符串、数组等），但更常用于处理文件、网络通信等场景中的原始二进制数据。</p><p>而&quot;上下文&quot;通常指代执行环境，其中包含了代码运行时的所有状态和变量。在 Node.js 的 <code>Buffer</code> 实现中，每个 <code>Buffer</code> 实例都关联到它被创建时的上下文。如果该上下文由于某些原因不再可用（比如，所在的线程已经结束工作），那么再尝试操作这个 <code>Buffer</code> 就会引发 <code>ERR_BUFFER_CONTEXT_NOT_AVAILABLE</code> 错误。</p><p>举例来说：</p><ol><li><p>在使用了 <code>Worker Threads</code> （工作线程）的情况下，如果主线程创建一个 <code>Buffer</code> 然后传递给了一个工作线程，当工作线程试图使用这个 <code>Buffer</code> 时，假设主线程已经结束了，这时候 <code>Buffer</code> 的上下文可能已经消失，工作线程再操作这个 <code>Buffer</code> 就可能触发 <code>ERR_BUFFER_CONTEXT_NOT_AVAILABLE</code> 错误。</p></li><li><p>又或者，如果你在一个 Node.js 的 <code>http.Server</code> 请求处理器中创建了一个 <code>Buffer</code>，并且试图在请求完成后的某个异步回调中使用它，如果服务器在这之前关闭了，那么当回调执行时，可能会遇到 <code>Buffer</code> 上下文不可用的情况。</p></li></ol><p>请注意，上述情况很少见，大多数普通应用场景下不会遇到这类错误。Node.js 的 <code>Buffer</code> 管理通常都是自动的，并且上下文管理也很隐蔽，开发者一般无需直接关心。</p><p>如果你确实遇到了 <code>ERR_BUFFER_CONTEXT_NOT_AVAILABLE</code> 这样的错误，需要查看你的代码上下文是否有跨线程或者异步调用导致 <code>Buffer</code> 的上下文失效，然后相应地进行修正，确保 <code>Buffer</code> 使用时上下文依然有效。</p><h3 id="err-buffer-out-of-bounds" tabindex="-1"><a class="header-anchor" href="#err-buffer-out-of-bounds"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_buffer_out_of_bounds" target="_blank" rel="noopener noreferrer">ERR_BUFFER_OUT_OF_BOUNDS</a></span></a></h3><p><code>ERR_BUFFER_OUT_OF_BOUNDS</code>是 Node.js 中的一个错误代码，当你尝试从一个 <code>Buffer</code> 或 <code>Uint8Array</code> 访问超出它们实际数据范围的位置时，这个错误就会被触发。在 Node.js 中，<code>Buffer</code> 对象用来处理原始二进制数据。</p><p>先解释一下什么是 <code>Buffer</code>：Node.js 设计了 <code>Buffer</code> 类来帮助开发者操作二进制数据流。比如，在网络通信或文件操作中，经常需要处理像图片、音频、视频等非文本资源，这些都可以用 <code>Buffer</code> 来表示。</p><p>现在，我们来看一下什么情况下会遇到 <code>ERR_BUFFER_OUT_OF_BOUNDS</code> 错误，并给出一些例子。</p><h3 id="实例-1-读取越界" tabindex="-1"><a class="header-anchor" href="#实例-1-读取越界"><span>实例 1: 读取越界</span></a></h3><p>假设你创建了一个大小为 10 个字节的 <code>Buffer</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建一个长度为 10 的 Buffer，初始化所有位为 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后，你尝试访问第 11 个字节（注意 Buffer 的索引是从 0 开始的）：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#D8DEE9FF;">[</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试访问不存在的第 11 个字节</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>由于你访问的位置超出了 <code>Buffer</code> 的范围，这里不会抛出 <code>ERR_BUFFER_OUT_OF_BOUNDS</code> 错误，而是简单地返回 <code>undefined</code>。但如果你使用的是 <code>buffer.readUInt8(10)</code> 方法，则会抛出这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readUInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将抛出 ERR_BUFFER_OUT_OF_BOUNDS 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="实例-2-写入越界" tabindex="-1"><a class="header-anchor" href="#实例-2-写入越界"><span>实例 2: 写入越界</span></a></h3><p>同样的规则适用于写入操作。如果你尝试向 <code>Buffer</code> 写入数据，但指定的起始位置超出了 <code>Buffer</code> 的实际大小，你也会遇到 <code>ERR_BUFFER_OUT_OF_BOUNDS</code> 错误。</p><p>例如，假设你想在同一个 Buffer 的第 11 个位置写入一个字节：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeUInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">255</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试在第 11 个位置写入一个字节，这将抛出 ERR_BUFFER_OUT_OF_BOUNDS 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="避免错误的技巧" tabindex="-1"><a class="header-anchor" href="#避免错误的技巧"><span>避免错误的技巧</span></a></h3><p>为了避免这种类型的错误，你应该在尝试读取或写入 <code>Buffer</code> 之前检查索引值是否超出范围。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> index</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 10</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">index</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readUInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">index</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">尝试访问的索引超出了 Buffer 的范围！</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码首先检查索引是否小于 <code>buffer.length</code>（即 <code>Buffer</code> 的大小），如果不是，则不进行任何读取操作，并打印一条消息说明索引超出了范围。</p><p>记住，当你处理 <code>Buffer</code> 数据时，始终要确保你的索引是有效的，这样可以避免运行时错误和潜在的程序崩溃。</p><h3 id="err-buffer-too-large" tabindex="-1"><a class="header-anchor" href="#err-buffer-too-large"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_buffer_too_large" target="_blank" rel="noopener noreferrer">ERR_BUFFER_TOO_LARGE</a></span></a></h3><p><code>ERR_BUFFER_TOO_LARGE</code> 是 Node.js 中的一个错误类型，表明试图创建的缓冲区（Buffer）太大，无法在 JavaScript 的 V8 引擎中分配。Node.js 的 Buffer 类用于处理二进制数据流，在 Node.js 应用程序中非常常见。</p><p>在 JavaScript 中，内容通常以字符串形式处理，但许多类型的 I/O（输入/输出）操作，如文件系统操作和网络通信，往往是基于二进制数据的。为了更高效地处理这些二进制数据，Node.js 提供了 Buffer 类。</p><p>一个 Buffer 对象类似于一个数组，但它是固定大小的内存块，且里面存储的是原始的内存数据，而不是像数组那样的对象引用。但由于 JavaScript 有内存管理的限制，不能创建任意大的 Buffer 对象，否则就会引发 <code>ERR_BUFFER_TOO_LARGE</code> 错误。</p><p>下面通过例子来解释这个概念：</p><h3 id="示例-1-创建一个过大的-buffer" tabindex="-1"><a class="header-anchor" href="#示例-1-创建一个过大的-buffer"><span>示例 1: 创建一个过大的 Buffer</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设我们尝试创建一个特别大的 Buffer：</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">allocUnsafe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#81A1C1;"> **</span><span style="color:#B48EAD;"> 31</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试分配超过 2GB 的内存</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 捕获错误并打印到控制台</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试调用 <code>Buffer.allocUnsafe()</code> 方法来创建一个非常大的 Buffer 实例。如果请求的大小超出了 V8 引擎能够分配的最大值（例如 2GB），则会抛出 <code>ERR_BUFFER_TOO_LARGE</code> 错误。</p><h3 id="示例-2-分配较大但合理的-buffer" tabindex="-1"><a class="header-anchor" href="#示例-2-分配较大但合理的-buffer"><span>示例 2: 分配较大但合理的 Buffer</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 创建一个合理大小的 Buffer：</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> size</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 1MB</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确分配 1MB 内存的 Buffer</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Buffer created with size:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上示例中，我们创建了一个 1MB 大小的 Buffer，这通常在 V8 的限制范围内，因此不会抛出 <code>ERR_BUFFER_TOO_LARGE</code> 错误。</p><h3 id="使用场景举例" tabindex="-1"><a class="header-anchor" href="#使用场景举例"><span>使用场景举例</span></a></h3><h4 id="读取文件" tabindex="-1"><a class="header-anchor" href="#读取文件"><span>读取文件</span></a></h4><p>当你需要从文件系统中读取一张图片或者其他二进制文件时，你可以使用 Buffer：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/image.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;data&#39; 是一个包含图片二进制数据的 Buffer 实例</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="网络通信" tabindex="-1"><a class="header-anchor" href="#网络通信"><span>网络通信</span></a></h4><p>当你需要处理来自 HTTP 请求或响应的二进制数据时，也会用到 Buffer：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">resp</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> chunks</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    chunks</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  resp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">concat</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunks</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // &#39;data&#39; 现在是一个包含完整响应体的 Buffer 实例</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结起来，<code>ERR_BUFFER_TOO_LARGE</code> 错误提醒开发者他们试图创建的 Buffer 超过了内存分配的极限，这通常是由于编码错误或对内存需求的误判造成的。在实际应用中，大部分情况下你不需要创建如此巨大的 Buffer，而是应该创建适量大小的 Buffer 来进行有效的内存管理。</p><h3 id="err-cannot-watch-sigint" tabindex="-1"><a class="header-anchor" href="#err-cannot-watch-sigint"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_cannot_watch_sigint" target="_blank" rel="noopener noreferrer">ERR_CANNOT_WATCH_SIGINT</a></span></a></h3><p>在 Node.js 中，<code>ERR_CANNOT_WATCH_SIGINT</code> 是一个特定类型的错误，它发生于当 Node.js 尝试去侦听 SIGINT 信号（通常是用户按下 Ctrl+C 意图关闭程序时产生的信号）但却无法这么做的情况。</p><p>让我们先解释一下什么是 SIGINT 信号。在操作系统中，SIGINT 是一个中断信号，当用户希望中断当前运行的程序时，会发送这个信号。举个例子，当你在命令行运行一个程序，然后你突然想要停止它，你可能会按下 <code>Ctrl+C</code>。这时候，操作系统就会发送一个 SIGINT 信号给该程序，告诉它需要优雅地结束运行。</p><p>在 Node.js 中，你可以使用 <code>process.on(&#39;SIGINT&#39;, callback)</code> 来监听这个信号，然后执行一些清理工作，比如关闭文件、数据库连接等，再退出程序。这样可以确保即使程序被中断，也不会留下未处理的任务或者资源泄露的问题。</p><p>下面是一个简单的例子，演示了如何在 Node.js 中捕获和处理 SIGINT 信号：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SIGINT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received SIGINT. Performing cleanup...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 在这里执行清理操作</span></span>
<span class="line"><span style="color:#616E88;">  // 关闭数据库连接、保存工作状态等</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正常退出程序</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设有一个长时间运行的操作</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a long running operation</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，如果用户在长时间操作完成之前按下 <code>Ctrl+C</code>，程序将输出 <code>Received SIGINT. Performing cleanup...</code>，执行任何定义在回调函数中的清理操作，然后正常退出。</p><p>然而，当 Node.js 出于某种原因无法监听 SIGINT 信号时，就会抛出 <code>ERR_CANNOT_WATCH_SIGINT</code> 错误。这种情况不常见，可能是因为环境限制或者内部错误导致 Node.js 无法注册对 SIGINT 信号的监听。</p><p>如果你遇到了这个错误，那说明在你的 Node.js 程序中，尝试监听 SIGINT 信号失败了。解决办法通常涉及检查你的程序是否有权限监听信号，或者检查是否有其它进程或程序干扰了正常的信号处理。在大多数情况下，这个问题是由于环境设置不正确或者 Node.js 的 bug 导致的。</p><h3 id="err-child-closed-before-reply" tabindex="-1"><a class="header-anchor" href="#err-child-closed-before-reply"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_child_closed_before_reply" target="_blank" rel="noopener noreferrer">ERR_CHILD_CLOSED_BEFORE_REPLY</a></span></a></h3><p>当你在 Node.js 中使用子进程（也就是你的主程序可以启动一个或多个额外的小程序来执行特定的任务）时，这个错误可能会发生。在 Node.js 中，子进程的创建和管理通常是通过<code>child_process</code>模块完成的。</p><p><code>ERR_CHILD_CLOSED_BEFORE_REPLY</code> 是一个错误码，表示你的主程序尝试从一个子进程中获得回应，但是那个子进程在发送任何回应之前已经关闭了。这通常表明有些事情出错了——可能是子进程遇到了错误并自己退出了，或者它由于某种原因被外部环境强制终止了。</p><p>让我们用两个简单的例子来解释这个问题：</p><h3 id="示例-1-子进程正常工作" tabindex="-1"><a class="header-anchor" href="#示例-1-子进程正常工作"><span>示例 1：子进程正常工作</span></a></h3><p>假设你想让一个子进程执行一个简单的命令，比如列出一个目录的内容。你的代码可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> exec</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ls</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stderr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">执行的错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">标准输出：</span><span style="color:#EBCB8B;">\n</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">stderr</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">标准错误输出：</span><span style="color:#EBCB8B;">\n</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stderr</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果一切正常，子进程会执行<code>ls</code>命令，并将结果通过标准输出传递回主程序。</p><h3 id="示例-2-子进程异常退出-可能导致-err-child-closed-before-reply" tabindex="-1"><a class="header-anchor" href="#示例-2-子进程异常退出-可能导致-err-child-closed-before-reply"><span>示例 2：子进程异常退出（可能导致 ERR_CHILD_CLOSED_BEFORE_REPLY）</span></a></h3><p>现在，让我们假设，你有一个更复杂的子进程，它需要一些时间才能完成工作。如果这个子进程在完成工作前异常退出了，而主程序又正在等待它的结果，你可能就会遇到<code>ERR_CHILD_CLOSED_BEFORE_REPLY</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设 complexProcess.js 是一个需要长时间运行的复杂进程</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./complexProcess.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">从子进程收到:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">exit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">子进程退出，退出码 </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 在某个时间点，我们试图从子进程获取信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">are you there?</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果子进程在接收到消息 <code>&#39;are you there?&#39;</code> 并且回答之前就退出了，你可能就会在主程序中遇到 <code>ERR_CHILD_CLOSED_BEFORE_REPLY</code> 错误。</p><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法"><span>解决方法</span></a></h3><p>要解决这个问题，你需要检查为什么子进程会提前退出。可能的原因包括：</p><ul><li>子进程中的代码存在 bug，导致它崩溃。</li><li>外部条件导致子进程被系统杀死，例如内存不足。</li><li>子进程的任务执行时间过长，超出了预期或设置的超时限制。</li></ul><p>你需要对子进程中的代码进行调试，确保所有的异常都被正确处理，并且确保子进程能够在任何情况下都能向主程序返回适当的响应。同时，你可能还需要考虑增加错误处理的逻辑，在主程序中捕获并处理这类错误。</p><h3 id="err-child-process-ipc-required" tabindex="-1"><a class="header-anchor" href="#err-child-process-ipc-required"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_child_process_ipc_required" target="_blank" rel="noopener noreferrer">ERR_CHILD_PROCESS_IPC_REQUIRED</a></span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境，它允许我们使用 JavaScript 来写后台服务或者命令行工具。其中，<code>child_process</code>模块是 Node.js 的一个内置模块，它允许你从 Node.js 应用程序中创建和管理子进程。</p><p>错误 <code>ERR_CHILD_PROCESS_IPC_REQUIRED</code> 是在 Node.js 中当你尝试使用<code>child_process.fork()</code>方法创建一个新的子进程时，如未正确设置进行间通信（IPC）管道就会抛出的错误。</p><p><code>child_process.fork()</code>方法主要用于派生新的 Node.js 进程。这个方法返回一个 <code>ChildProcess</code> 对象，并且通过 IPC 建立了一个管道，父进程和子进程之间可以通过这个管道互相发送消息。</p><p>下面是一些详细的解释以及实际的例子：</p><h3 id="为什么-ipc-管道很重要" tabindex="-1"><a class="header-anchor" href="#为什么-ipc-管道很重要"><span>为什么 IPC 管道很重要？</span></a></h3><p>IPC 代表“进程间通信”（Inter-Process Communication），它允许在不同的进程之间传递消息、信号等信息。在 Node.js 中，如果你想要父进程和子进程之间相互通信，就需要 IPC 管道。没有 IPC 管道，两个进程就不能直接交换信息。</p><h3 id="示例-使用-child-process-fork" tabindex="-1"><a class="header-anchor" href="#示例-使用-child-process-fork"><span>示例：使用 <code>child_process.fork()</code></span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// parent.js - 父进程文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建子进程并传入子进程脚本路径</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听子进程发来的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">收到子进程的消息：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> msg</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 向子进程发送消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// child.js - 子进程文件</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">在子进程中收到消息：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> msg</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 回复父进程</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> received</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ok</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，我们有两个文件：<code>parent.js</code> 和 <code>child.js</code>。父进程文件 <code>parent.js</code> 使用 <code>fork</code> 方法创建了一个子进程，并向它发送了一条消息。子进程文件 <code>child.js</code> 接收这条消息，并回复父进程。这里的通信就是通过 IPC 管道进行的。</p><h3 id="错误场景示例" tabindex="-1"><a class="header-anchor" href="#错误场景示例"><span>错误场景示例</span></a></h3><p>如果你尝试在不支持 IPC 的环境中使用 <code>fork</code> 方法，或者在调用 <code>fork</code> 方法时破坏了 IPC 管道的设置，那么 <code>ERR_CHILD_PROCESS_IPC_REQUIRED</code> 错误就会发生。在 Node.js v21.7.1 中，如果没有遇到特定的系统层面的限制，正常情况下不应该碰到这个错误，因为 <code>fork</code> 默认就会创建 IPC 通道。但如果你修改了相关的选项，比如 <code>stdio</code> 配置，可能就会产生问题。</p><p>下面是一个错误示例，故意配置错误来引发 <code>ERR_CHILD_PROCESS_IPC_REQUIRED</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 故意设置 stdio 参数错误的父进程文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 注意，这里的 stdio 配置是错误的。正确的配置应该包含 &#39;ipc&#39; 来启用IPC通信</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> stdio</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试发送消息将会失败，因为没有 &#39;ipc&#39; 通道</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_CHILD_PROCESS_IPC_REQUIRED 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码中，我们在 <code>stdio</code> 配置中只提供了三个 &#39;pipe&#39; 而没有 &#39;ipc&#39;，这导致了 IPC 通道无法被创建，所以父进程尝试发送消息给子进程时就会抛出 <code>ERR_CHILD_PROCESS_IPC_REQUIRED</code> 错误。</p><p>总结起来，<code>ERR_CHILD_PROCESS_IPC_REQUIRED</code> 错误提示你在使用 <code>child_process.fork()</code> 时必须确保能够通过 IPC 管道进行通信。在正常使用中，除非你故意更改默认配置，否则不太可能遇到这个错误。</p><h3 id="err-child-process-stdio-maxbuffer" tabindex="-1"><a class="header-anchor" href="#err-child-process-stdio-maxbuffer"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_child_process_stdio_maxbuffer" target="_blank" rel="noopener noreferrer">ERR_CHILD_PROCESS_STDIO_MAXBUFFER</a></span></a></h3><p>在 Node.js 中，<code>ERR_CHILD_PROCESS_STDIO_MAXBUFFER</code>是一个错误代码，它跟子进程的标准输入输出有关。当你在 Node.js 代码中使用像<code>exec</code>这样的函数运行另一个程序（即创建一个子进程）时，你可以获取那个程序的输出。</p><p>举个例子，如果你想要运行系统命令 <code>ls</code> 来列出文件夹中的文件，并获取结果，你可能会写这样的 Node.js 代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> exec</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ls</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stderr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">执行的错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stdout: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stderr: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stderr</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，<code>exec</code> 函数用来执行一个命令，然后它有三个参数传递给回调函数：<code>error</code>, <code>stdout</code>和<code>stderr</code>。其中，<code>stdout</code>是正常的输出，而<code>stderr</code>是错误的输出。</p><p>现在，我们来谈谈<code>ERR_CHILD_PROCESS_STDIO_MAXBUFFER</code>。默认情况下，Node.js 为<code>stdout</code>和<code>stderr</code>设置了一个最大的缓冲区大小（buffer size）。在 Node.js v14.17.0 之前，默认大小是 200*1024 字节（大约 200KB），但之后的版本可能改变了这个值。</p><p>如果运行的子进程返回的数据超过了这个缓冲区大小，Node.js 就会抛出一个错误，也就是<code>ERR_CHILD_PROCESS_STDIO_MAXBUFFER</code>错误。这个错误意味着输出太大了，Node.js 无法处理。</p><p>例如，如果你尝试列出一个包含非常多文件的目录，输出可能就会超过默认的缓冲区限制：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> exec</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这个路径有非常多的文件</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ls /some/path/with/tons/of/files</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stderr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">发生错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stdout: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stderr: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stderr</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果发生了<code>ERR_CHILD_PROCESS_STDIO_MAXBUFFER</code>错误，你将会在<code>error.message</code>中看到这个代码。</p><p>解决方法通常有两种：</p><ol><li><p>增加缓冲区的大小：<br> 你可以通过传递一个选项<code>{ maxBuffer: }</code>来增加允许的最大缓冲区大小。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> exec</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置更大的maxBuffer值</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">ls /some/path/with/tons/of/files</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> maxBuffer</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#ECEFF4;"> },</span><span style="color:#616E88;"> // 1MB</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> stderr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">发生错误: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stdout: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stderr: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">stderr</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>使用流代替缓冲区：<br> 如果输出非常大，使用流（stream）处理输出可能更合适。例如，使用<code>spawn</code>代替<code>exec</code>，因为<code>spawn</code>不会对输出进行缓冲。</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> spawn</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> childProcess</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> spawn</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ls</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/some/path/with/tons/of/files</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">childProcess</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stdout: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">childProcess</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stderr</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">stderr: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">childProcess</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">子进程退出码：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，<code>data</code>事件会随着数据的产生被重复触发，这样你就可以处理任何量级的数据，而不会因为超出固定的缓冲区大小而导致错误。</p><h3 id="err-closed-message-port" tabindex="-1"><a class="header-anchor" href="#err-closed-message-port"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_closed_message_port" target="_blank" rel="noopener noreferrer">ERR_CLOSED_MESSAGE_PORT</a></span></a></h3><p><code>ERR_CLOSED_MESSAGE_PORT</code>是一个特定类型的错误，它在 Node.js 中表示尝试与已经关闭的消息端口进行通信。消息端口是一种允许不同执行上下文（如主线程和工作线程）之间传递消息的机制。</p><p>为了帮助你更好地理解这个概念，我们可以将消息端口比作两个人之间通过手机短信沟通。当一方的手机电源关闭或者退出了短信应用，另一方就无法再发送消息给他们。如果他们继续尝试发送短信，会收到一个错误提示说手机已关机或退出短信应用。</p><p>在 Node.js 中，使用<code>worker_threads</code>模块可以创建新的线程（相当于创建一个能独立工作的小助手），并且主线程可以与这些工作线程通过消息端口来通信。每当创建一个新的工作线程时，Node.js 会自动创建一个消息端口来允许主线程和工作线程互相传递消息。</p><p>现在让我们看一个简单的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> MessageChannel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的MessageChannel，这里的port1和port2是互相连接的端口</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> port1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> port2</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MessageChannel</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的工作线程</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  `</span><span style="color:#A3BE8C;">const { parentPort } = require(&#39;worker_threads&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">parentPort.once(&#39;message&#39;, (value) =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">  console.log(&#39;Received in worker:&#39;, value);</span></span>
<span class="line"><span style="color:#A3BE8C;">});</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> eval</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听错误事件</span></span>
<span class="line"><span style="color:#D8DEE9;">port1</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在工作线程中使用port2</span></span>
<span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> port2</span><span style="color:#ECEFF4;"> },</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#D8DEE9;">port2</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送消息到工作线程</span></span>
<span class="line"><span style="color:#D8DEE9;">port1</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 关闭消息端口</span></span>
<span class="line"><span style="color:#D8DEE9;">port1</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次发送消息会导致发生ERR_CLOSED_MESSAGE_PORT错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  port1</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will fail</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">捕获到错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会打印 &#39;ERR_CLOSED_MESSAGE_PORT&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们首先引入了<code>worker_threads</code>模块，并创建了一个新的<code>MessageChannel</code>。<code>MessageChannel</code>有两个端口：<code>port1</code>和<code>port2</code>，它们直接相连，通过它们可以跨线程发送消息。</p><p>然后我们创建了一个工作线程并且使用<code>postMessage</code>方法向工作线程发送了一个包含<code>port2</code>的消息，这样工作线程也拥有了一个端口来与主线程通信。</p><p>我们通过<code>port1</code>向工作线程发送了一条消息&quot;Hello world!&quot;。紧接着我们关闭了<code>port1</code>，此时该端口已经不可用了。如果我们再尝试通过<code>port1</code>发送消息，就会抛出<code>ERR_CLOSED_MESSAGE_PORT</code>错误。在示例中我们使用了<code>try...catch</code>结构来捕获并打印这个错误。</p><p>总结一下，<code>ERR_CLOSED_MESSAGE_PORT</code>错误是一个指示消息端口已关闭且不能再被用来发送信息的错误标识。在实际应用中，要确保端口处于开启状态才能发送消息，否则需要妥善处理可能出现的这类错误。</p><h3 id="err-console-writable-stream" tabindex="-1"><a class="header-anchor" href="#err-console-writable-stream"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_console_writable_stream" target="_blank" rel="noopener noreferrer">ERR_CONSOLE_WRITABLE_STREAM</a></span></a></h3><p><code>ERR_CONSOLE_WRITABLE_STREAM</code> 是 Node.js 中的一个错误代码，表示你尝试对一个 Console 实例做了不合法的操作，具体来说，就是试图更改它内部使用的 writable stream（可写流）。在 Node.js 中，Console 类主要用于实现控制台输出，比如打印日志到 stdout（标准输出流）或 stderr（标准错误流）。</p><p>这个错误通常发生在你尝试更改 Console 实例默认行为的时候。例如，在创建了 Console 实例之后，如果你尝试修改它的 <code>_stdout</code> 或 <code>_stderr</code> 属性（这些属性分别代表了标准输出和错误输出流），就可能触发此错误。</p><p>下面举几个实际运用的例子来说明：</p><ol><li>创建 Console 实例并尝试修改其标准输出流：</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Console</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">console</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个指向文件的写入流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> output</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./stdout.log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> errorOutput</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./stderr.log</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用上述流创建 Console 实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> logger</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Console</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> stdout</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> output</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> stderr</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> errorOutput</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 下面的操作试图直接修改logger的_stdout属性，这将会抛出ERR_CONSOLE_WRITABLE_STREAM错误</span></span>
<span class="line"><span style="color:#616E88;">// 因为Node.js不允许这样的操作，这是为了保护内部的数据流一致性</span></span>
<span class="line"><span style="color:#D8DEE9;">logger</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">_stdout</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会引发错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>直接修改全局 console 对象的标准输出流：</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 下面的操作试图直接修改全局console对象的_stderr属性</span></span>
<span class="line"><span style="color:#616E88;">// 这同样会抛出ERR_CONSOLE_WRITABLE_STREAM错误</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">_stderr</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会引发错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的做法是在创建 Console 实例的时候传递正确的 streams，而不是之后去修改。如果你需要改变输出目的地，应该重新创建一个 Console 实例。</p><p>总结一下，<code>ERR_CONSOLE_WRITABLE_STREAM</code> 错误是告诉你，你试图以一种不被允许的方式去修改 Console 实例中的流对象。在正常使用中，你应该避免这样的操作，按照 API 设计来正确使用 Console 功能。</p><h3 id="err-construct-call-invalid" tabindex="-1"><a class="header-anchor" href="#err-construct-call-invalid"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_construct_call_invalid" target="_blank" rel="noopener noreferrer">ERR_CONSTRUCT_CALL_INVALID</a></span></a></h3><p><code>ERR_CONSTRUCT_CALL_INVALID</code>是 Node.js 中的一个错误代码，它代表一个对象被以不正确的方式构建或者实例化了。在 JavaScript 中，“构造”通常是指使用<code>new</code>关键字来创建一个对象的实例。这个错误通常会发生在尝试以非构造函数的方式去调用一个需要用<code>new</code>关键字来调用的类或者构造函数时。</p><p>在 Node.js 中，有许多内置的类和函数设计为只能通过<code>new</code>关键字来调用。如果你忽略了这个要求，就会遇到<code>ERR_CONSTRUCT_CALL_INVALID</code>错误。</p><p>这里举一个简单的例子来说明这种情况：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyObject</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">value</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的构造方式：</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyObject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 没有错误，obj是MyObject的一个实例</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果我们尝试不使用new关键字来构造MyObject：</span></span>
<span class="line"><span style="color:#616E88;">// let obj2 = MyObject(10); // 这里会抛出 ERR_CONSTRUCT_CALL_INVALID 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，<code>MyObject</code>是一个类，我们只能使用<code>new</code>关键字来创建它的实例。如果尝试直接调用<code>MyObject(10)</code>而不使用<code>new</code>，Node.js 将会抛出<code>ERR_CONSTRUCT_CALL_INVALID</code>错误。</p><p>真实世界中的一个例子可能涉及 Node.js 的内置模块。例如，<code>Promise</code>、<code>Buffer</code>和许多其他内置对象都必须使用<code>new</code>来构造。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确的使用Promise：</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> promise</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Success!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果我们尝试直接调用Promise而不使用new：</span></span>
<span class="line"><span style="color:#616E88;">// let badPromise = Promise((resolve, reject) =&gt; { // 这里将会抛出 ERR_CONSTRUCT_CALL_INVALID 错误</span></span>
<span class="line"><span style="color:#616E88;">//     resolve(&#39;Failure!&#39;);</span></span>
<span class="line"><span style="color:#616E88;">// });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>Promise</code>是 Node.js 中用于表示异步操作的一个类。我们必须使用<code>new</code>关键字来创建一个新的<code>Promise</code>实例。如果直接调用<code>Promise</code>函数，而没有使用<code>new</code>，就会导致<code>ERR_CONSTRUCT_CALL_INVALID</code>错误。</p><p>总结起来，当你在 Node.js 中看到<code>ERR_CONSTRUCT_CALL_INVALID</code>错误时，应该检查是否有某个类或者构造函数被错误地调用了，即没有使用<code>new</code>关键字。修复方法就是确保在创建对象实例时使用<code>new</code>关键字。</p><h3 id="err-construct-call-required" tabindex="-1"><a class="header-anchor" href="#err-construct-call-required"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_construct_call_required" target="_blank" rel="noopener noreferrer">ERR_CONSTRUCT_CALL_REQUIRED</a></span></a></h3><p>Node.js 的错误代码 <code>ERR_CONSTRUCT_CALL_REQUIRED</code> 表示某个对象或函数需要通过 <code>new</code> 操作符来构造（创建实例），但没有这样做。在 JavaScript 和 Node.js 中，有些特定的对象和类被设计为只能通过 <code>new</code> 关键字来创建实例，如果直接调用这些构造函数而不使用 <code>new</code>，就会抛出这个错误。</p><p>下面是一个简单的例子来解释这个错误：</p><h3 id="示例-1-不正确地调用构造函数" tabindex="-1"><a class="header-anchor" href="#示例-1-不正确地调用构造函数"><span>示例 1：不正确地调用构造函数</span></a></h3><p>假设我们有一个名为 <code>User</code> 的类，它表示一个用户，并且这个类应该通过 <code>new</code> 操作符来实例化：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> User</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的使用方式 - 使用 `new` 来实例化 User 类</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> user</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> User</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">user</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: Alice</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的使用方式 - 直接调用 User 构造函数而不使用 `new`</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> user2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> User</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Bob</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将抛出 ERR_CONSTRUCT_CALL_REQUIRED 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，第一个示例是正确的，我们通过 <code>new User(&#39;Alice&#39;)</code> 创建了一个用户实例。第二个示例中，我们试图像普通函数那样直接调用 <code>User(&#39;Bob&#39;)</code>，这会导致 <code>ERR_CONSTRUCT_CALL_REQUIRED</code> 错误，因为 <code>User</code> 需要作为构造器使用。</p><h3 id="示例-2-内置对象的错误使用" tabindex="-1"><a class="header-anchor" href="#示例-2-内置对象的错误使用"><span>示例 2：内置对象的错误使用</span></a></h3><p>Node.js 和 JavaScript 中有内置的对象也会有这种行为，比如 <code>Promise</code> 对象：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确的使用方式 - 使用 `new` 来创建 Promise 实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myPromise</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Success!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的使用方式 - 直接调用 Promise 函数而不使用 `new`</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myPromise2</span><span style="color:#81A1C1;"> =</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这将抛出 ERR_CONSTRUCT_CALL_REQUIRED 错误</span></span>
<span class="line"><span style="color:#88C0D0;">  resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Success!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，<code>myPromise</code> 是通过 <code>new</code> 关键字正确创建的 Promise 实例，它可以正常工作。然而，<code>myPromise2</code> 直接调用了 <code>Promise</code> 函数而没有使用 <code>new</code>，这样做是错误的，会抛出 <code>ERR_CONSTRUCT_CALL_REQUIRED</code> 错误。</p><p><strong>如何修复这个错误？</strong></p><p>当你遇到 <code>ERR_CONSTRUCT_CALL_REQUIRED</code> 错误时，检查你的代码是否正确地使用了 <code>new</code> 关键字来创建类或内置对象的实例。确保在需要使用构造器的地方添加 <code>new</code>。这通常很容易修复，只需在调用构造函数前面加上 <code>new</code> 关键字即可。</p><h3 id="err-context-not-initialized" tabindex="-1"><a class="header-anchor" href="#err-context-not-initialized"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_context_not_initialized" target="_blank" rel="noopener noreferrer">ERR_CONTEXT_NOT_INITIALIZED</a></span></a></h3><p>当然可以为你解释这个错误。在 Node.js 中，<code>ERR_CONTEXT_NOT_INITIALIZED</code> 是一个特定类型的错误，它通常会在使用某些需要上下文初始化的 API 时出现，如果没有正确地初始化这些上下文（context），就可能会遇到这个错误。</p><p>在 Node.js 中，“上下文”通常是指在执行特定代码或操作时所需要的一组环境设置或内部状态。例如，在使用异步资源或者进行异步编程时，Node.js 需要追踪这些操作相关的信息以保证正确处理。</p><p>要详细理解这个错误，我们需要知道什么是 V8 Context。Node.js 是建立在 Chrome 的 V8 JavaScript 引擎之上的，V8 引擎使用了所谓的“上下文（context）”来隔离不同的执行环境。每个上下文都有自己的全局对象以及与之相关联的 JavaScript 构件。当你在 Node.js 中执行一段脚本或模块时，它通常运行在它自己的上下文中。</p><p>现在，<code>ERR_CONTEXT_NOT_INITIALIZED</code> 错误出现的情况可能涉及底层的 Node.js 功能，比如异步钩子（async_hooks）或者嵌入式场景，其中 V8 上下文需要明确初始化和管理。对于大多数普通应用开发者来说，很少需要直接处理这些低级别的上下文问题。</p><p>以下是几个可能抛出 <code>ERR_CONTEXT_NOT_INITIALIZED</code> 错误的例子：</p><ol><li><p>当你使用 async_hooks 模块来监控异步资源的生命周期，并且在启动时没有正确初始化异步钩子（如未调用 <code>async_hooks.createHook()</code>）时。</p></li><li><p>在开发 Node.js 的嵌入式应用程序时，如果你尝试执行脚本或者创建新的异步资源而没有正确设置执行上下文，也可能遇到这个错误。</p></li></ol><p>由于 <code>ERR_CONTEXT_NOT_INITIALIZED</code> 属于内部错误，举具体的用户层面的例子可能相对困难。这类错误更多地与 Node.js 内部机制有关，普通开发者在正常使用高级 API 时不太可能遇到它。如果你真的遇到了这个错误，并且是在写普通的应用程序代码，那么这可能是一个 Node.js 的 bug 或者是你不小心使用了一些不该直接使用的内部 API。</p><p>通常，如果你只是一个编程新手，正在学习如何构建 Web 应用程序或简单的命令行工具，你可能永远不需要担心这个错误。专注于学习 Node.js 的核心模块，如 http、fs、path 和其他高级 API 将会更加有益。</p><h3 id="err-crypto-custom-engine-not-supported" tabindex="-1"><a class="header-anchor" href="#err-crypto-custom-engine-not-supported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_custom_engine_not_supported" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</a></span></a></h3><p><code>ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</code> 是一个错误类型，它在 Node.js 中用来表示你尝试使用了一个不被当前 Node.js 版本支持的自定义加密引擎。这个错误通常发生在你试图使用一些特定的加密功能时，而当前安装的 Node.js 版本并不支持那些功能。</p><p>首先，让我们解释一下“加密引擎”是什么。在计算机科学中，加密引擎是指执行加密和解密操作的软件或硬件组件。Node.js 通过内置的 <code>crypto</code> 模块提供了许多加密功能，例如：生成散列（hashes）、加密数据、创建数字签名等。</p><p>有时，为了满足特定的性能要求或者使用一些未被 Node.js 标准库直接支持的加密算法，开发者可能会想要使用自定义的加密引擎。在 Node.js 环境中，这可以通过加载外部模块实现。但是，并非所有版本的 Node.js 都允许使用这种自定义加密引擎。因此，如果你的代码试图设置或启用一个自定义引擎，而你的 Node.js 版本不支持这样做，就会抛出 <code>ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</code> 错误。</p><p>举个例子，假设有一个 Node.js 的第三方加密库叫做 <code>awesome-crypto-engine</code>，提供了一些超快速的加密算法。你想在你的应用程序中使用这个库。你的代码可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试设置自定义的加密引擎 &#39;awesome-crypto-engine&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEngine</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">awesome-crypto-engine</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">自定义加密引擎不被支持。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生了其他错误。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码尝试设置一个名为 <code>awesome-crypto-engine</code> 的自定义加密引擎，如果当前 Node.js 版本不支持这种操作，<code>setEngine</code> 方法将会抛出 <code>ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</code> 错误。这个错误的 <code>.code</code> 属性将会是 <code>&#39;ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED&#39;</code>，你可以用这个属性来检查捕获的错误是否是因为不支持自定义引擎。</p><p>如果遇到这个错误，作为开发者你需要考虑以下几个方案：</p><ol><li><strong>检查 Node.js 版本</strong>：确保你使用的 Node.js 版本支持自定义加密引擎。</li><li><strong>寻找替代库</strong>：如果当前版本的 Node.js 不支持自定义引擎，看看是否有其他库可以满足你的需求而不需要使用自定义引擎。</li><li><strong>更改 Node.js 版本</strong>：如果必须要使用自定义加密引擎，考虑升级或更换你的 Node.js 版本到能够支持自定义引擎的版本。</li></ol><p>总之，<code>ERR_CRYPTO_CUSTOM_ENGINE_NOT_SUPPORTED</code> 是 Node.js 报告不支持自定义加密引擎的一种方式。当你遇到这个问题时，你需要重新评估你的加密需求和可用的解决方案。</p><h3 id="err-crypto-ecdh-invalid-format" tabindex="-1"><a class="header-anchor" href="#err-crypto-ecdh-invalid-format"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_ecdh_invalid_format" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_ECDH_INVALID_FORMAT</a></span></a></h3><p><code>ERR_CRYPTO_ECDH_INVALID_FORMAT</code> 是 Node.js 中的一个错误代码，它关联于加密操作中的一种特定问题。在 Node.js 中，加密是通过内置的 <code>crypto</code> 模块来处理的，该模块提供了各种加密功能，包括与 ECDH（椭圆曲线 Diffie-Hellman）相关的功能。</p><p>ECDH 是一种密钥交换协议，用于安全地在双方之间共享加密密钥。这个过程涉及到使用椭圆曲线密码学来生成公钥和私钥。</p><p>当你在使用 Node.js 的 <code>crypto</code> 模块进行 ECDH 密钥交换操作时，如果你提供了不正确的输入格式给 ECDH 相关的函数或方法，Node.js 就会抛出 <code>ERR_CRYPTO_ECDH_INVALID_FORMAT</code> 错误。</p><p>这里有几个可能导致这个错误的情况：</p><ol><li><strong>错误的公钥格式</strong>：当你尝试使用一个格式不正确的公钥来生成共享的密钥时。</li><li><strong>错误的私钥格式</strong>：当你尝试设置 ECDH 的私钥，但提供了一个不符合要求的格式时。</li></ol><p>下面是一个简化的例子，说明如何正确使用 Node.js 的 <code>crypto</code> 模块来执行 ECDH 密钥交换，并指出哪里可能会发生 <code>ERR_CRYPTO_ECDH_INVALID_FORMAT</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 ECDH 密钥交换对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createECDH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">secp256k1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 使用 secp256k1 曲线</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 生成私钥和公钥</span></span>
<span class="line"><span style="color:#D8DEE9;">ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取公钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getPublicKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们接收到了对方的公钥（这里只是示例，所以使用自己的公钥）</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> otherPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 计算共享的密钥</span></span>
<span class="line"><span style="color:#616E88;">  // 如果 &#39;otherPublicKey&#39; 不是有效的格式，将会抛出 ERR_CRYPTO_ECDH_INVALID_FORMAT 错误</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">computeSecret</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">otherPublicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">sharedSecret</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出共享密钥的十六进制字符串</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 处理错误</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_ECDH_INVALID_FORMAT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">提供的公钥格式有误！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生了其他错误！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，如果 <code>otherPublicKey</code> 是一个格式不正确的值，比如一个损坏的十六进制字符串，那么 <code>ecdh.computeSecret()</code> 方法将会抛出 <code>ERR_CRYPTO_ECDH_INVALID_FORMAT</code> 错误。</p><p>为了避免这类错误，你需要确保：</p><ul><li>所有提供给 ECDH 相关方法的密钥都是正确的格式（通常是 Buffer 对象或者十六进制字符串）；</li><li>你严格按照文档或标准操作，不传入无效或损坏的数据。</li></ul><h3 id="err-crypto-ecdh-invalid-public-key" tabindex="-1"><a class="header-anchor" href="#err-crypto-ecdh-invalid-public-key"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_ecdh_invalid_public_key" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</a></span></a></h3><p>好的，我来解释一下 Node.js 中遇到的 <code>[ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY]</code> 错误。</p><p>首先，让我们分解一下这个概念。在 Node.js 中，<code>crypto</code> 模块提供了一个包含各种加密功能的集合，比如用于创建散列、加密数据等。ECDH（Elliptic Curve Diffie-Hellman）是一个基于椭圆曲线密码学的密钥交换协议，它可以让双方在不安全的通道上安全地交换密钥材料（即用于后续加密通信的秘密数据）。</p><p>现在，当你在使用 Node.js 的 <code>crypto</code> 模块进行 ECDH 密钥交换时，如果你提供了一个格式不正确或无法识别的公钥，Node.js 就会抛出 <code>ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</code> 这个错误。</p><p>公钥需要满足特定的格式和条件，才能被用于椭圆曲线算法中。如果公钥无效，那么任何依赖它的操作都不能成功执行，因为密钥交换协议必须要有有效的密钥来确保其安全性。</p><p>举几个实际运用的例子说明：</p><ol><li><p><strong>服务器间安全通信</strong>：假设你正在编写一个需要与其他服务器安全通信的应用程序。在建立连接并交换数据之前，你的服务器和目标服务器会通过 ECDH 协议交换公钥，以确保后续通信的加密。如果你传递了一个无效的公钥，就会收到 <code>ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</code> 错误。</p></li><li><p><strong>客户端-服务器模型</strong>：如果你开发了一个 Web 应用，并希望与客户端（比如浏览器）安全地交换信息，可能也会使用 ECDH 密钥交换。当客户端发送一个无效的公钥到服务器时，服务器在尝试使用该公钥时就会遇到这个错误。</p></li><li><p><strong>API 安全认证</strong>：某些 API 为了安全性可能使用 ECDH 来为每次请求生成一个唯一的密钥。如果 API 的消费者（如另一个服务或应用程序）在请求的身份验证阶段提供了一个不合规范的公钥，就会导致 <code>ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</code> 错误，进而请求失败。</p></li></ol><p>正式的代码示例涉及到的可能会比较复杂，但以下是一个简化的伪代码，展示了可能出错的场景：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 ECDH 对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createECDH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">prime256v1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 生成密钥对</span></span>
<span class="line"><span style="color:#D8DEE9;">ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 接收到一个来自外部的公钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> externalPublicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> getExternalPublicKey</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里假设得到一个公钥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 使用外部的公钥来计算共享密钥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sharedSecret</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">computeSecret</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">externalPublicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // ...使用共享密钥进行加密通信</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">提供的公钥无效，无法计算共享密钥。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">处理密钥时出现了其他错误。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getExternalPublicKey</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这个函数是用来获取外部公钥的，可能是来自用户输入或者其他服务。</span></span>
<span class="line"><span style="color:#616E88;">  // 如果这个函数返回的公钥格式不正确，就会引发上述错误。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>getExternalPublicKey</code> 返回了一个无效的公钥，那么 <code>ecdh.computeSecret</code> 方法就会抛出 <code>ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY</code> 错误，我们需要捕获这个错误并相应地处理它，比如向用户提示错误信息或记录日志。</p><p>总结一下，<code>[ERR_CRYPTO_ECDH_INVALID_PUBLIC_KEY]</code> 是一个表示在椭圆曲线密钥交换过程中遇到无效公钥的错误。处理这个错误的关键是确保所有参与密钥交换的公钥都是合法有效的。</p><h3 id="err-crypto-engine-unknown" tabindex="-1"><a class="header-anchor" href="#err-crypto-engine-unknown"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_engine_unknown" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_ENGINE_UNKNOWN</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它允许你在服务器端执行 JavaScript 代码。Node.js 中有一个模块叫<code>crypto</code>，这个模块提供了包括加密解密、哈希等在内的一系列与密码学相关的功能。</p><p>在 Node.js 使用<code>crypto</code>模块时，你可能会遇到各种错误。<code>ERR_CRYPTO_ENGINE_UNKNOWN</code>是这些错误之一。这个错误表示你尝试使用了一个未知的加密引擎。</p><p>加密引擎（Crypto Engine）通常是一个用来进行加密操作的软件或硬件组件。在 Node.js 中，你可以通过特定的 API 配置和使用不同的加密引擎。</p><p>当你看到<code>ERR_CRYPTO_ENGINE_UNKNOWN</code>这个错误时，意味着你尝试指定一个加密引擎，但是这个引擎在 Node.js 的上下文中并不被识别或者不存在。让我们通过一个简单的例子来说明：</p><p>假设你想要使用一个名为“SuperSecureEngine”的加密引擎：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 设置加密引擎为&quot;SuperSecureEngine&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sign</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> engine</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SuperSecureEngine</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果引擎未知，则会捕获到 ERR_CRYPTO_ENGINE_UNKNOWN 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 Node.js 不知道如何处理或找不到名为“SuperSecureEngine”的引擎，它将抛出<code>ERR_CRYPTO_ENGINE_UNKNOWN</code>错误。</p><p>解决这个问题的办法是确保你指定的加密引擎是正确的，并且被当前的 Node.js 版本支持。你可以查阅 Node.js 的官方文档，了解哪些加密引擎是可用的，或者如果你在使用第三方库，确保已经正确安装并配置该库。</p><p>例如，如果只是想使用 Node.js 自带的默认加密功能，你可以省略<code>engine</code>选项，像这样调用<code>createSign</code>方法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 使用Node.js默认的加密功能创建签名对象</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sign</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // ... 接下来，你可以用这个签名对象进行签名等操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，你需要根据项目需求选择合适的加密引擎，确认它们的兼容性和安全性，并按照文档正确地集成到你的 Node.js 程序中。</p><h3 id="err-crypto-fips-forced" tabindex="-1"><a class="header-anchor" href="#err-crypto-fips-forced"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_fips_forced" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_FIPS_FORCED</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它让开发者可以使用 JavaScript 编写服务器端代码。在 Node.js 环境中，开发者经常需要处理加密操作（如创建 HTTPS 服务器或者密码哈希等）。Node.js 提供了一个内置的 <code>crypto</code> 模块来支持各种加密技术。</p><p>现在，让我们聊一聊你提到的那个错误：<code>ERR_CRYPTO_FIPS_FORCED</code>。</p><h3 id="什么是-fips" tabindex="-1"><a class="header-anchor" href="#什么是-fips"><span>什么是 FIPS？</span></a></h3><p>FIPS 代表联邦信息处理标准（Federal Information Processing Standards），它是由美国国家标准与技术研究院（NIST）发布的一系列计算机安全标准。当特定的 Node.js 构建被配置为只支持 FIPS 标准的加密算法时，这意味着所有的加密操作都必须符合这些标准。</p><h3 id="err-crypto-fips-forced-错误解释" tabindex="-1"><a class="header-anchor" href="#err-crypto-fips-forced-错误解释"><span>ERR_CRYPTO_FIPS_FORCED 错误解释</span></a></h3><p><code>ERR_CRYPTO_FIPS_FORCED</code> 是错误类型的一个代码，它表示尝试执行一个非 FIPS 兼容的加密操作，但是 Node.js 已经被设置为只允许 FIPS 兼容的加密方法。如果你启用了 FIPS 模式，并且试图使用一个不符合 FIPS 标准的加密算法，就会抛出这个错误。</p><h3 id="实际运用的例子-1" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-1"><span>实际运用的例子</span></a></h3><p>假设你负责一个要求高安全性的网站后端开发，比如一个银行系统。出于合规性的要求，你可能需要确保所有加密操作都符合 FIPS 标准。那么你可以配置 Node.js 以运行在 FIPS 模式下。这样做之后，你的代码中任何试图使用非 FIPS 加密算法的地方都会触发 <code>ERR_CRYPTO_FIPS_FORCED</code> 错误。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 启用 FIPS 模式</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setFips</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试创建一个不符合 FIPS 标准的 hash 算法，比如 MD5</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">md5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获 ERR_CRYPTO_FIPS_FORCED 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>MD5</code> 不是一个 FIPS 认可的加密算法，因此尝试创建它的 hash 实例时会抛出 <code>ERR_CRYPTO_FIPS_FORCED</code> 错误。</p><p>这种错误通常是在应用程序级别而不是在用户级别处理的。作为一名开发人员，您应该确保程序逻辑符合 FIPS 要求，或者在不需要 FIPS 模式时禁用它。</p><p>总的来说，<code>ERR_CRYPTO_FIPS_FORCED</code> 错误涉及到遵循特定的加密标准，并且当 Node.js 被配置为只使用那些标准时，它会强制使代码遵循这些规则。这有助于确保应用程序在处理敏感数据时达到高安全性标准。</p><h3 id="err-crypto-fips-unavailable" tabindex="-1"><a class="header-anchor" href="#err-crypto-fips-unavailable"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_fips_unavailable" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_FIPS_UNAVAILABLE</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它使得开发者能够使用 JavaScript 来编写服务器端的代码。在 Node.js 的众多特性中，安全性是一个重要的考虑因素。为了更好地处理加密功能，Node.js 提供了一个名为 <code>crypto</code> 的模块，这个模块封装了 OpenSSL 的功能。</p><p>FIPS（Federal Information Processing Standards）是美国联邦政府用来标准化计算机系统的公共标准之一，包括一些用于加密数据的算法标准。当你在 Node.js 中启用 FIPS 模式时，Node.js 会强制使用符合 FIPS 标准的加密算法和函数。</p><p>现在，让我们来谈论错误 <code>ERR_CRYPTO_FIPS_UNAVAILABLE</code>。这个错误是在 Node.js 程序中发生的，在使用 <code>crypto</code> 模块时试图以 FIPS 兼容方式执行加密操作，但没有正确配置 Node.js 环境来支持 FIPS 模式或者系统本身不支持 FIPS 模式时，这个错误便会被触发。</p><p>简单的说，如果你试图在你的 Node.js 应用程序中使用 FIPS 模式，但是你的系统并不支持或者 Node.js 没有以支持 FIPS 模式启动，就会出现 <code>ERR_CRYPTO_FIPS_UNAVAILABLE</code> 错误。</p><p>来举几个例子说明可能的场景：</p><ol><li><p>开发一个需要符合 FIPS 标准的网站或应用程序：假设你是在为政府部门或其他需要满足严格安全规定的客户工作，那么可能会要求你的应用程序必须运行在启用了 FIPS 模式的 Node.js 环境中。如果你没有正确地设置 Node.js 或者操作系统以支持 FIPS，那么当你的程序试图使用加密功能时，就会抛出 <code>ERR_CRYPTO_FIPS_UNAVAILABLE</code> 错误。</p></li><li><p>使用 Node.js 编写的命令行工具：如果你创建了一个命令行工具，该工具使用加密技术来保护用户信息，并假设用户的环境都支持 FIPS。但某个用户在非 FIPS 支持环境中运行该工具时，相同的错误将会出现。</p></li></ol><p>要解决这个问题，你需要确保 Node.js 被配置为使用 FIPS 模式的加密库。这通常涉及到使用 Node.js 的构建选项来启用 FIPS 支持，或者在系统级别进行配置以确保 FIPS 模式可用。</p><p>请注意，由于你是编程新手，如果你没有特别的要求去遵守 FIPS 标准，你通常不需要担心 FIPS 模式或者这个错误。这些是面向特殊需求和高安全性场景的高级特性。对大多数初学者和普通项目来说，Node.js 默认的加密功能已经足够安全和强大了。</p><h3 id="err-crypto-hash-finalized" tabindex="-1"><a class="header-anchor" href="#err-crypto-hash-finalized"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_hash_finalized" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_HASH_FINALIZED</a></span></a></h3><p>Node.js 中的 <code>[ERR_CRYPTO_HASH_FINALIZED]</code> 错误与加密模块的使用有关。在 Node.js 中，加密模块允许你进行数据加密和解密，生成哈希值等操作。</p><p>哈希是一种算法，它接收输入（比如文本）并产生一个固定大小的字符串，这个字符串通常看起来是随机的，并且即使只改变输入中的一个小部分，输出的哈希值也会完全不同。哈希函数用于很多场景，例如验证数据完整性、存储密码等。</p><p>在 Node.js 的加密模块中，当你使用哈希函数时，你会按照以下步骤操作：</p><ol><li>创建一个哈希对象。</li><li>向哈希对象中输入数据。</li><li>结束输入数据，获取最终的哈希值。</li></ol><p>一旦你完成了步骤 3，也就是调用了 <code>.final()</code> 方法获取了最终的哈希值，哈希对象的状态就被设置为“已完成”。此时，如果你再次尝试向这个已经完成的哈希对象添加数据或者再次调用 <code>.final()</code> 方法，Node.js 就会抛出 <code>[ERR_CRYPTO_HASH_FINALIZED]</code> 错误。</p><p>下面通过一个例子来说明这个过程：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个哈希实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 输入一些数据到哈希实例</span></span>
<span class="line"><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取最终的哈希值</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> digest</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">digest</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印出哈希值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里我们已经调用了 `.digest()` 方法，所以哈希对象已经结束了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 下面我们尝试再次调用 `.update()` 方法添加更多数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">More data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将会抛出错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印出 [ERR_CRYPTO_HASH_FINALIZED]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 或者尝试再次获取哈希值也会导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> digestAgain</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里同样会打印出 [ERR_CRYPTO_HASH_FINALIZED]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个 SHA-256 哈希实例，并给它输入了 &quot;Hello, World!&quot; 字符串。然后，我们通过 <code>.digest()</code> 方法获取了这个字符串的哈希值。但是，在我们尝试第二次调用 <code>.update()</code> 或 <code>.digest()</code> 方法时，程序抛出了 <code>[ERR_CRYPTO_HASH_FINALIZED]</code> 错误，因为哈希对象在第一次调用 <code>.digest()</code> 后就已经完成了，不能再次被用来输入数据或获取哈希值。</p><p>简而言之，<code>[ERR_CRYPTO_HASH_FINALIZED]</code> 是告诉你，你正在尝试对一个已经完成且不能再修改的哈希对象进行操作。要解决这个问题，你需要创建一个新的哈希实例。</p><h3 id="err-crypto-hash-update-failed" tabindex="-1"><a class="header-anchor" href="#err-crypto-hash-update-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_hash_update_failed" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_HASH_UPDATE_FAILED</a></span></a></h3><p>当我们在 Node.js 中使用加密模块（crypto module）进行数据散列或哈希（hashing）操作时，有时可能会遇到一个错误，称为<code>ERR_CRYPTO_HASH_UPDATE_FAILED</code>。这个错误发生的时候，意味着尝试更新哈希对象失败了。</p><p>在 Node.js 中，散列是一种算法，它可以将任何长度的输入数据转换成一个固定长度的字符串。这通常用于确保数据的完整性，例如检查文件是否被篡改或用于保存密码的加密版本。</p><p>现在，让我们通俗地解释一下什么是哈希更新失败，并给出几个例子。</p><h3 id="故障原因" tabindex="-1"><a class="header-anchor" href="#故障原因"><span>故障原因：</span></a></h3><ul><li>输入数据类型不对：你可能试图向哈希函数传递了不支持的数据类型。</li><li>内部故障：在 Node.js 的底层 C++代码中，某些操作可能出错，导致无法正确更新哈希。</li></ul><h3 id="实际使用举例" tabindex="-1"><a class="header-anchor" href="#实际使用举例"><span>实际使用举例：</span></a></h3><p>假设你正在编写一个程序来验证文件的完整性。为此，你需要生成文件内容的哈希值。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个哈希对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取一个文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> input</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">readable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 读取数据块并更新哈希</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> input</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">) </span><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果这里出现了问题，可能会抛出 ERR_CRYPTO_HASH_UPDATE_FAILED</span></span>
<span class="line"><span style="color:#81A1C1;">  else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 文件读取完毕，输出最终的哈希值</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们创建了一个哈希对象，并且尝试通过读取文件并且逐步更新哈希对象来计算文件的 SHA-256 哈希值。如果在调用<code>hash.update(data)</code>的过程中发生了错误，比如说<code>data</code>变量不是一个有效的 Buffer 或者字符串，那么就可能触发<code>ERR_CRYPTO_HASH_UPDATE_FAILED</code>错误。</p><p>如果你看到这个错误，要做的第一件事是检查传递给<code>update()</code>方法的数据类型是否正确。在大多数情况下，改正数据类型或确保正确处理数据流就可以解决问题。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结:</span></a></h3><p><code>ERR_CRYPTO_HASH_UPDATE_FAILED</code>是 Node.js 中的一个特定错误，它表明在使用 crypto 模块进行数据哈希时更新哈希对象失败。这通常是由于传递给更新函数的数据类型不正确或内部错误所致。解决这个问题的关键是仔细检查和调试传递给哈希更新函数的数据。</p><h3 id="err-crypto-incompatible-key" tabindex="-1"><a class="header-anchor" href="#err-crypto-incompatible-key"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_incompatible_key" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INCOMPATIBLE_KEY</a></span></a></h3><p><code>ERR_CRYPTO_INCOMPATIBLE_KEY</code> 是在 Node.js 中一个特定类型的错误，它属于加密错误的一种。这种错误发生的时候，通常意味着你尝试使用了一个与期望的加密操作不兼容的密钥。换句话说，你在进行加密或解密操作时提供了一个不适合该操作的密钥。</p><p>让我们用一个简单的例子来解释这个概念：</p><p>在 Node.js 中，有一个名为 <code>crypto</code> 的模块，它提供了各种各样的加密功能。例如，假设你想要使用 RSA 算法来加密一些数据。你首先需要生成一对密钥（一个公钥和一个私钥）。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，假如我们要用公钥去加密一些信息：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">secret message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publicEncrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里没有问题，因为我们使用了正确的公钥进行加密。</p><p>但如果我们尝试用一个非 RSA 密钥进行加密，就可能会遇到<code>ERR_CRYPTO_INCOMPATIBLE_KEY</code>错误。比如说，我们创建了一个 EC（椭圆曲线）的密钥，然后尝试用它做 RSA 加密：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ecKeyPair</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ec</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  namedCurve</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sect239k1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedDataWithEcKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publicEncrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    ecKeyPair</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们使用了一个 EC 算法的公钥去尝试执行一个 RSA 算法的加密操作，结果就会抛出<code>ERR_CRYPTO_INCOMPATIBLE_KEY</code>错误，因为 EC 公钥不能用于 RSA 加密。</p><p>总结一下，当你在 Node.js 中遇到<code>ERR_CRYPTO_INCOMPATIBLE_KEY</code>错误时，应当检查你所使用的密钥是否匹配你尝试进行的操作。确保你的加密和解密操作都使用了与之相匹配的正确类型的密钥。</p><h3 id="err-crypto-incompatible-key-options" tabindex="-1"><a class="header-anchor" href="#err-crypto-incompatible-key-options"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_incompatible_key_options" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS</a></span></a></h3><p>在 Node.js 中，<code>ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS</code> 错误是一个特定类型的错误，它通常发生于处理密码学操作时，传递给 API 的选项与期望的不兼容。也就是说，当你尝试用加密模块进行操作（比如签名、解密等），而提供的密钥参数不适合当前操作时，Node.js 就会抛出这个错误。</p><p>接下来，我会举几个例子来说明出现这类错误的情况：</p><h3 id="示例-1-使用错误的密钥类型进行签名" tabindex="-1"><a class="header-anchor" href="#示例-1-使用错误的密钥类型进行签名"><span>示例 1：使用错误的密钥类型进行签名</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一个公钥（通常用于验证签名，而不是创建签名）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">-----BEGIN PUBLIC KEY-----</span></span>
<span class="line"><span style="color:#A3BE8C;">...你的公钥内容...</span></span>
<span class="line"><span style="color:#A3BE8C;">-----END PUBLIC KEY-----</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个签名对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 添加要签名的数据</span></span>
<span class="line"><span style="color:#D8DEE9;">signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是需要被签名的数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试用公钥进行签名，这显然是错误的，因为签名需要私钥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 这里会输出 ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS 错误信息，因为公钥不能用来签名</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="示例-2-使用非法密钥格式进行加密" tabindex="-1"><a class="header-anchor" href="#示例-2-使用非法密钥格式进行加密"><span>示例 2：使用非法密钥格式进行加密</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个明文内容</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这是需要加密的数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设有一串字符作为密钥（但格式或大小可能不正确）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">this-is-not-a-valid-key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 创建一个 cipher 实例</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-192-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1234567890123456</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果 key 不符合 aes-192-cbc 所需的格式或长度，那么会抛出错误</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果 key 不合法，这里会输出 ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS 错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这两个示例中，如果你尝试运行代码，都会遇到 <code>ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS</code> 错误。这个错误指出了你在使用 Node.js 加密模块的过程中，提供了不合适的密钥类型或格式。当你遇到这样的错误时，你应该检查所提供密钥的正确性和适用性。</p><p>总结来说，<code>ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS</code> 是 Node.js 在执行密码学操作时由于密钥设置不当而引发的错误。处理此类错误的关键是检查并确保提供给密码学函数的密钥选项是正确的，并且符合预期的操作标准。</p><h3 id="err-crypto-initialization-failed" tabindex="-1"><a class="header-anchor" href="#err-crypto-initialization-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_initialization_failed" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INITIALIZATION_FAILED</a></span></a></h3><p><code>ERR_CRYPTO_INITIALIZATION_FAILED</code>是一个错误类型，在 Node.js 中，特别是与加密功能有关的场景中会遇到。在使用 Node.js 内置的<code>crypto</code>模块进行数据加密、解密、生成散列（hash）或签名等操作时，如果加密库初始化失败，就可能引发这种错误。</p><p>这个错误可能由以下几种情况引起：</p><ol><li>你的系统上缺少必要的加密库或者这些库损坏。</li><li>Node.js 在编译时没有正确地配置加密支持。</li><li>在运行 Node.js 程序时，系统资源不足或权限受限导致无法初始化加密库。</li></ol><p>现在让我们通过一些具体的例子来理解这个错误：</p><h3 id="实际例子-1" tabindex="-1"><a class="header-anchor" href="#实际例子-1"><span>实际例子</span></a></h3><p>假设你正在使用 Node.js 的<code>crypto</code>模块来为用户密码生成一个安全的散列。代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> generateHash</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">pbkdf2Sync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1000</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 64</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha512</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> salt</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> hash</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> userPassword</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">mySuperSecretPassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> passwordData</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> generateHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">userPassword</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">passwordData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用了<code>pbkdf2Sync</code>方法来生成密码散列。通常，如果一切正常，你应该会得到一个包含盐值（salt）和散列值（hash）的对象。但是，如果在此过程中加密库初始化失败，那么在调用<code>pbkdf2Sync</code>方法时，就可能会抛出<code>ERR_CRYPTO_INITIALIZATION_FAILED</code>错误。</p><p>处理这个错误通常需要检查 Node.js 的安装和配置，确认系统上加密依赖是否完整，以及运行程序的环境是否有适当的权限和资源。</p><p>此外，这个错误也可以出现在其他使用了<code>crypto</code>模块的场景中，比如创建数字签名、生成随机字节或者建立 HTTPS 服务器时。每次使用加密功能时，都有可能会因为初始化问题而抛出这个错误。</p><h3 id="解决方法-1" tabindex="-1"><a class="header-anchor" href="#解决方法-1"><span>解决方法</span></a></h3><p>解决<code>ERR_CRYPTO_INITIALIZATION_FAILED</code>错误的大致步骤如下：</p><ol><li>确保你的系统上已经安装了所有必需的加密库，并且它们是最新的。</li><li>如果你自己编译了 Node.js，请检查编译选项是否包含了对加密的支持。</li><li>检查你的系统资源，确保有足够的内存和 CPU 资源来完成加密操作。</li><li>如果你的应用程序在容器或受限的环境中运行，请确保有适当的权限来访问加密库。</li></ol><p>如果你在实践过程中遇到了<code>ERR_CRYPTO_INITIALIZATION_FAILED</code>，请根据以上步骤进行排查。如果问题依然存在，考虑寻求更多社区支持或更新 Node.js 到最新版本，以获得可能包含的修复。</p><h3 id="err-crypto-invalid-auth-tag" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-auth-tag"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_auth_tag" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_AUTH_TAG</a></span></a></h3><p><code>[ERR_CRYPTO_INVALID_AUTH_TAG]</code> 是 Node.js 中的一个错误类型，它出现在使用加密模块进行某些操作时验证失败。这个错误具体是指在使用带有认证标签（Authentication Tag）的加密算法时，提供了一个无效或不正确的认证标签。</p><p>认证标签通常用于验证加密数据的完整性和真实性。它是一种安全机制，确保数据在传输过程中没有被篡改。在使用像 AES-GCM 这样的加密算法时，除了密文外，还会生成一个认证标签作为输出。接收方在解密时，需要使用同样的密钥和认证标签来验证密文是否有效，保证数据的安全。</p><p>如果在验证阶段提供的认证标签与加密时生成的标签不匹配，就会抛出<code>ERR_CRYPTO_INVALID_AUTH_TAG</code>错误。</p><h3 id="实际例子-2" tabindex="-1"><a class="header-anchor" href="#实际例子-2"><span>实际例子</span></a></h3><p>假设你正在编写一个需要安全通信的网络应用程序，并且使用了 AES-GCM 加密算法保证数据的安全性和完整性。这里是一段简化的代码，演示了如何使用 Node.js 的加密库进行加密和解密操作。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 加密函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> encrypt</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">text</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 初始化向量</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-gcm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">text</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> authTag</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getAuthTag</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 获取认证标签</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    iv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    encryptedData</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    authTag</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> authTag</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 解密函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> decrypt</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> authTag</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDecipheriv</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">aes-256-gcm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    secretKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">iv</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setAuthTag</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">authTag</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置认证标签</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  decrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 解密</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 密钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> textToEncrypt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Node.js!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 要加密的文本</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 加密文本</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">textToEncrypt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> secretKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encrypted:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试解密</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedText</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> decrypt</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">encryptedData</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    secretKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">iv</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    encrypted</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">authTag</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Decrypted:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> decryptedText</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_INVALID_AUTH_TAG</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Authentication tag is invalid! Data might be corrupted.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中：</p><ul><li><code>encrypt</code> 函数通过 AES-GCM 算法加密文本，并返回了包含初始化向量(<code>iv</code>)、加密后的数据(<code>encryptedData</code>)和认证标签(<code>authTag</code>)的对象。</li><li><code>decrypt</code> 函数则尝试对数据进行解密，并验证认证标签是否匹配。</li></ul><p>如果在调用<code>decrypt</code>函数时错误地更改了<code>authTag</code>，或者数据在传输过程中被篡改，导致认证标签校验失败，<code>decipher.final()</code>将抛出<code>ERR_CRYPTO_INVALID_AUTH_TAG</code>错误。这时，我们可以通过捕获这个错误并检查其<code>code</code>属性是否等于<code>&#39;ERR_CRYPTO_INVALID_AUTH_TAG&#39;</code>，来处理这种异常情况。</p><h3 id="err-crypto-invalid-counter" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-counter"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_counter" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_COUNTER</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的 <code>[ERR_CRYPTO_INVALID_COUNTER]</code> 错误。</p><p>在 Node.js 中，<code>[ERR_CRYPTO_INVALID_COUNTER]</code> 是一个与加密操作相关的错误。这个错误通常出现在使用某些特定类型的加密算法时，比如基于计数器模式（Counter mode，简称 CTR）的算法，其中需要指定一个“计数器”值。</p><p>加密是信息安全领域的一个重要组成部分，在网络上发送消息前将它们加密可以防止未经授权的人查看信息内容。CTR 模式是一种对称加密算法的工作模式之一，对称加密意味着加密和解密使用相同的密钥。</p><p>现在，为了明白 <code>ERR_CRYPTO_INVALID_COUNTER</code> 这个错误，我们需要知道 CTR 模式中的“计数器”是干什么用的。在 CTR 模式中，计数器是一个序列号，它对于每个加密的数据块是唯一的，并且随着每个新数据块的加密而增加。这个计数器不仅保证了加密的数据块具有高度的随机性，而且还确保即使两个相同的明文数据块被加密，得到的密文数据块也是不同的。</p><p>如果在使用 CTR 模式进行加密操作时提供了无效的计数器，例如格式不正确、大小不适当或者无法按预期递增，Node.js 就会抛出 <code>ERR_CRYPTO_INVALID_COUNTER</code> 这个错误。这意味着程序不能继续执行加密操作，因为没有有效的计数器值。</p><p>让我们通过一个例子来说明这一点：</p><p>假设你正在使用 Node.js 的 <code>crypto</code> 模块来实现某种加密操作，你选择了使用 CTR 模式的 AES 加密。在设置这个模式时，你需要提供一个初始化向量（IV），它起到类似计数器的作用。如果这个 IV 提供错误或格式不合规范，就会出现 <code>ERR_CRYPTO_INVALID_COUNTER</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有以下密匙和不正确的 IV（初始化向量）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-super-secret-key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 密钥应该是适当长度和格式的二进制数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> incorrectIV</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1234</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // IV 太短，不符合要求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-ctr</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> incorrectIV</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能会抛出 ERR_CRYPTO_INVALID_COUNTER 错误</span></span>
<span class="line"><span style="color:#616E88;">  // ... 其他加密逻辑</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果捕获到错误，控制台输出</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的 IV 应该是一个特定长度的二进制数据，长度取决于所使用的加密算法。AES-256 要求 IV 必须是 16 个字节的长度。</p><p>总结一下，<code>ERR_CRYPTO_INVALID_COUNTER</code> 错误表明在执行加密操作时遇到了一个无效的计数器值。在实际运用中，开发者应该确保使用正确的参数和格式来配置他们的加密算法，以避免此类错误。</p><h3 id="err-crypto-invalid-curve" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-curve"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_curve" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_CURVE</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_CURVE</code> 是 Node.js 中的一个错误码，它表示在使用 Node.js 的加密库时指定了无效的椭圆曲线。在 Node.js 中，加密库主要是用于执行与安全通信和数据保护相关的操作，比如创建 HTTPS 服务器或加密数据。</p><p>首先让我们理解一下什么是椭圆曲线（Elliptic Curve）。在密码学中，椭圆曲线加密是一种使用椭圆曲线数学原理来构建公钥系统的方法。它提供了与传统算法（如 RSA）相比更高的安全性，并且需要较短的密钥长度。</p><p>当你在 Node.js 中调用加密模块的一些函数，如创建椭圆曲线密钥对或签名数据时，你需要指定一个椭圆曲线名称。不同的曲线有不同的属性和安全级别。Node.js 支持一系列预定义的椭圆曲线，比如 <code>secp256k1</code>、<code>prime256v1</code> (也称为 <code>P-256</code>) 等。</p><p>现在，如果你试图使用一个 Node.js 加密库不支持的曲线名称，就会触发 <code>ERR_CRYPTO_INVALID_CURVE</code> 错误。</p><p>这里是一个简单的例子：</p><p>假设你想要生成一个椭圆曲线密钥对，但你给出了一个不存在的曲线名称：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;nonexistentcurve&#39; 不是一个有效的曲线名称。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createECDH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">nonexistentcurve</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会捕获并打印 ERR_CRYPTO_INVALID_CURVE 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的使用方式是指定支持的椭圆曲线名称：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;secp256k1&#39; 是一个由 Node.js 支持的有效椭圆曲线名称。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createECDH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">secp256k1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keys</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> ecdh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 生成密钥对</span></span>
<span class="line"><span style="color:#616E88;">  // ... 进行后续的加密或签名操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，你可能会在设置 HTTPS 服务器、签署或验证 JSON Web Tokens (JWTs)、执行客户端和服务端之间的安全通信等方面遇到椭圆曲线的使用场景。在这些情况下，确保选择有效且适合当前安全需求的椭圆曲线非常关键。如果不小心使用了错误的曲线名称，<code>ERR_CRYPTO_INVALID_CURVE</code> 就会提醒你进行更正。</p><h3 id="err-crypto-invalid-digest" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-digest"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_digest" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_DIGEST</a></span></a></h3><p>Node.js 中的 <code>ERR_CRYPTO_INVALID_DIGEST</code> 是一个错误代码，它表示在使用 Node.js 的加密模块时指定了一个无效的散列摘要算法。在 Node.js 中，你可能会用到加密模块来进行数据加密、创建哈希值、验证数据完整性等。</p><p>首先，让我解释一下“散列摘要算法”是什么。散列摘要算法，有时也称为哈希函数，是一种将任意长度的输入数据转换成固定长度输出字符串的方法，这个输出通常被称作哈希值或摘要。哈希函数有很多不同的算法，比如 MD5、SHA-1、SHA-256 等。每种算法都有其特点，而且随着时间的发展和计算能力的增强，某些老旧的哈希函数（比如 MD5 和 SHA-1）被认为不再安全，因此出现了更多新的、安全的算法。</p><p>当你在 Node.js 中使用 <code>crypto</code> 模块进行操作，如创建一个哈希值，你需要指定使用哪种哈希算法。如果你指定了一个 <code>crypto</code> 模块不支持的算法名称，就会抛出 <code>ERR_CRYPTO_INVALID_DIGEST</code> 错误。</p><p>下面我将通过几个例子来说明它的运用。</p><h3 id="例子-1-创建哈希值" tabindex="-1"><a class="header-anchor" href="#例子-1-创建哈希值"><span>例子 1：创建哈希值</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 创建一个哈希对象，并指定一个合法的算法名称</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 更新数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 计算摘要</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用了 SHA-256 算法（<code>&#39;sha256&#39;</code>），它是一个广泛支持和推荐使用的散列算法。如果你尝试替换 <code>&#39;sha256&#39;</code> 为一个不支持的算法名称，就会抛出 <code>ERR_CRYPTO_INVALID_DIGEST</code> 错误。</p><h3 id="例子-2-捕获无效算法名称错误" tabindex="-1"><a class="header-anchor" href="#例子-2-捕获无效算法名称错误"><span>例子 2：捕获无效算法名称错误</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试创建一个哈希对象，但使用了一个无效的算法名称 &#39;sha999&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha999</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 捕获到错误，并打印出错误信息</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_INVALID_DIGEST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">指定了无效的散列摘要算法！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们故意使用了一个不存在的散列算法 <code>&#39;sha999&#39;</code>，Node.js 无法识别这个算法名称，因此抛出了 <code>ERR_CRYPTO_INVALID_DIGEST</code> 错误，然后我们通过 try-catch 语句捕获了这个错误并打印出了自定义的错误信息。</p><p>总结起来，<code>ERR_CRYPTO_INVALID_DIGEST</code> 是一个与 Node.js 内置 <code>crypto</code> 模块相关的错误，当你尝试使用一个无效或未被支持的散列摘要算法时，Node.js 会抛出这个错误。正确处理这类错误可以帮助你调试程序，并确保加密操作的正确执行。</p><h3 id="err-crypto-invalid-iv" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-iv"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_iv" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_IV</a></span></a></h3><p>Node.js 中的 <code>ERR_CRYPTO_INVALID_IV</code> 错误是一个专门的错误类型，它涉及到在处理加密操作时使用的“初始化向量”（IV）。在讨论这个错误之前，我们需要理解一些基本的加密概念。</p><p><strong>加密和初始化向量(IV)的基础知识：</strong><br> 加密是将明文信息转换为无法读取的密文的过程，保证只有拥有正确秘钥的人才能解密并阅读原始信息。在对数据进行加密时，特别是使用块加密算法时，通常会用到一个名为“初始化向量”（IV）的东西。这个 IV 是随机生成的，并且不需要保密，但它必须是唯一的（通常意味着每次加密都要更改），以确保即使同样的数据被多次加密，产生的密文也将不同，这增加了加密过程的安全性。</p><p><strong>错误 <code>ERR_CRYPTO_INVALID_IV</code> 的含义：</strong><br> 当你在 Node.js 应用中执行加密操作，而传递给加密函数的 IV 不符合所需的条件时（例如长度不正确或没有提供 IV），就会抛出 <code>ERR_CRYPTO_INVALID_IV</code> 错误。</p><p><strong>实际例子：</strong></p><p>假设你正在使用 Node.js 的 <code>crypto</code> 模块来加密数据。如果你选择了一个使用 IV 的加密算法，比如 AES-256-CBC，IV 的长度通常应该是 16 字节。下面是使用正确和错误 IV 长度的代码示例。</p><p><strong>正确使用 IV 的例子：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 密钥和 IV 都必须正确设置</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 对于 AES-256-CBC，密钥应该是 32 字节</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 对于 AES-256-CBC，IV 应该是 16 字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是一个秘密消息</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们首先导入 <code>crypto</code> 模块，然后生成随机的密钥和 IV，这些长度都是适合 AES-256-CBC 算法的。之后，我们创建了一个加密器对象，并通过它对消息进行加密。</p><p><strong>错误使用 IV 的例子（导致 <code>ERR_CRYPTO_INVALID_IV</code>）：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 假设我们错误地生成了一个长度只有 8 字节的 IV</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这是错误的！对于 AES-256-CBC，IV 必须是 16 字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印出 ERR_CRYPTO_INVALID_IV 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个错误的例子中，我们故意生成了一个错误长度的 IV，因此当我们尝试创建加密器对象时，程序会抛出 <code>ERR_CRYPTO_INVALID_IV</code> 错误。这个错误表明 IV 的长度或格式不满足算法要求。</p><p>总结起来，<code>ERR_CRYPTO_INVALID_IV</code> 错误告诉你初始化向量在加密操作中的使用方式不正确，要修复这个错误，你需要确保 IV 的长度与选择的加密算法相匹配，而且每次加密操作时都应该使用新的随机 IV。</p><h3 id="err-crypto-invalid-jwk" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-jwk"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_jwk" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_JWK</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_JWK</code> 是 Node.js 中的一个错误类型，它指出在使用 JavaScript Web Key (JWK) 的操作中发现了无效的 JWK。JWK 是一种表示加密密钥的 JSON 格式，它经常被用于网络上的密钥交换，在如 JSON Web Tokens (JWT) 认证等场景中较为常见。</p><p>当 Node.js 的加密模块期望得到一个正确格式的 JWK，但是接收到的 JWK 有问题时（比如属性缺失、值类型不对、或者值本身就不合法），就会抛出 <code>ERR_CRYPTO_INVALID_JWK</code> 错误。</p><p>我可以给你举几个实际运用的例子来解释这个概念。</p><h3 id="实例-1-使用-jwk-生成密钥" tabindex="-1"><a class="header-anchor" href="#实例-1-使用-jwk-生成密钥"><span>实例 1：使用 JWK 生成密钥</span></a></h3><p>让我们来看一个简单的例子，假设你想用 JWK 创建一个具体的密钥对象。正常情况下，你会提供一个包含必要信息的 JSON 对象。如下是一个合法的 JWK：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> jwk</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  kty</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  e</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AQAB</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  n</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sXchV2uYv...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createPublicKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> jwk</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> format</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码演示了如何利用 JWK 来生成一个公钥。如果 JWK 的格式正确，那么这个代码将成功运行并打印出密钥信息。然而，如果 JWK 格式不正确，比如缺少了 <code>kty</code> 属性，Node.js 将会抛出 <code>ERR_CRYPTO_INVALID_JWK</code> 错误。</p><h3 id="实例-2-验证-json-web-token-jwt" tabindex="-1"><a class="header-anchor" href="#实例-2-验证-json-web-token-jwt"><span>实例 2：验证 JSON Web Token (JWT)</span></a></h3><p>当你尝试用 JWK 验证一个 JWT 的签名时，如果提供的 JWK 是无效的，同样会遇到 <code>ERR_CRYPTO_INVALID_JWK</code> 错误。以下是一个伪造的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> jwt</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">jsonwebtoken</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 引入 jsonwebtoken 库</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> token</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">你的.jwt.token</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> invalidJWK</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  /* 不完整或格式错误的 JWK 数据 */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decoded</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> jwt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">verify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">token</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> invalidJWK</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decoded</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果 JWK 无效，将捕获并输出 ERR_CRYPTO_INVALID_JWK 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>invalidJWK</code> 没有按照预期的格式传入，比如它缺少了表示密钥类型的 <code>kty</code> 属性，或者其他必须的组成部分，那么 <code>jsonwebtoken</code> 库在尝试验证 JWT 签名时就会因为 Node.js 抛出的 <code>ERR_CRYPTO_INVALID_JWK</code> 而失败。</p><p><strong>注意</strong>：由于错误信息可能会随着 Node.js 版本的更新而有所变化，建议查看你正在使用的特定版本的官方文档以获取最准确的信息。</p><h3 id="err-crypto-invalid-key-object-type" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-key-object-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_key_object_type" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</a></span></a></h3><p>在 Node.js 中，<code>ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</code>是一个特定类型的错误代码，它表示在使用加密模块时，提供了错误类型的密钥对象。让我们先解释一下背景知识，然后通过一个例子来说明这个错误。</p><h3 id="背景-密钥和-node-js-的加密模块" tabindex="-1"><a class="header-anchor" href="#背景-密钥和-node-js-的加密模块"><span>背景：密钥和 Node.js 的加密模块</span></a></h3><p>在 Node.js 中，<code>crypto</code>模块是用于加密的内置模块，它提供了很多用于数据加密、解密、生成摘要等功能的方法。当你使用这些方法时，你需要提供密钥（key），密钥可以是字符串或者一个特殊的密钥对象，比如 RSA、DSA 或 EC（椭圆曲线）的密钥对。</p><p>密钥对象通常有明确的类型，例如私钥对象、公钥对象或者密钥对对象，并且每种密钥对象都有其特定的使用场景。</p><h3 id="错误情况-err-crypto-invalid-key-object-type" tabindex="-1"><a class="header-anchor" href="#错误情况-err-crypto-invalid-key-object-type"><span>错误情况：<code>ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</code></span></a></h3><p>当你调用一个需要特定类型密钥对象的方法时，如果传入了错误类型的密钥对象，Node.js 就会抛出<code>ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</code>错误。例如，如果你尝试用公钥去做需要私钥才能完成的操作，比如签名（signing），就会发生这个错误。</p><h3 id="实际运用的例子-2" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-2"><span>实际运用的例子</span></a></h3><p>假设你想使用 RSA 算法来为一段数据创建数字签名。为此，你需要使用私钥：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> generateKeyPairSync</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> sign</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 生成RSA密钥对</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 待签名的数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是要被签名的数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 使用公钥来进行签名，这是不正确的，应该使用私钥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们本应该使用<code>privateKey</code>来执行<code>sign</code>函数，但是我们错误地使用了<code>publicKey</code>。这会导致 Node.js 抛出<code>ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</code>错误，因为<code>publicKey</code>无法用于创建数字签名，只有<code>privateKey</code>才能用于签名操作。</p><p>如果你将<code>publicKey</code>改为<code>privateKey</code>，那么代码就能正常运行，并生成数据的数字签名。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确使用私钥来进行签名</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span>总结</span></a></h3><p><code>ERR_CRYPTO_INVALID_KEY_OBJECT_TYPE</code>错误通常意味着你在使用 Node.js 的<code>crypto</code>模块进行某些操作时，提供了错误类型的密钥对象。当你遇到这个错误时，检查你所传递的密钥是否符合当前操作所需的类型，例如使用私钥进行签名或者使用公钥进行验证等。</p><h3 id="err-crypto-invalid-keylen" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-keylen"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_keylen" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_KEYLEN</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_KEYLEN</code> 是 Node.js 中的一个错误类型，它属于 Node.js 的加密库（crypto 模块）所抛出的错误。当你使用 crypto 模块进行编程时，如果你在创建密码学算法的键（key）时，提供了一个不合法或者不正确长度的键值，Node.js 会抛出这个错误。</p><p>在加密中，“键”是用于加密和解密数据的参数。根据不同的加密算法，这些键的长度有特定的要求。比如，如果你使用 AES-256 加密算法，那么你所需的键必须是 256 位（32 字节）长，如果你提供了一个更短或者更长的键，就会触发 <code>ERR_CRYPTO_INVALID_KEYLEN</code> 错误。</p><p>下面举例说明：</p><h3 id="实例-1-使用-crypto-createcipheriv-创建一个加密器实例" tabindex="-1"><a class="header-anchor" href="#实例-1-使用-crypto-createcipheriv-创建一个加密器实例"><span>实例 1：使用 <code>crypto.createCipheriv</code> 创建一个加密器实例</span></a></h3><p>假设我们想使用 AES-256-CBC 算法来加密一段文本。对于 AES-256-CBC，我们需要一个 256 位（即 32 字节）的键（key）和一个初始向量（iv），如果我们提供一个长度不是 32 字节的 key，就会看到 <code>ERR_CRYPTO_INVALID_KEYLEN</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的 key 长度应该是 32 字节</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">mysecretkey</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 明显太短了，只有 11 字节</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 初始向量通常是随机的 16 字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果 key 长度不是 32 字节，将无法执行到这里，会被 catch 捕获到</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码因为 key 长度不正确，将会输出像这样的信息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error: Invalid key length</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="实例-2-使用-crypto-pbkdf2-函数来生成一个安全的键" tabindex="-1"><a class="header-anchor" href="#实例-2-使用-crypto-pbkdf2-函数来生成一个安全的键"><span>实例 2：使用 <code>crypto.pbkdf2</code> 函数来生成一个安全的键</span></a></h3><p><code>pbkdf2</code> 函数用于基于密码生成一个密钥。当调用此函数时，你需要指定最终生成的键的字节长度。如果指定的长度不符合内部算法的要求，也会出现 <code>ERR_CRYPTO_INVALID_KEYLEN</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">mypassword</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1000</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keylen</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 64</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果这个长度是不支持的，会抛出 ERR_CRYPTO_INVALID_KEYLEN 错误</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pbkdf2</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">  password</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  salt</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  iterations</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  keylen</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">sha512</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果没有错误，打印生成的键</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码正常工作时不会有问题，但是如果你改变 <code>keylen</code> 的值到一个不受支持的长度，比如把它改成 <code>9999999</code>，就会抛出错误。</p><p>注意每次 Node.js 版本更新可能带来新的 API 更改，所以总是好主意去查阅当前版本的官方文档，确保你使用的功能和参数是正确的。</p><h3 id="err-crypto-invalid-keypair" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-keypair"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_keypair" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_KEYPAIR</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 JavaScript 引擎的 JavaScript 运行环境，它让我们可以在服务器端运行 JavaScript 代码。Node.js 提供了很多模块，其中 <code>crypto</code> 模块是用于加密功能的，它提供了包括数字签名和其它各种加密技术在内的功能。</p><h3 id="错误-err-crypto-invalid-keypair" tabindex="-1"><a class="header-anchor" href="#错误-err-crypto-invalid-keypair"><span>错误：ERR_CRYPTO_INVALID_KEYPAIR</span></a></h3><p>这个错误信息表示你在使用 Node.js 的 <code>crypto</code> 模块时遇到了问题。具体来说，“INVALID_KEYPAIR”这个部分告诉我们出错的原因是与密钥对有关。在加密中，密钥对通常指的是公钥和私钥的组合，在很多加密场景中需要同时使用这两个密钥。</p><p>当我们使用 <code>crypto</code> 模块进行操作如创建数字签名、进行加密解密操作时，如果提供给函数的密钥对无效或不匹配，就可能会抛出 <code>ERR_CRYPTO_INVALID_KEYPAIR</code> 错误。</p><p>这里举几个实际运用的例子：</p><h4 id="示例-1-生成和使用密钥对" tabindex="-1"><a class="header-anchor" href="#示例-1-生成和使用密钥对"><span>示例 1：生成和使用密钥对</span></a></h4><p>假设你正在尝试生成一个密钥对，并使用这个密钥对创建一个数字签名。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> generateKeyPair</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> createSign</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 异步生成一个 RSA 密钥对</span></span>
<span class="line"><span style="color:#88C0D0;">generateKeyPair</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 秘钥长度</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 使用得到的私钥创建签名对象</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> sign</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data to sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 加入一些数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 使用私钥生成签名</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码片段正常情况下不会抛出 <code>ERR_CRYPTO_INVALID_KEYPAIR</code>，因为它在正确生成并使用了一个有效的密钥对。</p><h4 id="示例-2-错误的密钥对引发的错误" tabindex="-1"><a class="header-anchor" href="#示例-2-错误的密钥对引发的错误"><span>示例 2：错误的密钥对引发的错误</span></a></h4><p>现在，如果你有一个私钥和公钥，但它们实际上并不配对，尝试使用它们进行某些操作时，就会报 <code>ERR_CRYPTO_INVALID_KEYPAIR</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> createSign</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这是你从某处获取的公钥和私钥，但它们其实不是一对</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-----BEGIN PUBLIC KEY-----</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">...</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">-----END PUBLIC KEY-----</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">-----BEGIN PRIVATE KEY-----</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">...</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">-----END PRIVATE KEY-----</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> sign</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data to sign</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 这里会抛出错误，因为 privateKey 实际上并不是 publicKey 的配对私钥</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里 err 将是 ERR_CRYPTO_INVALID_KEYPAIR</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，由于 <code>privateKey</code> 和 <code>publicKey</code> 不匹配，尝试用 <code>sign.sign(privateKey)</code> 方法生成签名时就会抛出 <code>ERR_CRYPTO_INVALID_KEYPAIR</code> 错误。</p><h3 id="解决方法-2" tabindex="-1"><a class="header-anchor" href="#解决方法-2"><span>解决方法</span></a></h3><p>当遇到 <code>ERR_CRYPTO_INVALID_KEYPAIR</code> 错误时，你需要检查提供给 <code>crypto</code> 相关函数的密钥对是否匹配、格式是否正确，以及是否满足该函数的要求。确保使用正确匹配的密钥对，才能成功执行加密或解密操作。</p><h3 id="err-crypto-invalid-keytype" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-keytype"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_keytype" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_KEYTYPE</a></span></a></h3><p>好的，Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它让开发者可以使用 JavaScript 来编写服务端代码。在 Node.js 中，你可以进行文件操作、网络通信等众多不受浏览器限制的操作。</p><p>错误 <code>[ERR_CRYPTO_INVALID_KEYTYPE]</code> 是一个与加密操作相关的错误类型。在 Node.js 的 <code>crypto</code> 模块中，你可以进行数据加密和解密的操作。这通常涉及到一些关键的组件，如密钥（keys）、证书（certificates）、签名（signatures）等。</p><p>当你在使用 Node.js 的加密模块时，如果你尝试用一个错误的密钥类型去做某些操作（比如尝试用公钥（public key）去执行本应使用私钥（private key）的操作），就可能会引发 <code>[ERR_CRYPTO_INVALID_KEYTYPE]</code> 错误。</p><p>下面是几个实际的例子来解释这种情况：</p><h3 id="示例-1-加密数据" tabindex="-1"><a class="header-anchor" href="#示例-1-加密数据"><span>示例 1: 加密数据</span></a></h3><p>假设你想使用 RSA 加密技术来加密一段文本信息。你需要一个公钥去加密数据，并且需要相对应的私钥来解密数据。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeyPairSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">rsa</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  modulusLength</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2048</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这是一段需要加密的文本信息。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">publicEncrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">publicKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">加密成功：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">加密失败：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子是正确的使用方式。但如果我们错误地将 <code>publicKey</code> 替换为 <code>privateKey</code>，则 Node.js 会抛出 <code>[ERR_CRYPTO_INVALID_KEYTYPE]</code> 错误。</p><h3 id="示例-2-解密数据" tabindex="-1"><a class="header-anchor" href="#示例-2-解密数据"><span>示例 2: 解密数据</span></a></h3><p>反过来，假设你有一段加密后的数据，你需要解密。你应该使用私钥来解密。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 上述例子中的 encryptedData 变量</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">privateDecrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encryptedData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">解密成功：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> decryptedData</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">解密失败：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里如果我们错误地尝试使用公钥来解密，或者使用了一个完全不匹配的密钥（比如一个 HMAC 密钥），就会触发 <code>[ERR_CRYPTO_INVALID_KEYTYPE]</code> 错误。</p><p>请记住，错误 <code>[ERR_CRYPTO_INVALID_KEYTYPE]</code> 指的是你提供了一个不适合当前操作的密钥类型。在编程实践中，要保证你为加密和解密操作使用正确的密钥类型，并且这些密钥是有效的并且没有损坏。当遇到这个错误时，检查你的密钥是否符合预期的格式和类型往往是解决问题的第一步。</p><h3 id="err-crypto-invalid-messagelen" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-messagelen"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_messagelen" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_MESSAGELEN</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_MESSAGELEN</code> 是 Node.js 中的一个错误码，它属于加密相关的错误（即来自<code>crypto</code>模块）。当你在使用 Node.js 的加密功能时，如果传入了一个不合适长度的消息给特定的加密操作，就可能触发这个错误。</p><p>让我们通过一些基本的概念和例子来详细理解它：</p><h3 id="加密模块的基本知识" tabindex="-1"><a class="header-anchor" href="#加密模块的基本知识"><span>加密模块的基本知识</span></a></h3><p>Node.js 的 <code>crypto</code> 模块提供了一系列用于执行各种加密操作的函数，比如散列计算、加密解密数据、生成随机字节等。在进行加密操作时，某些算法要求输入数据（即消息）必须有一个特定的长度或者长度范围。如果输入的消息长度不符合要求，程序就会抛出错误。</p><h3 id="什么是-err-crypto-invalid-messagelen" tabindex="-1"><a class="header-anchor" href="#什么是-err-crypto-invalid-messagelen"><span>什么是 <code>ERR_CRYPTO_INVALID_MESSAGELEN</code></span></a></h3><p>具体到 <code>ERR_CRYPTO_INVALID_MESSAGELEN</code> 这个错误，它表示你提供给某个加密算法的消息长度不正确，无法执行加密或相应操作。每种算法对消息长度的限制不同，所以错误的具体情况也会有所不同。</p><h3 id="实际运用的例子-3" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-3"><span>实际运用的例子</span></a></h3><p>假设我们使用了 Node.js 中的某个加密函数，需要固定长度的数据块来进行操作，比如 AES 加密。AES 加密对输入的数据块大小有严格要求（通常是 16 字节的倍数）。如果输入的数据块大小不满足要求，就会抛出 <code>ERR_CRYPTO_INVALID_MESSAGELEN</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一个 AES 加密的函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> encryptWithAES</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-128-ecb</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 密钥长度应该是 16 字节（128位）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1234567890abcdef</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试加密一个文本</span></span>
<span class="line"><span style="color:#616E88;">// 注意：请不要在生产环境使用 ECB 模式，这里只是为了演示。</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 正常情况，文本转换成 Buffer 后恰好是 16 字节的倍数</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedText</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encryptWithAES</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a secret message!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedText</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果尝试加密的文本长度不是 16 字节的倍数</span></span>
<span class="line"><span style="color:#616E88;">// 下面这段代码将会导致 ERR_CRYPTO_INVALID_MESSAGELEN 错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> erroneousText</span><span style="color:#81A1C1;"> =</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">This text causes an error because its length is not a multiple of the block size.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedText</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encryptWithAES</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">erroneousText</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedText</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ERR_CRYPTO_INVALID_MESSAGELEN</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述例子中，第二个 <code>encryptWithAES</code> 调用会因为输入文本转换为 Buffer 后的长度不是 16 字节的倍数而抛出 <code>ERR_CRYPTO_INVALID_MESSAGELEN</code> 错误。</p><p>要注意的是，这个错误不仅仅可以由 AES 触发，在使用 Node.js 的加密模块的其他场景下也可能遇到，关键是传入数据的长度不符合特定算法的要求。</p><p>希望这个解释能够帮助你理解 <code>ERR_CRYPTO_INVALID_MESSAGELEN</code> 这个错误以及它在实际使用中是怎样出现的。</p><h3 id="err-crypto-invalid-scrypt-params" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-scrypt-params"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_scrypt_params" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_SCRYPT_PARAMS</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_SCRYPT_PARAMS</code>是 Node.js 中的一个错误类型，它属于 Node.js 中用于加密的 crypto 模块。这个错误通常在你使用 crypto 模块内置的 scrypt 方法或其同步版本 scryptSync 时，如果你提供了无效的参数，就会抛出此类错误。</p><p>Scrypt 是一种密码基敔函数，被设计来保护密码存储不被破解。Scrypt 函数通过使用大量的内存和 CPU 资源来使暴力破解变得极为困难。</p><p>在 Node.js 中，当你想要加密一些敏感数据（比如用户的密码），你可能会使用到<code>crypto.scrypt()</code>或者<code>crypto.scryptSync()</code>这样的函数。这些函数需要一系列参数，包括：</p><ul><li><code>password</code>：需要被加密的密码。</li><li><code>salt</code>：加盐值，用于增强加密过程的安全性。</li><li><code>keylen</code>：生成密钥的长度。</li><li><code>options</code>：一个对象，包含了其他的配置项，例如 N、r、p 等参数，这些都关乎于 scrypt 算法的内存和 CPU 的使用量。</li></ul><p>如果这些参数没有按照预期设置，或者超出了 Node.js crypto 模块所支持的范围，就会导致<code>ERR_CRYPTO_INVALID_SCRYPT_PARAMS</code>错误。</p><p>举例来说：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 密码和盐应该是Buffer或字符串格式</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-secret-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">salt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 目标是生成一个256字节的密钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keylen</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 256</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 配置选项</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  N</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1024</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  r</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  p</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  maxmem</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 32</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 最大内存限制32MB</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">scryptSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keylen</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> options</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Derived key:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果options包含无效的N、r、p值或者maxmem太小，那么会抛出ERR_CRYPTO_INVALID_SCRYPT_PARAMS错误。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们试图使用<code>crypto.scryptSync()</code>来生成一个密钥。如果<code>options</code>对象中的参数设置不正确，如 N、r、p 的值太小或太大，或者 maxmem 不足以支持计算，就会抛出<code>ERR_CRYPTO_INVALID_SCRYPT_PARAMS</code>错误。常见的使用不当可能有：</p><ul><li>使用了非正整数作为 N、r、p 的值。</li><li>所需内存超过了<code>maxmem</code>的限制。</li><li><code>keylen</code>太大，超出了可以处理的范围。</li></ul><p>确保参数在合适的范围内就能避免这个错误。要修复这个问题，你需要检查你的参数是否符合 scrypt 函数的要求，并且调整它们以满足这些要求。</p><h3 id="err-crypto-invalid-state" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-state"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_state" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_STATE</a></span></a></h3><p><code>ERR_CRYPTO_INVALID_STATE</code> 是 Node.js 中的一个错误代码，它表明在使用 Node.js 的加密模块时发生了一个状态错误。换句话说，它表示尝试以某种不合适或非法的方式使用加密相关的功能。</p><p>在 Node.js 的加密模块中，有很多操作需要按照特定的顺序来执行。例如，如果你在创建加密散列（hash）之前尝试更新散列，或者如果你尝试使用未正确初始化的加密键进行操作，都可能会触发 <code>ERR_CRYPTO_INVALID_STATE</code> 错误。</p><p>举一个例子：考虑一下你正在使用 Node.js 加密模块的一个常见用例，即对数据进行加密和解密。假如你想要先初始化一个加密器，然后用它来加密一些数据。正常的流程大致应该是这样的：</p><ol><li>创建并初始化一个加密器对象。</li><li>使用加密器对象加密数据。</li><li>结束加密过程，获取加密后的数据。</li></ol><p>如果在初始化加密器之后，你直接跳到第三步尝试结束加密过程而没有实际加密任何数据，那你可能会遇到 <code>ERR_CRYPTO_INVALID_STATE</code> 错误，因为你试图在加密器还没有处于正确状态时完成加密操作。</p><p>下面是一个可能导致此错误的伪代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个加密器实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这里我们忘记了对数据进行加密，直接试图结束加密过程</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_CRYPTO_INVALID_STATE 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，<code>createCipheriv</code> 函数是用来创建一个加密器实例的，其中 <code>algorithm</code>, <code>key</code> 和 <code>iv</code> 分别代表加密算法、密钥和初始向量。在调用 <code>final()</code> 方法之前，我们本应该对一些数据调用 <code>cipher.update(data)</code> 方法进行加密。由于直接调用了 <code>final()</code> 而没有进行更新(<code>update</code>)操作，就违反了加密器对象正确的使用流程，从而触发 <code>ERR_CRYPTO_INVALID_STATE</code> 错误。</p><p>正确处理加密流程的代码应该类似于：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 定义加密算法、密钥和初始向量</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建加密器实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用加密器加密数据</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some clear text data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 完成加密过程，获取加密后的数据</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，首先通过 <code>cipher.update()</code> 方法更新了数据，然后才调用 <code>cipher.final()</code> 来结束加密过程，并获取最终加密的结果。这是正确的使用顺序，不会导致 <code>ERR_CRYPTO_INVALID_STATE</code> 错误。</p><h3 id="err-crypto-invalid-tag-length" tabindex="-1"><a class="header-anchor" href="#err-crypto-invalid-tag-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_invalid_tag_length" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_INVALID_TAG_LENGTH</a></span></a></h3><p>在 Node.js 中，<code>ERR_CRYPTO_INVALID_TAG_LENGTH</code>是一个特定的错误类型，它与加密操作相关。当你使用某些加密算法时，比如 AES（高级加密标准）的 GCM 模式（伽罗瓦/计数器模式），你需要提供一个&quot;tag&quot;，这个 tag 用来验证数据的完整性和真实性。如果这个 tag 长度不正确，那么 Node.js 就会抛出<code>ERR_CRYPTO_INVALID_TAG_LENGTH</code>错误。</p><p>为了更好地理解这个概念，让我们先来了解一些加密的基础知识：</p><p><strong>加密和认证标签（Tag）</strong><br> 在密码学中，加密算法可以保护数据不被未授权的人读取，而认证标签则是用来确认数据是否被篡改过。在使用对称加密算法如 AES 的 GCM 模式时，输出结果既包括加密后的数据，也包括一个用于验证数据的认证标签。</p><p><strong>认证标签的作用</strong><br> 这个标签的作用是，在解密数据时，确保数据在传输过程中没有被修改。如果数据或者标签在传输过程中被篡改，那么解密操作将失败，因为认证标签不匹配。</p><p><strong>标签的长度</strong><br> 在使用 GCM 模式进行加密时，你可以指定认证标签的长度。然而，并非所有长度都是有效的。通常情况下，有效的标签长度可能是 12 字节（96 位）或者其他根据算法规范定义的长度。如果你尝试使用一个不合规范的标签长度，就会导致<code>ERR_CRYPTO_INVALID_TAG_LENGTH</code>错误。</p><p><strong>实际的例子</strong><br> 假设你正在编写一个 Node.js 应用，该应用需要安全地存储用户的敏感信息。你选择使用 AES-GCM 算法来加密这些数据。以下是一个简化的例子，展示如何进行加密和解密：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一些敏感数据要加密</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> secretMessage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这是一个秘密消息</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 随机生成密钥和初始向量(IV)用于加密</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // AES-256需要32字节的密钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 初始向量通常是16字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建cipher实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-gcm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 加密消息</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">secretMessage</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取认证标签</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tag</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getAuthTag</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ... 存储 encrypted 和 tag 等待以后解密 ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 解密过程...</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDecipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-256-gcm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> key</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setAuthTag</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">tag</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置之前获得的认证标签</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试解密</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> decrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  decrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> decipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">decrypted</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果成功，将展示原始消息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_INVALID_TAG_LENGTH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无效的标签长度错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，如果你使用了一个不支持的认证标签长度，你将在运行时遇到<code>ERR_CRYPTO_INVALID_TAG_LENGTH</code>错误。在实际使用中，你需要确保遵循 Node.js 文档和相关的密码学规范，使用正确的标签长度。</p><h3 id="err-crypto-job-init-failed" tabindex="-1"><a class="header-anchor" href="#err-crypto-job-init-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_job_init_failed" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_JOB_INIT_FAILED</a></span></a></h3><p>Node.js 是一个使用 Chrome 的 V8 JavaScript 引擎来执行代码的平台，它常用于创建高性能、可扩展的网络应用程序。Node.js 使用事件驱动、非阻塞 I/O 模型，使其轻量且高效。</p><p>在 Node.js 中，有一个模块叫做 <code>crypto</code>，它提供了包括 OpenSSL&#39;s hash、HMAC、cipher、decipher、sign 和 verify 等在内的加密功能。当你使用这个模块中的功能时，通常会创建一些称为 &quot;jobs&quot; 的任务来处理加密操作。</p><p><code>ERR_CRYPTO_JOB_INIT_FAILED</code> 是 Node.js 抛出的错误类型之一，它表示在初始化加密操作的时候发生了错误。如果你看到了这个错误，这意味着 Node.js 在尝试开始一个加密任务的时候遇到了问题，无法正常启动这个任务。</p><p>原因可能是多方面的，比如：</p><ul><li>由于系统资源不足（比如内存），导致无法创建新的任务。</li><li>内部配置错误或者底层库的问题。</li><li>版本不兼容等引起的未知错误。</li></ul><p>让我们通过一个简单的例子来理解这个错误可能是如何发生的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们在这里初始化一个加密相关的操作，</span></span>
<span class="line"><span style="color:#616E88;">  // 但是由于某种原因，这个操作不能被初始化。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> job</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipher</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-192-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">a_secret_key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 正常情况下，后续代码会使用 job 来进行加密工作，</span></span>
<span class="line"><span style="color:#616E88;">  // 但是如果上面的 createCipher 出现问题，</span></span>
<span class="line"><span style="color:#616E88;">  // 就会捕获到 ERR_CRYPTO_JOB_INIT_FAILED 这样的错误。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果错误是 ERR_CRYPTO_JOB_INIT_FAILED，</span></span>
<span class="line"><span style="color:#616E88;">  // 我们就知道这是一个初始化加密操作时的错误。</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_JOB_INIT_FAILED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">加密任务初始化失败！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，通常当你遇到这类错误时，首先应该查看你传递给 <code>crypto</code> 函数的参数是否正确，然后检查系统资源和环境是否满足要求。如果错误持续存在，可能需要进一步的调试或查询文档，甚至可能需要更新 Node.js 到最新版本或者修补库的问题。</p><h3 id="err-crypto-jwk-unsupported-curve" tabindex="-1"><a class="header-anchor" href="#err-crypto-jwk-unsupported-curve"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_jwk_unsupported_curve" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</a></span></a></h3><p>好的，让我们一步一步来解释这个错误信息：<code>ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</code>。</p><p>首先，我们需要了解几个概念：</p><ol><li><p><strong>Node.js</strong>: 这是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它允许你在服务器端运行 JavaScript 代码。</p></li><li><p><strong>Crypto</strong>: 在 Node.js 中，<code>crypto</code>模块提供加密功能，包括对数据进行加密和解密的能力。</p></li><li><p><strong>JWK (JSON Web Keys)</strong>: JWK 是一种用于表示加密密钥的 JSON 格式。它主要用于 Web 应用中的密钥交换。</p></li><li><p><strong>Curve</strong>: 当我们在加密领域谈论&quot;curve&quot;时，通常指的是椭圆曲线。椭圆曲线加密（ECC）是一种公钥加密技术，它依赖于椭圆曲线数学来生成安全的加密密钥。</p></li></ol><p>现在，让我们理解错误信息本身：</p><ul><li><code>ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</code> 是一个特定的错误类型，它表明你尝试使用一个 JWK（JSON Web Key），但是这个密钥使用了 Node.js 不支持的椭圆曲线。</li></ul><p>现实中遇到这个错误通常意味着你正在与一些加密算法打交道，特别是那些涉及到椭圆曲线的算法。例如，假设你有一个应用，需要验证通过第三方服务（如 OAuth 提供商）提供的 JWT（JSON Web Tokens）。JWT 可能会包含一个用于签名验证的公钥，表示为 JWK。</p><p>如果这个公钥使用了 Node.js 不支持的曲线，当你的应用尝试使用这个公钥时，就会抛出<code>ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</code>错误。</p><p>下面是一个简化的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们从外部服务获取了一个JWK</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> jwk</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  kty</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EC</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  crv</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">P-1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这里故意使用一个不存在的曲线名称</span></span>
<span class="line"><span style="color:#88C0D0;">  x</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">......</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  y</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">......</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试将JWK转换为Node.js支持的密钥格式</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyObject</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createPublicKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> jwk</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> format</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果曲线不支持，将捕获到此错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，我们导入了 Node.js 的<code>crypto</code>模块，并试图用<code>createPublicKey</code>方法将一个 JWK 对象转换成 Node.js 能识别的公钥对象。如果这个 JWK 对象包含的<code>crv</code>属性值是 Node.js 不支持的曲线名称，比如&quot;P-1&quot;这个错误的曲线，就会抛出<code>ERR_CRYPTO_JWK_UNSUPPORTED_CURVE</code>错误。</p><p>修复这个问题的方法通常涉及以下几个步骤：</p><ol><li>确认是否有笔误或者配置错误导致了不正确的曲线名称。</li><li>检查 Node.js 的文档或更新日志，看看你需要的曲线是否在新版 Node.js 中得到支持。</li><li>如果必须使用该曲线，考虑使用其他库或工具，或者升级到支持所需曲线的 Node.js 版本。</li></ol><h3 id="err-crypto-jwk-unsupported-key-type" tabindex="-1"><a class="header-anchor" href="#err-crypto-jwk-unsupported-key-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_jwk_unsupported_key_type" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</a></span></a></h3><p><code>ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</code>是 Node.js 中的一个错误类型，它与 Node.js 的加密模块有关。在这个上下文中，“JWK”指的是 JSON Web Key，这是一种使用 JSON 格式表示加密密钥的标准。</p><p>Node.js 的加密模块允许你进行各种加密操作，比如生成密钥、加密数据、解密数据、签名数据和验证签名等。为了完成这些操作，你需要使用密钥。这些密钥可以以多种形式存在，其中一种就是 JWK。</p><p>当你尝试使用一个被认为是 JWK 格式的密钥时，如果这个密钥的类型不被 Node.js 所支持，你会遇到<code>ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</code>错误。换句话说，这个错误告诉你：“你给我的 JWK 密钥类型，我不认识，也不知道怎么用。”</p><p>让我们通过一个例子来看看这个错误是怎么发生的：</p><p>假设你正在尝试导入一个 JWK 格式的密钥，以便用于数字签名或者加密。一个基本的 JWK 对象可能看起来像这样：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">kty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RSA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">e</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AQAB</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0vx7agoebGcQSuuPiLJXZptN9nndrQmbXE...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的<code>kty</code>属性代表密钥类型（Key Type），在这个例子中是<code>RSA</code>，这是一种广泛支持的公钥加密算法。</p><p>然而，如果你尝试导入一个包含不被支持的<code>kty</code>值的 JWK，比如一个虚构的密钥类型<code>XYZ</code>，Node.js 就会抛出<code>ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</code>错误，因为它不知道如何处理这种类型的密钥。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> jwkKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  kty</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">XYZ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这是一个不支持的密钥类型</span></span>
<span class="line"><span style="color:#88C0D0;">  e</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">AQAB</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  n</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0vx7agoebGcQSuuPiLJXZptN9nndrQmbXE...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keyObject</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createPublicKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> jwkKey</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> format</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">jwk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会捕获并输出 ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要修复这个问题，确保你使用的 JWK 密钥类型是 Node.js 支持的类型之一。Node.js 目前支持的密钥类型包括 RSA、EC（椭圆曲线）、OKP（Octet Key Pair）等。如果你在代码中遇到这个错误，检查你的 JWK 对象，确保<code>kty</code>字段是正确的，并且对应一个 Node.js 支持的密钥类型。</p><p>简而言之，<code>ERR_CRYPTO_JWK_UNSUPPORTED_KEY_TYPE</code>就是 Node.js 告诉你，你尝试使用的密钥类型它不理解，检查密钥类型是否正确或者是否支持当前的操作。</p><h3 id="err-crypto-operation-failed" tabindex="-1"><a class="header-anchor" href="#err-crypto-operation-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_operation_failed" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_OPERATION_FAILED</a></span></a></h3><p>在 Node.js 中，当你使用 Node 的加密模块来进行某些加密操作时，如果出现了无法预料的内部错误，你就会遇到<code>ERR_CRYPTO_OPERATION_FAILED</code>这个错误。这种错误并不是因为你使用的方法或参数有问题，而是因为加密过程中发生了一些意外的问题，例如系统资源不足或者内部库的故障。</p><p>下面用一个简单例子来说明可能导致<code>ERR_CRYPTO_OPERATION_FAILED</code>错误的情形：</p><p>首先，你需要知道 Node.js 的<code>crypto</code>模块提供了各种加密功能，包括数据加密、生成哈希等。</p><p>假设我们尝试对一段文字进行加密处理：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipher</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-192-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">a password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> encryptedText</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encryptData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Encrypted text: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">encryptedText</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Encryption failed:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个名为<code>encryptData</code>的函数，它接收要加密的数据并返回加密后的结果。如果在加密过程中出现了一些不可控的错误，就有可能抛出<code>ERR_CRYPTO_OPERATION_FAILED</code>异常。</p><p>请注意，实际上不是每次加密都会出现这个错误，因为它通常与底层系统的状态有关，比如内存不足或者加密库的问题。所以，如果你真的碰到了这个错误，并且确定你的代码使用方法没有问题，那么你可能需要检查系统资源或者重新安装或更新 Node.js 环境。</p><p>在实际应用中，如果你的程序抛出了<code>ERR_CRYPTO_OPERATION_FAILED</code>错误，你应该确保：</p><ol><li>你的系统有足够的资源运行加密操作。</li><li>Node.js 和它的依赖库是最新的，没有已知的 bug。</li><li>如果问题仍然存在，你可以尝试重启程序或服务器，看看问题是否能够解决。</li></ol><p>通常，这类错误较为罕见，多数情况下，加密操作会顺利完成。但了解这个错误可以帮助你更好地调试程序，在遇到问题时快速定位原因。</p><h3 id="err-crypto-pbkdf2-error" tabindex="-1"><a class="header-anchor" href="#err-crypto-pbkdf2-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_pbkdf2_error" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_PBKDF2_ERROR</a></span></a></h3><p>好的，我来解释一下 Node.js 中的 <code>ERR_CRYPTO_PBKDF2_ERROR</code> 错误。</p><p>首先，我们需要理解几个概念：Node.js、crypto 模块和 PBKDF2。</p><p><strong>Node.js</strong> 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它让我们能够使用 JavaScript 语言编写服务器端的应用程序。</p><p>在 Node.js 中有一个名为 <strong>crypto</strong> 的核心模块。这个模块提供了包括密码学在内的许多安全相关的功能，例如加密、解密和散列等。</p><p><strong>PBKDF2</strong>（Password-Based Key Derivation Function 2）是一种密钥派生函数。它的作用是接收一个密码和一个盐值（salt），然后经过多次计算后输出一个密钥。这个过程通常用于加强密码存储的安全性，防止彩虹表攻击，并可以抵御穷举攻击。</p><p>现在让我们看看 <code>ERR_CRYPTO_PBKDF2_ERROR</code>：</p><p>当你在 Node.js 应用中使用 crypto 模块进行 PBKDF2 相关操作时，如果遇到了问题或异常，就可能会抛出 <code>ERR_CRYPTO_PBKDF2_ERROR</code> 这个错误。换句话说，这个错误表示 PBKDF2 密钥派生失败了。</p><p>举个例子，假设你想使用 crypto 模块生成一个基于用户密码的密钥，并用于后续加密操作。代码可能是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 用户的密码和一个随机生成的盐值</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 派生密钥的参数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 100000</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 计算次数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keylen</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 64</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 期望得到的密钥长度 (以字节为单位)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> digest</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha512</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 哈希函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pbkdf2</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iterations</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keylen</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> digest</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥派生失败:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里抛出的可能就是 ERR_CRYPTO_PBKDF2_ERROR</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">派生的密钥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果这段代码运行正常，那么你将在控制台上看到一串派生的密钥。但如果由于某些原因（比如参数不正确，或系统资源不足等）导致派生过程出错，就会捕获到 <code>ERR_CRYPTO_PBKDF2_ERROR</code> 这个错误。</p><p>总结一下，<code>ERR_CRYPTO_PBKDF2_ERROR</code> 是 Node.js 在使用 crypto 模块进行 PBKDF2 密钥派生时，如果遇到错误就会出现的一个标识符，告诉你密钥派生过程中出现了问题。</p><h3 id="err-crypto-scrypt-invalid-parameter" tabindex="-1"><a class="header-anchor" href="#err-crypto-scrypt-invalid-parameter"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_scrypt_invalid_parameter" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_SCRYPT_INVALID_PARAMETER</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎运行的 JavaScript 环境，它允许你在服务器端执行 JavaScript。在 Node.js 中，你可以使用各种内建模块来完成不同的任务，比如文件系统操作、网络请求处理等。</p><p><code>ERR_CRYPTO_SCRYPT_INVALID_PARAMETER</code> 是 Node.js 中的一个错误代码，它属于加密错误的一类。这个特定的错误是在你尝试使用 Node.js 内置的 <code>crypto</code> 模块中的 <code>scrypt</code> 方法时产生的，如果你为该方法提供了无效的参数，就会抛出这个错误。</p><p><code>scrypt</code> 是一个密码基键派生函数，它可以用来将用户提供的密码转换为固定长度的密钥。这在储存和验证用户密码时非常有用，因为它增加了破解密码的难度，从而提高安全性。</p><p>这里是一个简单的例子来说明当你使用 <code>scrypt</code> 函数时可能遇到的 <code>ERR_CRYPTO_SCRYPT_INVALID_PARAMETER</code> 错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 通常，你需要提供一个密码、盐值、密钥长度、选项对象和一个回调函数。</span></span>
<span class="line"><span style="color:#616E88;">// 如果提供的参数不符合预期或者缺失，就会抛出 ERR_CRYPTO_SCRYPT_INVALID_PARAMETER 错误。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们故意传入一个无效参数来触发错误</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-salt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyLen</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 密钥长度不能是负数，所以这个是无效的</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">scrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyLen</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印出 ERR_CRYPTO_SCRYPT_INVALID_PARAMETER 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们故意设置 <code>keyLen</code> 参数为 <code>-1</code>。由于密钥长度不能是负数，所以这会导致 <code>scrypt</code> 方法抛出 <code>ERR_CRYPTO_SCRYPT_INVALID_PARAMETER</code> 错误。</p><p>正确使用 <code>scrypt</code> 的方式应该像下面这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 定义有效的参数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">user-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 用户的密码</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> salt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-salt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 盐值，它是一个随机字符串，用来提高密码的复杂性</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> keyLen</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 64</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出密钥的长度（字节数）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用 scrypt 方法</span></span>
<span class="line"><span style="color:#D8DEE9;">crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">scrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> salt</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keyLen</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> derivedKey</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果出现错误，会在这里处理</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 如果没有错误，derivedKey 就是生成的密钥</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">derivedKey</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 将生成的密钥转换为十六进制字符串输出</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际开发中，你会使用 <code>scrypt</code> 来加密用户密码，并将其存储在数据库中。当用户尝试登录时，你会再次使用相同的密码和盐值进行 <code>scrypt</code> 加密，然后将结果与数据库中存储的密钥进行比较，以验证用户的身份。</p><h3 id="err-crypto-scrypt-not-supported" tabindex="-1"><a class="header-anchor" href="#err-crypto-scrypt-not-supported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_scrypt_not_supported" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_SCRYPT_NOT_SUPPORTED</a></span></a></h3><p>Node.js 是一个基于 Chrome 的 V8 JavaScript 引擎构建的 JavaScript 运行环境。它让开发者能够使用 JavaScript 来编写服务器端的代码，以及运行一些需要后端处理的脚本。现在，让我们来聊一聊 Node.js 中的一个特定错误：<code>ERR_CRYPTO_SCRYPT_NOT_SUPPORTED</code>。</p><p>这个错误表示你尝试使用了一个叫作 <code>scrypt</code> 的加密功能，但是这个功能在你当前的 Node.js 环境中不可用。<code>scrypt</code> 是一个密码基础密钥派生函数，广泛用于将用户提供的密码转换为一个固定长度的密钥，这个密钥然后可以用于进一步的加密操作。它设计得故意计算量大、内存消耗高，以此来抵抗暴力破解攻击。</p><p>下面举几个实际的例子说明 <code>scrypt</code> 加密是如何应用的：</p><ol><li><p><strong>用户账号密码存储</strong>：<br> 在网站或应用程序中，当用户创建账户时，通常会被要求设置一个密码。出于安全考虑，你不能直接把这些密码明文存储在数据库中。相反，你需要将密码通过一个密钥派生函数（如 <code>scrypt</code>）进行哈希处理，然后存储生成的哈希值。这样即使数据库被泄露，攻击者也很难还原出原始密码。</p></li><li><p><strong>加密钱包</strong>：<br> 在加密货币领域，<code>scrypt</code> 可用于加密钱包文件，确保只有知道密码的人才能访问和使用里面的资金。</p></li><li><p><strong>文件加密</strong>：<br> 如果你想要加密一些敏感数据或文件，可以先用 <code>scrypt</code> 从一个密码生成一个密钥，再使用该密钥对数据进行加密。</p></li></ol><p>如果你遇到了 <code>ERR_CRYPTO_SCRYPT_NOT_SUPPORTED</code> 错误，这通常意味着你的 Node.js 版本可能太旧，或者 Node.js 在构建时没有包含对 <code>scrypt</code> 功能的支持。例如，在某些操作系统上，默认的 Node.js 构建可能未包含某些加密算法。</p><p>解决这个问题，你可以尝试以下方法：</p><ul><li><p><strong>升级 Node.js</strong>：检查你是否运行的是最新版的 Node.js，因为新版本可能已经修复了这个问题。</p></li><li><p><strong>自定义构建 Node.js</strong>：如果你有能力，可以尝试从源代码构建 Node.js，并确保在构建过程中启用 <code>scrypt</code> 支持。</p></li><li><p><strong>替代模块</strong>：如果上述方法都不适用，你可以寻找一些第三方的 Node.js 包，比如 <code>bcrypt</code>，这是另外一个流行的密钥派生函数，它可能在你的环境中有支持。</p></li></ul><h3 id="err-crypto-sign-key-required" tabindex="-1"><a class="header-anchor" href="#err-crypto-sign-key-required"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_sign_key_required" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_SIGN_KEY_REQUIRED</a></span></a></h3><p>好的，让我们来聊一下 Node.js 中的 <code>[ERR_CRYPTO_SIGN_KEY_REQUIRED]</code> 这个错误。</p><p>首先，为了理解这个错误，你需要知道在 Node.js 中，有一个内置的模块叫 <code>crypto</code>，它用于处理加密功能，比如生成数字签名和公钥/私钥对等。数字签名是一种用于验证信息完整性和来源认证的技术。简单来说，就是像在文件上签名一样，只不过这里是用数学的方式在电子数据上&quot;签名&quot;。</p><p>当你使用 <code>crypto</code> 模块中的某些函数来生成数字签名时，你必须提供一个私钥（signing key）。因为没有这个私钥，函数就无法生成签名。如果你尝试调用签名函数而没有传入需要的私钥，Node.js 就会抛出 <code>[ERR_CRYPTO_SIGN_KEY_REQUIRED]</code> 这个错误，告诉你“嘿，我需要一个私钥来完成签名”。</p><p>现在，让我们通过一个实际的例子来说明这一点：</p><p>假设你想创建一个数字签名，以验证发送给某人的消息是真实的。在 Node.js 中，你将会这么做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> message</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这是需要签名的消息</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设你有一个私钥字符串或者Buffer</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这里应该是你的私钥内容</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个Sign对象</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 把你的消息放进去准备签名</span></span>
<span class="line"><span style="color:#D8DEE9;">signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 生成签名</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> signer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKey</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">签名是: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">signature</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 如果私钥丢失或未提供，这里会捕捉到错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，如果你没有提供有效的私钥给 <code>signer.sign</code> 方法，或者你根本就没提供私钥，那么 <code>crypto</code> 模块就会抛出 <code>[ERR_CRYPTO_SIGN_KEY_REQUIRED]</code> 错误。</p><p>希望这个解释和例子帮助你理解这个概念！记住，在进行加密操作时，总是需要正确管理和提供必要的密钥。</p><h3 id="err-crypto-timing-safe-equal-length" tabindex="-1"><a class="header-anchor" href="#err-crypto-timing-safe-equal-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_timing_safe_equal_length" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_TIMING_SAFE_EQUAL_LENGTH</a></span></a></h3><p><code>ERR_CRYPTO_TIMING_SAFE_EQUAL_LENGTH</code> 是 Node.js 中的一个错误代码，它代表一个特定类型的错误。这个错误出现在你使用 Node.js 的加密模块中的 <code>crypto.timingSafeEqual()</code> 函数时。</p><p><code>crypto.timingSafeEqual(a, b)</code> 函数的作用是以时间攻击安全（timing-attack safe）的方式比较两个缓冲区（Buffer），字符串或者 TypedArray 是否相等。&quot;时间攻击安全&quot;意思是无论两个值是否相等，函数的运行时间都是恒定的，这样攻击者就不能通过测量处理时间来推断出任何信息，进而用于破解密码等敏感操作。</p><p>为了保证比较的时间攻击安全性，输入给 <code>crypto.timingSafeEqual()</code> 的两个参数必须具有相同的长度。如果它们的长度不同，Node.js 就会抛出 <code>ERR_CRYPTO_TIMING_SAFE_EQUAL_LENGTH</code> 错误。</p><p>下面举个例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 两个相同长度的缓冲区</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer1</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">1234</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer2</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">4321</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这个比较是时间攻击安全的</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isEqual</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">timingSafeEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer2</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isEqual</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">相等</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">不相等</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 两个不同长度的缓冲区将会导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer3</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里会抛出 ERR_CRYPTO_TIMING_SAFE_EQUAL_LENGTH 错误</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> isEqual</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">timingSafeEqual</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer3</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">isEqual</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">相等</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">不相等</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果不捕获错误，程序将会退出</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在真实应用场景中，<code>crypto.timingSafeEqual()</code> 经常用于比较例如密码哈希：当用户登录时，系统会对用户提供的密码进行哈希处理，然后使用 <code>crypto.timingSafeEqual()</code> 来与存储在数据库中的正确哈希值进行比较，从而确保即使密码不正确，比较所花费的时间也和密码正确时相同，提高系统的安全性。</p><h3 id="err-crypto-unknown-cipher" tabindex="-1"><a class="header-anchor" href="#err-crypto-unknown-cipher"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_unknown_cipher" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_UNKNOWN_CIPHER</a></span></a></h3><p>Node.js 是一个基于 Chrome 的 V8 JavaScript 引擎的 JavaScript 运行环境，它使得开发者能够用 JavaScript 编写服务器端的代码。Node.js 提供了很多内建的模块，其中 <code>crypto</code> 模块就是用来执行加密操作的。</p><p>在 Node.js 中，当你使用 <code>crypto</code> 模块进行加密或解密操作时，你需要指定一个算法（例如 AES、DES 等）。每种算法都有自己的名称或字符串标识符，这些名称在 Node.js 版本间可能会有变化，取决于底层支持的加密库（比如 OpenSSL）。</p><h3 id="err-crypto-unknown-cipher-的含义" tabindex="-1"><a class="header-anchor" href="#err-crypto-unknown-cipher-的含义"><span>[ERR_CRYPTO_UNKNOWN_CIPHER] 的含义</span></a></h3><p><code>[ERR_CRYPTO_UNKNOWN_CIPHER]</code> 是一个错误码，它表示在使用 <code>crypto</code> 模块进行加密或解密操作时所提供的密码算法名称未被识别或不受支持。换句话说，你可能尝试使用了一个拼写错误的算法名称，或者该算法根本就不存在于当前的 Node.js 版本中。</p><h3 id="实际运用的例子-4" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-4"><span>实际运用的例子</span></a></h3><ol><li><p><strong>正确使用加密算法</strong></p><p>假设你想要使用 AES-256-CBC 算法来加密一段文本，在 Node.js 中你可能会这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">aes-256-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> encrypt</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">text</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">text</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  encrypted</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">concat</span><span style="color:#D8DEE9FF;">([</span><span style="color:#D8DEE9;">encrypted</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">final</span><span style="color:#D8DEE9FF;">()])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> encrypted</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> textToEncrypt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> encryptedText</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encrypt</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">textToEncrypt</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">encryptedText</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出加密后的文本</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用了 <code>&#39;aes-256-cbc&#39;</code> 作为算法名称，这是 Node.js 所支持的。</p></li><li><p><strong>导致 ERR_CRYPTO_UNKNOWN_CIPHER 错误的错误用法</strong></p><p>如果你拼写错了算法名称，比如下面的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> algorithm</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">aes-256-xyz</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里故意拼写错误</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> key</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> iv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">randomBytes</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipheriv</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">algorithm</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">key</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> iv</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_CRYPTO_UNKNOWN_CIPHER</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个时候，因为 <code>&#39;aes-256-xyz&#39;</code> 并不是一个有效的算法名称，Node.js 将无法创建加密器实例，而会抛出一个包含 <code>ERR_CRYPTO_UNKNOWN_CIPHER</code> 的错误。</p></li></ol><p>解决 <code>[ERR_CRYPTO_UNKNOWN_CIPHER]</code> 错误的方法通常是检查并确保你使用的算法名称正确无误，且 Node.js 的当前版本支持该算法。可以通过查阅 Node.js 的官方文档或使用 <code>crypto.getCiphers()</code> 函数获取所有受支持的算法列表来验证算法名称。</p><h3 id="err-crypto-unknown-dh-group" tabindex="-1"><a class="header-anchor" href="#err-crypto-unknown-dh-group"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_unknown_dh_group" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_UNKNOWN_DH_GROUP</a></span></a></h3><p>当然，我很乐意解释这个错误给你。</p><p>Node.js 中的<code>ERR_CRYPTO_UNKNOWN_DH_GROUP</code>错误表示在试图使用加密功能时，你指定了一个未知的 Diffie-Hellman（DH）组。现在让我们分步骤来了解这是什么意思，并举例说明。</p><p>首先，Diffie-Hellman（DH）是一种密钥交换算法，用于两个通信方在不安全的通道上安全地共享密钥。在使用 DH 算法时，你可以选择使用预定义的“组”，这些组包含了一套参数（比如一个大的素数和一个生成元），这些参数对于算法的安全性至关重要。</p><p>现在，假设你正在写一个需要加密通信的网络应用程序。你决定使用 Diffie-Hellman 算法来交换密钥。在 Node.js 中，你可能会这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 创建一个Diffie-Hellman密钥交换对象。</span></span>
<span class="line"><span style="color:#616E88;">  // 这里&#39;realGroup&#39;是假定存在的一个DH组名称，但实际上不存在。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDiffieHellmanGroup</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">realGroup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 如果指定的组名称不存在，会捕获到一个错误。</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你尝试运行上面的代码并指定一个不存在的 DH 组（像示例中的<code>&#39;realGroup&#39;</code>），Node.js 将无法识别它，并抛出<code>ERR_CRYPTO_UNKNOWN_DH_GROUP</code>错误。</p><p>实际上，在 Node.js 中使用正确的 DH 组名是非常重要的。最常用的组名可能是<code>&#39;modp1&#39;</code>, <code>&#39;modp2&#39;</code>, <code>&#39;modp5&#39;</code>等，这些都是 IANA 定义的“模数组”名称。如果你使用这些有效的组名，前述错误就不会发生。</p><p>例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 正确使用已知的DH组名，例如&#39;modp14&#39;。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dh</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDiffieHellmanGroup</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">modp14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 你的其余代码，例如生成密钥等。</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> keys</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dh</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">私钥:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> keys</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 处理错误情况。</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个例子中，我们使用了一个有效的 DH 组名<code>&#39;modp14&#39;</code>。因此，没有发生错误，程序能够继续执行并生成 DH 密钥对。</p><p>记住，当你遇到<code>ERR_CRYPTO_UNKNOWN_DH_GROUP</code>错误时，你应该检查所使用的组名是否正确，并使用 Node.js 文档中列出的有效组名之一。</p><h3 id="err-crypto-unsupported-operation" tabindex="-1"><a class="header-anchor" href="#err-crypto-unsupported-operation"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_unsupported_operation" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_UNSUPPORTED_OPERATION</a></span></a></h3><p><code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 是 Node.js 的一个错误代码，它表示你尝试进行的操作在 Node.js 的加密模块中不被支持。Node.js 的加密模块是用于实现各种安全的加密功能，比如生成散列、加密和解密数据、创建数字签名等。</p><p>当你使用 Node.js 的 <code>crypto</code> 模块中的某个函数或特性时，如果那个函数或特性在当前版本的 Node.js 或者在你提供的参数下不可用，就可能会触发 <code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 错误。</p><p>我们来通过一些通俗易懂的例子来说明这个错误：</p><h3 id="示例-1-不支持的方法或算法" tabindex="-1"><a class="header-anchor" href="#示例-1-不支持的方法或算法"><span>示例 1：不支持的方法或算法</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设 &#39;sha256&#39; 不被支持</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_UNSUPPORTED_OPERATION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">不支持的散列算法</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">其他错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个例子中，<code>createHash</code> 函数用于创建一个散列（hash），如果传递给它的算法（如：&#39;sha256&#39;）在当前 Node.js 版本中不受支持，就会抛出 <code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 错误。</p><h3 id="示例-2-使用了不被支持的选项或配置" tabindex="-1"><a class="header-anchor" href="#示例-2-使用了不被支持的选项或配置"><span>示例 2：使用了不被支持的选项或配置</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> cipher</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createCipher</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">aes-128-cbc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设这里有一些特定的选项不被支持</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_CRYPTO_UNSUPPORTED_OPERATION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">使用了不支持的选项或配置</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">其他错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>createCipher</code> 功能是为了创建一个加密器，但是如果你传递了一些 Node.js 不支持的配置或选项，也会导致 <code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 错误。</p><h3 id="解决方法-3" tabindex="-1"><a class="header-anchor" href="#解决方法-3"><span>解决方法</span></a></h3><p>当你遇到 <code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 错误时，通常需要检查以下几点：</p><ol><li>确保你使用的 Node.js 版本支持你尝试使用的加密方法或算法。</li><li>查看 Node.js 的文档，确保你没有使用任何不支持的选项或配置。</li><li>如果有更新的 Node.js 版本可用，请考虑升级，因为新版本可能添加了对更多特性的支持。</li></ol><p>总结起来，<code>ERR_CRYPTO_UNSUPPORTED_OPERATION</code> 是一个指示你尝试执行的操作在 Node.js 加密模块中不被支持的错误码。遇到这个错误时，应该检查 Node.js 的文档，确认所使用的特性、算法以及配置选项都是被当前版本支持的。</p><h3 id="err-debugger-error" tabindex="-1"><a class="header-anchor" href="#err-debugger-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_debugger_error" target="_blank" rel="noopener noreferrer">ERR_DEBUGGER_ERROR</a></span></a></h3><p><code>ERR_DEBUGGER_ERROR</code>是 Node.js 中的一个错误类型，用于表示与调试器通信或操作过程中发生的问题。在 Node.js 中，调试器是一个工具，它允许开发者检查运行中的代码，设置断点，并逐步执行代码以排查和修复错误。</p><p>当你在使用 Node.js 的内置调试功能时，如果遇到了一些意外的内部错误，就可能会触发这个<code>ERR_DEBUGGER_ERROR</code>。这种错误通常不是由于你的应用代码直接导致的，而是因为调试过程中的某些问题。</p><p>举个例子，假如你在使用 Node.js 提供的<code>inspector</code>模块来启动调试会话，并与 Chrome DevTools 之类的调试客户端进行交互。如果在这个过程中有什么地方出了问题（例如，调试器无法连接到指定的端口，或者与调试客户端的通信中断），Node.js 可能就会抛出<code>ERR_DEBUGGER_ERROR</code>。</p><p>示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> session</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Session</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">session</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试进行一些调试相关的操作</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里有某种问题，比如通信失败</span></span>
<span class="line"><span style="color:#D8DEE9;">  session</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">post</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Debugger.enable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> params</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 如果有错误，这里会处理它</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 如果捕获到异常，可能是ERR_DEBUGGER_ERROR</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_DEBUGGER_ERROR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">调试器内部错误：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 其他类型的错误</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">未知错误：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在实际应用中，这个错误处理会更复杂</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码片段创建了一个调试会话，并尝试启用调试器。如果在启用过程中发生错误，则捕获并打印错误信息。注意，如果触发了<code>ERR_DEBUGGER_ERROR</code>，我们可以通过检查错误对象的<code>code</code>属性来识别这个特定的错误类型。</p><p>这样的错误对于新手来说可能比较罕见，因为通常只有在进行较复杂的调试任务时才会涉及到。如果你遇到了<code>ERR_DEBUGGER_ERROR</code>，可能需要检查你的调试工具链配置是否正确，或者是不是存在网络问题等导致调试器无法正常通信。</p><h3 id="err-debugger-startup-error" tabindex="-1"><a class="header-anchor" href="#err-debugger-startup-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_debugger_startup_error" target="_blank" rel="noopener noreferrer">ERR_DEBUGGER_STARTUP_ERROR</a></span></a></h3><p>好的，Node.js 的 <code>ERR_DEBUGGER_STARTUP_ERROR</code> 是一个错误代码，它代表在 Node.js 试图启动调试器时发生了问题。在 Node.js 中，你可以使用内置的调试工具来帮助你诊断和修复程序中的问题。</p><p>当你遇到 <code>ERR_DEBUGGER_STARTUP_ERROR</code> 这个错误时，通常意味着 Node.js 无法正常启动它的调试服务。这可能是由于多种原因造成的，比如端口冲突（如果有其他应用已经在使用默认的调试端口），或者配置不正确等。</p><p>让我给你举一个例子来说明这个错误出现的情境：</p><p>假设你正在开发一个基于 Node.js 的 web 应用，你想要调试一些后端代码。为此，你可能会通过命令行使用 <code>--inspect</code> 标志来启动 Node.js，从而激活调试模式。下面是命令行中的一个简单示例：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect</span><span style="color:#A3BE8C;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在这个例子中，<code>your-script.js</code> 是你想要调试的 Node.js 脚本文件。</p><p>如果一切顺利，Node.js 会启动，并且会监听一个特定的端口（默认是 9229），允许调试客户端（比如 Chrome 开发者工具）连接进来并与之交互。</p><p>但是，如果在启动过程中出现了问题，比如说另一个应用已经占用了该端口，那么 Node.js 就无法绑定到这个端口上，你可能就会看到类似这样的消息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error: [ERR_DEBUGGER_STARTUP_ERROR] Starting inspector on 127.0.0.1:9229 failed: address already in use</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>以上就是 <code>ERR_DEBUGGER_STARTUP_ERROR</code> 出现的一个典型场景。</p><p>为了解决这个问题，你可以采取以下几种方法：</p><ol><li><p>检查并关闭占用 9229 端口的应用，然后再次尝试启动 Node.js 的调试。</p></li><li><p>使用其他端口来启动 Node.js 的调试，可以通过 <code>--inspect=[port]</code> 来指定一个端口，例如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect=9230</span><span style="color:#A3BE8C;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>如果问题依旧存在，检查你的防火墙设置，确保没有阻止 Node.js 监听调试端口。</p></li><li><p>确保你的 Node.js 版本支持所使用的调试功能，并且你的系统环境没有特殊限制。</p></li></ol><p>记住，在处理这类问题时，首先确认错误的详细信息，它会为你提供关于问题原因的重要线索。然后，按照提示进行排查和修复。</p><h3 id="err-dlopen-disabled" tabindex="-1"><a class="header-anchor" href="#err-dlopen-disabled"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_dlopen_disabled" target="_blank" rel="noopener noreferrer">ERR_DLOPEN_DISABLED</a></span></a></h3><p><code>ERR_DLOPEN_DISABLED</code> 是 Node.js 中的一个错误代码，用来表示在 Node.js 环境中尝试使用 <code>dlopen</code> 功能时出现了问题。<code>dlopen</code> 是一个底层的系统调用，通常用于在运行时动态加载库（如 <code>.so</code>, <code>.dll</code> 或 <code>.dylib</code> 文件），但在 Node.js 中更常见的是加载原生模块，即使用 C 或 C++ 编写的拓展模块。</p><p>这个错误发生的情况比较特殊，它意味着你的 Node.js 环境被配置为禁止使用 <code>dlopen</code> 调用。这可能是由于安全考虑，或者在构建 Node.js 时明确指定了相关编译选项。</p><p>通俗易懂地说，想象你的 JavaScript 代码是一家餐厅的主厨，而 Node.js 是这家餐厅的厨房。正常情况下，主厨可以随时打开冰箱（<code>dlopen</code>）取出食材（使用库或模块）。但是，如果有人把冰箱上了锁，并且告诉主厨不能再打开它，那么当主厨尝试取用里面的食材时，就会收到“冰箱上锁了”（<code>ERR_DLOPEN_DISABLED</code>）的通知。</p><p>具体实际应用中的例子可能包括：</p><ol><li><p>当你尝试在 Node.js 应用程序中加载一个原生插件，比如一些性能监控工具或图像处理库时，如果 Node.js 禁止了 <code>dlopen</code> 调用，你将会遇到 <code>ERR_DLOPEN_DISABLED</code> 错误。</p></li><li><p>如果你参与开发需要嵌入式系统或有特殊安全需求的项目，可能会基于安全原因决定禁用 <code>dlopen</code> 调用，在这种环境中尝试加载原生模块也会引发此错误。</p></li></ol><p>如果你遇到了 <code>ERR_DLOPEN_DISABLED</code> 错误，这通常意味着你需要检查 Node.js 的配置和启动参数，确定是否有意或无意中禁止了动态链接库的加载，并根据实际情况对配置进行相应的修改。</p><h3 id="err-dlopen-failed" tabindex="-1"><a class="header-anchor" href="#err-dlopen-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_dlopen_failed" target="_blank" rel="noopener noreferrer">ERR_DLOPEN_FAILED</a></span></a></h3><p><code>ERR_DLOPEN_FAILED</code> 是 Node.js 中的一个错误代码，它指示 Node.js 尝试加载（通常是通过 <code>require</code> 函数）一个原生模块时失败了。原生模块通常是用 C 或 C++编写的，并且编译成 <code>.node</code> 文件。当 Node.js 无法正确地打开这个文件，通常由于文件损坏、不兼容或者缺失所需的依赖时，就会抛出这个错误。</p><p>在 Node.js 中，原生模块通常用于执行一些 JavaScript 不太擅长的任务，例如直接与操作系统进行交互，或者执行一些需要高性能的计算任务。因为这些模块是用 C/C++编写的，所以它们可以更快地执行，并且可以更直接地访问系统资源和硬件。</p><h3 id="实际运用的例子-5" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-5"><span>实际运用的例子</span></a></h3><p>假设你要安装一个叫做 <code>sharp</code> 的 Node.js 模块来处理图片。这个库底层使用了 C++ 来实现图片处理的功能，提供了比纯 JavaScript 更快的性能。当你运行 <code>npm install sharp</code> 来安装该模块时，npm 将会下载并编译相关的 C++代码，生成<code>.node</code>文件。</p><p>如果一切顺利，你可以在你的 Node.js 代码中像下面这样使用 <code>sharp</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sharp</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sharp</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">sharp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">input.jpg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">resize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">300</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">toFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">output.jpg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> info</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">图片已经被成功处理</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但如果你看到了 <code>ERR_DLOPEN_FAILED</code> 的错误，可能是因为：</p><ol><li>缺少操作系统级别的依赖：例如，在 Linux 上你可能需要安装某些库，如 <code>libvips</code>，才能使 <code>sharp</code> 工作。</li><li><code>.node</code> 文件损坏：如果编译过程中出现问题，或者文件在传输过程中被破坏。</li><li>系统架构不匹配：你的系统可能是 32 位的，而编译出来的模块是为 64 位系统设计的，或者相反。</li><li>Node.js 版本不兼容：有些原生模块可能只能在特定版本的 Node.js 上运行。</li></ol><p>解决 <code>ERR_DLOPEN_FAILED</code> 错误通常包括以下几步：</p><ul><li>确保所有的操作系统级别的依赖都已经正确安装。</li><li>重新编译模块，可以通过删除 <code>node_modules</code> 目录后再次运行 <code>npm install</code> 来尝试。</li><li>确认 Node.js 版本是否与模块兼容。</li><li>查阅模块的文档或者 Issue 追踪器，看看是否有其他人遇到了相同的问题，并找到解决方案。</li></ul><p>总结起来，<code>ERR_DLOPEN_FAILED</code> 提醒你 Node.js 在尝试加载一个原生模块时出错了，解决这个问题涉及到确认和修复环境设置、依赖关系或者兼容性问题。</p><h3 id="err-dir-closed" tabindex="-1"><a class="header-anchor" href="#err-dir-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_dir_closed" target="_blank" rel="noopener noreferrer">ERR_DIR_CLOSED</a></span></a></h3><p>当你在使用 Node.js 进行文件系统操作时，尤其是涉及到目录（文件夹）的操作时，你可能会遇到一些错误。<code>ERR_DIR_CLOSED</code> 错误就是其中之一。这个错误表示你尝试对一个已经被关闭的目录执行操作。</p><p>在 Node.js 中，特别是使用 <code>fs</code> 模块（文件系统模块）进行目录读取和操作时，通常需要打开目录、执行操作然后再关闭目录。如果在目录已经关闭之后，你还尝试进行某些操作，如读取该目录下的文件列表或者其他信息，Node.js 就会抛出 <code>ERR_DIR_CLOSED</code> 错误。</p><p>举个例子来说，假设我们有一个脚本，它需要列出一个目录下的所有文件。我们会使用 <code>fs.opendir</code> 方法来打开目录，然后使用 <code>dir.read()</code> 来一个接一个地读取文件信息，用完之后，我们会调用 <code>dir.close()</code> 关闭目录。这是一个正确处理目录的流程。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> listDirectory</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> dir</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">opendir</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dirent</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> dir</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">dirent</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印目录内部的每个文件或目录的名称</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> finally</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#D8DEE9;"> dir</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 即使发生错误也确保目录被关闭</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">listDirectory</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./some-directory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在上面的代码中，在调用 <code>await dir.close();</code> 后，我们尝试再次使用 <code>dir.read()</code> 方法，那么我们将会得到 <code>ERR_DIR_CLOSED</code> 错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 这段代码会导致 ERR_DIR_CLOSED 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">dir</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  dir</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">dirent</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 这里会失败，因为目录已经被关闭了</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要避免这种错误，确保你不在关闭目录后进行任何操作。如果你必须这么做，那么考虑重新打开目录或者重新设计代码逻辑，以确保目录在你完成所有必要操作之前保持打开状态。</p><h3 id="err-dir-concurrent-operation" tabindex="-1"><a class="header-anchor" href="#err-dir-concurrent-operation"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_dir_concurrent_operation" target="_blank" rel="noopener noreferrer">ERR_DIR_CONCURRENT_OPERATION</a></span></a></h3><p>Node.js 是一个 JavaScript 运行环境，让你可以在服务器端运行 JavaScript 代码。在编程中，错误处理是一个非常重要的部分，因为它帮助开发者了解程序运行中可能出现的问题，并且采取措施修复这些问题。</p><p>在 Node.js 中，<code>ERR_DIR_CONCURRENT_OPERATION</code> 是一个特定类型的错误代码，它代表“目录并发操作错误”。这个错误通常发生在你尝试同时进行多个操作到同一个目录时。例如，如果你在读取一个目录的内容的同时，又试图删除或修改这个目录，就可能触发 <code>ERR_DIR_CONCURRENT_OPERATION</code> 错误。</p><p>这里有一个简单的例子来说明这种情况：</p><p>假设我们有一段 Node.js 代码正在读取一个目录的内容：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> readDirectory</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readdir</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在这个操作没有完成之前，另一个函数尝试删除这个目录：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> deleteDirectory</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">rmdir</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，如果我们同时调用这两个函数，可能会产生冲突：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> directoryPath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./my-directory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这个目录存在，并且我们几乎同时调用两个函数</span></span>
<span class="line"><span style="color:#88C0D0;">readDirectory</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">directoryPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">deleteDirectory</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">directoryPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个例子中，<code>readDirectory</code> 函数和 <code>deleteDirectory</code> 函数都涉及到了同一个目录 <code>./my-directory</code>，而且它们几乎是同时执行的。Node.js 中的文件系统不允许这样的并发操作，因此可能会抛出 <code>ERR_DIR_CONCURRENT_OPERATION</code> 错误。</p><p>为了避免这种情况，你需要确保在同一个时间点只对目录进行一个操作。这可以通过回调、Promise 链、async/await 等技术来实现顺序执行：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 使用 async/await 来确保操作是顺序执行的</span></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> manageDirectory</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> directoryPath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./my-directory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 首先读取目录</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> files</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> readDirectory</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">directoryPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">files</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 然后删除目录</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#88C0D0;"> deleteDirectory</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">directoryPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Directory deleted successfully.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">manageDirectory</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个改良的例子中，我们创建了一个名为 <code>manageDirectory</code> 的新函数，它首先等待 <code>readDirectory</code> 完成后，才执行 <code>deleteDirectory</code>。这样可以确保在删除目录之前不会有其他并发操作发生，从而避免了 <code>ERR_DIR_CONCURRENT_OPERATION</code> 错误。</p><p>总结一下，<code>ERR_DIR_CONCURRENT_OPERATION</code> 错误提示你在处理文件系统时进行了不被支持的并发操作。为了解决这个问题，你应该合理安排代码的执行顺序，避免同时对同一个资源进行操作。</p><h3 id="err-dns-set-servers-failed" tabindex="-1"><a class="header-anchor" href="#err-dns-set-servers-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_dns_set_servers_failed" target="_blank" rel="noopener noreferrer">ERR_DNS_SET_SERVERS_FAILED</a></span></a></h3><p>好的，让我为你解释 Node.js 中的 <code>ERR_DNS_SET_SERVERS_FAILED</code> 错误。</p><p>在 Node.js 中，<code>dns</code> 模块用来与域名服务器进行交互，例如查询域名的 IP 地址。有时候，我们可能想自定义使用的 DNS 服务器而不是默认的（比如更快或者支持某些特殊需求的服务器）。Node.js 允许我们通过 <code>dns.setServers()</code> 方法来设置自定义的 DNS 服务器。</p><p>然而，如果在调用 <code>dns.setServers()</code> 时出现了问题，就会抛出 <code>ERR_DNS_SET_SERVERS_FAILED</code> 这个错误。这个错误表示 Node.js 尝试设置 DNS 服务器时失败了，这种失败可能是由多种原因造成的，包括但不限于：</p><ol><li>提供的 DNS 服务器地址格式不正确。</li><li>DNS 服务器地址无法被使用，可能是因为网络问题或者 DNS 服务器本身的问题。</li><li>在一个不允许更改 DNS 服务器的环境中尝试设置（比如某些权限受限的系统）。</li></ol><p>实际运用的例子：</p><p>假设你正在开发一个 Node.js 应用程序，并且你想使用 Google 的 DNS 服务器（8.8.8.8 和 8.8.4.4）来解析域名。你可以像下面这样设置 DNS 服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dns</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dns</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置 DNS 服务器地址</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  dns</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setServers</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">8.8.8.8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">8.8.4.4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">DNS servers updated successfully.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 在这里处理错误</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_DNS_SET_SERVERS_FAILED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to set DNS servers:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先导入了 <code>dns</code> 模块。接着我们尝试使用 <code>dns.setServers()</code> 来设置两个 Google 的 DNS 服务器地址。如果成功，控制台会显示 &quot;DNS servers updated successfully.&quot;。如果失败，它会检查错误代码，如果是 <code>ERR_DNS_SET_SERVERS_FAILED</code>，则会打印出失败的具体原因。</p><p>这样的错误处理非常重要，因为它能帮助你诊断问题并采取适当的补救措施，以确保你的应用程序能够正常地处理域名解析。</p><h3 id="err-domain-callback-not-available" tabindex="-1"><a class="header-anchor" href="#err-domain-callback-not-available"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_domain_callback_not_available" target="_blank" rel="noopener noreferrer">ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</a></span></a></h3><p>在 Node.js 中，<code>ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</code> 是一个错误代码，它代表一个特定的问题：尝试使用 domain 模块相关功能，但这个功能在当前的 Node.js 版本中已经不可用或者已经被遗弃。</p><p>Domains 是 Node.js 中的一种旧特性，它们被设计用来捕获和管理异步操作中出现的错误。然而，由于多种原因（包括性能考虑和某些设计缺陷），domain 模块已在 Node.js 中被废弃，并且在未来的版本中可能会被完全移除。</p><p>当你试图在代码中注册一个 domain 的错误处理回调（例如使用 <code>domain.on(&#39;error&#39;, callback)</code>）时，如果当前版本的 Node.js 不再支持域回调，就会抛出 <code>ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</code> 错误。</p><p>在 Node.js v21.7.1 中，如果你收到这个错误，意味着你应该停止使用 domain 相关的功能，并寻找替代方案，比如使用 <code>try...catch</code> 语句、Promise 或者 async/await 来处理异步错误。</p><p>下面是一个示例说明了在过去你可能怎样使用 domains，以及为何现在会出现 <code>ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</code> 错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 这是过去可能的使用方式</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> domain</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">domain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> d</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> domain</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">create</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 在 domain 中处理异步错误的逻辑</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">捕获到 domain 错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">run</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 异步操作，可能会发生错误</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">有错误发生！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个 domain 并设置了错误处理器。然后在 domain 的上下文中运行异步代码。如果在这段异步代码中发生了错误，正常情况下它将被 domain 捕获并传递给错误处理器。</p><p>但是，由于在新版本的 Node.js 中 domain 模块已经被标记为废弃（deprecated），在尝试执行上述代码时，可能会看到类似 <code>ERR_DOMAIN_CALLBACK_NOT_AVAILABLE</code> 的错误信息。</p><p>为了处理异步错误，你应该使用现代的 JavaScript 错误处理方法。例如，你可以使用 Promises 和 async/await 结合 try/catch 块，像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> riskyOperation</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> success</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">random</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 0.5</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">success</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">        resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">操作成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">        reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">操作失败！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> handleErrorAsync</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> riskyOperation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">异步操作中捕获到错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">handleErrorAsync</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，<code>riskyOperation</code> 函数返回一个 Promise，它可能会解决（成功）或拒绝（失败）。<code>handleErrorAsync</code> 函数使用 <code>await</code> 等待 <code>riskyOperation</code> 的结果，并用 <code>try...catch</code> 块来捕获和处理任何可能发生的错误。这是在最新版本的 Node.js 中处理异步错误更加推荐的方式。</p><h3 id="err-domain-cannot-set-uncaught-exception-capture" tabindex="-1"><a class="header-anchor" href="#err-domain-cannot-set-uncaught-exception-capture"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_domain_cannot_set_uncaught_exception_capture" target="_blank" rel="noopener noreferrer">ERR_DOMAIN_CANNOT_SET_UNCAUGHT_EXCEPTION_CAPTURE</a></span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境，它允许你使用 JavaScript 编写服务器端的代码。Node.js 提供了很多核心模块，其中 <code>domain</code> 模块旨在处理程序中未捕获的异常。但是需要注意的是，在 Node.js 的新版本中，<code>domain</code> 模块被淘汰，并不推荐使用。</p><p>现在直接来说这个错误：<code>ERR_DOMAIN_CANNOT_SET_UNCAUGHT_EXCEPTION_CAPTURE</code>。这个错误是指在 Node.js 中，当你尝试同时使用 <code>domain</code> 模块和 <code>process.setUncaughtExceptionCaptureCallback()</code> 方法时会遇到的一个问题。</p><h3 id="process-setuncaughtexceptioncapturecallback" tabindex="-1"><a class="header-anchor" href="#process-setuncaughtexceptioncapturecallback"><span><code>process.setUncaughtExceptionCaptureCallback()</code></span></a></h3><p>首先解释一下 <code>process.setUncaughtExceptionCaptureCallback()</code> 这个方法。Node.js 应用运行过程中，如果有错误没有被捕获（即代码里没有相应的 <code>try...catch</code> 来捕获错误），通常会触发 <code>uncaughtException</code> 事件，并且可能会导致程序退出。为了防止程序因为这些未捕获的异常退出，可以使用 <code>process.setUncaughtExceptionCaptureCallback()</code> 方法设置一个回调函数来捕获这些异常，从而你可以记录日志或者做一些清理工作后再决定是否退出程序。</p><h3 id="domain-模块" tabindex="-1"><a class="header-anchor" href="#domain-模块"><span><code>domain</code> 模块</span></a></h3><p><code>domain</code> 模块本意是为了简化异步代码的异常处理，可以创建一个 <code>domain</code> 上下文，然后在这个上下文中执行代码。如果代码运行出错，就会被 <code>domain</code> 捕获，不会影响到其他的 <code>domain</code>。但是这个模块存在一些问题，比如和其他模块集成的问题，所以 Node.js 决定逐步废弃。</p><h3 id="错误原因" tabindex="-1"><a class="header-anchor" href="#错误原因"><span>错误原因</span></a></h3><p><code>ERR_DOMAIN_CANNOT_SET_UNCAUGHT_EXCEPTION_CAPTURE</code> 错误表明你不能同时在代码中使用 <code>domain</code> 模块的异常处理和 <code>process.setUncaughtExceptionCaptureCallback()</code> 方法。因为这两者的使用场景有重叠，都是用来捕获未处理的异常，而 Node.js 设计上要求它们不能共存。</p><h3 id="如何避免这个错误" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误"><span>如何避免这个错误</span></a></h3><p>要避免这个错误，简单来说，就是不要在你的应用中同时使用 <code>domain</code> 模块和 <code>process.setUncaughtExceptionCaptureCallback()</code> 方法。你应该选择一个来进行错误处理。鉴于 <code>domain</code> 已经被废弃，建议使用 <code>process.setUncaughtExceptionCaptureCallback()</code> 来捕获未处理的异常。</p><h3 id="实际例子-3" tabindex="-1"><a class="header-anchor" href="#实际例子-3"><span>实际例子</span></a></h3><p>如果你正在编写一个 Node.js 应用，并且想要优雅地处理未捕获的异常，你可以这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 设置一个回调函数来捕获未处理的异常</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setUncaughtExceptionCaptureCallback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">捕获到未处理的异常:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 在这里可以记录日志，并决定是否需要重启服务等操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 示例：一个将会抛出异常的函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> riskyFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">出问题啦！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试运行这个有风险的函数</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  riskyFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">捕获到异常:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果异常不在 try...catch 中捕获，它将由 setUncaughtExceptionCaptureCallback 中设置的回调函数捕获</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>riskyFunction()</code> 函数中的异常如果没有被 <code>try...catch</code> 捕获，那么它将被 <code>setUncaughtExceptionCaptureCallback()</code> 设置的回调函数捕获。这样我们就可以确保程序不会因为一个未捕获的异常而突然崩溃。</p><h3 id="err-duplicate-startup-snapshot-main-function" tabindex="-1"><a class="header-anchor" href="#err-duplicate-startup-snapshot-main-function"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_duplicate_startup_snapshot_main_function" target="_blank" rel="noopener noreferrer">ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION</a></span></a></h3><p>好的，让我们来聊一聊 Node.js 中的 <code>ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION</code> 这个错误。</p><p>首先要明白的是，在 Node.js 中，一个 &quot;snapshot&quot; 是指在 Node.js 启动时生成的一份内存快照。Node.js 可以使用这种技术来提升启动速度。当 Node.js 启动时，它可以加载之前保存的内存快照，而不是从零开始执行全部初始化工作，这样可以加快启动时间。</p><p>现在，来解释 <code>ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION</code> 这个错误。这个错误信息意味着在尝试创建或使用一个 startup snapshot 时，出现了一个问题：有两个 “main” 函数被定义，但实际上应该只有一个。这在 Node.js 的 context 下通常是意料之外的，因为每个程序只应该有一个入口点。</p><p>这个错误最可能发生在你尝试自己去创建一个 startup snapshot 的时候。Node.js 允许开发者制作自己的 snapshots 来加快特定应用程序的启动速度，但是这涉及到一些高级操作和内部的 Node.js 机制。如果在这个过程中某处代码不小心注册了两个 “main” 函数，就会触发这个错误。</p><p>举一个实际的例子：</p><p>假设你在编写一个 Node.js 应用程序，并想要通过创建一个 startup snapshot 来优化启动性能。你需要使用 Node.js 的内部 API 去创建这个 snapshot。以下伪代码表示了这个过程：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 导入 Node.js 的 snapshot 创建模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> snapshot</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">snapshot-creation-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 定义你的应用程序的主函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...你的应用初始化代码...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 再次定义一个主函数，即使与第一个完全相同也算重复</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> mainDuplicate</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...可能是由于复制粘贴导致的重复代码...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 告诉 snapshot 模块使用 main 函数作为入口点</span></span>
<span class="line"><span style="color:#D8DEE9;">snapshot</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setStartupMainFunction</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">main</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 不小心再次设置了另一个 “main” 函数</span></span>
<span class="line"><span style="color:#D8DEE9;">snapshot</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setStartupMainFunction</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">mainDuplicate</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们错误地尝试将两个不同的函数都注册为启动 snapshot 的主函数。Node.js 在检测到这种情况时会抛出 <code>ERR_DUPLICATE_STARTUP_SNAPSHOT_MAIN_FUNCTION</code> 错误，因为一个 snapshot 只能有一个入口点。</p><p>作为一个编程新手，除非你正在深入学习 Node.js 的内部机制并尝试对性能进行微调，否则你很少需要直接处理 startup snapshots。快照的创建和管理通常是由更有经验的开发者在优化大型应用程序的启动时间时考虑的事情。简单的 Node.js 应用程序开发中，你不太可能遇到这种错误。</p><h3 id="err-encoding-invalid-encoded-data" tabindex="-1"><a class="header-anchor" href="#err-encoding-invalid-encoded-data"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_encoding_invalid_encoded_data" target="_blank" rel="noopener noreferrer">ERR_ENCODING_INVALID_ENCODED_DATA</a></span></a></h3><p><code>ERR_ENCODING_INVALID_ENCODED_DATA</code>是在 Node.js 中的一个特定错误类型，表示数据编码无效或者不符合预期。在 Node.js 中处理文本、文件或网络通信时，经常需要对数据进行编码和解码，比如将字符串转换为 Buffer 或者从 Buffer 中读取字符串时。</p><p><strong>编码（Encoding）</strong>：是将一种数据格式转换成另一种格式的过程，通常是为了方便存储或传输。例如，你可能会将字符串转换为字节序列（Buffer），以便可以在文件系统或网络上传输。</p><p><strong>解码（Decoding）</strong>：则是编码过程的相反，它把编码后的数据格式转换回原始格式。例如，当你接收到一个字节序列时，你可能需要将其转换回人类可读的字符串。</p><p><code>ERR_ENCODING_INVALID_ENCODED_DATA</code>错误发生时，意味着在这个编码或解码的过程中，提供的数据不符合所使用的编码方式的规则。下面是几个关于这个错误的例子：</p><h3 id="例子-1-buffer-到字符串的转换" tabindex="-1"><a class="header-anchor" href="#例子-1-buffer-到字符串的转换"><span>例子 1：Buffer 到字符串的转换</span></a></h3><p>假设你有一个包含文本数据的 Buffer，并且你想要将这个 Buffer 转换为字符串。如果你指定了一个无效的字符编码，就可能会遇到<code>ERR_ENCODING_INVALID_ENCODED_DATA</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buf</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">0xe9</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0x8b</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0xbf</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试用一个无效的编码方式来解码Buffer</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> str</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> buf</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf-16</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_ENCODING_INVALID_ENCODED_DATA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法解码数据：提供的编码无效或数据已损坏。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试使用 UTF-16 编码来解码一个明显不是 UTF-16 编码的 Buffer，导致了错误的产生。</p><h3 id="例子-2-url-编码" tabindex="-1"><a class="header-anchor" href="#例子-2-url-编码"><span>例子 2：URL 编码</span></a></h3><p>Node.js 中也可能在处理 URL 编码时遇到这个错误。当你尝试解码一个 URL 部分，但是给定的字符串不符合 URL 编码规范时，就会抛出<code>ERR_ENCODING_INVALID_ENCODED_DATA</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> URL</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设有一个不正确的URL编码字符串</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> malformedUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">%E4%BD%A0%E5%A5%BD%ZZ</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &quot;ZZ&quot;在这里是无效的URL编码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> decoded</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> decodeURIComponent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">malformedUrl</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_ENCODING_INVALID_ENCODED_DATA</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法解码URL：编码数据无效。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的字符串<code>malformedUrl</code>尝试被解码，但由于包含非法的编码序列<code>%ZZ</code>，所以抛出了错误。</p><h3 id="如何处理这个错误" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误"><span>如何处理这个错误？</span></a></h3><p>当你在代码中捕获到<code>ERR_ENCODING_INVALID_ENCODED_DATA</code>错误时，你应该检查提供给编码/解码函数的数据是否符合预期的格式。若不符合，那么你需要修正数据或者更改编码方式。此外，确保你对数据的来源有足够的了解，并且验证输入数据的有效性，都是防止这种错误发生的好方法。</p><h3 id="err-encoding-not-supported" tabindex="-1"><a class="header-anchor" href="#err-encoding-not-supported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_encoding_not_supported" target="_blank" rel="noopener noreferrer">ERR_ENCODING_NOT_SUPPORTED</a></span></a></h3><p>当你在 Node.js 中工作，尤其是处理文本和数据转换时，你可能会遇到各种错误。<code>ERR_ENCODING_NOT_SUPPORTED</code> 就是其中一种错误。</p><p>在 Node.js v21.7.1 版本中，<code>ERR_ENCODING_NOT_SUPPORTED</code> 是一个错误代码，代表你尝试使用了一个不被支持的编码格式。编码是指如何将字符（比如字母、数字等）转换成可以在计算机中存储和传输的数字形式。常见的编码格式有 UTF-8、UTF-16、ASCII 等。</p><p>这个错误通常发生在你调用 Node.js 内置模块的函数时，例如 <code>Buffer</code>、<code>stream</code> 或者 <code>fs</code>，并且传递了一个 Node.js 不认识的编码类型。</p><p>下面举几个实际例子来说明这个错误：</p><h3 id="例子-1-读取文件" tabindex="-1"><a class="header-anchor" href="#例子-1-读取文件"><span>例子 1：读取文件</span></a></h3><p>假设你想使用 <code>fs</code> 模块来读取一个文本文件，并且希望它按照特定的编码方式来解析这个文件。代码大概会长这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">super-encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 &#39;super-encoding&#39; 这种编码方式不存在于 Node.js 所支持的编码列表中，那么上面的代码会抛出 <code>ERR_ENCODING_NOT_SUPPORTED</code> 错误。</p><h3 id="例子-2-写入文件" tabindex="-1"><a class="header-anchor" href="#例子-2-写入文件"><span>例子 2：写入文件</span></a></h3><p>或者你想要把一段文本以特定编码写入文件时：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> content</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">  content</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> encoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fantasy-encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The file has been saved!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 &#39;fantasy-encoding&#39; 不是一个有效的编码格式，写入文件时就会产生 <code>ERR_ENCODING_NOT_SUPPORTED</code> 错误。</p><h3 id="例子-3-使用-buffer" tabindex="-1"><a class="header-anchor" href="#例子-3-使用-buffer"><span>例子 3：使用 Buffer</span></a></h3><p>再比如你尝试创建一个新的 Buffer 实例，并指定一个编码类型：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some text</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">alien-encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果 &#39;alien-encoding&#39; 不是一个 Node.js 支持的编码类型，该行代码会导致 <code>ERR_ENCODING_NOT_SUPPORTED</code> 错误。</p><h3 id="如何处理这个错误-1" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-1"><span>如何处理这个错误？</span></a></h3><p>处理 <code>ERR_ENCODING_NOT_SUPPORTED</code> 错误最直接的方式是确保你使用的是 Node.js 支持的编码类型。目前 Node.js 支持的编码类型包括但不限于：&#39;utf8&#39;, &#39;utf16le&#39;, &#39;latin1&#39;, &#39;base64&#39;, &#39;hex&#39;, &#39;ascii&#39; 等。你可以查阅 Node.js 的官方文档来获得完整的支持列表。</p><p>如果你确认使用的编码类型是正确的，但是仍然遇到这个错误，需要检查 Node.js 版本是否过旧，或者编码类型名称是否拼写正确。如果问题依旧，可能需要进一步查看 Node.js 的相关模块源码或者提交问题反馈给 Node.js 的维护者。</p><h3 id="err-eval-esm-cannot-print" tabindex="-1"><a class="header-anchor" href="#err-eval-esm-cannot-print"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_eval_esm_cannot_print" target="_blank" rel="noopener noreferrer">ERR_EVAL_ESM_CANNOT_PRINT</a></span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境，它让开发者能够使用 JavaScript 来编写服务器端程序。Node.js 支持模块化的代码组织方式，其中有两种不同类型的模块系统：CommonJS（CJS）和 ECMAScript 模块（ESM）。</p><p>错误 <code>ERR_EVAL_ESM_CANNOT_PRINT</code> 与 ECMAScript 模块（即 ESM）有关。在 Node.js 中，你可以使用 <code>import</code> 和 <code>export</code> 关键词来处理 ESM 模块，这是符合最新的 JavaScript 标准的一种做法。</p><p>在你使用 Node.js 的 REPL（Read-Eval-Print Loop，交互式解释器）模式时，如果你尝试直接在 REPL 中以命令行形式输入并评估（Eval）ECMAScript 模块相关的代码，就可能会遇到 <code>ERR_EVAL_ESM_CANNOT_PRINT</code> 错误。REPL 模式通常是用来快速测试代码片段的地方。</p><p>这个错误的意思是说，Node.js 的 REPL 不支持直接打印出使用 ECMAScript 模块语法书写的代码的结果。这是因为 ESM 模块的加载和执行都是异步的，而 REPL 通常预期同步执行并立即返回结果。</p><p>下面我将通过一个实际的例子来说明这个错误：</p><p>假设你在 Node.js 的 REPL 中尝试了以下操作：</p><ol><li>启动 Node.js REPL:</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>在 REPL 中尝试导入一个 ESM 模块：</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> something</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-es-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>当你这么做时，Node.js 可能会抛出 <code>ERR_EVAL_ESM_CANNOT_PRINT</code> 错误，提示你不能在 REPL 中这样直接使用 ESM 模块。</p><p>要正确地在 REPL 中使用 ESM 模块，你需要将你的模块代码放在一个文件中，比如名为 <code>module-file.mjs</code> 的文件（<code>.mjs</code> 是一个常用的文件扩展名来标识 ECMAScript 模块）。然后，在 Node.js 的 REPL 中，你可以异步地加载这个模块文件：</p><ol><li>创建名为 <code>module-file.mjs</code> 的文件，并添加以下内容：</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// module-file.mjs</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> const</span><span style="color:#D8DEE9;"> something</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, ESM world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>回到 Node.js 的 REPL，你可以使用 <code>import()</code> 函数来异步加载这个模块：</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">async</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#81A1C1;"> import</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./module-file.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">myModule</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">something</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 将输出: Hello, ESM world!</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过这种方式，你避免了直接在 REPL 中评估 ESM 模块代码，从而也就不会碰到 <code>ERR_EVAL_ESM_CANNOT_PRINT</code> 错误了。需要注意的是，你需要确保你的 Node.js 版本支持 ECMAScript 模块，并且你的文件路径和名称应该根据你的实际情况进行调整。</p><p>简单来说，<code>ERR_EVAL_ESM_CANNOT_PRINT</code> 是 Node.js 提示你无法在 REPL 中直接评估 ESM 模块代码的错误信息。正确的做法是将 ESM 代码放在单独的文件中，并通过异步函数去加载和使用这些模块。</p><h3 id="err-event-recursion" tabindex="-1"><a class="header-anchor" href="#err-event-recursion"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_event_recursion" target="_blank" rel="noopener noreferrer">ERR_EVENT_RECURSION</a></span></a></h3><p>好的，我来解释一下 Node.js 中的 <code>ERR_EVENT_RECURSION</code> 这个错误。Node.js 是一个基于 Chrome 的 V8 JavaScript 引擎构建的 JavaScript 运行时环境，它让开发者能够使用 JavaScript 来编写服务器端的代码。</p><p>在 Node.js 中，有一个叫做 <code>EventEmitter</code> 的核心模块，这个模块用于处理事件，可以发射（emit）事件和监听（on/once）事件。这跟你平常在浏览器里面监听按钮点击之类的事件是类似的概念。</p><p>现在来说说 <code>ERR_EVENT_RECURSION</code> 错误，这个错误与事件的递归调用有关。当我们设计事件监听和响应的代码时，如果在一个事件的监听函数中直接或间接地再次触发了同一个事件，并且这个过程没有终止条件，就会不断循环下去，这就是递归调用。Node.js 设计了检测机制，当检测到这种可能导致“无限循环”的情况时，就会抛出 <code>ERR_EVENT_RECURSION</code> 错误。</p><p>让我们来看一个简单的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> emitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 定义一个简单的事件监听器，该监听器会在被调用时再次触发 &#39;test&#39; 事件</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">触发了 test 事件</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里又触发了 &#39;test&#39; 事件</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 初始触发 &#39;test&#39; 事件</span></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个名为 <code>emitter</code> 的 <code>EventEmitter</code> 实例，然后我们给它添加了一个监听 <code>test</code> 事件的监听器。一旦 <code>test</code> 事件被触发，监听器就打印一条信息，并再次触发 <code>test</code> 事件。这样就形成了一个没有结束的循环，因为每次 <code>test</code> 事件响应中又触发了同样的事件。</p><p>如果你运行这段代码，会发现它并不会如我们所期望地持续打印信息，相反，它会在某一点抛出 <code>ERR_EVENT_RECURSION</code> 错误，因为 Node.js 检测到了这种潜在的无限递归情况并阻止了它，以避免可能的栈溢出问题或者程序崩溃。</p><p>理想情况下，我们设计事件响应时应该避免这种递归调用，或者至少要确保有明确的退出条件。例如，我们可以设置一个计数器，只允许事件被触发特定的次数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> count</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置一个计数器</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 5</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span><span style="color:#616E88;"> // 只有当 count 小于 5 时才触发事件</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">触发了 test 事件</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    count</span><span style="color:#81A1C1;">++;</span><span style="color:#616E88;"> // 增加计数器</span></span>
<span class="line"><span style="color:#D8DEE9;">    emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 再次触发事件</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">emitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 初始触发</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修改后的版本中，我们增加了一个 <code>count</code> 计数器，确保事件最多只会被触发五次，这样就避免了 <code>ERR_EVENT_RECURSION</code> 错误的产生。</p><h3 id="err-execution-environment-not-available" tabindex="-1"><a class="header-anchor" href="#err-execution-environment-not-available"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_execution_environment_not_available" target="_blank" rel="noopener noreferrer">ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</a></span></a></h3><p><code>ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</code> 错误是在 Node.js 程序中遇到的一种错误情况，这个错误表示你试图在一个不支持的执行环境中运行代码。在 Node.js v21.7.1 的文档中，这个错误属于系统错误（system errors），它通常是内部错误，意味着 Node.js 的某些内部组件或者功能不能正常工作。</p><p>举个例子，假设 Node.js 在未来的某个版本中引入了一项新功能，比如一个特殊的 API 或者模块，这个功能可能依赖于底层操作系统的某些特定特性或者配置。如果你尝试在一个没有这些特性或配置的系统上运行使用了这个新功能的代码，Node.js 可能会抛出 <code>ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</code> 错误。</p><p>例如，Node.js 在某个版本中可能加入了对某种特殊硬件加速的支持，但是当你尝试在一个不具备该硬件特性的机器上运行代码时，就会碰到这个问题：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设有一个 fictionalModule 提供了对特殊硬件的支持，</span></span>
<span class="line"><span style="color:#616E88;">// 我们尝试在代码中导入并使用它</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> specialHardwareFeature</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fictionalModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  specialHardwareFeature</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">doSomething</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">当前环境不支持此功能，请检查你的硬件是否满足要求。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生了一个未知错误：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>fictionalModule</code> 模块需要特定的硬件加速，而当前执行环境的硬件不支持这项功能，那么当尝试加载和使用这个模块时，就会捕获到 <code>ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</code> 这个错误。</p><p>请注意，由于 <code>ERR_EXECUTION_ENVIRONMENT_NOT_AVAILABLE</code> 是 Node.js 的内部错误码之一，你可能不经常在编程实践中遇到它。这个错误码更多是为了 Node.js 开发者诊断和解决底层执行环境相关的问题所设计的。如果你在编写普通的 JavaScript 应用程序时遇到这个错误，这通常意味着你需要检查你的代码是否使用了一些特殊的、与平台紧密相关的 Node.js 功能，并确保你的执行环境符合这些功能的要求。</p><h3 id="err-falsy-value-rejection" tabindex="-1"><a class="header-anchor" href="#err-falsy-value-rejection"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_falsy_value_rejection" target="_blank" rel="noopener noreferrer">ERR_FALSY_VALUE_REJECTION</a></span></a></h3><p>在 Node.js 中，当你使用 Promises 或 async/await 这样的异步编程模式时，经常会处理到“rejected promises”。一个 promise 可以“resolve”（成功）或者“reject”（失败），而当它失败时，通常应该提供错误信息或者一个错误对象。</p><p><code>ERR_FALSY_VALUE_REJECTION</code>是一个错误代码，指出了一个具体的问题：你在某处的代码尝试拒绝(reject)一个 promise，但是拒绝时使用的值不是一个错误对象，而是一个“falsy”值。在 JavaScript 中，falsy 值包括：<code>false</code>、<code>0</code>、<code>&quot;&quot;</code>（空字符串）、<code>null</code>、<code>undefined</code>和<code>NaN</code>。</p><p>这个错误通常发生在开发者尝试拒绝一个 promise 但没有提供有效的错误信息时。在 Node.js 中处理错误应该总是尽量清晰且具体，所以最好拒绝(reject)一个 promise 时提供一个 Error 对象，这样能更清楚地表明发生了什么错误，便于调试。</p><p>下面通过一些代码示例来解释：</p><p>错误的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getSomethingAsync</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设有一个条件检查，如果失败则拒绝Promise</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> condition</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">condition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里使用了falsy值null，这是不推荐的</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个函数<code>getSomethingAsync()</code>返回一个 promise，如果条件检查失败，则使用<code>null</code>来拒绝这个 promise。这是不推荐的，因为它发送了一个无效的错误信号。</p><p>正确的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getSomethingAsync</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设有一个条件检查，如果失败则拒绝Promise</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> condition</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">condition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      reject</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Condition failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 使用Error对象来拒绝</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 当你调用这个函数并处理失败情况时，你能获得一个具体的错误信息。</span></span>
<span class="line"><span style="color:#88C0D0;">getSomethingAsync</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印错误信息：Error: Condition failed</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个正确的例子中，我们创建了一个新的 Error 对象并将它传递给<code>reject</code>函数。这样，任何处理这个 promise 的<code>.catch</code>或者<code>async/await</code>结构中的<code>try/catch</code>都能够接收到一个明确的错误对象，并且知道确切的失败原因。</p><p>简单的说，<code>ERR_FALSY_VALUE_REJECTION</code>错误提醒开发者在拒绝 promise 时，应该提供有意义的错误信息，并鼓励使用标准的 Error 对象，从而使错误处理更加一致和可靠。</p><h3 id="err-feature-unavailable-on-platform" tabindex="-1"><a class="header-anchor" href="#err-feature-unavailable-on-platform"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_feature_unavailable_on_platform" target="_blank" rel="noopener noreferrer">ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</a></span></a></h3><p><code>ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</code> 是一个特定的错误类型，在 Node.js 中表示你试图使用的功能在当前操作系统平台上不可用。当你尝试执行某个依赖于平台的操作，而这个操作在你的操作系统中没有被实现或者不支持时，就会抛出这个错误。</p><p>Node.js 跨多种平台（如 Windows、macOS、Linux 等），但并非所有功能都在每个平台上均有相同的支持。有些 API 或模块可能仅在某些系统上工作，所以当你在一个不支持该特性的操作系统上运行代码时，Node.js 就会给你返回 <code>ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</code> 错误。</p><p>举例来说：</p><ol><li><p>文件系统监控：<br> 在 Node.js 中，<code>fs.watch()</code> 函数用于监听文件系统的变化。然而，这个函数依赖于操作系统底层的文件监控机制，这些机制在不同的平台上可能有不同的实现。例如，某些特定的监听选项可能在 Windows 上有效，而在其他平台上不可用。如果你尝试使用一个在当前平台上不支持的监听选项，可能就会遇到 <code>ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</code> 错误。</p></li><li><p>进程管理：<br> 某些进程管理功能可能只在类 Unix 系统上工作，比如一些详细的信号处理。如果你尝试在不支持这些功能的 Windows 上使用它们，就可能会抛出这个错误。</p></li></ol><p>要处理这种类型的错误，通常需要检查你的 Node.js 代码是否依赖于特定平台的特性，并确保对于不同的平台有回退或者替代方案。</p><p>例如，如果你在编写一个跨平台的应用，你可以在使用平台依赖的 API 之前检查当前操作系统，然后根据操作系统的不同提供不同的实现或提示用户该功能不可用：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> os</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">os</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">os</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">platform</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">win32</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">在 Windows 平台上运行</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 执行 Windows 特有的操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#81A1C1;"> if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">os</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">platform</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">linux</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">在 Linux 平台上运行</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 执行 Linux 特有的操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">此功能在您的平台上可能不可用</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 提供一个回退方案或者不执行操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总之，<code>ERR_FEATURE_UNAVAILABLE_ON_PLATFORM</code> 错误是 Node.js 告诉你某个功能在当前平台上不受支持，作为开发者需要注意这种平台差异，并为不同的平台提供适配或者错误处理。</p><h3 id="err-fs-cp-dir-to-non-dir" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-dir-to-non-dir"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_dir_to_non_dir" target="_blank" rel="noopener noreferrer">ERR_FS_CP_DIR_TO_NON_DIR</a></span></a></h3><p><code>ERR_FS_CP_DIR_TO_NON_DIR</code> 是 Node.js 中的一个错误代码，它代表了一个特定类型的文件系统错误。当你尝试使用 Node.js 中的文件系统 API（如 <code>fs.cp()</code> 或 <code>fsPromises.cp()</code>）来复制一个目录到一个已存在的非目录文件时，就会遇到这个错误。</p><p>在操作文件系统时，有两种类型的文件实体：<strong>目录</strong>和<strong>文件</strong>。</p><ul><li><strong>目录</strong>：可以包含其他文件或目录。</li><li><strong>文件</strong>：存储数据，例如文本、图片等，但不能像目录一样包含其他文件或目录。</li></ul><p>现在，让我透过一个例子来解释 <code>ERR_FS_CP_DIR_TO_NON_DIR</code> 错误：</p><p>假设我们有以下的文件结构：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>/myfolder</span></span>
<span class="line"><span>    /subfolder</span></span>
<span class="line"><span>    file.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里 <code>/myfolder</code> 是一个目录，它包含一个名为 <code>subfolder</code> 的子目录和一个名为 <code>file.txt</code> 的文件。</p><p>现在，如果你想复制 <code>subfolder</code> 这个目录到 <code>file.txt</code>，这是不允许的操作，因为 <code>file.txt</code> 不是一个目录，而是一个文件。如果你在 Node.js 中试图执行这样的操作，你将得到 <code>ERR_FS_CP_DIR_TO_NON_DIR</code> 错误。</p><p>下面是一个模拟出现此错误的 Node.js 代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 复制目录到一个文件路径</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/myfolder/subfolder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/myfolder/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果出错，打印错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Copy operation successful</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果没有错误，显示成功信息</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，我们尝试通过回调函数异步地将 <code>subfolder</code> 复制到 <code>file.txt</code>。因为 <code>file.txt</code> 是一个文件而不是目录，所以 Node.js 将抛出 <code>ERR_FS_CP_DIR_TO_NON_DIR</code> 错误，并且错误对象 <code>err</code> 的内容将包含该错误代码。</p><p>为了正确地进行复制操作，你应该确保目标是一个目录。如果目标不存在，Node.js 将创建一个新目录。如果目标存在并且是一个目录，则原目录内容会被复制到目标目录中。</p><p>修正后的代码可能是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的目标目录</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mkdir</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/myfolder/newfolder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> recursive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">mkErr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">mkErr</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">mkErr</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 现在复制目录到新创建的目录路径</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">/myfolder/subfolder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">/myfolder/newfolder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      {</span><span style="color:#88C0D0;"> recursive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">      (</span><span style="color:#D8DEE9;">cpErr</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">cpErr</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">cpErr</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Copy operation successful</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段修正后的代码中，我们首先创建了一个新目录 <code>/myfolder/newfolder</code>，然后再将 <code>subfolder</code> 目录内容复制到这个新创建的目录中。注意我们传入了 <code>{ recursive: true }</code> 选项给 <code>fs.mkdir()</code> 和 <code>fs.cp()</code>，这表示在创建目录和复制目录内容时，会递归地处理所有子目录。</p><h3 id="err-fs-cp-eexist" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-eexist"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_eexist" target="_blank" rel="noopener noreferrer">ERR_FS_CP_EEXIST</a></span></a></h3><p><code>ERR_FS_CP_EEXIST</code>是 Node.js 中的一个错误码，它代表在使用文件系统模块(<code>fs</code>)执行拷贝操作时遇到了问题。具体来说，当你试图将一个文件或目录拷贝到目标位置，而目标位置已经存在相同名称的文件或目录，并且没有指定覆盖选项时，就会发生这个错误。</p><p>让我们逐步解释一下这个概念，并通过实际例子来理解它：</p><h3 id="文件系统模块-fs" tabindex="-1"><a class="header-anchor" href="#文件系统模块-fs"><span>文件系统模块(fs)</span></a></h3><p>Node.js 提供了一个核心模块叫做文件系统(<code>fs</code>)模块，允许你在服务器上执行文件操作，比如读取文件内容、创建文件、修改文件、删除文件以及拷贝文件等。</p><h3 id="拷贝操作" tabindex="-1"><a class="header-anchor" href="#拷贝操作"><span>拷贝操作</span></a></h3><p>拷贝操作通常指的是将文件或者目录从一个位置复制到另一个位置。在 Node.js 中，你可以使用<code>fs.copyFile()</code>或者<code>fs.cp()</code>来执行拷贝文件的操作。</p><h3 id="错误情况" tabindex="-1"><a class="header-anchor" href="#错误情况"><span>错误情况</span></a></h3><p>如果你要拷贝的目标位置已经有一个同名的文件或目录，并且你没有特别指定要覆盖它，Node.js 就不会自动替换那个文件/目录，因为这样可能会导致数据丢失。在这种情况下就会抛出<code>ERR_FS_CP_EEXIST</code>错误。</p><h3 id="实际运用的例子-6" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-6"><span>实际运用的例子</span></a></h3><p>假设我们有以下两个文件：</p><ul><li><code>source.txt</code>：这是源文件，我们希望将其拷贝到另一个位置。</li><li><code>destination.txt</code>：这是目标位置的文件，与源文件名相同。</li></ul><h4 id="示例-1-拷贝文件而不覆盖现有文件" tabindex="-1"><a class="header-anchor" href="#示例-1-拷贝文件而不覆盖现有文件"><span>示例 1：拷贝文件而不覆盖现有文件</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试拷贝source.txt到一个已经存在的destination.txt</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">copyFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果发生了错误，打印错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File was copied successfully</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果<code>destination.txt</code>已经存在，那么你会得到<code>ERR_FS_CP_EEXIST</code>错误，因为没有给<code>fs.copyFile()</code>函数指定覆盖选项。</p><h4 id="示例-2-拷贝文件并覆盖现有文件" tabindex="-1"><a class="header-anchor" href="#示例-2-拷贝文件并覆盖现有文件"><span>示例 2：拷贝文件并覆盖现有文件</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> COPYFILE_EXCL</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">constants</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试拷贝source.txt到一个已经存在的destination.txt，并指定覆盖它</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">copyFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> COPYFILE_EXCL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果发生了错误，打印错误信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File was copied and existing file was overwritten</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们通过传递<code>COPYFILE_EXCL</code>作为参数告诉 Node.js 覆盖现有的<code>destination.txt</code>。但请注意，如果<code>destination.txt</code>存在，<code>COPYFILE_EXCL</code>会阻止覆盖该文件，导致<code>ERR_FS_CP_EEXIST</code>错误。如果想要覆盖，请去除<code>COPYFILE_EXCL</code>标志。</p><p>通过正确管理拷贝文件时的选项和错误处理，你可以更好地控制 Node.js 应用程序的文件操作行为。</p><h3 id="err-fs-cp-einval" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-einval"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_einval" target="_blank" rel="noopener noreferrer">ERR_FS_CP_EINVAL</a></span></a></h3><p><code>ERR_FS_CP_EINVAL</code> 是在 Node.js 应用程序中的一个特定错误代码，表示当你尝试使用文件系统模块（fs 模块）的 <code>cp</code> 方法复制文件或目录时，传入了无效参数。简单来说，这个错误告诉你调用 <code>cp</code> 方法时提供的某些信息不正确或者不符合要求。</p><p>Node.js 中的 <code>cp</code> 方法是用于复制文件和目录的。它接收一些参数，比如源路径、目标路径以及可选的配置选项。如果这些参数不正确地设置，就可能引发 <code>ERR_FS_CP_EINVAL</code> 错误。</p><h3 id="实例解释-2" tabindex="-1"><a class="header-anchor" href="#实例解释-2"><span>实例解释</span></a></h3><p>假设你有以下的 Node.js 脚本：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/source</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path/to/destination</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个脚本尝试将 <code>/path/to/source</code> 目录复制到 <code>/path/to/destination</code>。如果源路径或目标路径不存在，或者提供的是一个非法的路径字符串，那么 <code>cp</code> 方法就会触发 <code>ERR_FS_CP_EINVAL</code> 错误。</p><h3 id="几个可能导致-err-fs-cp-einval-错误的场景" tabindex="-1"><a class="header-anchor" href="#几个可能导致-err-fs-cp-einval-错误的场景"><span>几个可能导致 <code>ERR_FS_CP_EINVAL</code> 错误的场景：</span></a></h3><ol><li><p><strong>源路径是无效的</strong>：如果源路径不存在或者指向的不是一个文件或目录，就会引发此错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设 /some/nonexistent/path 不存在</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/some/nonexistent/path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path/to/destination</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将输出 ERR_FS_CP_EINVAL 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>目标路径格式不正确</strong>：如果目标路径是无效的或者格式不正确，也会引发此错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设目标路径是非法的或者格式不正确</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/source</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path`&lt;`to&gt;destination?</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将输出 ERR_FS_CP_EINVAL 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>选项参数无效</strong>：<code>cp</code> 方法还接受一个选项对象作为第二个参数，如果提供了无效的选项，也会产生此错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设我们提供了一个无效的选项</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">/path/to/source</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">/path/to/destination</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> recursive</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将输出 ERR_FS_CP_EINVAL 错误，因为 recursive 应该是一个布尔值</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>对于编程新手来说，遇到 <code>ERR_FS_CP_EINVAL</code> 错误最好的办法就是检查所有传给 <code>cp</code> 方法的路径和选项，确保它们都是有效且符合预期的。如果路径存在并且格式正确，同时选项参数也是预期的类型（例如，boolean 值而不是字符串），通常可以避免这种错误。</p><h3 id="err-http-body-not-allowed" tabindex="-1"><a class="header-anchor" href="#err-http-body-not-allowed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_body_not_allowed" target="_blank" rel="noopener noreferrer">ERR_HTTP_BODY_NOT_ALLOWED</a></span></a></h3><p><code>ERR_HTTP_BODY_NOT_ALLOWED</code>是 Node.js 中的一个错误代码，表示在某种 HTTP 请求中不应该包含消息体（body），但尝试在这个请求中发送了消息体。在 HTTP 协议中，并不是所有类型的请求都允许有消息体。例如，通常 GET 和 DELETE 请求是不应该包含消息体的，而 POST 和 PUT 请求则可以包含消息体。</p><p>这个错误通常发生在开发者使用 Node.js 编写服务器端代码时，尝试向不支持消息体的请求类型添加消息体。如果 Node.js 检测到这种情况，它就会抛出<code>ERR_HTTP_BODY_NOT_ALLOWED</code>错误。</p><p>下面通过几个例子来说明这个错误：</p><h3 id="示例-1-get-请求发送消息体" tabindex="-1"><a class="header-anchor" href="#示例-1-get-请求发送消息体"><span>示例 1：GET 请求发送消息体</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 检测请求方法</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试向GET请求响应中添加消息体</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是不被允许的消息体</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">服务器运行在 http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述示例中，我们尝试为一个 GET 请求的响应添加了消息体。根据 HTTP 协议规范，GET 请求通常没有消息体。如果 Node.js 的某个版本开始强制执行这一点并且抛出<code>ERR_HTTP_BODY_NOT_ALLOWED</code>错误，代码就会因此产生问题。</p><h3 id="示例-2-delete-请求发送消息体" tabindex="-1"><a class="header-anchor" href="#示例-2-delete-请求发送消息体"><span>示例 2：DELETE 请求发送消息体</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 检测请求方法</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DELETE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试向DELETE请求响应中添加消息体</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">删除操作不应带有消息体</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">服务器运行在 http://localhost:3000/</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，我们尝试为一个 DELETE 请求的响应添加了消息体。同样地，DELETE 请求也通常不包含消息体，如果 Node.js 检测到这种用法，可能会抛出<code>ERR_HTTP_BODY_NOT_ALLOWED</code>错误。</p><h3 id="如何解决这个错误" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误"><span>如何解决这个错误？</span></a></h3><p>要解决<code>ERR_HTTP_BODY_NOT_ALLOWED</code>错误，你需要确保你的代码只为允许有消息体的 HTTP 请求类型发送消息体。对于 GET、HEAD 和 DELETE 这类请求，避免在响应中调用<code>res.write()</code>或发送消息体。</p><p>如果你无意中触发了这个错误，检查你的请求处理逻辑，确保你没有尝试向不允许携带消息体的请求发送数据。正确的做法是，仅在 POST、PUT 等允许包含消息体的请求类型中发送消息体。</p><h3 id="err-http-content-length-mismatch" tabindex="-1"><a class="header-anchor" href="#err-http-content-length-mismatch"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_content_length_mismatch" target="_blank" rel="noopener noreferrer">ERR_HTTP_CONTENT_LENGTH_MISMATCH</a></span></a></h3><p><code>ERR_HTTP_CONTENT_LENGTH_MISMATCH</code> 是 Node.js 中的一个错误码，它表示在处理 HTTP 请求或响应时出现了内容长度不匹配的问题。具体来说，当 HTTP 消息头中声明的 <code>Content-Length</code> 和实际传输的体（body）数据的长度不一致时，就会触发这个错误。</p><h3 id="解释" tabindex="-1"><a class="header-anchor" href="#解释"><span>解释</span></a></h3><p>HTTP 协议中，<code>Content-Length</code> 头部用于告诉对方消息体的精确字节数。如果发送者声称消息体有 500 字节，但实际只发送了 300 字节或超过 500 字节，接收方会检测到一个不匹配，并可能抛出 <code>ERR_HTTP_CONTENT_LENGTH_MISMATCH</code> 错误。这个机制是为了保证数据的完整性和准确性。</p><h3 id="实际运用的例子-7" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-7"><span>实际运用的例子</span></a></h3><h4 id="服务器端代码示例" tabindex="-1"><a class="header-anchor" href="#服务器端代码示例"><span>服务器端代码示例：</span></a></h4><p>想象你正在写一个简单的 Node.js 服务器，你需要发送一个文件给客户端：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设 example.txt 文件大小为 1000 字节.</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正常情况下，如果 <code>example.txt</code> 确实是 1000 字节，那么一切都会运行得很好。但如果 <code>example.txt</code> 文件大小并非如声明的 1000 字节，比如只有 800 字节，那么当客户端接收数据时就会因为期待更多的数据而导致 <code>ERR_HTTP_CONTENT_LENGTH_MISMATCH</code> 错误。</p><h4 id="客户端代码示例" tabindex="-1"><a class="header-anchor" href="#客户端代码示例"><span>客户端代码示例：</span></a></h4><p>同样地，如果你在编写一个 HTTP 客户端请求数据时：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 你向服务器发送一个请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 假设我们期望从服务器获取 1000 字节的数据</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">content-length</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received all the data.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content length mismatch!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里捕获到异常</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Got error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果服务器声明将发送 1000 字节的数据，但实际上发送的数据少于或超过了这个数字，客户端可能会报出相似的错误。</p><h3 id="如何避免这个错误-1" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误-1"><span>如何避免这个错误？</span></a></h3><p>为了避免 <code>ERR_HTTP_CONTENT_LENGTH_MISMATCH</code> 错误，你需要确保：</p><ol><li>作为服务端，当设置 <code>Content-Length</code> 头部的时候，必须保证发送的正文长度与它一致。</li><li>作为客户端，在接收数据时应该检查接收到的数据长度是否与 <code>Content-Length</code> 头部声明的长度相匹配。</li></ol><p>始终确保 <code>Content-Length</code> 头与实际发送或接收的正文长度一致，能够有效防止出现内容长度不匹配的问题。</p><h3 id="err-fs-cp-fifo-pipe" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-fifo-pipe"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_fifo_pipe" target="_blank" rel="noopener noreferrer">ERR_FS_CP_FIFO_PIPE</a></span></a></h3><p><code>ERR_FS_CP_FIFO_PIPE</code> 是 Node.js 中的一个特定错误代码，用于标识在文件复制操作中遇到的特定类型问题。在 Node.js 的文件系统(<code>fs</code>)模块中处理文件和目录时，您可能会进行一些复制文件的操作。如果在这个过程中尝试对命名管道（FIFOs）或套接字（sockets）执行不恰当的操作，就可能引发 <code>ERR_FS_CP_FIFO_PIPE</code> 错误。</p><p>命名管道(FIFOs) 和套接字(sockets)是两种类型的特殊文件，它们用于进程间通信(IPC):</p><ul><li>命名管道（FIFOs）：允许在无关的进程之间按先进先出（FIFO）顺序进行通信的管道。</li><li>套接字（sockets）：用于提供网络通信功能，例如 TCP/IP 或 UDP 网络协议。</li></ul><p>在大多数情况下，您将使用 Node.js 复制普通文件或目录。然而，如果您尝试使用标准的复制方法来复制命名管道或套接字，就会出问题，因为这些是为传输数据而不是简单地被复制而设计的。Node.js 期望这些特殊文件以特定的方式来处理，而不是像普通文件那样复制。</p><h3 id="实际运用的例子-8" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-8"><span>实际运用的例子：</span></a></h3><p>假设你有一个应用程序，该程序在一端创建了一个命名管道文件，并且另一端的服务正在监听并从该管道读取数据。如果你尝试用 Node.js 的 <code>fs.cp</code> 或 <code>fs.copyFile</code> 方法去复制这个命名管道文件，而不是通过它发送数据，就会触发 <code>ERR_FS_CP_FIFO_PIPE</code> 错误，因为这些 API 不支持此类操作。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试复制一个命名管道文件（仅做示例，实际上你需要先有一个命名管道文件）</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/named/pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/destination/path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果发生错误，检查是否是 ERR_FS_CP_FIFO_PIPE</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_CP_FIFO_PIPE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制失败：不能对命名管道或套接字执行复制操作</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制失败：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这段代码里，如果 <code>/path/to/named/pipe</code> 是一个命名管道文件而不是常规文件，尝试复制它将会导致 <code>ERR_FS_CP_FIFO_PIPE</code> 错误。</p><p>要正确地处理这些特殊文件，你需要根据其设计进行交互，比如对于命名管道，你可以打开它并向其中写入数据，让其他进程读取；对于套接字，你可以建立连接并进行网络通信。</p><p>总结一下，<code>ERR_FS_CP_FIFO_PIPE</code> 是 Node.js 抛出的一个错误，提示您在复制文件时尝试对不支持复制操作的特殊文件类型（如命名管道或套接字）进行了操作。正确的做法是根据这些特殊文件的预期用途来处理它们，而不是尝试将其像普通文件一样复制。</p><h3 id="err-fs-cp-non-dir-to-dir" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-non-dir-to-dir"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_non_dir_to_dir" target="_blank" rel="noopener noreferrer">ERR_FS_CP_NON_DIR_TO_DIR</a></span></a></h3><p><code>ERR_FS_CP_NON_DIR_TO_DIR</code>是一个 Node.js 中的错误代码，它指的是在使用文件系统（fs 模块）中的<code>copy</code>操作时遭遇的特定类型的错误。这个错误会发生在尝试将一个非目录文件复制到一个已经存在的目录路径时。</p><p>让我用一个简单例子来解释一下：</p><p>假设你有一个名为<code>file.txt</code>的文件和一个名为<code>myDirectory</code>的目录。现在，如果你想把<code>file.txt</code>复制到<code>myDirectory</code>这个目录下，并且你使用了<code>fs.cp()</code>函数来实现这一点，但是在调用函数时，你误将<code>myDirectory</code>作为目标路径而没有指定新文件名，那么就可能触发<code>ERR_FS_CP_NON_DIR_TO_DIR</code>错误。</p><p>以下是一个可能导致<code>ERR_FS_CP_NON_DIR_TO_DIR</code>错误的示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs/promises</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> copyFile</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设 file.txt 是一个文件，myDirectory 是一个目录</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">myDirectory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_CP_NON_DIR_TO_DIR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法将非目录文件复制到目录路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制文件时出错:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">copyFile</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们希望复制<code>file.txt</code>到<code>myDirectory</code>目录下，但是我们未指定新文件的名称。Node.js 期望当目标路径是一个目录时，应该明确指出新文件的名称（例如<code>&#39;myDirectory/newFile.txt&#39;</code>）。由于没有指定新文件名，只给了一个已经存在的目录，Node.js 不知道如何处理这种情况，因此会抛出<code>ERR_FS_CP_NON_DIR_TO_DIR</code>错误。</p><p>正确地复制文件到目录的代码应该像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs/promises</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> copyFile</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 将 file.txt 复制为 myDirectory/file.txt</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">myDirectory/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制文件时出错:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">copyFile</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正后的例子里，我们清楚地告诉 Node.js 我们想要将<code>file.txt</code>复制到<code>myDirectory</code>目录下，并命名为<code>file.txt</code>。如此一来，即使目录已经存在，Node.js 也能够成功地执行复制操作，而不会抛出<code>ERR_FS_CP_NON_DIR_TO_DIR</code>错误。</p><h3 id="err-fs-cp-socket" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-socket"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_socket" target="_blank" rel="noopener noreferrer">ERR_FS_CP_SOCKET</a></span></a></h3><p>Node.js v21.7.1 中的 <code>ERR_FS_CP_SOCKET</code> 是一个特定类型的错误，它会在使用文件系统模块 (<code>fs</code>) 的 <code>fs.cp()</code> 或 <code>fs.cpSync()</code> 方法尝试复制一个套接字文件时抛出。在操作系统中，套接字文件通常用于进程间通信，它们不同于普通的文本或二进制文件。</p><p>首先，让我们简单了解下几个概念：</p><ul><li><strong>Node.js</strong>: Node.js 是一个基于 Chrome V8 JavaScript 引擎的 JavaScript 运行环境，可以让你在服务器端运行 JavaScript 代码。</li><li><strong>fs 模块</strong>: 在 Node.js 中，<code>fs</code>是“文件系统”的缩写，这个模块提供了很多操作文件的 API，比如读文件、写文件、复制文件等。</li><li><strong>套接字文件（Socket file）</strong>: 是一种特殊类型的文件，通常用于 UNIX 和类 UNIX 操作系统中，支持进程间的通信。</li></ul><p>现在说说 <code>ERR_FS_CP_SOCKET</code> 错误，当你尝试复制一个套接字文件时，Node.js 认为这个操作是没有意义的或者可能是危险的，因为套接字文件代表着动态的进程间通信路径，而复制它并不能复制通信状态，也无法保证新的套接字文件有同样的行为。</p><p>来看个例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设 &#39;/path/to/mysocket.sock&#39; 是一个套接字文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sourceSocketFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path/to/mysocket.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> destinationPath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/path/to/copy_of_mysocket.sock</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试同步复制套接字文件</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cpSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">sourceSocketFile</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> destinationPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 错误处理逻辑</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_CP_SOCKET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法复制套接字文件：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制过程中出现错误：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子里，如果你尝试运行上面的代码去复制一个套接字文件，你将会捕获到 <code>ERR_FS_CP_SOCKET</code> 错误，并且会输出 &quot;无法复制套接字文件&quot;。这就是 Node.js 告诉你，你做了一个它不允许的操作。</p><p>实践中，大多数用户可能永远都不需要复制套接字文件，所以遇到这个错误的机会也相对较少。但了解这个错误的存在对于理解 Node.js 对文件操作的限制和规则还是有帮助的。</p><h3 id="err-fs-cp-symlink-to-subdirectory" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-symlink-to-subdirectory"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_symlink_to_subdirectory" target="_blank" rel="noopener noreferrer">ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</a></span></a></h3><p><code>ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</code>是 Node.js 中的一个错误码，它代表你在尝试复制文件时遇到了错误。具体来说，这个错误发生在你用 Node.js 的文件系统（fs 模块）去复制一个符号链接（symlink），而这个符号链接指向了一个子目录时。</p><p>在计算机文件系统中，符号链接就像是一种快捷方式或者引用，它引用或“指向”另一个文件或目录。但是与快捷方式不同的是，对于大部分操作系统而言，符号链接就像是真实存在的文件或目录。</p><p>现在，让我们看几个例子来更好地理解<code>ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</code>错误是如何发生的，并且怎样使用 Node.js 去处理这些情况。</p><p>假设我们有这样一个目录结构：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>/myproject/</span></span>
<span class="line"><span>  /folder1/</span></span>
<span class="line"><span>    file1.txt</span></span>
<span class="line"><span>  /folder2/</span></span>
<span class="line"><span>  symlink -&gt; /myproject/folder1/ (这是一个指向folder1的符号链接)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>/myproject</code>目录中，<code>folder2</code>目录里有一个名为<code>symlink</code>的符号链接，它指向同一项目中的<code>folder1</code>目录。</p><p>如果我们想要将<code>symlink</code>这个符号链接复制到另一个目录下，例如到<code>/myproject/folder3</code>目录，并且我们希望复制的行为是将<code>symlink</code>作为一个指向原始目标（<code>folder1</code>）的符号链接进行复制，那么我们可以使用 Node.js 的<code>fs.cp()</code>函数。如果此函数调用期间的参数设置不当或其他操作不正确，可能会触发<code>ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</code>错误。</p><p>下面是一个 Node.js 脚本的示例，它可能导致这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 定义源路径和目标路径</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sourcePath</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">folder2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">symlink</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> destPath</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">folder3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">symlink</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试复制符号链接</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">sourcePath</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> destPath</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> dereference</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果发生错误，这里会处理错误</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Symbolic link copied successfully!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码片段中，<code>fs.cp()</code>函数被用来从<code>sourcePath</code>复制文件到<code>destPath</code>。<code>dereference</code>选项被设置为<code>true</code>，这意味着我们试图复制链接所指向的实际目录内容，而不是符号链接本身。如果目标文件是一个已存在的子目录，这将导致一个问题，因为我们不能将一个目录复制到它自己里面。这就像是试图将一个文件夹拖动进它自己一样，会导致无法解析的循环引用。</p><p>如果你遇到了<code>ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY</code>错误，你应该检查你的复制操作是否正确设置了参数，并且确保不是在试图将目录复制到它自己或其子目录中。通常，合理地处理这个错误包括检查你的路径设置，以及可能需要改变你的逻辑，以防止符号链接指向递归或循环的目录结构。</p><h3 id="err-fs-cp-unknown" tabindex="-1"><a class="header-anchor" href="#err-fs-cp-unknown"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_cp_unknown" target="_blank" rel="noopener noreferrer">ERR_FS_CP_UNKNOWN</a></span></a></h3><p><code>ERR_FS_CP_UNKNOWN</code> 是一个特定于 Node.js 的错误代码，它代表在使用文件系统（fs）模块复制文件或目录时发生了未知的错误。这种类型的错误通常涉及到操作系统层面的问题，这可能是由于磁盘错误、权限问题、文件正在被使用或其他一些无法预料的情况导致的。</p><p>当你在 Node.js 中使用 <code>fs.cp()</code> 或 <code>fs.cpSync()</code> 方法尝试复制文件或文件夹时，如果出现了不可识别的错误，Node.js 就可能抛出 <code>ERR_FS_CP_UNKNOWN</code> 错误。这些方法是用来在文件系统中复制文件和目录的。</p><p>这里有一个简单的例子，说明如何使用 <code>fs.cp()</code> 方法，并且展示了如果出现 <code>ERR_FS_CP_UNKNOWN</code> 该怎么处理：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们想要复制 &#39;source.txt&#39; 文件到 &#39;destination.txt&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> source</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> destination</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用异步的方式复制文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cp</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">source</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> destination</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_CP_UNKNOWN</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制过程中遇到了未知的错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">复制文件时发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件复制成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在执行上述代码时产生了未知的错误，你将在控制台看到相应的错误消息，并提供一些关于错误的详细信息。通常，对于 <code>ERR_FS_CP_UNKNOWN</code> 类型的错误，最好的调查方式是检查源文件和目标路径是否都是合法的、没有被锁定或者正被其他程序使用，并确保程序具有所需的文件操作权限。</p><p>总结一下，<code>ERR_FS_CP_UNKNOWN</code> 是一个表示复制文件时发生未知错误的代码，你需要根据错误的上下文信息进行调试和修复。它并不指向一个特定的原因，而是一个通用的错误提示，告知开发者在文件复制操作中发生了某个意料之外的问题。</p><h3 id="err-fs-eisdir" tabindex="-1"><a class="header-anchor" href="#err-fs-eisdir"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_eisdir" target="_blank" rel="noopener noreferrer">ERR_FS_EISDIR</a></span></a></h3><p><code>ERR_FS_EISDIR</code> 是一个错误代码，用于在 Node.js 中表示一个特定的文件系统错误。当你试图对一个目录执行那些仅适用于文件的操作时（比如读取或写入数据），就会出现这个错误。</p><p>EISDIR 是一个来自底层操作系统的错误码，它是 &quot;Error: Is a directory&quot; 的缩写，意味着你尝试将一个目录当作文件来处理了。</p><p>举几个实际运用的例子：</p><p><strong>例子 1 – 读取目录内容错误</strong></p><p>假设你有一个名为 <code>myDirectory</code> 的目录，并且你想读取这个目录里的内容。如果你错误地使用了读取文件的方法而不是列出目录内容的方法，你会遇到 <code>ERR_FS_EISDIR</code> 错误。</p><p>错误的做法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试读取目录的内容</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myDirectory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_FS_EISDIR 错误</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的做法应该使用 <code>fs.readdir()</code> 或 <code>fs.readdirSync()</code> 来列出该目录下的所有文件和子目录。</p><p><strong>例子 2 – 写入数据到目录</strong></p><p>如果你尝试向一个目录写入数据，也会收到 <code>ERR_FS_EISDIR</code> 错误，因为目录是用来包含文件的，而不是用来直接存储数据的。</p><p>错误的做法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试向目录写入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myDirectory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_FS_EISDIR 错误</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Data written to directory.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 实际上不会执行到这里</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例子 3 – 使用同步函数错误地处理目录</strong></p><p>Node.js 的 <code>fs</code> 模块还提供了一套同步函数，如果你不小心使用了这些同步版本的函数来操作目录，也会遇到 <code>ERR_FS_EISDIR</code> 错误。</p><p>错误的做法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 同步读取目录内容，会抛出错误</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myDirectory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_FS_EISDIR 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在处理文件和目录时，你应该始终确保使用正确的 API 方法，并且检查你的路径是指向文件还是目录。如果你不确定，可以使用 <code>fs.stat()</code> 或 <code>fs.statSync()</code> 先检查路径是文件还是目录。</p><h3 id="err-fs-file-too-large" tabindex="-1"><a class="header-anchor" href="#err-fs-file-too-large"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_file_too_large" target="_blank" rel="noopener noreferrer">ERR_FS_FILE_TOO_LARGE</a></span></a></h3><p><code>ERR_FS_FILE_TOO_LARGE</code> 是 Node.js 中的一个错误代码，它表示在尝试对一个文件执行操作时，该文件的大小超过了 Node.js 或底层文件系统支持的最大限制。这种情况通常发生在处理非常大的文件时。</p><p>在某些操作系统中，特别是 32 位系统中，文件系统可能会有一个最大文件大小的限制，如 2GB 或 4GB。即使在 64 位系统上，Node.js 也可能有其自己的限制，或者基于运行时的 JavaScript 引擎（比如 V8）可能会有堆内存限制，这些限制都会影响到可以处理的最大文件大小。</p><p>这里举几个例子来说明这个错误是如何出现的：</p><ol><li><p>使用 <code>fs.writeFileSync</code> 或 <code>fs.writeFile</code> 写入一个非常大的文件时：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试创建一个10GB的Buffer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">huge-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_FILE_TOO_LARGE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件太大，无法写入！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你的系统不支持创建这么大的文件，以上代码将导致 <code>ERR_FS_FILE_TOO_LARGE</code> 错误。</p></li><li><p>使用 <code>fs.readFile</code> 或 <code>fs.readFileSync</code> 读取一个非常大的文件时：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/large-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这是一个非常大的文件</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_FILE_TOO_LARGE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件太大，无法一次性读取到内存！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果文件太大，无法一次性放入 Node.js 的内存中，这段代码也会触发 <code>ERR_FS_FILE_TOO_LARGE</code> 错误。</p></li></ol><p>要解决这个问题，可以采取分块处理文件的策略，例如使用流（Streams）来逐片段地读取或写入文件，而不是一次性处理整个文件。这样做可以有效避免因为文件大小超出限制而导致的错误，并且还能更好地管理内存使用。</p><p>下面是一个使用流处理大文件的例子：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/large-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">读取文件的一部分数据：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_FS_FILE_TOO_LARGE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件太大，无法读取！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件读取完成。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们通过创建一个可读流来逐步读取大文件，每次只处理文件的一小部分。这种方式不会把整个文件加载到内存中，因此不会触发 <code>ERR_FS_FILE_TOO_LARGE</code> 错误。</p><h3 id="err-fs-invalid-symlink-type" tabindex="-1"><a class="header-anchor" href="#err-fs-invalid-symlink-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_fs_invalid_symlink_type" target="_blank" rel="noopener noreferrer">ERR_FS_INVALID_SYMLINK_TYPE</a></span></a></h3><p><code>ERR_FS_INVALID_SYMLINK_TYPE</code> 是 Node.js 中的一个错误代码，它表示在尝试创建符号链接（symlink）时提供了</p><h3 id="err-http-headers-sent" tabindex="-1"><a class="header-anchor" href="#err-http-headers-sent"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_headers_sent" target="_blank" rel="noopener noreferrer">ERR_HTTP_HEADERS_SENT</a></span></a></h3><p><code>ERR_HTTP_HEADERS_SENT</code>错误是一个在 Node.js 中常见的错误，它发生在 HTTP 服务器处理请求时，如果你尝试多次发送响应头或响应体给客户端。</p><p>首先，我们需要理解 HTTP 请求和响应的基本流程。当客户端（通常是浏览器）向服务器发起 HTTP 请求时，服务器会对这个请求进行处理，并返回一个 HTTP 响应。这个响应包括了响应头部（headers）和响应主体（body）。响应头部包含了关于响应的元数据，比如内容类型、状态码等；而响应主体则是实际的数据内容，比如 HTML 页面、JSON 数据等。</p><p>在 Node.js 中，你可能会使用诸如 Express 这样的框架来创建一个 HTTP 服务。当服务器准备好发送响应给客户端时，它会先发送响应头部，然后是响应主体。一旦响应头部被发送出去，你就不能再修改它们了，因为按照 HTTP 协议的规定，响应头部必须在响应主体之前发送。</p><p><code>ERR_HTTP_HEADERS_SENT</code>错误就是告诉你，你试图做的操作违反了这个规则。具体来说，你可能已经开始发送响应主体，或者已经完成了整个响应，但你又试图通过某些方式去修改响应头部或再次发送它们。</p><p>来看几个常见的例子：</p><p><strong>例子 1：重复发送响应</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 发送响应头部</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 发送响应主体并结束响应</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 下面的操作将会导致 ERR_HTTP_HEADERS_SENT 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误！响应已经发送</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们发送完响应后，又试图设置一个响应头部。由于响应已经发送，所以 Node.js 会抛出<code>ERR_HTTP_HEADERS_SENT</code>错误。</p><p><strong>例子 2：在异步操作后发送响应</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 异步操作，比如查询数据库后尝试发送响应</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 下面的操作将会导致 ERR_HTTP_HEADERS_SENT 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误！响应已经发送</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，虽然我们的意图可能是在异步操作完成后才发送响应，但是我们已经提前调用了<code>res.end()</code>，从而结束了响应。当异步操作（这里是<code>setTimeout</code>）完成时，再次尝试发送响应会导致错误。</p><p><strong>如何避免<code>ERR_HTTP_HEADERS_SENT</code>错误？</strong></p><p>确保你不会在响应已经结束后再尝试修改或发送响应头部。务必检查代码逻辑，特别是涉及到异步操作的地方，确保响应只被发送一次。如果你需要基于异步操作的结果来决定响应，那么请确保只有在所有异步操作都完成之后，才发送响应。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 异步操作，比如查询数据库</span></span>
<span class="line"><span style="color:#88C0D0;">  getDataFromDatabase</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">500</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果出错，发送500状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Internal Server Error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 成功则发送200状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getDataFromDatabase</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 模拟数据库操作</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Database Data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的修正例子中，我们将发送响应的代码放在了异步操作（这里模拟的是数据库查询）的回调函数中，确保只有在得到异步结果之后才发送响应。这样就不会引起<code>ERR_HTTP_HEADERS_SENT</code>错误。</p><h3 id="err-http-invalid-header-value" tabindex="-1"><a class="header-anchor" href="#err-http-invalid-header-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_invalid_header_value" target="_blank" rel="noopener noreferrer">ERR_HTTP_INVALID_HEADER_VALUE</a></span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境。在网络编程中，HTTP（超文本传输协议）是一种用于从服务器传输网页到本地浏览器的协议。当使用 Node.js 进行 Web 开发时，你会经常与 HTTP 请求和响应打交道。</p><p>在 Node.js 中，每个 HTTP 请求和响应都会有一系列的头部（Headers）。这些头部包含了一些关键的信息，比如内容类型、日期、缓存策略等。由于这些头部对于通信是非常重要的，所以它们必须符合特定的格式和标准。</p><p><code>ERR_HTTP_INVALID_HEADER_VALUE</code> 是 Node.js 抛出的一个错误，表明你尝试设置的一个 HTTP 头部的值不合法或者格式错误。如果你在代码中遇到了这个错误，那么意味着你需要检查你设置的头部是否符合 HTTP 标准。</p><p>让我给你举些例子来说明这个问题：</p><h3 id="例子-1-设置-http-响应头部" tabindex="-1"><a class="header-anchor" href="#例子-1-设置-http-响应头部"><span>例子 1：设置 HTTP 响应头部</span></a></h3><p>假设你正在编写一个 Node.js 应用程序，并想要设置一个响应头部表示内容类型为 JSON。你可能会这样写代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码将会正常工作，因为 <code>&#39;application/json&#39;</code> 是一个有效的内容类型。</p><p>但是，如果你错误地设置了内容类型的值，像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的头部值，包含了换行符</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这时，Node.js 就会抛出 <code>ERR_HTTP_INVALID_HEADER_VALUE</code> 错误，因为 HTTP 头部的值不能包含某些特殊字符，如换行符。</p><h3 id="例子-2-设置自定义头部" tabindex="-1"><a class="header-anchor" href="#例子-2-设置自定义头部"><span>例子 2：设置自定义头部</span></a></h3><p>我们可以设置自定义的 HTTP 头部，但它们的值也必须是有效的字符串。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-My-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这是完全没问题的。但是如果我们尝试设置一个对象或者其他非字符串的值：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-My-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> some</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的头部值，尝试设置一个对象</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>同样，这会导致 <code>ERR_HTTP_INVALID_HEADER_VALUE</code> 错误，因为头部的值必须是字符串，不能是对象。</p><h3 id="如何解决" tabindex="-1"><a class="header-anchor" href="#如何解决"><span>如何解决？</span></a></h3><p>当你遇到 <code>ERR_HTTP_INVALID_HEADER_VALUE</code> 错误时，解决步骤如下：</p><ol><li><strong>检查头部的值</strong>：确保你设置的每个头部的值都是字符串，并且没有包含任何不允许的特殊字符。</li><li><strong>查看文档</strong>：有时候你可能不确定某个头部的正确值，这时应该查阅相关的 HTTP 文档或者 Node.js 的文档。</li><li><strong>调试代码</strong>：如果不确定哪个头部有问题，可以逐一注释掉设置头部的代码，然后重新运行程序，找出具体是哪个头部值造成了问题。</li></ol><p>总结起来，<code>ERR_HTTP_INVALID_HEADER_VALUE</code> 提醒你检查并确保所有的 HTTP 头部的值都符合预期的格式和标准。通过仔细检查代码并遵循 HTTP 规范，你可以避免此类错误。</p><h3 id="err-http-invalid-status-code" tabindex="-1"><a class="header-anchor" href="#err-http-invalid-status-code"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_invalid_status_code" target="_blank" rel="noopener noreferrer">ERR_HTTP_INVALID_STATUS_CODE</a></span></a></h3><p><code>ERR_HTTP_INVALID_STATUS_CODE</code> 是在 Node.js 中表示一个具体的错误类型，它属于 HTTP 错误的一种。在编写使用 Node.js 的服务器代码时，你会与 HTTP 状态码打交道。HTTP 状态码是服务器用来告知客户端（如浏览器或其他接收数据的应用）关于请求的处理结果的三位数字代码。</p><p>当你在 Node.js 代码中尝试设置一个不合规范的 HTTP 状态码时，就会遇到 <code>ERR_HTTP_INVALID_STATUS_CODE</code> 错误。HTTP 状态码标准由 IETF 在 RFC 7231 及其他文档中定义，它们通常分为几个类别：</p><ul><li><code>1xx</code> - 信息性响应</li><li><code>2xx</code> - 成功</li><li><code>3xx</code> - 重定向</li><li><code>4xx</code> - 客户端错误</li><li><code>5xx</code> - 服务器错误</li></ul><p>举个例子，假设我们有以下的 Node.js 服务器代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试设置一个不存在的状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 999</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个简单的服务器示例中，我们尝试将响应的 <code>statusCode</code> 设置为 <code>999</code>。因为 <code>999</code> 不是一个有效的 HTTP 状态码，所以当这段代码运行时，Node.js 将会抛出 <code>ERR_HTTP_INVALID_STATUS_CODE</code> 错误。</p><p>正确的做法是使用标准的 HTTP 状态码，例如 <code>200</code> 表示成功、<code>404</code> 表示未找到等。修改后的代码应该看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 设置一个有效的状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // OK</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，我们将 <code>statusCode</code> 设置为了 <code>200</code>，表示请求已正常处理并返回。</p><p>在实际开发中，保证使用正确的 HTTP 状态码非常重要，它们帮助客户端理解请求的结果和采取相应的行动。例如，如果你正在编写一个 RESTful API，并且某个资源没有被找到，你应该返回 <code>404</code> 状态码；如果创建新资源成功，则返回 <code>201</code> 状态码；如果是服务器内部错误导致无法处理请求，则应返回 <code>500</code> 状态码。</p><h3 id="err-http-request-timeout" tabindex="-1"><a class="header-anchor" href="#err-http-request-timeout"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_request_timeout" target="_blank" rel="noopener noreferrer">ERR_HTTP_REQUEST_TIMEOUT</a></span></a></h3><p><code>ERR_HTTP_REQUEST_TIMEOUT</code> 是一个错误代码，用于标识在 Node.js 应用程序中发起的 HTTP 请求超时。HTTP 请求可能因为各种原因无法在指定时间内完成，所以当设置了请求超时，并且请求在设定的时间内没有得到响应时，Node.js 就会抛出这个错误。</p><p>在 Node.js 中，进行 HTTP 请求通常使用内置的 <code>http</code> 或 <code>https</code> 模块。我们可以设置一个特定的超时时间，告诉 Node.js 若请求在规定的时间内未收到响应就视为失败。</p><p>举个例子：</p><p>假设你正在编写一个 Node.js 应用程序，用来获取某个网站的最新天气信息。你希望这个 HTTP 请求如果在 2 秒钟内没能完成，就取消请求并通知用户。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP GET 请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">http://api.weatherapi.com/v1/current.json?key=YOUR_API_KEY&amp;q=Paris</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 接收数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 数据接收完毕</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置请求超时时间为 2000 毫秒（即 2 秒钟）</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听请求超时事件</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">请求超时，未能在 2 秒内获取到信息。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 终止请求</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听请求错误事件</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECONNRESET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">请求被终止。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">遇到问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，我们尝试从某个天气 API 获取巴黎当前的天气信息。我们通过调用 <code>setTimeout</code> 方法为这个请求设置了一个超时时间（2000 毫秒）。如果请求在这段时间内未得到响应，<code>&#39;timeout&#39;</code> 事件将被触发。在 <code>&#39;timeout&#39;</code> 事件的回调函数中，我们打印出一条消息提醒用户请求超时，并通过调用 <code>abort</code> 方法来取消这个请求。</p><p>如果请求因为其他原因失败了（例如网络问题、服务器错误等），它将触发 <code>&#39;error&#39;</code> 事件，我们可以在 <code>&#39;error&#39;</code> 事件的回调函数中处理这些错误情况。</p><p>总的来说，<code>ERR_HTTP_REQUEST_TIMEOUT</code> 是 Node.js 中用来指示 HTTP 请求由于超过预设的时间限制而未完成的错误码。通过合理设置和处理请求超时，你的应用程序可以更加健壮，能够优雅地处理潜在的网络延迟或中断问题。</p><h3 id="err-http-socket-assigned" tabindex="-1"><a class="header-anchor" href="#err-http-socket-assigned"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_socket_assigned" target="_blank" rel="noopener noreferrer">ERR_HTTP_SOCKET_ASSIGNED</a></span></a></h3><p><code>ERR_HTTP_SOCKET_ASSIGNED</code>是 Node.js 中的一个错误码，它表示在 HTTP 操作中出现了问题，具体是指尝试对一个已经被分配了 socket 连接的 HTTP 请求（或响应）进行操作。</p><p>在 Node.js 中，当你使用 HTTP 模块创建服务器或发起请求时，内部会创建所谓的&quot;sockets&quot;来处理网络通信。每个 HTTP 请求和响应基本上都是通过这些 sockets 发送和接收数据的。</p><p>如果你尝试在一个请求或响应已经与一个 socket 建立关联后对其进行某些不允许的操作，就可能触发<code>ERR_HTTP_SOCKET_ASSIGNED</code>错误。比如，在请求已经开始发送数据到客户端后，再尝试对请求头进行修改，这是不被允许的，因为 HTTP 协议规定头信息必须在任何实际数据之前发送。</p><p>下面通过一些例子来进一步解释：</p><h3 id="示例-1-错误地尝试修改已发送的响应头" tabindex="-1"><a class="header-anchor" href="#示例-1-错误地尝试修改已发送的响应头"><span>示例 1：错误地尝试修改已发送的响应头</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个HTTP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送响应头部和一些数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 响应已经开始发送，再次尝试写入头部会导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出ERR_HTTP_SOCKET_ASSIGNED</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cannot set header after response is sent:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 结束响应</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个简单的 HTTP 服务器，它在响应一个请求时首先发送了响应头和一段文本。然后，它尝试再次设置一个新的响应头。由于头部已经发送，这个操作是不合法的，Node.js 会抛出<code>ERR_HTTP_SOCKET_ASSIGNED</code>错误。</p><h3 id="示例-2-错误地尝试多次发送响应" tabindex="-1"><a class="header-anchor" href="#示例-2-错误地尝试多次发送响应"><span>示例 2：错误地尝试多次发送响应</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个HTTP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送第一次响应</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">First response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试再次发送响应会导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Second response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出ERR_HTTP_SOCKET_ASSIGNED</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Cannot send another response:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，服务器尝试对同一次请求发送两次响应。在 HTTP 协议中，一个请求只能有一个响应。因为第一次调用<code>res.end()</code>时响应已结束，再次尝试结束响应会导致<code>ERR_HTTP_SOCKET_ASSIGNED</code>错误。</p><p>总结起来，遇到<code>ERR_HTTP_SOCKET_ASSIGNED</code>错误通常意味着你正在尝试执行一个不符合 HTTP 协议标准的操作，如在响应已经开始发送的情况下修改头部、或对同一请求发送多次响应等。正确的做法是保证所有的响应头设置在响应体发送之前完成，并且确保每个请求只对应一次响应的发送。</p><h3 id="err-http-socket-encoding" tabindex="-1"><a class="header-anchor" href="#err-http-socket-encoding"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_socket_encoding" target="_blank" rel="noopener noreferrer">ERR_HTTP_SOCKET_ENCODING</a></span></a></h3><p>当我们谈论 Node.js 中的<code>ERR_HTTP_SOCKET_ENCODING</code>错误时，我们指的是在 HTTP 服务器或客户端工作时可能发生的一个特定类型的错误。在 Node.js 中，错误是用唯一的错误代码来识别的，以便于开发者能快速地理解和定位出现问题的具体环节。</p><p><code>ERR_HTTP_SOCKET_ENCODING</code>错误码表示尝试对 HTTP 连接的套接字（socket）进行不允许的编码设置。在 Node.js 中，套接字可以看作是网络间通信的渠道，例如，当你的 Node.js 程序要从网络上的另一个服务请求数据时，就会通过这种套接字与那个服务通信。</p><p>在 HTTP 的上下文中，套接字应该始终处理原始二进制数据，因为 HTTP 协议中定义了它自己如何处理字符编码。然而，如果你尝试手动改变套接字的默认行为——比如，尝试设置它以某种字符编码发送和接收数据——Node.js 就会抛出<code>ERR_HTTP_SOCKET_ENCODING</code>错误。</p><p>举个例子，考虑以下情况：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 在此处理请求并发送响应</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 启动服务器监听在3000端口</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取服务器的底层套接字</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 错误的尝试：设置套接字的编码</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会触发 ERR_HTTP_SOCKET_ENCODING 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个简单的 HTTP 服务器，并且当有新的连接建立时（<code>&#39;connection&#39;</code>事件被触发），我们尝试使用<code>setEncoding</code>方法设置套接字的编码。由于 HTTP 协议并不期望套接字在这一层级上处理编码，Node.js 会抛出<code>ERR_HTTP_SOCKET_ENCODING</code>错误。</p><p>因此，正确的做法是不要尝试对 HTTP 的套接字设置任何编码。它们应该始终处理二进制数据流，所有关于文本编码的工作都将在 HTTP 消息的更高级别处理，而非在传输层面。如果你需要处理编码，应该在接收到完整的 HTTP 消息之后、在处理响应或请求体时进行。</p><h3 id="err-http-trailer-invalid" tabindex="-1"><a class="header-anchor" href="#err-http-trailer-invalid"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_trailer_invalid" target="_blank" rel="noopener noreferrer">ERR_HTTP_TRAILER_INVALID</a></span></a></h3><p>Node.js 中的 <code>[ERR_HTTP_TRAILER_INVALID]</code> 是一个错误代码，这个错误发生在处理 HTTP 请求或响应的 trailers 部分时不符合协议规范。在详细解释之前，我们需要了解一些基础概念。</p><h3 id="什么是-http-trailer" tabindex="-1"><a class="header-anchor" href="#什么是-http-trailer"><span>什么是 HTTP Trailer？</span></a></h3><p>HTTP 协议允许在消息（请求或响应）的末尾添加额外的元数据，称为“trailers”。Trailers 类似于 HTTP 消息头部（Headers），但是它们出现在消息的 body 后面，通常用于在发送完整个消息体后提供额外的信息，比如消息体内容的校验和、数字签名等。Trailers 在 <code>Transfer-Encoding: chunked</code> 响应中才被使用，因为只有当你以分块方式发送数据时，你才能在所有数据都发送完毕后追加额外的元数据。</p><h3 id="什么情况下会遇到-err-http-trailer-invalid-错误" tabindex="-1"><a class="header-anchor" href="#什么情况下会遇到-err-http-trailer-invalid-错误"><span>什么情况下会遇到 <code>ERR_HTTP_TRAILER_INVALID</code> 错误？</span></a></h3><p>当 Node.js 的 HTTP 模块在接收或发送包含 trailers 的 HTTP 消息时，如果这些 trailer 不符合 HTTP 协议的规定，则会抛出 <code>ERR_HTTP_TRAILER_INVALID</code> 错误。这种情况可能由以下几个原因引起：</p><ol><li>Trailer 字段名称不合法。</li><li>Trailer 字段值包含非法字符。</li><li>Trailer 被发送在没有标识为 <code>Transfer-Encoding: chunked</code> 的消息中。</li><li>Trailer 出现在消息中，但是在消息头部并没有通过 <code>Trailer</code> 字段明确声明将会发送哪些 trailer。</li></ol><h3 id="实际例子-4" tabindex="-1"><a class="header-anchor" href="#实际例子-4"><span>实际例子</span></a></h3><p>假设你正在编写一个 Node.js 应用程序，该程序需要发送一个带有数字签名的 HTTP 响应。你计划在 trailers 中添加这个签名。你的代码可能像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 设置 Transfer-Encoding 为 chunked</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Transfer-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">chunked</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 声明将要发送的 Trailer</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Trailer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是响应体的一部分。</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 注意：在 Node.js 中，要调用 write 方法发送 trailerc</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-md5-hash-value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在上述代码中的 <code>addTrailers</code> 方法调用中，键或值不符合 HTTP 规范，就会触发 <code>ERR_HTTP_TRAILER_INVALID</code> 错误。例如，如果 &#39;Content-MD5&#39; 包含非法字符或者不是有效的 HTTP 标头字段，就会出问题。</p><h3 id="如何避免这个错误-2" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误-2"><span>如何避免这个错误？</span></a></h3><p>为了避免 <code>ERR_HTTP_TRAILER_INVALID</code> 错误，确保：</p><ul><li>只在使用 <code>Transfer-Encoding: chunked</code> 时发送 trailers。</li><li>在发送 trailers 前，必须在消息头部使用 <code>Trailer</code> 字段声明它们。</li><li>确保 trailer 的字段名称和值都是合法的。</li></ul><p>按照这些指导原则，你就可以安全地在 Node.js 应用程序中使用 HTTP trailers 功能了。</p><h3 id="err-http2-altsvc-invalid-origin" tabindex="-1"><a class="header-anchor" href="#err-http2-altsvc-invalid-origin"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_altsvc_invalid_origin" target="_blank" rel="noopener noreferrer">ERR_HTTP2_ALTSVC_INVALID_ORIGIN</a></span></a></h3><p><code>ERR_HTTP2_ALTSVC_INVALID_ORIGIN</code> 是一个特定的错误类型，在 Node.js 中用于指示在使用 HTTP/2 协议时遇到了与 ALTSVC 帧相关的问题。这个错误关联于 HTTP/2 的“Alternative Services”机制，用于告诉客户端可以通过不同的网络地址或不同的协议来访问服务。</p><p>首先，我们需要理解一些基础概念：</p><h3 id="http-2-和-altsvc-帧" tabindex="-1"><a class="header-anchor" href="#http-2-和-altsvc-帧"><span>HTTP/2 和 ALTSVC 帧</span></a></h3><p>HTTP/2 是 HTTP 协议的第二个主要版本，它在性能上有很多改进，比如多路复用（允许在单个连接上同时发送多个请求和响应），头部压缩等。</p><p>ALTSVC（Alternative Service）帧是 HTTP/2 的一个特性，允许服务器通知客户端存在其他提供相同资源的服务端点。这样，客户端可以选择使用这些替代的服务端点来优化性能或者绕过某些网络问题。</p><h3 id="err-http2-altsvc-invalid-origin-错误" tabindex="-1"><a class="header-anchor" href="#err-http2-altsvc-invalid-origin-错误"><span>ERR_HTTP2_ALTSVC_INVALID_ORIGIN 错误</span></a></h3><p>当服务器向客户端发送一个 ALTSVC 帧，但是其中包含的 origin（源）信息无效或者格式不正确时，Node.js 会抛出 <code>ERR_HTTP2_ALTSVC_INVALID_ORIGIN</code> 错误。Origin 通常是指提供服务的服务器，格式通常为一个 URI 或者主机名。</p><h3 id="实际例子-5" tabindex="-1"><a class="header-anchor" href="#实际例子-5"><span>实际例子</span></a></h3><p>假设你有一个运行在 HTTP/2 上的 Node.js 服务器，并且你想要通知客户端他们可以通过另一个地址来获取相同的服务。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 服务器，这里省略了 SSL 证书的配置环节</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 当客户端发起请求时</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 正确设置 ALTSVC 帧</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> altSvc</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">h3=&quot;:50781&quot;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">主页内容</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 发送 ALTSVC 帧，告诉客户端可以通过 HTTP/3 和端口 50781 来访问</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pushStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> pushStream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">alt-svc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> altSvc</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8443</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你的代码中的 origin 设置不正确，比如使用了错误的语法或格式，那么 Node.js 就可能触发 <code>ERR_HTTP2_ALTSVC_INVALID_ORIGIN</code> 错误。</p><h3 id="处理错误" tabindex="-1"><a class="header-anchor" href="#处理错误"><span>处理错误</span></a></h3><p>要处理这个错误，你应该检查发送 ALTSVC 帧时提供的 origin 参数是否符合规范，也就是说，确保它是有效的、格式正确的 URI 或主机名。如果你在代码中正确地设置了这些值，通常你不会遇到这个错误。如果你遇到了这个错误，仔细审查你的 ALTSVC 帧的构造方式和传递的参数。</p><h3 id="err-http2-altsvc-length" tabindex="-1"><a class="header-anchor" href="#err-http2-altsvc-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_altsvc_length" target="_blank" rel="noopener noreferrer">ERR_HTTP2_ALTSVC_LENGTH</a></span></a></h3><p>好的，我会尽量通俗易懂地解释这个概念。</p><p>首先，让我简单介绍一下 Node.js 和 HTTP/2:</p><ul><li><strong>Node.js</strong> 是一个可以让你使用 JavaScript 来编写后端代码的运行时环境。它非常适合开发需要高性能输入输出的网络应用程序。</li><li><strong>HTTP/2</strong> 是 HTTP 协议的第二个主要版本，提供了比老版本 HTTP/1.x 更高效的网络数据传输方式。</li></ul><p>在 HTTP/2 中有一种叫做<code>ALTSVC</code>（Alternative Service）的帧类型，它允许服务器告诉客户端：“嘿，你可以通过这里提供的另一个地址或协议来访问相同的资源，这可能会给你提供更好的服务。”这被用作一种性能优化技术，使得网络连接可以更灵活地根据当前网络状况进行调整。</p><p>现在，让我们谈谈<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误：</p><p>这个错误消息是针对 HTTP/2 功能中的<code>ALTSVC</code>帧的。当你在 Node.js 中使用 HTTP/2 模块，并且尝试发送一个<code>ALTSVC</code>帧但是其长度不符合规定时，就会抛出<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误。</p><p>具体来说，<code>ALTSVC</code>帧有一个长度限制，如果超出这个限制，Node.js 就会认为这是一个错误的情况，并抛出<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误。</p><p>这里是一些实际的例子场景：</p><ol><li><p>假如你正在构建一个支持 HTTP/2 的网站，而你想要告诉客户端他们可以使用另一个域名来获取资源，这样可以通过 CDN 加速内容分发。当你设置这个<code>ALTSVC</code>帧的信息时，如果信息太长，比允许值还要大，Node.js 就会抛出<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误。</p></li><li><p>或者你正开发一个 Node.js 应用程序，该程序需要与其他服务进行通信，并且你想利用 HTTP/2 的特点来优化性能。在尝试用<code>ALTSVC</code>帧通知其他服务可以使用备用的 API 端点时，如果你不慎将备用端点的 URI 设计得过于冗长，这就可能引发<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误。</p></li></ol><p>为了避免这个错误，你需要确保发送的<code>ALTSVC</code>帧符合 HTTP/2 规范中关于帧大小的要求。通常情况下，框架或库会管理这些细节，但是如果你在底层上工作，你就需要注意这些规则。</p><p>希望这个解释帮助你理解了<code>ERR_HTTP2_ALTSVC_LENGTH</code>错误及其背景。</p><h3 id="err-http2-connect-authority" tabindex="-1"><a class="header-anchor" href="#err-http2-connect-authority"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_connect_authority" target="_blank" rel="noopener noreferrer">ERR_HTTP2_CONNECT_AUTHORITY</a></span></a></h3><p>好的，让我们先从 Node.js 和 HTTP/2 协议说起。</p><p>Node.js 是一个开源、跨平台的 JavaScript 运行环境，能够让我们在服务器端运行 JavaScript 代码。它被设计为轻量级的，并且通过异步事件驱动的方式能够处理大量并发连接，这使得 Node.js 非常适合构建网络应用程序。</p><p>HTTP/2 是一种网络通信协议，它是 HTTP（超文本传输协议）的第二个主要版本，旨在提高网页加载速度，并改善用户体验。HTTP/2 引入了诸如二进制分帧、服务器推送、头部压缩等多项性能优化功能。</p><p>现在，关于<code>ERR_HTTP2_CONNECT_AUTHORITY</code>错误：</p><p>这个错误代表在使用 Node.js 进行 HTTP/2 通信时，客户端尝试通过<code>CONNECT</code>方法建立一个到指定“authority”（授权）的连接，但是遇到了问题。在 HTTP/2 中，“authority”通常是由目标服务器的域名和端口组成的。如果在这个过程中出现任何不匹配或无效，就可能抛出<code>ERR_HTTP2_CONNECT_AUTHORITY</code>错误。</p><p>实际例子：</p><ol><li>代理服务器支持：假设你正在编写一个使用 HTTP/2 代理的网络应用程序。客户端想要通过代理服务器连接到另一个服务，将会使用<code>CONNECT</code>方法，并在请求中指定目标服务器的“authority”。如果“authority”出现了拼写错误或者是代理服务器不认可的值，就会抛出<code>ERR_HTTP2_CONNECT_AUTHORITY</code>错误。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个HTTP/2客户端</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://proxy.example.com:8080</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试建立一个到错误的“authority”的连接</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">CONNECT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:authority</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">invalid#authority</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_CONNECT_AUTHORITY</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">连接的authority参数不正确或不被代理服务器接受</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>安全限制：如果你的 Node.js 服务器有特定的安全策略，只允许连接到某些预定义的“authority”，那么当客户端尝试建立连接到未授权的“authority”时，同样会触发<code>ERR_HTTP2_CONNECT_AUTHORITY</code>。</li></ol><p>请注意，因为 Node.js 是非常灵活的，这些错误大都是由于配置不当或程序员的误操作导致的。所以，当你遇到<code>ERR_HTTP2_CONNECT_AUTHORITY</code>这类错误时，首先要检查的就是你提供的“authority”是否正确无误，并且确保服务器或代理支持该值。</p><h3 id="err-http2-connect-path" tabindex="-1"><a class="header-anchor" href="#err-http2-connect-path"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_connect_path" target="_blank" rel="noopener noreferrer">ERR_HTTP2_CONNECT_PATH</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它允许开发人员使用 JavaScript 编写服务器端代码。HTTP/2 是网络协议的第二个主要版本，旨在解决 HTTP/1.x 的性能限制。</p><p>在 Node.js 中，<code>ERR_HTTP2_CONNECT_PATH</code> 错误是特定于 HTTP/2 功能的错误类型之一。这个错误会出现当你尝试通过 HTTP/2 协议创建连接，但是提供了一个不正确的路径时。按照 HTTP/2 的标准，当客户端发送 <code>CONNECT</code> 方法的请求时，所指定的“:path”伪头字段必须为空或者只包含 <code>&#39;/&#39;</code>。</p><p>在实际应用中，通常你不需要直接处理这样的细节，因为大多数 HTTP/2 交互都是通过高级的库来完成的，而这些库会帮你管理这些复杂的协议细节。然而，如果你正在编写涉及低级别 HTTP/2 通信的代码，那么了解和处理这种错误就变得很重要。</p><h3 id="实例演示" tabindex="-1"><a class="header-anchor" href="#实例演示"><span>实例演示</span></a></h3><p>假设你正在使用 Node.js 的 <code>http2</code> 模块手动创建 HTTP/2 请求，并尝试使用 <code>CONNECT</code> 方法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://myserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">CONNECT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:authority</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">myserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // &#39;:path&#39; 应该是 &#39;/&#39; 或者为空</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/connect</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> flags</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#EBCB8B;">\n</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试建立到 <code>myserver.com</code> 的 HTTP/2 连接，并发送一个 <code>CONNECT</code> 请求，指定了一个非法的路径 <code>&#39;/connect&#39;</code>。按照规范，这将导致 <code>ERR_HTTP2_CONNECT_PATH</code> 错误，因为我们应该使用 <code>&#39;/&#39;</code> 或者空字符串作为 <code>&#39;:path&#39;</code>，以遵循 HTTP/2 协议。</p><p>为了修正这个问题，你应该确保 <code>&#39;:path&#39;</code> 被设置为 <code>&#39;/&#39;</code> 或者省略该字段，默认值即为空：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">CONNECT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:authority</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">myserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 正确的 &#39;:path&#39; 设置</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在真实场景下，大多数开发者不需要直接使用 <code>CONNECT</code> 方法或者操作这样的低级别细节，除非他们在做一些特殊的代理服务或者网络层面的工作。即使如此，在编写类似的底层代码时，仍然需要对 HTTP/2 协议有深刻的了解，以避免此类错误。</p><h3 id="err-http2-connect-scheme" tabindex="-1"><a class="header-anchor" href="#err-http2-connect-scheme"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_connect_scheme" target="_blank" rel="noopener noreferrer">ERR_HTTP2_CONNECT_SCHEME</a></span></a></h3><p><code>ERR_HTTP2_CONNECT_SCHEME</code> 是 Node.js 中的一个错误代码，它特定于 HTTP/2 协议。在解释这个错误之前，我们需要理解一下 HTTP/2 的基本概念。</p><p>HTTP/2 是一种网络通信协议，它是 HTTP 协议的第二个主要版本，旨在改进网络性能、效率和安全性。与 HTTP/1.x 相比，HTTP/2 引入了诸如头部压缩、服务器推送以及请求和响应的多路复用等特性。多路复用允许在同一个连接上并行发送多个请求和响应，从而减少延迟和提高页面加载速度。</p><p>当你在使用 Node.js 编写服务器或客户端代码以利用 HTTP/2 功能时，有可能遇到<code>ERR_HTTP2_CONNECT_SCHEME</code>错误。这个错误表示你尝试使用不合适的 URL scheme 去建立 HTTP/2 连接。</p><p>在 HTTP/2 中，必须使用加密的传输（即 HTTPS）来保证数据传输的安全性。因此，当你尝试用<code>http://</code>这样的非加密 scheme 去创建一个 HTTP/2 连接时，就会抛出<code>ERR_HTTP2_CONNECT_SCHEME</code>错误。</p><p>让我们通过一些实际运用的例子来看看这个错误是如何触发的：</p><p>假设你正在使用 Node.js 的<code>http2</code>模块创建一个 HTTP/2 客户端：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的URL scheme (http://)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将打印 ERR_HTTP2_CONNECT_SCHEME 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，尽管我们导入了 HTTP/2 模块并尝试建立连接，但是我们使用的是<code>http://</code> scheme 而不是<code>https://</code>。这会导致<code>ERR_HTTP2_CONNECT_SCHEME</code>错误被触发，并且在错误处理器中打印出来。</p><p>为了正确地使用 HTTP/2 客户端并避免这个错误，你需要使用 HTTPS scheme：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的URL scheme (https://)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 现在你可以安全地使用HTTP/2的功能发送请求等等</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正后的例子中，我们使用了<code>https://</code>作为 URL scheme，这样就可以成功地建立 HTTP/2 连接而不会抛出<code>ERR_HTTP2_CONNECT_SCHEME</code>错误。</p><p>总结一下，<code>ERR_HTTP2_CONNECT_SCHEME</code>错误是告诉你在使用 Node.js 的 http2 模块时，需要注意只能通过安全的 HTTPS 连接来使用 HTTP/2 协议，不然就会违反协议规定并导致错误。</p><h3 id="err-http2-error" tabindex="-1"><a class="header-anchor" href="#err-http2-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_error" target="_blank" rel="noopener noreferrer">ERR_HTTP2_ERROR</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，让开发者可以使用 JavaScript 来编写服务器端的代码。HTTP/2 则是一种网络通信协议，它是 HTTP 协议的第二个主要版本，用于优化用户和网站服务器之间的数据传输。</p><p>在 Node.js 中，<code>ERR_HTTP2_ERROR</code>是一个特定类型的错误，它与 HTTP/2 协议相关的操作失败时产生。当你在使用 Node.js 内置的 http2 模块创建或与 HTTP/2 服务器进行交互时，如果出现了违反 HTTP/2 协议规范的情况，就可能会遇到这个错误。</p><p>Node.js 中的错误通常都会有一个错误码来标识，对于<code>ERR_HTTP2_ERROR</code>，其代表的是一个通用的 HTTP/2 协议错误，并且通常会伴随着更具体的信息来说明错误的原因。</p><p>下面举几个实际运用中可能遇到<code>ERR_HTTP2_ERROR</code>的例子：</p><ol><li><p>无效的帧发送：在 HTTP/2 中，数据通过帧（frame）的形式在客户端和服务器之间传输。如果你尝试发送一个不符合 HTTP/2 规范的帧，比如帧大小超过了协议定义的最大值，那么就会触发<code>ERR_HTTP2_ERROR</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://myserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们发送了一个非法的帧，代码里不会真这样做，这只是为了演示</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_ERROR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生了HTTP/2协议错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>流控制错误：HTTP/2 使用流控制（flow control）机制防止发送方淹没接收方以太多数据。如果你的应用没有正确处理流控制，也可能导致<code>ERR_HTTP2_ERROR</code>的出现。</p></li><li><p>设置参数非法：HTTP/2 允许客户端和服务器通过设置帧（SETTINGS frame）来交换配置参数。如果发送了非法的设置参数，例如超出了规范定义的数值范围，将触发<code>ERR_HTTP2_ERROR</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_ERROR</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP/2设置参数非法:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安全性问题：HTTP/2 强制使用 TLS 加密，如果在设置 TLS 时出现问题，比如证书不匹配或者加密套件不兼容，也可能报告<code>ERR_HTTP2_ERROR</code>。</p></li></ol><p>需要注意的是，<code>ERR_HTTP2_ERROR</code>并不总是代表你的代码有错误。它有时候也反映了网络问题或远端服务器问题，所以在实际处理时需要根据错误信息的上下文来判断错误的来源。</p><p>解决<code>ERR_HTTP2_ERROR</code>错误通常涉及检查代码以确保它遵循 HTTP/2 的规范，以及检查网络连接和服务器设置是否正确。如果你是编程新手，处理这类错误可能会有些复杂，不过理解了它的含义和可能的触发场景后，再结合具体的错误消息，应该能够逐步定位和修复问题。</p><h3 id="err-http2-goaway-session" tabindex="-1"><a class="header-anchor" href="#err-http2-goaway-session"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_goaway_session" target="_blank" rel="noopener noreferrer">ERR_HTTP2_GOAWAY_SESSION</a></span></a></h3><p>当然，我来解释一下<code>ERR_HTTP2_GOAWAY_SESSION</code>这个错误。</p><p>Node.js 中的 HTTP/2 模块允许你使用 HTTP/2 协议进行网络通信。HTTP/2 是一种比传统的 HTTP/1.x 更高效的网络协议，它支持多路复用（一个连接上并行传输多个请求和响应）、服务器推送等特性。</p><p>在 HTTP/2 中，<code>GOAWAY</code>帧是一个控制帧，由服务器发送给客户端。这个帧的作用是通知客户端，当前的连接不再接受新的请求，并将要关闭。但它允许当前正在处理的请求完成。这通常是因为服务器需要进行维护或者关闭，也可能是因为遇到了错误情况。</p><p><code>ERR_HTTP2_GOAWAY_SESSION</code>这个错误指的是当你的 Node.js 程序在使用 HTTP/2 客户端与服务器进行通信时，服务器发送了一个<code>GOAWAY</code>帧，表明会话（session）即将结束，不会接受更多请求。</p><p>这里有几个实际运用的例子来说明这个错误是如何出现的：</p><ol><li><p>维护中的服务器：假设你正在编写一个 Node.js 程序，该程序使用 HTTP/2 客户端定期向某个 API 发送请求。如果 API 服务器开始维护并且发送了<code>GOAWAY</code>帧，你的程序会收到<code>ERR_HTTP2_GOAWAY_SESSION</code>错误。此时，你的程序应该停止发送新的请求，并根据需要重新连接或重试。</p></li><li><p>负载均衡：在一个负载均衡的环境中，可能有多台服务器处理请求。如果其中一台服务器需要下线，它将发送<code>GOAWAY</code>帧以逐渐关闭连接。任何尝试向该服务器发送新请求的客户端都将收到<code>ERR_HTTP2_GOAWAY_SESSION</code>错误。</p></li><li><p>错误处理：如果 HTTP/2 服务器遇到了不能恢复的内部错误，它可能发送<code>GOAWAY</code>帧并关闭连接。你的 Node.js 程序，如果正好在这时尝试发送请求，就会收到这个错误。</p></li></ol><p>处理<code>ERR_HTTP2_GOAWAY_SESSION</code>错误的方式通常是捕获这个错误，并根据程序的逻辑决定是立刻重试、延迟重试还是简单地记录错误信息。</p><p>记住，这个错误不是你的程序引起的，而是服务器告诉你的程序它即将关闭当前的连接，所以你的程序需要做出相应的反应。</p><h3 id="err-http2-header-single-value" tabindex="-1"><a class="header-anchor" href="#err-http2-header-single-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_header_single_value" target="_blank" rel="noopener noreferrer">ERR_HTTP2_HEADER_SINGLE_VALUE</a></span></a></h3><p><code>ERR_HTTP2_HEADER_SINGLE_VALUE</code> 是 Node.js 中的一个错误类型，它指的是在使用 HTTP/2 协议通信时违反了协议规定：某些标头（Header）字段必须只发送单个值，而不是多个值或重复的字段。</p><p>在 HTTP/2 中，与 HTTP/1.x 相比，对标头的处理有很多区别和限制。HTTP/2 使用标头压缩算法减少冗余，并提高性能。因此，一些标头字段在 HTTP/2 中有更严格的要求。</p><p>例如，在 HTTP/2 中，一些标头字段如 <code>:method</code>, <code>:scheme</code>, <code>:path</code>, 和 <code>:authority</code> 必须只出现一次，并且它们的值也必须是单一的值，不能是逗号分隔的列表或重复出现。</p><p>如果你试图通过 Node.js 的 HTTP/2 模块发送一个具有多个值的这类标头，Node.js 将会抛出 <code>ERR_HTTP2_HEADER_SINGLE_VALUE</code> 错误。</p><p>下面是一个例子来说明这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 试图发送包含多个值的 :path 标头</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> responseHeaders</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/home, /about</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 错误用法！:path 标头应该只有一个值</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">responseHeaders</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们试图将 <code>:path</code> 标头设置为两个值的列表（<code>&#39;/home, /about&#39;</code>），这在 HTTP/2 协议中是不允许的。在实际运行时，这将引发 <code>ERR_HTTP2_HEADER_SINGLE_VALUE</code> 错误，因为 <code>:path</code> 标头期望单个值。</p><p>正确的做法是，为每个请求单独响应并发送合适的路径值。以下是一个修正后的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ...省略前面创建服务器和监听流的代码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送带有单个值的 :path 标头</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> responseHeaders</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/home</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 正确用法，:path 标头只有一个值</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">responseHeaders</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Welcome to the home page!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...省略监听端口的代码</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正示例中，<code>:path</code> 标头被设为单个值 <code>&#39;/home&#39;</code>，这符合 HTTP/2 协议的要求。如此，服务就可以正确处理请求，并且不会抛出 <code>ERR_HTTP2_HEADER_SINGLE_VALUE</code> 错误。</p><h3 id="err-http2-headers-after-respond" tabindex="-1"><a class="header-anchor" href="#err-http2-headers-after-respond"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_headers_after_respond" target="_blank" rel="noopener noreferrer">ERR_HTTP2_HEADERS_AFTER_RESPOND</a></span></a></h3><p>Node.js 中的 <code>ERR_HTTP2_HEADERS_AFTER_RESPOND</code> 错误是在使用 HTTP/2 协议进行网络通信时可能遇到的一个错误。在解释这个错误之前，我们需要简单了解一下 HTTP/2 协议以及和它有关的一些概念。</p><p>HTTP/2 是互联网上使用的新版 http 协议，它为我们提供了更快、更高效的 Web 浏览体验。相比于前一版本 HTTP/1.1，HTTP/2 引入了头部压缩、服务端推送、请求/响应多路复用等新特性，使得数据交换更加高效。</p><p>在一个 HTTP/2 的连接中，客户端（如浏览器）与服务器可以通过单一的连接同时发送多个请求和接收多个响应，每个请求或响应称作一个“流”。</p><p>现在来看你提到的错误：<code>ERR_HTTP2_HEADERS_AFTER_RESPOND</code>。</p><p>这个错误发生的场景是这样的：在 HTTP/2 协议中，当服务器向客户端发送了一个响应头（response headers）之后，它不应该再发送第二组响应头。如果服务器尝试在已经发送完响应（包括响应头和响应体）之后，再次发送响应头，就会触发 <code>ERR_HTTP2_HEADERS_AFTER_RESPOND</code> 错误。</p><p>让我们举个例子。</p><p>假设你正在编写一个 Node.js 的 web 应用，并使用了 HTTP/2 来与客户端通信。你的代码可能像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送响应头</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html; charset=utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 发送响应体</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 下面的代码尝试再次发送响应头，这是不允许的。</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 204</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会引发 ERR_HTTP2_HEADERS_AFTER_RESPOND 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先对客户端的请求发送了一个 200 状态码的响应头和一个简单的 HTML 响应体。但紧接着我们尝试再次发送响应头（尽管是空的响应体），这违反了 HTTP/2 的协议规定，所以 Node.js 将会抛出 <code>ERR_HTTP2_HEADERS_AFTER_RESPOND</code> 错误。</p><p>要修复这个问题，确保只在开始响应时发送一次响应头，并且不要在发送响应体之后尝试再次发送响应头。如果你需要传递其他信息给客户端，考虑使用 HTTP 头部中的 Trailer 字段，或者调整你的程序逻辑以避免违反协议规则。</p><h3 id="err-http2-headers-sent" tabindex="-1"><a class="header-anchor" href="#err-http2-headers-sent"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_headers_sent" target="_blank" rel="noopener noreferrer">ERR_HTTP2_HEADERS_SENT</a></span></a></h3><p><code>ERR_HTTP2_HEADERS_SENT</code>是一个错误类型，在 Node.js 中特别表示在使用 HTTP/2 通信协议时，你试图发送一些响应头部（headers），但是这个时候响应的头部已经被发送出去了。这通常意味着你正在尝试做一些不被允许的操作，因为按照 HTTP 协议的规则，一旦响应头部被确定并发送给客户端之后，就不能再更改它们了。</p><p>首先，理解 HTTP 请求和响应的基本过程很重要：当一个客户端（比如说一个网页浏览器）发起一个 HTTP 请求到服务器时，服务器会回答这个请求，并发送一个响应。这个响应包含了几个部分：</p><ol><li>状态码（Status Code）: 告诉客户端请求是否成功，比如 200 代表成功，404 代表未找到资源。</li><li>响应头部（Headers）: 包含了关于响应的额外信息，例如内容类型、设置 Cookie、缓存控制等。</li><li>响应体（Body）: 实际返回给客户端的数据，如网页的 HTML 代码、图片或 API 调用的 JSON 数据等。</li></ol><p>在 HTTP/2 协议下，一旦服务器开始发送响应的头部给客户端，你就不能再修改这个头部信息了。如果你尝试添加、删除或修改任何头部信息，Node.js 就会抛出<code>ERR_HTTP2_HEADERS_SENT</code>错误。</p><p>现在让我们来看一个简单的例子来说明这个问题：</p><p>假设你写了一个 Node.js HTTP/2 服务器，它有一个逻辑来处理用户请求并返回一些信息。但是在发送响应头部之后，你尝试再次设置一些头部信息。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送响应头部</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html; charset=utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设我们在这里执行了一些异步操作</span></span>
<span class="line"><span style="color:#88C0D0;">  someAsyncOperation</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 错误处理</span></span>
<span class="line"><span style="color:#616E88;">      // 尝试设置一个新的状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">      stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 500</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会出错，因为响应头部已经发送</span></span>
<span class="line"><span style="color:#81A1C1;">      return;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 发送响应体</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们首先发送了响应头部，其中包括了状态码 200 和内容类型。然后，我们在一些异步操作完成后尝试再次发送一个状态码 500，这是不允许的，因为头部已经被发送过一次了，所以 Node.js 将会抛出<code>ERR_HTTP2_HEADERS_SENT</code>错误。</p><p>正确的做法是检查响应头部是否已经发送，如果没有，才进行设置。如果已经发送了，你可能需要考虑其他逻辑来处理错误情况，例如关闭流或者记录日志。记住，一旦响应头部发送，你就失去了修改他们的机会。</p><h3 id="err-http2-info-status-not-allowed" tabindex="-1"><a class="header-anchor" href="#err-http2-info-status-not-allowed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_info_status_not_allowed" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INFO_STATUS_NOT_ALLOWED</a></span></a></h3><p>好的，Node.js 是一个开放源代码、跨平台的 JavaScript 运行时环境，它允许你在服务器端运行 JavaScript 代码。Node.js 使用了一个事件驱动的非阻塞 I/O 模型，使其轻量又高效。Node.js 的包管理器 npm，是全球最大的软件注册表。</p><p>HTTP/2 是网络协议中的一个版本，它旨在提供比传统的 HTTP/1.x 更快的数据传输速率。在 Node.js 中实现 HTTP/2 可以让开发者构建更加高效的网络应用。</p><p>现在，让我们谈谈特定的错误 <code>ERR_HTTP2_INFO_STATUS_NOT_ALLOWED</code>：</p><p>这个错误意味着你试图在 HTTP/2 连接中发送一个信息性状态码（informational status code），但是这个操作是不被允许的。信息性状态码是指那些以 <code>1XX</code> 开头的状态码，例如 <code>100 Continue</code> 或者 <code>102 Processing</code>。</p><p>在 HTTP/2 协议中，并不是所有的信息性状态码都可以被随意使用。比如，<code>103 Early Hints</code> 是一个可用的信息性状态码，而其他的如 <code>100 Continue</code> 则通常不用于 HTTP/2。</p><p>假设你有以下的 Node.js 代码片段，尝试在 HTTP/2 服务器上发送一个信息性状态码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试发送一个信息性状态码，比如 &#39;100 Continue&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">additionalHeaders</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // ... 其他的响应处理逻辑 ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，<code>stream.additionalHeaders</code> 方法调用尝试发送一个 <code>100 Continue</code> 状态，但这并不适合 HTTP/2，所以 Node.js 会抛出 <code>ERR_HTTP2_INFO_STATUS_NOT_ALLOWED</code> 错误。</p><p>要避免这个错误，确保你不要试图发送不支持的 HTTP/2 信息性状态码。如果你确实需要发送一个预期内的响应，那么你应该选择一个恰当的 <code>2XX</code>、<code>3XX</code>、<code>4XX</code> 或 <code>5XX</code> 状态码，这取决于你想要表达的具体情况：成功、重定向、客户端错误还是服务器错误。</p><p>例如，如果请求已经成功处理，并且你想发送响应给客户端，你可以使用 <code>200 OK</code> 状态码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送一个成功的状态码 &#39;200 OK&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 响应主体</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们没有使用任何不被允许的信息性状态码，取而代之的是标准的 <code>200 OK</code> 状态来表示请求已被成功处理。这样就不会触发 <code>ERR_HTTP2_INFO_STATUS_NOT_ALLOWED</code> 错误。</p><h3 id="err-http2-invalid-connection-headers" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-connection-headers"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_connection_headers" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_CONNECTION_HEADERS</a></span></a></h3><p>好的，我来解释一下 Node.js 中的 <code>ERR_HTTP2_INVALID_CONNECTION_HEADERS</code> 错误。</p><p>HTTP/2 是一个网络通信协议，它是 HTTP 协议的第二个主要版本，用于在网页浏览器和服务器之间传输数据。相比于上一个版本 HTTP/1.x，HTTP/2 采用了不同的机制来提高效率和性能，比如多路复用（即在同一个连接上同时传输多个消息），头部压缩等。</p><p>Node.js 中的 <code>http2</code> 模块允许你使用 HTTP/2 协议。但是，在使用 HTTP/2 的时候，需要遵循一些特定的规则。其中之一就是：某些 HTTP 头部字段在 HTTP/2 中不能被使用。这些字段通常与 HTTP/1.x 的连接管理相关，例如 <code>Connection</code>、<code>Upgrade</code>、<code>Keep-Alive</code>、<code>Transfer-Encoding</code> 和 <code>Host</code>。当这些头部在 HTTP/2 连接中出现时，它们是无效的。</p><p>如果在使用 Node.js 的 <code>http2</code> 模块创建 HTTP/2 通信时，错误地设置了这些头部，你就会遇到 <code>ERR_HTTP2_INVALID_CONNECTION_HEADERS</code> 错误。这意味着你尝试使用了在 HTTP/2 中被认为是非法的连接头部字段。</p><p>举个例子，假设我们正在编写一个 Node.js 程序，该程序启动了一个 HTTP/2 服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ... 在这里处理请求 ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 下面的代码尝试发送一个无效的连接头部</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    connection</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">keep-alive</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这是无效的，在HTTP/2 中不应该存在</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当这段代码尝试运行时，会抛出 <code>ERR_HTTP2_INVALID_CONNECTION_HEADERS</code> 错误，因为 <code>&#39;connection&#39;: &#39;keep-alive&#39;</code> 是 HTTP/1.x 的一个标准头部，而在 HTTP/2 中，连接管理是不同的，并且 &#39;Connection&#39; 头部已经不再有效。</p><p>所以正确的做法是，不要在 HTTP/2 响应中包含那些无效的头部：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ...</span></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，确保当你转向使用 HTTP/2 时，移除了所有针对 HTTP/1.x 设计的头部信息，以避免类似的错误。</p><h3 id="err-http2-invalid-header-value" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-header-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_header_value" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_HEADER_VALUE</a></span></a></h3><p><code>ERR_HTTP2_INVALID_HEADER_VALUE</code>是一个错误类型，它在 Node.js 的 HTTP/2 模块中使用。首先，我们先了解一下什么是 HTTP/2 以及头部（header）。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它旨在提高网页加载速度，优化用户体验，并减少服务器负载。它有很多改进点，比如它支持头部压缩和服务器推送等特性。</p><p>在 HTTP 通信中，&quot;头部&quot;是指包含在请求和响应消息中的元数据。头部告诉接收方关于消息正文的额外信息，例如内容类型、内容长度或者是否需要保持连接等。</p><p>当你在使用 HTTP/2 时，如果你试图发送一个不合法的头部值，Node.js 会抛出<code>ERR_HTTP2_INVALID_HEADER_VALUE</code>错误。这意味着你尝试设置的某个 HTTP/2 头部字段的值不符合规范，或者是不可以接受的格式。</p><p>以下是几个实际的例子：</p><ol><li><p><strong>设置过长的头部值</strong>：HTTP/2 有对头部长度的限制，如果你尝试设置一个超过这个长度限制的值，你将会遇到这个错误。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试设置一个非常长的头部值</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">repeat</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1000</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>&#39;text/plain&#39;.repeat(1000)</code>超过了头部长度限制，那么上面的代码将会触发<code>ERR_HTTP2_INVALID_HEADER_VALUE</code>错误。</p></li><li><p><strong>设置非法字符的头部值</strong>：HTTP 头部不能包含某些特定的字符集。如果你尝试设置含有这些非法字符的头部值，你也会遇到这个错误。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试设置一个包含非法字符的头部值</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Location</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://example.com/</span><span style="color:#EBCB8B;">\n</span><span style="color:#A3BE8C;">new-location</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Redirecting...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，尝试设置<code>Location</code>头部为一个带有换行符<code>\n</code>的 URL，这是不允许的，导致<code>ERR_HTTP2_INVALID_HEADER_VALUE</code>错误。</p></li></ol><p>处理这种错误的方式通常是仔细检查你设置的头部值，确保它们都是合法的并符合 HTTP/2 的标准。在进行开发时，你应该参考相应的 HTTP 规范来确认头部值的正确格式和大小限制。</p><h3 id="err-http2-invalid-info-status" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-info-status"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_info_status" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_INFO_STATUS</a></span></a></h3><p>Node.js v21.7.1 的<code>ERR_HTTP2_INVALID_INFO_STATUS</code>错误是与 HTTP/2 协议中的“信息状态（Informational Status）”响应有关的一个特定类型的错误。</p><p>首先，为了理解这个错误，我们需要知道 HTTP/2 是什么。HTTP/2 是一种网络通信协议，它是 HTTP 协议的第二个主要版本，旨在提高 Web 性能，使数据传输更加高效。它引入了一些新的功能比如头部压缩、服务器推送和多路复用等。</p><p>在 HTTP 协议中，当服务器接收到客户端的请求后，会返回一个状态码作为响应。这些状态码有不同的范围，表示不同类型的信息。例如：</p><ul><li><strong>1xx</strong> (信息性状态码)：表示接收到请求，还在处理中。</li><li><strong>2xx</strong> (成功状态码)：表示请求成功被服务器接收、理解并处理。</li><li><strong>3xx</strong> (重定向状态码)：告诉客户端需要采取进一步的操作才能完成请求。</li><li><strong>4xx</strong> (客户端错误状态码)：表示请求包含错误或无法被执行。</li><li><strong>5xx</strong> (服务器错误状态码)：表示服务器在尝试处理请求时发生了错误。</li></ul><p><code>ERR_HTTP2_INVALID_INFO_STATUS</code>错误指的是，在使用 HTTP/2 协议时，如果服务器尝试发送的信息性状态码不正确，Node.js 就会抛出这类错误。信息性状态码是指那些以 1 开头的状态码，如 100 (Continue) 或 103 (Early Hints)。这些状态码通常用于在最终响应之前给予客户端一些初步信息。</p><p>举例来说：</p><ol><li><p>假设你正在使用 Node.js 编写一个 HTTP/2 服务器，而你想在发送最终响应前，向客户端发送一个 100 (Continue) 状态码提示客户端继续发送请求的剩余部分。如果你因为某种原因错误地尝试发送一个非标准的 1xx 状态码，如 190 (这是不存在的)，Node.js 就会抛出<code>ERR_HTTP2_INVALID_INFO_STATUS</code>错误。</p></li><li><p>另一个例子，如果你正在处理一个上传文件的请求，并且想要通过 103 (Early Hints) 状态码来提前发送一些响应头给客户端，以便它们可以开始加载需要的资源。如果你错误地发送了一个如 120 的状态码（这同样是不存在的状态码），那么 Node.js 也会报出<code>ERR_HTTP2_INVALID_INFO_STATUS</code>错误。</p></li></ol><p>处理这个错误的方法是确保你发送的是正确的信息性状态码，并且这些状态码适用于你所使用的场景。如果你看到这个错误，你就需要检查你的代码，找出发送了错误状态码的地方，并将其修正为合法的 1xx 状态码。</p><h3 id="err-http2-invalid-origin" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-origin"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_origin" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_ORIGIN</a></span></a></h3><p><code>ERR_HTTP2_INVALID_ORIGIN</code> 是 Node.js 中一个专门针对 HTTP/2 协议的错误类型。在讨论这个错误之前，我们需要先了解什么是 HTTP/2 和 Origin。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，比它的前身 HTTP/1.x 更高效、更快速。它引入了一些新特性，比如头部压缩、多路复用等，所有这些都旨在提高网页加载速度并减少延迟。</p><p>Origin 通常指的是发起一个网络请求的地方，在 Web 应用中，通常由协议（如 http, https）、域名和端口三部分组成。例如，如果你的浏览器访问<code>https://www.example.com:443/path</code>，那么这个 URL 的 origin 就是<code>https://www.example.com:443</code>。</p><p>现在，让我们来看看<code>ERR_HTTP2_INVALID_ORIGIN</code>这个错误。在 HTTP/2 上下文中，如果服务器接收到一个请求，其中包含了无效或不被允许的 Origin 头部值，可能会触发这种错误。这意味着原始的发送源与服务器期望的不匹配，或者以某种方式被认为是不正确的。这个检查是出于安全考虑，以确保跨源请求（cross-origin requests）符合预期，并防止潜在的恶意行为。</p><p>实际运用例子：</p><ol><li><p>跨域资源共享（CORS）问题：如果你开发了一个网站，该网站向另一个域名提供的 API 服务器发送请求，而服务器端没有适当配置 CORS 策略来接受来自你网站域名的请求，就可能遇到<code>ERR_HTTP2_INVALID_ORIGIN</code>错误。</p></li><li><p>配置问题：如果你在使用 Node.js 作为你的 HTTP/2 服务器时错误地配置了允许列表或反向代理设置，使得某些合法的 origin 被错误地拒绝，也可能抛出<code>ERR_HTTP2_INVALID_ORIGIN</code>错误。</p></li><li><p>Web 开发中的跨站点脚本编写（XSS）攻击或其他安全漏洞可能会尝试伪造 origin，服务器识别到异常的 origin 并拒绝响应，从而抛出<code>ERR_HTTP2_INVALID_ORIGIN</code>错误作为一种安全措施。</p></li></ol><p>处理这个错误的关键在于确认服务器端的 HTTP/2 配置是否正确允许了合法的 origin 或者更新服务器端的 CORS 策略，以确保只有合法和安全的请求能够被接收和处理。</p><h3 id="err-http2-invalid-packed-settings-length" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-packed-settings-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_packed_settings_length" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_PACKED_SETTINGS_LENGTH</a></span></a></h3><p>Node.js 中的 <code>ERR_HTTP2_INVALID_PACKED_SETTINGS_LENGTH</code> 是一个错误标识，它指示在使用 HTTP/2 协议通信时发生了一个具体的问题。为了理解这个错误，我们需要先简单了解一下 HTTP/2 和 Node.js 中的设置。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它旨在改善网络性能，提供更优的页面加载速度和响应时间。在 HTTP/2 中，有一个概念叫做“设置”（Settings），这是在建立连接时两端互相交换的参数集合，用来告知对方一些关键的通信参数，比如可以发送的最大帧大小等。</p><p>在 Node.js 中实现 HTTP/2 时，有一段二进制数据被称为“打包设置”（Packed Settings）。这块数据包含了多个设置参数，每个参数都有其自己的标识符和值。</p><p>那么什么是 <code>ERR_HTTP2_INVALID_PACKED_SETTINGS_LENGTH</code> 错误呢？当 Node.js 解析来自客户端或服务器的打包设置时，如果发现这段打包设置的长度不正确，就会抛出这个错误。长度可能不正确的原因包括：</p><ul><li>打包设置的数据不完整。</li><li>打包设置的格式错误。</li><li>打包设置的长度与实际接收到的数据长度不一致。</li></ul><p>举个例子，假设一个客户端尝试与 Node.js 服务器建立 HTTP/2 连接，并发送了打包设置信息。服务器在解析这些设置时发现数据长度不符合预期，这就可能导致 <code>ERR_HTTP2_INVALID_PACKED_SETTINGS_LENGTH</code> 错误的产生。</p><p>具体到你看到的这个错误，这意味着在 Node.js 应用程序中处理 HTTP/2 通信时，代码需要妥善处理打包设置的解析，确保长度准确，否则就会遇到这类错误。</p><p>解决这个问题通常需要检查发送打包设置的代码部分，确保发送的数据格式和长度是正确的。如果你是使用第三方库或框架，可能需要查看该库的文档或寻求维护者的帮助来确定正确的使用方式。</p><h3 id="err-http2-invalid-pseudoheader" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-pseudoheader"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_pseudoheader" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_PSEUDOHEADER</a></span></a></h3><p><code>ERR_HTTP2_INVALID_PSEUDOHEADER</code> 是 Node.js 中的一个错误代码，特别与 HTTP/2 协议有关。在解释这个错误之前，我会先简单介绍一下 HTTP/2 和伪头字段（pseudoheader）的概念。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它旨在提高网页加载速度，优化用户体验，并改善网络通信的效率。HTTP/2 引入了一些新特性，比如头部压缩、服务器推送、请求/响应多路复用等。</p><p>在 HTTP/2 中，伪头字段是特殊的头部字段，它们以冒号 (&quot;😊 开头，并包含了对于建立和管理请求非常关键的信息。典型的伪头字段包括：</p><ul><li><code>:method</code>: 这指明了请求的方法（比如 GET 或 POST）。</li><li><code>:scheme</code>: 这指出了使用的协议（通常是 https 或者 http）。</li><li><code>:authority</code>: 这通常包含了请求目标的域名和端口。</li><li><code>:path</code>: 这指出了请求的具体路径或参数。</li></ul><p>当你在 Node.js 中使用内置的 HTTP/2 模块来处理 HTTP/2 请求时，如果发送到服务器的请求中包含无效的伪头字段，就有可能会触发 <code>ERR_HTTP2_INVALID_PSEUDOHEADER</code> 错误。这种情况下，无效可能意味着某个伪头字段不符合规定的格式，被重复发送，或者在请求中出现了不该出现的额外伪头字段。</p><p>举一个实际例子来说，假设我们正在编写一个 Node.js 应用程序，使用 HTTP/2 来处理请求。以下代码尝试手动构造一个请求并将其发送给服务器，但由于使用了一个不正确的伪头字段，因此会抛出 <code>ERR_HTTP2_INVALID_PSEUDOHEADER</code> 错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建客户端会话</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 构造请求头，错误地添加了一个自定义的伪头字段 &#39;:custom&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> reqHeaders</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:scheme</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:authority</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:custom</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这是错误的！不允许自定义伪头字段。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发起请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">reqHeaders</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 如果伪头字段无效，将捕获到 ERR_HTTP2_INVALID_PSEUDOHEADER 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 处理响应等其他逻辑…</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 结束请求</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们错误地添加了一个名为 <code>:custom</code> 的伪头字段，这不是 HTTP/2 规范中定义的有效伪头字段。正确使用 HTTP/2 时，我们只能使用规范定义的伪头字段。一旦我们添加了非法的伪头字段，Node.js 将抛出 <code>ERR_HTTP2_INVALID_PSEUDOHEADER</code> 错误。</p><p>解决这个问题的办法是删除所有不合规范的伪头字段，确保每个请求都遵守 HTTP/2 的标准。这样，我们的应用程序就可以正常地使用 HTTP/2 功能，而不会遇到类似的错误。</p><h3 id="err-http2-invalid-session" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-session"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_session" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_SESSION</a></span></a></h3><p><code>ERR_HTTP2_INVALID_SESSION</code>是一个错误类型，它在 Node.js 中专门用于 HTTP/2 功能。HTTP/2 是一种网络通信协议，它是 HTTP/1.1 的继承者，提供了更高的效率、更低的延迟和额外的新特性。在使用 Node.js 的 HTTP/2 模块时，如果遇到了一个无效或已经关闭的会话（session），就可能会抛出这个错误。</p><p>在 HTTP/2 中，&quot;会话&quot;指的是客户端和服务器之间的一条连接，其中可以传输多个请求和响应，而不需要每次都建立一个新连接。会话可以实现资源的复用，降低开销。</p><p>举个例子：</p><p>假设你正在写一个 Node.js 的程序，想要用 HTTP/2 去访问一个网站或服务。你可能会像这样开始创建一个 HTTP/2 的客户端：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2客户端</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用这个客户端发起请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听响应事件</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> flags</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 收集数据</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 结束请求</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">请求已结束</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 关闭客户端会话</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在正常情况下，这段代码可以顺利执行。但如果在你尝试用客户端发送请求或操作会话的时候，这个会话因某种原因（比如网络问题或服务器关闭了连接）已经无效或关闭了，此时 Node.js 就会抛出<code>ERR_HTTP2_INVALID_SESSION</code>错误。</p><p>为了处理这个错误，你可以监听&#39;error&#39;事件，并且添加相应的错误处理逻辑：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_INVALID_SESSION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">会话无效或已关闭</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里可以写一些逻辑来重试连接或者其他恢复策略</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，正确处理各种错误是非常重要的，这可以让你的程序更加稳定和健壮，能够应对可能出现的各种异常情况。</p><h3 id="err-http2-invalid-setting-value" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-setting-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_setting_value" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_SETTING_VALUE</a></span></a></h3><p><code>ERR_HTTP2_INVALID_SETTING_VALUE</code> 是 Node.js 中的一个错误类型，它专门用于 HTTP/2 协议中出现的设置错误。在你提到的 Node.js v21.7.1 版本中，这个错误表示当你尝试配置 HTTP/2 连接的相关设置时，给定了不合法或无效的值。</p><p>HTTP/2 是一种网络传输协议，是 HTTP/1.x 的后继版本，旨在提高网页加载速度、优化用户体验和改善网络安全。HTTP/2 引入了一些新的概念如流、帧和设置，来控制连接的各种方面。</p><p>设置（Settings）在 HTTP/2 中指的是一组键值对，用来告知对端如何处理当前的连接。这些设置可以包括例如：</p><ul><li><code>SETTINGS_MAX_CONCURRENT_STREAMS</code>: 控制同时打开的最大流数量。</li><li><code>SETTINGS_INITIAL_WINDOW_SIZE</code>: 确定流控制窗口的初始大小。</li><li>等等。</li></ul><p>每个设置都有其规定的有效值范围。如果你在编程时设定了超出范围的值，或者是完全不允许的值，Node.js 就会抛出 <code>ERR_HTTP2_INVALID_SETTING_VALUE</code> 错误。</p><p>举个实际的例子，假设我们正在使用 Node.js 的 <code>http2</code> 模块创建一个 HTTP/2 服务器，并且我们想要设置最大并行流的数量。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置 HTTP/2 连接选项</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  settings</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设我们错误地设置了一个非法的值，</span></span>
<span class="line"><span style="color:#616E88;">    // 比如设置最大并发流的数量为 99999999（可能超过了规定的最大值）</span></span>
<span class="line"><span style="color:#88C0D0;">    maxConcurrentStreams</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 99999999</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听请求事件</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，如果 <code>maxConcurrentStreams</code> 设定的值超过了规定的最大值，那么 Node.js 就会触发一个 <code>ERR_HTTP2_INVALID_SETTING_VALUE</code> 错误。因此，作为开发者，你需要确保你对每个设置的理解正确，并且按照文档或规范提供的有效范围去配置它们。</p><p>如果遇到这个错误，通常的解决办法就是查阅 HTTP/2 的相关文档或者 Node.js 的官方文档，确认你设定的值是否在允许的范围内，然后适当地调整它们。</p><h3 id="err-http2-invalid-stream" tabindex="-1"><a class="header-anchor" href="#err-http2-invalid-stream"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_invalid_stream" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INVALID_STREAM</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它允许你在服务器端运行 JavaScript。在 Node.js 中，HTTP/2 是一种网络通信协议，用于替代旧版本的 HTTP/1.x 协议。HTTP/2 提供了更高效的网页加载方式，因为它支持数据流的多路复用、服务器推送等特性。</p><p><code>ERR_HTTP2_INVALID_STREAM</code> 是一个错误类型，在 Node.js 的 HTTP/2 模块中可能会遇到。这个错误表示操作被执行在了一个非法或无效的数据流上。在 HTTP/2 协议中，数据流（stream）是一种虚拟信道，可以承载双向消息传输。每个数据流都有一个唯一标识符，如果你尝试对一个不存在或已经关闭的数据流进行操作，就可能触发 <code>ERR_HTTP2_INVALID_STREAM</code> 错误。</p><p>例如，当你使用 Node.js 的 HTTP/2 客户端或服务器时，如果你试图发送数据到一个已经结束了的数据流，就会引发这个错误。</p><p>以下是一些可能导致 <code>ERR_HTTP2_INVALID_STREAM</code> 错误的场景：</p><p><strong>客户端示例：</strong></p><p>假设你正在编写一个 Node.js 应用，该应用使用 HTTP/2 客户端与服务器通信。你创建了一个新的请求发送到服务器，但在请求完成之前，由于某种原因，这个数据流被提前关闭了。如果你此时还试图往这个数据流发送数据，将会收到 <code>ERR_HTTP2_INVALID_STREAM</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 客户端</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置数据接收</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 结束请求</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设出于某种原因数据流被提前关闭了，接下来尝试发送更多数据</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能会引发 ERR_HTTP2_INVALID_STREAM 如果数据流已关闭</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_INVALID_STREAM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Tried to write to an invalid stream!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>服务器端示例：</strong></p><p>如果你在 Node.js 服务器端使用 HTTP/2 并且试图往一个客户端已经关闭的连接写入数据，也会遇到这个错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 处理进来的流</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设客户端关闭了流，服务端仍尝试写入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_INVALID_STREAM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Tried to respond to an invalid stream!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，为了防止这种错误的发生，开发者需要确保在数据流结束之后不再对其执行任何操作，并且妥善处理错误事件。通过监听数据流的状态变化和错误事件，你可以更加稳健地管理数据流的生命周期，从而避免 <code>ERR_HTTP2_INVALID_STREAM</code> 等错误。</p><h3 id="err-http2-max-pending-settings-ack" tabindex="-1"><a class="header-anchor" href="#err-http2-max-pending-settings-ack"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_max_pending_settings_ack" target="_blank" rel="noopener noreferrer">ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</a></span></a></h3><p><code>ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</code>是一个专门针对 HTTP/2 通信协议的错误类型。在 Node.js 中，当你使用 HTTP/2 模块建立服务器或客户端时，会用到这个协议。为了理解这个错误，我们需要简要地了解一下 HTTP/2 和其中的&quot;Settings&quot;帧。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它引入了很多新特性，比如头部压缩、服务器推送、请求优先级以及多路复用（允许多个请求在同一个连接上并行传输）。这些特性试图提高网页加载效率，减少延迟。</p><p>在 HTTP/2 协议中，&quot;Settings&quot;帧是用于交换连接配置参数的一种控制帧。当两个端点（服务器和客户端）开始通信时，它们会互相发送&quot;Settings&quot;帧来告知对方自己的偏好和限制。例如，它们可以设定最大并发流数、初始窗口大小等参数。</p><p>现在，让我们回到<code>ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</code>错误。这个错误会在以下情况发生：</p><p>在 HTTP/2 连接中，当一个端点发送了&quot;Settings&quot;帧后，它期望另一个端点回复一个带有确认标志的&quot;Settings&quot;帧，表示已经接收并应用了这些设置。但如果发送了太多的未被确认的&quot;Settings&quot;帧，就会触发<code>ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</code>错误。这是因为 Node.js HTTP/2 实现中规定了一个上限，超过这个上限就认为是异常行为，可能是由于编程错误或者潜在的拒绝服务攻击。</p><h3 id="实际运用的例子-9" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-9"><span>实际运用的例子</span></a></h3><p>考虑到你是编程新手，让我们来看一些简化的代码例子。在真实场景中，你可能不会直接处理这个错误，因为它通常涉及到更深层次的 HTTP/2 协议交互，但了解它是怎样发生的可以帮助进行调试。</p><p>假设有一个 Node.js HTTP/2 服务器，代码可能是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">太多未确认的Settings帧！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们创建了一个 HTTP/2 服务器，监听端口 3000。服务器有一个错误监听器，专门检查<code>ERR_HTTP2_MAX_PENDING_SETTINGS_ACK</code>错误，并打印出一个相关消息。</p><p>正常情况下，你不应该遇到这个错误，除非在 HTTP/2 通信过程中有什么意外行为。如果确实发生了，通常意味着需要检查客户端或服务端的 HTTP/2 实现，确保它们正确处理&quot;Settings&quot;帧的确认机制。</p><h3 id="err-http2-nested-push" tabindex="-1"><a class="header-anchor" href="#err-http2-nested-push"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_nested_push" target="_blank" rel="noopener noreferrer">ERR_HTTP2_NESTED_PUSH</a></span></a></h3><p>首先，为了理解<code>ERR_HTTP2_NESTED_PUSH</code>错误，我们需要先了解 HTTP/2 协议中的服务器推送(Server Push)功能，以及在 Node.js 中如何使用这一特性。</p><p><strong>HTTP/2 服务器推送（Server Push）简介：</strong><br> HTTP/2 服务器推送是一种性能优化技术，允许服务器在发送客户端请求的响应同时，主动发送额外资源（比如 CSS、JavaScript 文件或图片），即使客户端没有明确请求这些资源。这样做的好处是可以减少延迟，提高页面加载速度，因为不需要等待客户端逐一请求所有资源。</p><p><strong>Node.js 中的 HTTP/2 和服务器推送使用：</strong><br> 在 Node.js 中使用 HTTP/2 通常涉及到创建一个 HTTP/2 服务器，然后利用它来处理请求并根据需要推送资源。</p><p>例子 - 创建一个 HTTP/2 服务器，并使用服务器推送发送一个 CSS 文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取SSL证书</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server.key</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server.cert</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">serverOptions</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 向客户端推送style.css文件</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> pushStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pushStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/style.css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">        throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 设置要推送的资源内容类型和其他头信息</span></span>
<span class="line"><span style="color:#D8DEE9;">    pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respondWithFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">style.css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 响应主请求</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html; charset=utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &#39;</span><span style="color:#A3BE8C;">`&lt;`html&gt;`&lt;`head&gt;`&lt;`link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot;&gt;`&lt;`/head&gt;`&lt;`body&gt;Hello World`&lt;`/body&gt;`&lt;`/html&gt;</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8443</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，当一个客户端请求根路径 <code>/</code> 的时候，除了发送常规的</p><h3 id="err-http2-no-mem" tabindex="-1"><a class="header-anchor" href="#err-http2-no-mem"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_no_mem" target="_blank" rel="noopener noreferrer">ERR_HTTP2_NO_MEM</a></span></a></h3><p><code>ERR_HTTP2_NO_MEM</code> 是一个错误码，表示在 Node.js 中使用 HTTP/2 时遇到了内存问题。HTTP/2 是一种网络通信协议，用于改进网页和服务器之间的数据传输效率。</p><p>在 Node.js 的上下文中，当你尝试建立或操作一个 HTTP/2 连接时，如果 Node.js 检测到内存不足以完成这个操作，就可能抛出 <code>ERR_HTTP2_NO_MEM</code> 错误。这个错误意味着 Node.js 在尝试分配内存给 HTTP/2 的相关操作（比如打开一个新的连接、发送数据等）时失败了。</p><p>这里举几个实际运用的例子：</p><ol><li><strong>创建 HTTP/2 服务器：</strong> 当你使用 Node.js 创建一个 HTTP/2 服务器时，服务器需要为每个新的连接分配内存。如果系统内存耗尽，创建新连接的尝试可能会触发 <code>ERR_HTTP2_NO_MEM</code> 错误。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_NO_MEM</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">内存分配失败：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p><strong>处理大量并发连接：</strong> 如果你的服务器正在处理大量并发的 HTTP/2 请求，那么随着连接数增加，服务器消耗的内存也会增加。当系统可用内存低于某个阈值时，处理新请求可能会导致 <code>ERR_HTTP2_NO_MEM</code> 错误。</p></li><li><p><strong>流控制：</strong> HTTP/2 使用流控制机制来平衡数据传输速度。如果服务器因为内存不足无法对数据流进行适当的管理，你可能会看到 <code>ERR_HTTP2_NO_MEM</code> 错误。</p></li></ol><p>解决 <code>ERR_HTTP2_NO_MEM</code> 错误的方法可能包括增加服务器的内存容量、优化应用程序以减少内存使用、或者实施更好的负载均衡策略来分散请求压力。</p><h3 id="err-http2-no-socket-manipulation" tabindex="-1"><a class="header-anchor" href="#err-http2-no-socket-manipulation"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_no_socket_manipulation" target="_blank" rel="noopener noreferrer">ERR_HTTP2_NO_SOCKET_MANIPULATION</a></span></a></h3><p>我很乐意为你解释这个错误。</p><p>在 Node.js 中，<code>ERR_HTTP2_NO_SOCKET_MANIPULATION</code> 是一个特定于 HTTP/2 协议的错误代码。在理解这个错误之前，让我们先来快速了解一下 HTTP/2 和它与 HTTP/1.x 的一些主要不同点。</p><p>HTTP/2 是互联网上用于客户端和服务器通信的新一代 HTTP 协议，它带来了一些性能优化，例如多路复用（同时发送多个请求和响应），头部压缩等。HTTP/2 也试图减少延迟，并允许服务器推送资源到客户端。</p><p>现在，<code>ERR_HTTP2_NO_SOCKET_MANIPULATION</code> 错误发生在使用 Node.js 的 HTTP/2 模块时尝试执行某些在 HTTP/1.x 中可能有效但在 HTTP/2 中不被允许的操作。具体来说，这涉及到对底层 socket 连接的直接操作。</p><p>在 HTTP/1.x 中，每个请求和响应都通过一个单独的 TCP 连接发送。这意味着如果你有对原始 socket 的引用，你可以对其进行操作，比如关闭连接、暂停数据的读取等。</p><p>而在 HTTP/2 中，情况就完全不同了。因为使用了多路复用技术，多个请求和响应可以在同一个 TCP 连接上并行处理。如果你试图像在 HTTP/1.x 中那样操作底层 socket，可能会导致整个连接上的所有请求/响应都受到影响，这显然是不可取的。</p><p>当你在 Node.js 中使用 HTTP/2 模块尝试进行这样的操作时，Node.js 会抛出<code>ERR_HTTP2_NO_SOCKET_MANIPULATION</code>错误，以防止潜在的破坏性行为。</p><p>下面举一个简单的例子来说明：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2服务</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // stream是HTTP/2中处理请求和响应的对象</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设我们想直接操作socket，比如：</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">session</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 这会尝试结束整个TCP连接，而不仅仅是当前的请求/响应。</span></span>
<span class="line"><span style="color:#616E88;">  // 在HTTP/2中，这是不允许的，因此你会收到ERR_HTTP2_NO_SOCKET_MANIPULATION错误。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如何避免这种错误呢？通常，在使用 HTTP/2 模块时，你应该使用该模块提供的接口，而不是直接对 socket 进行操作。HTTP/2 模块已经设计得足够健壮，能够正确处理多路复用和其他 HTTP/2 的特性，因此直接操作 socket 是不必要的，也是不安全的。</p><h3 id="err-http2-origin-length" tabindex="-1"><a class="header-anchor" href="#err-http2-origin-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_origin_length" target="_blank" rel="noopener noreferrer">ERR_HTTP2_ORIGIN_LENGTH</a></span></a></h3><p><code>ERR_HTTP2_ORIGIN_LENGTH</code>是 Node.js 中的一个错误代码，它与 HTTP/2 协议的实现有关。在解释这个错误之前，我们需要理解一些基础知识。</p><p>HTTP/2 是互联网数据传输的一种新协议，相比于旧版本的 HTTP/1.x，它具有许多优势，比如可以同时发送多个请求和响应，减少了延迟，并且可以更有效地使用网络资源。</p><p>在 HTTP/2 中，有一个概念叫“Origin Frame”。Origin Frame 用于指示同一连接中可以提供服务的 URI（统一资源标识符）集。简单来说，就是告诉客户端，这个连接可以用来访问哪些网址的内容。</p><p>现在，让我们回到你问的<code>ERR_HTTP2_ORIGIN_LENGTH</code>错误。这个错误发生时，意味着在尝试建立 HTTP/2 连接并且发送原始帧时，原始帧里面包含的数据长度不正确。按照规范，原始帧的数据必须是一个或多个可变长度的字符串，代表 origin 的 URI。如果服务器发送了一个格式不对的原始帧，客户端就会收到这个错误。</p><p>实际例子：</p><p>想象你在管理一个支持 HTTP/2 的 Web 服务器。当一个客户端（例如浏览器）通过 HTTP/2 与服务器建立连接后，服务器想要告诉客户端它可以为哪些网站提供服务。如果因为某种原因服务器发送了一个格式错误的 origin 帧（可能是程序员编码时的一个 bug 导致），比如说 origin 的 URI 长度字段不正确，那么客户端将无法理解这个帧的内容，并显示<code>ERR_HTTP2_ORIGIN_LENGTH</code>错误。用户可能会看到一个错误信息，而无法成功加载网页。</p><p>修复这个错误通常需要检查和更新服务器端的代码，确保发送的 origin 帧符合 HTTP/2 协议的要求。</p><h3 id="err-http2-out-of-streams" tabindex="-1"><a class="header-anchor" href="#err-http2-out-of-streams"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_out_of_streams" target="_blank" rel="noopener noreferrer">ERR_HTTP2_OUT_OF_STREAMS</a></span></a></h3><p><code>ERR_HTTP2_OUT_OF_STREAMS</code> 是一个错误码，它表示在使用 Node.js 中的 HTTP/2 协议时出现了流资源耗尽的问题。HTTP/2 是一种网络传输协议，它被设计为比旧版的 HTTP/1.x 更高效，能够更好地处理多个请求。</p><p>在 HTTP/2 中，&quot;流&quot;（stream）是通信的基本单位。每个流都代表了一个单独的双向数据流通道，可以用来发送和接收数据。客户端和服务器之间可以同时打开多个流，而不需要像 HTTP/1.x 那样一次只能处理一个请求（称为 head-of-line blocking）。</p><p>然而，HTTP/2 也有一些限制。其中之一就是同一时间内打开的流的数量是有上限的。这个上限可以由服务器设置，并且在客户端和服务器初次握手时告知客户端。当客户端或服务器试图超过这个上限创建更多的流时，就会触发 <code>ERR_HTTP2_OUT_OF_STREAMS</code> 错误。</p><p>举个实际例子：</p><p>假设你正在运行一个 Node.js 的 HTTP/2 服务器，这个服务器配置为最多允许同时存在 100 个活跃的流。当第 101 个流试图建立时，如果没有其他流关闭来腾出空间，那么就会出现 <code>ERR_HTTP2_OUT_OF_STREAMS</code> 错误。</p><p>示例代码可能如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 服务器实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // stream 是一个新的 HTTP/2 流</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设我们对流进行了某些操作，可能会造成流的数量超出限制</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 当 ERR_HTTP2_OUT_OF_STREAMS 错误发生时，我们需要在这里处理它</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_OUT_OF_STREAMS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">已经达到了最大流数限制！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 正常情况下，我们将响应发送回客户端</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听特定的端口启动服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们创建了一个简单的 HTTP/2 服务器，并在每个新流（<code>stream</code>）上设置了事件监听器。如果在某个流上出现了任何错误，我们就会检查它是否是因为 <code>ERR_HTTP2_OUT_OF_STREAMS</code> 而出错，并相应地输出一个错误信息。</p><p>解决方法通常包括优化应用程序逻辑以减少并发流的数量，关闭不活跃的流，或者增加服务器配置的流数量上限。</p><p>请注意，示例仅用于演示如何处理 <code>ERR_HTTP2_OUT_OF_STREAMS</code> 错误，实际应用中还需要考虑安全性、错误处理、性能优化等许多其他方面。</p><h3 id="err-http2-payload-forbidden" tabindex="-1"><a class="header-anchor" href="#err-http2-payload-forbidden"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_payload_forbidden" target="_blank" rel="noopener noreferrer">ERR_HTTP2_PAYLOAD_FORBIDDEN</a></span></a></h3><p>Node.js 中的 <code>[ERR_HTTP2_PAYLOAD_FORBIDDEN]</code> 是一种特定于 HTTP/2 协议的错误。在了解这个错误之前，我们需要先简要了解一下 HTTP/2 和它与 HTTP/1.x 的区别，以及什么是“payload”。</p><p>HTTP/2 是互联网用于传输网页数据的协议的第二个主要版本，它旨在提高效率、减少延迟并允许更多并行请求。与 HTTP/1.x 相比，HTTP/2 引入了新的概念，例如流（Streams）和帧（Frames），这些都是用来在客户端和服务器之间高效地传送数据的。</p><ul><li><strong>流</strong>：一个双向字节流，可以承载一个或多个消息。</li><li><strong>帧</strong>：HTTP/2 协议中的最小通信单位，每个帧都属于某个特定的流，并且携带不同类型的数据，如请求头（HEADERS frame）、请求体（DATA frame）等。</li></ul><p>现在让我们理解什么是 Payload：</p><ul><li><strong>Payload</strong>：通常指的是传输过程中携带的实际数据部分。例如，在 HTTP 请求中，Payload 就是客户端发送给服务器的数据本身，比如 POST 请求的表单数据。</li></ul><p>那么，<code>[ERR_HTTP2_PAYLOAD_FORBIDDEN]</code> 错误是什么意思呢？</p><p>在 HTTP/2 中，有些情况下，发送某些类型的 Payload 是不被允许的。这可能是因为采用了特定的设置或者是因为遵循了协议规范的限制。如果你的 Node.js 应用程序尝试在这些不允许的情况下发送 Payload，就会触发 <code>ERR_HTTP2_PAYLOAD_FORBIDDEN</code> 错误。</p><p>让我们举个例子：</p><p>假设你有一个使用 HTTP/2 的 Node.js 服务器，当客户端发送一个 GET 请求时，按照 HTTP/2 的规范，GET 请求不应携带 Payload（即请求体）。如果你的服务器尝试向一个 GET 请求响应时包含 Payload，就可能抛出 <code>ERR_HTTP2_PAYLOAD_FORBIDDEN</code> 错误，因为这违反了 HTTP/2 协议的规则。</p><p>代码示例（可能导致错误的伪代码）:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试向 GET 请求发送 Payload</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这里是不允许的 payload 数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这段代码中，服务器接收到 GET 请求后尝试发送带有 Payload 的响应，这可能会引发 <code>ERR_HTTP2_PAYLOAD_FORBIDDEN</code> 错误。</p><p>总结一下，<code>[ERR_HTTP2_PAYLOAD_FORBIDDEN]</code> 就是当你的 Node.js 应用程序试图在 HTTP/2 协议不允许的情况下发送数据时，Node.js 抛出的一种错误。处理这类错误的方法通常涉及确保应用程序的行为符合 HTTP/2 标准。</p><h3 id="err-http2-ping-cancel" tabindex="-1"><a class="header-anchor" href="#err-http2-ping-cancel"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_ping_cancel" target="_blank" rel="noopener noreferrer">ERR_HTTP2_PING_CANCEL</a></span></a></h3><p>在解释 <code>ERR_HTTP2_PING_CANCEL</code> 错误之前，我们需要弄清楚几个概念：Node.js、HTTP/2 协议和 PING 帧。</p><p><strong>Node.js</strong> 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境。它使得可以在服务器端运行 JavaScript 代码，常用于构建网络应用程序。</p><p><strong>HTTP/2</strong> 是一种网络传输协议，它是 HTTP 协议的第二个主要版本，旨在改进数据传输性能和效率。与 HTTP/1.x 相比，HTTP/2 引入了多路复用、流控制、头部压缩等新特性。</p><p><strong>PING 帧</strong> 在 HTTP/2 协议中是一种特殊的帧类型，用来检测连接是否处于活动状态。发送方会发送一个 PING 请求，接收方收到后通常会回送一个相应的 PING 响应。这种机制可以用来测量往返时间或者保持连接不被自动关闭。</p><p>现在让我们来看 <code>ERR_HTTP2_PING_CANCEL</code> 这个错误：</p><p>在 Node.js 中使用 HTTP/2 模块时，你可以发起一个 PING 帧来检查 HTTP/2 连接的活跃性。如果出于某种原因，你决定取消这个 PING 请求，Node.js 就会抛出一个 <code>ERR_HTTP2_PING_CANCEL</code> 错误。</p><p>这里是一个简化的例子，说明如何在 Node.js 中使用 HTTP/2 并可能触发这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 客户端</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://yourserver.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ping</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> duration</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> payload</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_PING_CANCEL</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">PING 请求被取消</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">PING 请求失败</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">PING RTT: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ms</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设在某个条件下，我们想要取消 PING 请求</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">someCondition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 这将导致 &#39;ERR_HTTP2_PING_CANCEL&#39; 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 关闭客户端并取消所有正在进行的请求，包括 PING</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>client.ping()</code> 方法用于向服务器发送一个 PING 请求。如果在得到响应之前客户端被销毁（比如调用了 <code>client.destroy()</code>），那么正在进行的 PING 请求就会被取消，并且会触发 <code>ERR_HTTP2_PING_CANCEL</code> 错误。</p><p>在实际的应用程序中，你应当正确处理这种情况，确保即使 PING 被取消，程序的其他部分也能正常工作。例如，在销毁客户端之前，你可以先等待正在进行的操作完成，或者根据业务逻辑选择合适的时机进行取消。</p><h3 id="err-http2-ping-length" tabindex="-1"><a class="header-anchor" href="#err-http2-ping-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_ping_length" target="_blank" rel="noopener noreferrer">ERR_HTTP2_PING_LENGTH</a></span></a></h3><p><code>[ERR_HTTP2_PING_LENGTH]</code> 是 Node.js 中的一个错误码，它与 HTTP/2 协议相关。HTTP/2 是一个网络通信协议，它是 HTTP 协议的第二个主要版本，并且在性能上做了很多改进。</p><p>在 HTTP/2 中，&quot;PING&quot; 框架用于测量最小往返时间或检查连接是否仍然有效。这个 &quot;PING&quot; 消息由一个固定长度的负载组成，其长度必须是 8 字节。</p><p>如果你在使用 HTTP/2 并尝试发送一个 PING 帧，但是你设置的负载长度不是 8 字节，Node.js 就会抛出 <code>[ERR_HTTP2_PING_LENGTH]</code> 错误。</p><p>举个例子，想象一下你正在编写一个 Node.js 应用程序，该程序使用 HTTP/2 协议与其他服务进行通信。你可能有以下代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 准备一个非 8 字节长的负载</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> payload</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">12345</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 只有 5 字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ping</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">payload</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> duration</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> payload</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Ping round-trip time: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ms</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上代码中，我们尝试通过 <code>ping</code> 方法发送一个 5 字节长的负载，但是 HTTP/2 规范要求这个负载必须是 8 字节。因此，当这段代码运行时，Node.js 将会抛出一个 <code>[ERR_HTTP2_PING_LENGTH]</code> 错误，错误消息将会表明负载的长度是错误的。</p><p>为了修复这个错误，你需要确保发送的负载正好是 8 字节长：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 修改后的正确的 8 字节长的负载</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> correctPayload</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">12345678</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 现在是 8 字节</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ping</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">correctPayload</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> duration</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> payload</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Ping round-trip time: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">ms</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修改后的代码中，我们创建了一个正确长度的负载，并再次尝试发送 PING。既然负载大小正确，Node.js 就不会抛出 <code>[ERR_HTTP2_PING_LENGTH]</code> 错误了。</p><h3 id="err-http2-pseudoheader-not-allowed" tabindex="-1"><a class="header-anchor" href="#err-http2-pseudoheader-not-allowed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_pseudoheader_not_allowed" target="_blank" rel="noopener noreferrer">ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</a></span></a></h3><p>好的，让我们一步一步来了解这个错误。</p><p>首先，<code>ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</code>是 Node.js 中与 HTTP/2 协议相关的一个错误代码。在了解这个错误之前，我们需要先简单了解一些 HTTP/2 的基础概念。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它带来了很多改进，比如性能提升、头部压缩等。在 HTTP/2 中，有一类特殊的头部叫做“伪头部（Pseudo-header）”。这些伪头部字段以冒号(<code>:</code>)开头，例如<code>:method</code>, <code>:path</code>, <code>:scheme</code>, <code>:status</code>等。它们用于传递对于 HTTP 请求和响应非常重要的信息，且必须在普通的 HTTP 头部之前发送。</p><p>现在，当你在使用 Node.js 编写 HTTP/2 服务器或客户端时，你可能会遇到<code>ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</code>错误。这个错误表示你尝试发送一个不合法的伪头部，或者在不允许的上下文中发送伪头部。这通常意味着你的代码不符合 HTTP/2 的规则。</p><p>让我们通过几个实际例子来进一步理解这个问题：</p><p><strong>例子 1：在响应中发送不正确的伪头部</strong></p><p>假设你正在编写一个 HTTP/2 服务器，并尝试在响应中自定义<code>:status</code>伪头部：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试在响应中设置一个伪头部</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的做法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，当你尝试使用<code>setHeader</code>方法设置<code>:status</code>伪头部时，会触发<code>ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</code>错误，因为<code>:status</code>是由 HTTP/2 协议自动管理的，不应该手动设置。</p><p><strong>正确的做法</strong>是什么都不做，因为默认情况下 HTTP/2 会处理状态码。</p><p><strong>例子 2：在请求中添加伪头部</strong></p><p>如果你在创建一个 HTTP/2 客户端请求时，试图添加一个不存在的伪头部，也会触发这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://localhost:3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">:custom-pseudoheader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这是不允许的</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>:custom-pseudoheader</code>不是一个有效的伪头部字段。按照 HTTP/2 的规范，你不能随便添加或更改伪头部。因此，当尝试发送请求时，会出现<code>ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</code>错误。</p><p>要解决这些问题，你需要确保遵循 HTTP/2 的标准，只使用规定的伪头部字段，并在正确的时机发送它们。对于想要设置的其他头部信息，应该使用符合 HTTP 标准的头部名称，而不是以冒号开头的伪头部字段。</p><p>总结起来，<code>ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED</code>错误告诉你，你在 HTTP/2 的交互中违反了伪头部的使用规则。当你看到这个错误时，检查你的代码是否正确地使用了伪头部，确保没有添加非法的伪头部，也没有在错误的上下文中使用伪头部。</p><h3 id="err-http2-push-disabled" tabindex="-1"><a class="header-anchor" href="#err-http2-push-disabled"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_push_disabled" target="_blank" rel="noopener noreferrer">ERR_HTTP2_PUSH_DISABLED</a></span></a></h3><p>Node.js v21.7.1 中的<code>ERR_HTTP2_PUSH_DISABLED</code>是一个错误代码，表示尝试使用 HTTP/2 的服务器推送功能，但这个功能已经被禁用了。</p><p>首先，让我们了解一下什么是 HTTP/2 的服务器推送（Server Push）。</p><p>HTTP/2 是一种网络传输协议，它比旧版的 HTTP/1.x 有很多改进，包括头部压缩、多路复用等。其中一个特性叫做“服务器推送”，允许服务器在客户端需要之前主动发送资源给客户端。这可以提高加载网页的速度，因为服务器可以预测客户端接下来会请求什么资源，并提前发送过去，避免了客户端发送额外的请求来获取这些资源。</p><p>然而，有时候服务器推送可能被禁用。这可能是因为配置了相关的安全或性能策略，或者因为某些环境（如某些浏览器或代理服务器）不支持这项功能。</p><p>当你在 Node.js 环境下，尤其是在运行一个使用了 HTTP/2 协议的服务器时，如果你尝试使用服务器推送功能，但服务器推送被禁用了，那么就会抛出<code>ERR_HTTP2_PUSH_DISABLED</code>错误。</p><p>现在让我们举一个实际的例子：</p><p>假设你正在使用 Node.js 创建一个 HTTP/2 服务器，并想要利用服务器推送来提升性能。你的代码可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取证书，因为 HTTP/2 需要使用 HTTPS</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 检查请求的路径</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试推送 another-file.js 给客户端</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pushStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/another-file.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">pushStream</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respondWithFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">路径到another-file.js文件</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 响应 index.html</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respondWithFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">路径到index.html文件</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，考虑到以下情况：</p><ol><li>如果 Node.js 运行时环境或者服务器配置禁用了 HTTP/2 推送。</li><li>如果你的代码尝试执行 <code>stream.pushStream</code> 方法来推送资源。</li></ol><p>在这种情况下，你的服务器将会抛出<code>ERR_HTTP2_PUSH_DISABLED</code>错误，因为你的代码试图进行一个被禁止的操作。</p><p>如何解决这个问题？</p><ul><li>检查你的 Node.js 环境和服务器配置，确认是否故意禁用了推送功能。</li><li>如果你希望启用服务器推送，请按照 Node.js 文档或你的服务器配置说明修改设置。</li><li>如果你决定不使用服务器推送，你应该从代码中移除任何调用 <code>stream.pushStream</code> 的部分。</li></ul><p>这就是<code>ERR_HTTP2_PUSH_DISABLED</code>错误的含义，以及它可能出现在实际编程实践中的情形。</p><h3 id="err-http2-send-file" tabindex="-1"><a class="header-anchor" href="#err-http2-send-file"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_send_file" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SEND_FILE</a></span></a></h3><p><code>ERR_HTTP2_SEND_FILE</code>是 Node.js 中一个具体的错误类型，它与 HTTP/2 协议和文件传输有关。在 Node.js 中，HTTP/2 是一种网络通信协议，它是 HTTP/1.x 版本的进化版，旨在提高网页加载速度，改善用户体验，通过支持多路复用、头部压缩等技术来减少延迟。</p><p>当你在使用 Node.js 的 HTTP/2 模块创建一个服务器，并尝试发送一个文件给客户端时，如果在这个过程中发生了某些特定的错误，Node.js 就会抛出<code>ERR_HTTP2_SEND_FILE</code>错误。这个错误通常表明在使用<code>response.streamFile()</code>或类似方法发送文件时遇到了问题。</p><p>例如，以下是一个简单的使用 HTTP/2 模块发送文件的代码片段：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个HTTP/2服务器实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 获取请求路径</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> reqPath</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 构建要发送的文件绝对路径</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> filePath</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reqPath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 将文件以流的形式发送到客户端</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respondWithFile</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    filePath</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/octet-stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      onError</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">        // 如果在发送文件时发生错误，将会调用此回调</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_SEND_FILE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">          // 特别处理 ERR_HTTP2_SEND_FILE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 500</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Internal Server Error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 404</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Not Found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听端口并启动服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们创建了一个 HTTP/2 服务器并监听了一个事件，该事件会在客户端创建一个新的流（即访问地址）时触发。我们尝试根据请求的路径发送一个文件。如果在发送文件的过程中出现问题 —— 比如文件不存在，没有读取权限，或者其他 IO 错误 —— <code>onError</code>回调函数就会被执行。在这个回调里面，我们检查了错误对象的<code>code</code>属性，如果它等于<code>ERR_HTTP2_SEND_FILE</code>，表示是在发送文件时出现了问题，我们就向客户端返回 500 内部服务器错误状态码和相应的错误信息。</p><p>简而言之，<code>ERR_HTTP2_SEND_FILE</code>是 Node.js 中表示在 HTTP/2 协议下发送文件时遇到问题的错误类型，这个错误需要被妥善处理，比如提供一个错误提示给用户或者记录日志以便开发者调试。</p><h3 id="err-http2-send-file-noseek" tabindex="-1"><a class="header-anchor" href="#err-http2-send-file-noseek"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_send_file_noseek" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SEND_FILE_NOSEEK</a></span></a></h3><p>在 Node.js 中，<code>ERR_HTTP2_SEND_FILE_NOSEEK</code>是一个错误代码，它与 HTTP/2 协议和文件传输有关。要理解这个错误，先来看一下相关的几个概念：</p><ol><li><p><strong>HTTP/2</strong>: 这是一种网络通信协议，相比于之前版本的 HTTP，它提供了更高的效率和速度，支持多路复用、服务器推送等特性。</p></li><li><p><strong>文件发送（File Serving）</strong>: 在 Web 开发中，服务器需要将文件如图片、文档或 JavaScript 文件发送给客户端（即浏览器）。这个过程叫做文件传输或文件服务。</p></li><li><p><strong>Seek 操作</strong>: 当读写文件时，seek 操作允许你在文件中移动到指定位置。例如，如果你想读取文件的中间部分而不是从头开始，你就会使用 seek 操作。</p></li></ol><p>那么，<code>ERR_HTTP2_SEND_FILE_NOSEEK</code>错误是怎么产生的呢？</p><p>在 Node.js 的 HTTP/2 模块中使用文件服务功能时，如果尝试发送一个不支持 seek 操作的文件流，就会遇到<code>ERR_HTTP2_SEND_FILE_NOSEEK</code>错误。这主要出现在某些类型的流上，比如从压缩文件中读取的流或者通过某些加密方法得到的流，因为这些流并不能随意移动到文件的任意位置。</p><p>实际运用举例：</p><p>假设你正在创建一个网站，并使用 Node.js 的 HTTP/2 模块来提供文件服务。如果你尝试用如下方式发送一个文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 不支持seek操作的文件流</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> getNonSeekableFileStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respondWithFile</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    {},</span></span>
<span class="line"><span style="color:#ECEFF4;">    {</span></span>
<span class="line"><span style="color:#88C0D0;">      statCheck</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stats</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">        // 做一些基于文件信息的操作</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#88C0D0;">      onError</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_SEND_FILE_NOSEEK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 500</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">          stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器内部错误：文件无法发送</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      },</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getNonSeekableFileStream</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假定这个函数返回了一个不支持seek操作的流</span></span>
<span class="line"><span style="color:#616E88;">  // 比如从ZIP文件中读取文件流</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们企图使用<code>respondWithFile</code>方法发送一个不支持 seek 操作的文件流。当这种情况发生时，Node.js 会触发<code>ERR_HTTP2_SEND_FILE_NOSEEK</code>错误，然后在<code>onError</code>回调中处理这个错误，向客户端返回一个状态码为 500 的响应，表示内部服务器错误。</p><p>总结起来，<code>ERR_HTTP2_SEND_FILE_NOSEEK</code>错误是告诉我们，Node.js 试图在 HTTP/2 连接上发送一个文件，但是由于文件流不支持 seek 操作，所以无法完成这个任务。处理这个问题通常需要确保发送的文件流是支持 seek 的，或者以其他方式处理文件发送逻辑。</p><h3 id="err-http2-session-error" tabindex="-1"><a class="header-anchor" href="#err-http2-session-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_session_error" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SESSION_ERROR</a></span></a></h3><p>Node.js 中的 <code>ERR_HTTP2_SESSION_ERROR</code> 是一个特定类型的错误，它与 HTTP/2 协议的会话(session)相关。在了解这个错误之前，我们需要知道几个基本概念。</p><h3 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念"><span>基本概念</span></a></h3><ul><li><p><strong>HTTP/2</strong>: 这是 HTTP 协议的第二版，旨在提高网页加载速度，改善性能，并使数据传输更加高效。它包括多个请求和响应在同一连接上同时进行的能力（称为多路复用）。</p></li><li><p><strong>会话(Session)</strong>: 在 HTTP/2 中，客户端与服务器之间的一系列交互可以被认为是一次“会话”。会话期间，可以传输多个消息。</p></li><li><p><strong>Node.js</strong>: 一个基于 Chrome V8 引擎的 JavaScript 运行时环境，让你可以在服务器上运行 JavaScript 代码。它非常适合构建网络应用程序。</p></li></ul><h3 id="err-http2-session-error-1" tabindex="-1"><a class="header-anchor" href="#err-http2-session-error-1"><span><code>ERR_HTTP2_SESSION_ERROR</code></span></a></h3><p>具体到 <code>ERR_HTTP2_SESSION_ERROR</code> 这个错误，它表明在 Node.js 应用程序中使用 HTTP/2 时出现了会话级别的问题。换句话说，当存在一个 HTTP/2 连接，而该连接因为某些原因无法正常工作时，就可能抛出这个错误。</p><h3 id="实际例子-6" tabindex="-1"><a class="header-anchor" href="#实际例子-6"><span>实际例子</span></a></h3><p>假设你正在开发一个 web 应用，并且你决定使用 HTTP/2 来提高性能。你的 Node.js 服务器配置如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取SSL证书，HTTP/2需要使用HTTPS</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-ssl-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-ssl-cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">serverOptions</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理请求并响应流</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个简单的服务器设置中，如果 HTTP/2 的会话遇到了问题，比如由于网络问题或配置错误，你就可能看到 <code>ERR_HTTP2_SESSION_ERROR</code> 的错误。当这个错误发生时，意味着服务器不能继续处理当前的会话，这通常需要开发者去检查代码，配置，甚至是底层的网络状况，以确定问题所在。</p><h3 id="处理-err-http2-session-error" tabindex="-1"><a class="header-anchor" href="#处理-err-http2-session-error"><span>处理 <code>ERR_HTTP2_SESSION_ERROR</code></span></a></h3><p>通常情况下，针对 <code>ERR_HTTP2_SESSION_ERROR</code> 错误的处理方式要依据具体问题来定。可能的处理方法包括但不限于：</p><ul><li>检查服务器的 SSL/TLS 证书是否有效。</li><li>确保服务器配置正确，没有监听错误的端口或地址。</li><li>检查网络连接是否稳定，防火墙设置是否允许 HTTP/2 通信。</li><li>查阅 Node.js 日志以获得更详细的错误信息，可能会提供更具体的调试线索。</li></ul><p>总体来说，<code>ERR_HTTP2_SESSION_ERROR</code> 是你在使用 HTTP/2 功能时可能会遇到的一个错误，它提醒你会话层面有问题，你需要检查整个环境和配置来解决它。</p><h3 id="err-http2-settings-cancel" tabindex="-1"><a class="header-anchor" href="#err-http2-settings-cancel"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_settings_cancel" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SETTINGS_CANCEL</a></span></a></h3><p>Node.js 中的 <code>[ERR_HTTP2_SETTINGS_CANCEL]</code> 错误是一个特定于 HTTP/2 协议的错误。HTTP/2 是一种网络通信协议，用于浏览器和服务器之间的通信，它是 HTTP/1.x 的后续版本，并旨在提供更高效的网页加载方式。</p><p>在 Node.js 中使用 HTTP/2 模块时，如果在处理设置帧（SETTINGS frame）的过程中发生了取消操作，则可能会遇到 <code>ERR_HTTP2_SETTINGS_CANCEL</code> 错误。设置帧是 HTTP/2 连接初始化时双方交换的一组参数，它们定义了连接的行为和约束。</p><p>这个错误通常表明客户端或服务器选择了取消发送或应用某些设置。在正式的 HTTP/2 规范中，如果一方不打算按照对方的要求更改设置，则可以发送一个带有 <code>CANCEL</code> 标志的设置帧作为响应。</p><p>例如，如果服务器尝试修改一些性能相关的设置，比如窗口大小（控制数据流量的量）或者并发流的最大数量，客户端可能因为某些原因决定不接受这样的变更，并发送设置帧来取消这次操作。当 Node.js 的 HTTP/2 实现检测到这种取消行为时，就会抛出 <code>ERR_HTTP2_SETTINGS_CANCEL</code> 错误。</p><p>在实践中，你不太可能直接与这个错误打交道，除非你在编写需要精细控制 HTTP/2 设置的高级代码。大多数开发者都会使用高级库来处理 HTTP/2 通信，这些库通常会抽象掉底层的复杂性。如果你确实遇到了这个错误，很可能是由于网络问题、客户端或服务器配置错误，或者是在使用 HTTP/2 功能时的编程错误。</p><p>举个实际例子，在 Node.js 应用程序中，你可能会创建一个 HTTP/2 服务器来响应客户端请求：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理请求并发送响应</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听错误事件</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_HTTP2_SETTINGS_CANCEL</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">设置帧被取消</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，如果在设置帧交换过程中发生了取消，<code>&#39;error&#39;</code> 事件将被触发，并且你可以在回调函数中看到 <code>ERR_HTTP2_SETTINGS_CANCEL</code> 错误。注意，这只是一个示例，实际上很少需要这样直接处理这个错误。</p><h3 id="err-http2-socket-bound" tabindex="-1"><a class="header-anchor" href="#err-http2-socket-bound"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_socket_bound" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SOCKET_BOUND</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的 <code>[ERR_HTTP2_SOCKET_BOUND]</code> 错误。</p><p>首先，Node.js 是一个基于 Chrome 的 V8 JavaScript 引擎运行的 JavaScript 环境，它允许你在服务器端运行 JavaScript 代码。Node.js 支持 HTTP/2，这是一种比传统的 HTTP/1.x 更快、更高效的网络协议。</p><p>HTTP/2 在 Node.js 中通过 <code>http2</code> 模块实现。当你使用 Node.js 创建一个 HTTP/2 服务器或客户端时，会涉及到很多底层的细节，其中之一就是如何处理网络连接（即“sockets”）。</p><p>现在，我们来讲解 <code>[ERR_HTTP2_SOCKET_BOUND]</code> 这个错误。这个错误表示一个 HTTP/2 的 socket（即网络连接）已经被用于另一个 HTTP/2 会话，并且尝试将它重新用于新的会话。HTTP/2 的设计中规定，每个 TCP socket 只能用于单个 HTTP/2 会话，因此，如果你试图重复使用同一个 socket，Node.js 就会抛出这个错误。</p><p>这里是一个简化的例子：</p><p>假设你创建了一个 HTTP/2 客户端，然后发起了一个到服务器的请求。这个请求会创建一个 socket 并建立一个 HTTP/2 会话。如果你尝试再次利用这个已经活跃的 socket 发起另一个 HTTP/2 会话，Node.js 就会给你 <code>[ERR_HTTP2_SOCKET_BOUND]</code> 这个错误，告诉你这个操作是不允许的。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 客户端连接到服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发起一个请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> flags</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 读取响应头等</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设有一段代码在这里尝试再次使用 `client` 来进行另一个不合法的会话。</span></span>
<span class="line"><span style="color:#616E88;">// 这时候就会触发 ERR_HTTP2_SOCKET_BOUND 错误。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了避免这个错误，确保每个 socket 只用于一个 HTTP/2 会话，如果需要发起另一个会话，就创建一个新的连接。</p><p>在实际开发中，通常你不需要担心这个错误，只要你按照 <code>http2</code> 模块的文档正确使用 API 即可。这个错误更多地关联于内部的实现错误，或者是不符合协议的使用方法。如果你遇到了这个错误，检查你的代码，确保没有尝试对一个已经绑定的 socket 进行非法的重复利用。</p><h3 id="err-http2-socket-unbound" tabindex="-1"><a class="header-anchor" href="#err-http2-socket-unbound"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_socket_unbound" target="_blank" rel="noopener noreferrer">ERR_HTTP2_SOCKET_UNBOUND</a></span></a></h3><p><code>ERR_HTTP2_SOCKET_UNBOUND</code> 是 Node.js 中的一个错误代码，表示在使用 HTTP/2 功能时出现了特定的问题。在你提到的版本（Node.js v21.7.1）中，这个错误是与 HTTP/2 相关的内部错误代码。</p><p>首先，让我们简单介绍下什么是 HTTP/2：<br> HTTP/2 是一种网络协议，它是 HTTP 协议的第二个主要版本，用于在网页浏览器和服务器之间传输数据。它的目标是提高性能，允许使用单一连接并行加载多个请求，并引入许多其他改进，以减少延迟和提高网页加载速度。</p><p>接下来，解释 <code>ERR_HTTP2_SOCKET_UNBOUND</code> 错误：<br> 这个错误表示一个 HTTP/2 的 socket 连接已经不再与任何会话或流绑定。例如，在 HTTP/2 通信过程中，客户端和服务器通过创建流（streams）进行数据传输。如果一个流被关闭或 socket 连接因某些原因断开，但应用程序仍试图通过这个未绑定（unbound）的 socket 发送数据，那么就会抛出 <code>ERR_HTTP2_SOCKET_UNBOUND</code> 错误。</p><p>举个例子，假设你正在编写一个使用 Node.js 的 HTTP/2 客户端，发送数据到一个服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> clientSession</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> clientSession</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听数据</span></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 结束监听</span></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  clientSession</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设在流结束后，我们尝试发送更多数据。</span></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 此时流已经结束，session 关闭</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试发送数据将导致 ERR_HTTP2_SOCKET_UNBOUND 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，当 <code>stream</code> 结束并且 session 关闭后，我们尝试调用 <code>stream.end()</code> 发送数据，这将导致触发 <code>ERR_HTTP2_SOCKET_UNBOUND</code> 错误，因为此时的流已经不能再发送数据了。</p><p>在实际应用中，正确的做法是确保在 socket 还处于绑定状态时发送数据，并且在关闭流或会话前不再尝试发送新的数据。处理异常和错误是很重要的，以保证即使遇到错误情况，程序也可以优雅地处理，而不是崩溃退出。</p><h3 id="err-http2-status-101" tabindex="-1"><a class="header-anchor" href="#err-http2-status-101"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_status_101" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STATUS_101</a></span></a></h3><p>在 Node.js 中，错误代码 <code>ERR_HTTP2_STATUS_101</code> 是关于 HTTP/2 协议的一个特定错误标识。在讲解这个错误之前，我需要先简单介绍一下 HTTP/2 协议和状态码。</p><p>HTTP/2 是 HTTP 协议的第二个主要版本，它旨在提高网页加载速度，提供更好的用户体验。HTTP/2 采用了新的数据传输机制，比如头部压缩、服务器推送等，以优化性能。</p><p>在 HTTP/1.x 协议中，有一系列的状态码来表示请求处理的结果，其中 101 状态码表示“切换协议”（Switching Protocols）。这个状态码通常用在客户端希望与服务器协商使用不同协议进行通信时。举个例子，如果客户端想从 HTTP/1.1 升级到 WebSocket，就会发送一个包含<code>Upgrade: websocket</code>头部的 HTTP 请求，而服务器在同意切换后会回应 101 状态码。</p><p>现在回到你的问题，<code>ERR_HTTP2_STATUS_101</code>这个错误代码意味着在使用 HTTP/2 协议的上下文中，收到了不恰当的 101 状态码。在 HTTP/2 标准中，并不存在&quot;切换协议&quot;的概念，因为 HTTP/2 本身已经是建立在 TLS（安全传输层协议）之上的，所以不需要像 HTTP/1.x 那样升级或切换协议。所以说，在 HTTP/2 连接中接收到 101 状态码是不合法的，而 Node.js 通过抛出<code>ERR_HTTP2_STATUS_101</code>错误来表明发生了这种违规情况。</p><p>实际运用示例：<br> 由于<code>ERR_HTTP2_STATUS_101</code>代表一个不应该出现在 HTTP/2 环境中的状态码，因此，这个错误在正常情况下很少遇到，它可能是程序逻辑上的 bug 或者是服务器配置错误导致的。例如，如果你编写了一个 Node.js 服务器，并且在某处错误地配置了响应逻辑，使其在 HTTP/2 请求上返回了 101 状态码，那么 Node.js 就会抛出<code>ERR_HTTP2_STATUS_101</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里假设某种条件下错误地尝试返回101状态码</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#616E88;">/* some condition */</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">101</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 正常的请求处理...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，如果触发了<code>if</code>块内的条件，尝试对 HTTP/2 请求返回 101 状态码，Node.js 就会报<code>ERR_HTTP2_STATUS_101</code>错误。正确的做法是确保在处理 HTTP/2 请求时不要返回不支持的状态码。</p><h3 id="err-http2-status-invalid" tabindex="-1"><a class="header-anchor" href="#err-http2-status-invalid"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_status_invalid" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STATUS_INVALID</a></span></a></h3><p>在 Node.js 中，错误代码<code>ERR_HTTP2_STATUS_INVALID</code>是与 HTTP/2 协议相关的一个特定类型的错误。HTTP/2 是一种由 IETF 开发的网络协议，它是 HTTP 协议的第二个主要版本，目的是提高网页加载速度并优化用户体验。</p><p>在 HTTP/2 通讯过程中，每次请求和响应都会有一个状态码。这些状态码用于告诉客户端请求是否成功，如果不成功，则提供原因。例如，状态码 200 表示请求成功，404 表示未找到请求的资源等。</p><p>当你在使用 Node.js 进行 HTTP/2 通信时，如果尝试发送一个无效或非法的状态码给客户端，那么就会触发<code>ERR_HTTP2_STATUS_INVALID</code>错误。有效的 HTTP/2 状态码是一个介于 100 到 599 之间的整数。如果你尝试发送一个不在这个范围内的值，或者你尝试发送一个不属于标准 HTTP 状态码的值，就会出现这个错误。</p><p>让我们来举几个例子说明这个问题：</p><p>例子 1：发送非法状态码</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试发送一个非法的状态码999</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 999</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码创建了一个简单的 HTTP/2 服务器。当有数据流（stream）进来时，我们尝试通过<code>:status</code>键发送一个状态码 999。因为 999 不是有效的 HTTP 状态码，所以 Node.js 会抛出<code>ERR_HTTP2_STATUS_INVALID</code>错误。</p><p>例子 2：忘记设置状态码<br> 假设我们在编写代码时忘记设置<code>:status</code>属性：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 忘记设置状态码</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，虽然我们没有显示地设置一个非法的状态码，但由于完全遗漏了<code>:status</code>字段，Node.js 也会默认这是一个错误，并可能抛出<code>ERR_HTTP2_STATUS_INVALID</code>错误，因为响应中必须包含有效的状态码。</p><p>解决这个错误的方法很简单：确保你总是发送有效的 HTTP 状态码，并且在调用<code>stream.respond()</code>时包含<code>:status</code>属性。如果你不确定哪些状态码是有效的，可以查询 HTTP 状态码列表来获取信息。</p><h3 id="err-http2-stream-cancel" tabindex="-1"><a class="header-anchor" href="#err-http2-stream-cancel"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_stream_cancel" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STREAM_CANCEL</a></span></a></h3><p>Node.js 是一个在服务器端运行 JavaScript 代码的平台，它允许开发者使用 JavaScript 来编写后端逻辑。Node.js 支持 HTTP/2，这是一种网络通信协议，相比于它的前身 HTTP/1.x 有很多改进，比如更好的性能和支持服务器推送等特性。</p><p>在 Node.js 中，<code>ERR_HTTP2_STREAM_CANCEL</code>是一个特定的错误类型，表示 HTTP/2 的一个数据流（stream）被取消了。数据流是 HTTP/2 连接中的一个虚拟通道，可以用来发送请求或接收响应。这个错误通常意味着客户端或者其他原因导致流无法继续进行。</p><p>这里举几个实际的例子来解释什么情况下你可能会遇到<code>ERR_HTTP2_STREAM_CANCEL</code>：</p><ol><li><p>**用户取消操作：**当一个用户在网页上发起了一个请求，然后在请求完成之前点击了浏览器的“停止”按钮，这个时候，如果你的服务器端使用 Node.js 处理这个请求，并且是通过 HTTP/2 协议的，就可能会产生<code>ERR_HTTP2_STREAM_CANCEL</code>错误，因为浏览器指示要取消这个数据流。</p></li><li><p>**超时：**在一些应用场景中，如果客户端认为服务器响应的时间过长，它可能会主动取消这个请求，从而导致服务器端出现<code>ERR_HTTP2_STREAM_CANCEL</code>错误。</p></li><li><p>**程序逻辑控制：**在你的 Node.js 应用程序中，如果你检测到某些条件不满足，可能会主动取消一个数据流。例如，在文件上传过程中，如果发现文件太大超过限制，你的程序可能会取消这个上传流，这时候也会抛出<code>ERR_HTTP2_STREAM_CANCEL</code>错误。</p></li><li><p>**资源管理：**服务器可能会由于资源限制（如内存使用过高）而决定取消掉一些低优先级的数据流，这同样会引发<code>ERR_HTTP2_STREAM_CANCEL</code>错误。</p></li></ol><p>如果你在编写 Node.js 应用时碰到了<code>ERR_HTTP2_STREAM_CANCEL</code>错误，你应该检查代码中对 HTTP/2 流的管理逻辑，并确保正确处理这种取消事件，以便优雅地关闭相关资源，并向客户端提供必要的反馈。</p><h3 id="err-http2-stream-error" tabindex="-1"><a class="header-anchor" href="#err-http2-stream-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_stream_error" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STREAM_ERROR</a></span></a></h3><p><code>ERR_HTTP2_STREAM_ERROR</code> 是 Node.js 中的一个错误类型，它与 HTTP/2 协议中的流相关。HTTP/2 是一个网络通信协议，用于在浏览器和服务器之间传输网页数据，它是 HTTP 协议的第二个主要版本。在 HTTP/2 中，&quot;流&quot; 是指在客户端（如浏览器）和服务器之间建立的单一的双向通信序列。</p><p>当使用 Node.js 创建基于 HTTP/2 的应用或服务时，如果在处理这些流的过程中出现问题，就可能会抛出 <code>ERR_HTTP2_STREAM_ERROR</code> 错误。举例来说，这类问题可能包括：</p><ol><li>流尝试使用不被支持的功能。</li><li>在流的生命周期内收到了无效或不合法的帧（HTTP/2 通信的数据包单位）。</li><li>流被迫关闭，比如由于超时或资源限制。</li></ol><p>下面通过一个简化的例子来解释这个概念：</p><p>假设你有一个使用 Node.js 的 HTTP/2 服务器，它可以发送图片给客户端。代码可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 响应头部信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image/jpeg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 读取本地图片并发送数据</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">图片路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">stream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  fileStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 当读取文件发生错误时，流可能已损坏，需要进行错误处理</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">http2</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">constants</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">NGHTTP2_INTERNAL_ERROR</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个代码示例中，我们创建了一个安全的 HTTP/2 服务器，监听了 <code>stream</code> 事件，每当有新的流打开时（即客户端请求图片），就响应这个流，发送图片数据。</p><p>但如果在读取图片过程中发生错误（例如，文件不存在或磁盘错误），那么 <code>fileStream</code> 的 <code>&#39;error&#39;</code> 事件将被触发。在错误处理回调中，我们关闭了流，并以 <code>NGHTTP2_INTERNAL_ERROR</code> 为原因关闭它。如果这种类型的错误没有正确处理，Node.js 可能会抛出 <code>ERR_HTTP2_STREAM_ERROR</code> 错误。</p><p>为了避免 <code>ERR_HTTP2_STREAM_ERROR</code> 错误，开发者应当确保他们正确处理流并预见可能的问题，比如通过适当地监听和响应错误事件、验证客户端发送的数据、控制资源消耗等。这样可以提高应用的稳定性和用户体验。</p><h3 id="err-http2-stream-self-dependency" tabindex="-1"><a class="header-anchor" href="#err-http2-stream-self-dependency"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_stream_self_dependency" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STREAM_SELF_DEPENDENCY</a></span></a></h3><p>在 HTTP/2 协议中，数据传输是通过流（Streams）来进行的。这些流可以有依赖关系，形成一个流的优先级结构。比如，你可能想让某个关键 CSS 文件的流比其他图片资源的流有更高的优先级，确保网页能够快速加载必要的样式。</p><p><code>ERR_HTTP2_STREAM_SELF_DEPENDENCY</code>错误发生在使用 Node.js 的 HTTP/2 模块进行编程时，尝试创建一个流，并且错误地将这个流设置为依赖于它自己。在 HTTP/2 的流优先级规则中，一个流不能依赖于它自己，因为这没有逻辑上的意义，并且会导致循环依赖，这在协议中是不允许的。</p><p>让我们假设有一个简单的场景，你正在编写一个 Web 服务器，它利用 HTTP/2 的功能来提供内容。如果在设置流依赖时出现了编码错误，你可能会遇到这个问题。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理流事件...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设这里有一段代码试图设置流的依赖，错误地将当前流ID作为它的依赖项</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> currentStreamID</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> stream</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">id</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 下面的代码尝试创建一个依赖，但错误地将它自己指定为依赖对象</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">priority</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> parent</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> currentStreamID</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 这将触发 ERR_HTTP2_STREAM_SELF_DEPENDENCY 错误</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 正确的代码应该是指定另一个流的ID或者不制定parent达到默认依赖。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此处的 <code>stream.priority({ parent: currentStreamID });</code> 尝试设置流的优先级，并指定它的父流为其自身的 ID <code>currentStreamID</code>，这是不合法的操作，从而引发了<code>ERR_HTTP2_STREAM_SELF_DEPENDENCY</code>错误。</p><p>为了解决这个问题，你需要确保流的依赖关系设置正确。如果你没有特殊的优先级需求，通常你不需要手动设置流的优先级，HTTP/2 模块会处理好默认情况。如果你确实需要设置流的优先级，那么你应当指定另一个不同的流 ID 作为依赖项，或者完全省略<code>parent</code>属性使用默认值。</p><p>记住，HTTP/2 的优先级机制是一个可选的功能，并不是所有的客户端和服务器都会使用这个机制，所以即使你不使用它，通信也能正常进行。</p><h3 id="err-http2-too-many-custom-settings" tabindex="-1"><a class="header-anchor" href="#err-http2-too-many-custom-settings"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_too_many_custom_settings" target="_blank" rel="noopener noreferrer">ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</a></span></a></h3><p>在 Node.js 中，HTTP/2 是一种网络通信协议，它允许浏览器和服务器之间进行更快速、更高效的数据交换。HTTP/2 引入了一些新的概念，例如流、帧以及设置参数，来实现这些改进。</p><p>当我们在使用 Node.js 开发一个使用 HTTP/2 协议的应用时，我们有可能会遇到一些特定的错误。其中之一就是<code>ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</code>这个错误。</p><h3 id="什么是err-http2-too-many-custom-settings错误" tabindex="-1"><a class="header-anchor" href="#什么是err-http2-too-many-custom-settings错误"><span>什么是<code>ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</code>错误？</span></a></h3><p>这个错误发生的场景是当一个 HTTP/2 的连接尝试发送太多的自定义设置（settings）给另一端时。根据 HTTP/2 协议的规范，每个端点都可以通过发送 SETTINGS 帧来向对方表明自己希望使用的配置参数。但是为了保护网络参与者不被过多的设置所淹没，规范中规定了一个端点可以更改的设置数量上限。</p><p>如果你的 Node.js 应用程序在建立 HTTP/2 连接时，尝试发送超出这个限制数量的自定义设置，那么就会抛出<code>ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</code>错误。</p><h3 id="实际运用的例子-10" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-10"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个基于 Node.js 的网站后端，并且决定使用 HTTP/2 协议来提高性能。你可能会这样配置你的 HTTP/2 服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书文件路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理请求...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置若干自定义参数</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">settings</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  headerTableSize</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 4096</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  enablePush</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  initialWindowSize</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 65535</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  maxFrameSize</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 16384</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // ... 可能还有更多设置</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>server.settings({ ... })</code>中配置的自定义设置数量超过了协议允许的最大值，那么当你启动这个服务器并且有客户端尝试连接时，就可能会抛出<code>ERR_HTTP2_TOO_MANY_CUSTOM_SETTINGS</code>错误。</p><p>为了解决这个问题，你需要检查并减少<code>server.settings({ ... })</code>中的设置数量，确保它们不超过 HTTP/2 协议规定的限制。这个限制具体是多少可能会随着 Node.js 版本的不同而有所变化，所以最好的做法是查阅当前 Node.js 版本的官方文档，了解具体的数值限制。</p><p>请注意，实际开发中很少需要手动配置大量的 HTTP/2 设置参数，因为 Node.js 为 HTTP/2 提供了合理的默认值，适用于大多数场景。只有在特定的性能调优或者要满足特殊需求的时候，才需要进行相关设置的微调。</p><h3 id="err-http2-too-many-invalid-frames" tabindex="-1"><a class="header-anchor" href="#err-http2-too-many-invalid-frames"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_too_many_invalid_frames" target="_blank" rel="noopener noreferrer">ERR_HTTP2_TOO_MANY_INVALID_FRAMES</a></span></a></h3><p>当然，我来解释一下什么是<code>ERR_HTTP2_TOO_MANY_INVALID_FRAMES</code>这个错误，并且会给你几个实际的例子。</p><p>首先，HTTP/2 是网络上的一个通信协议，它用于在 web 服务器和客户端（比如浏览器）之间传输数据。HTTP/2 的设计目标是提高网页加载速度、效率和安全性。</p><p>在 HTTP/2 中，&quot;帧&quot;（frames）是信息传输的基本单位。可以把它想象成火车里的每一节车厢，每节车厢携带的货物就是特定类型的数据。现在，假设有些车厢装载了不符合规定的货物或者以错误的方式被发送，我们就可以称这些车厢为“无效的帧”。</p><p>Node.js 作为一个运行 JavaScript 代码的平台，支持通过 HTTP/2 模块构建服务器和客户端应用程序。当使用 Node.js 运行一个 HTTP/2 服务器时，如果服务器连续收到过多的无效帧，就会产生<code>ERR_HTTP2_TOO_MANY_INVALID_FRAMES</code>这个错误。</p><p>这种错误的常见原因可能包括：</p><ol><li>客户端软件错误：正在与服务器交互的客户端（如浏览器或其他 HTTP 客户端）可能存在 bug，导致其发送错误格式的帧。</li><li>网络问题：在数据传输过程中可能出现干扰或损坏，从而产生无效帧。</li><li>恶意攻击：有人试图故意发送错误的帧来攻击服务器。</li></ol><p>实际运用的例子：</p><ol><li><p>假设你正在运行一个 Node.js 的 HTTP/2 网站，突然很多用户报告网站无法访问。你检查后发现服务器日志里出现了大量的<code>ERR_HTTP2_TOO_MANY_INVALID_FRAMES</code>错误。这时候，你可能需要检查是否有用户使用了不兼容的浏览器，或者服务器是否遭受了恶意的拒绝服务攻击（DDoS）。</p></li><li><p>如果你是一个开发者，正在用 Node.js 写一个新的 HTTP/2 客户端库。在测试过程中，你发现你写的库总是在某些情况下给服务器发送错误的数据帧，导致你的客户端程序收到<code>ERR_HTTP2_TOO_MANY_INVALID_FRAMES</code>错误。这表示你需要回去检查你的代码，确保所有的帧都是按照 HTTP/2 协议正确生成和发送的。</p></li><li><p>你可能是一个网络工程师，在分析公司内部网络问题时发现，员工在访问公司 HTTP/2 服务时频繁地遇到这个错误。经过调查，你可能发现是内部网络硬件（如路由器或负载均衡器）配置不当或故障，导致数据在传输过程中被篡改成了无效的帧。</p></li></ol><p>处理<code>ERR_HTTP2_TOO_MANY_INVALID_FRAMES</code>错误通常需要分析日志、更新客户端软件、修复网络问题或增强服务器对恶意流量的防护。因此，了解这个错误及其背后的原因，对于维护 HTTP/2 服务器的稳定性和安全性是非常重要的。</p><h3 id="err-http2-trailers-already-sent" tabindex="-1"><a class="header-anchor" href="#err-http2-trailers-already-sent"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_trailers_already_sent" target="_blank" rel="noopener noreferrer">ERR_HTTP2_TRAILERS_ALREADY_SENT</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的 <code>ERR_HTTP2_TRAILERS_ALREADY_SENT</code> 错误。这个错误是关于 HTTP/2 协议的一个特定情况。</p><p>首先，我们需要了解几个概念：</p><ol><li><p><strong>HTTP/2</strong>: 这是网络传输协议 HTTP 的第二个主要版本，它比旧版（HTTP/1.x）更高效，支持多路复用、服务器推送等新功能。</p></li><li><p><strong>Trailer</strong>: 在 HTTP/2 中，Trailer 类似于头部（Header），但是它们是在所有数据发送完毕后才发送的。可以想象成是在 HTTP 消息的尾部添加额外的元信息。</p></li></ol><p>现在，当你使用 Node.js 创建一个涉及 HTTP/2 的网络应用时，可能会遇到 <code>ERR_HTTP2_TRAILERS_ALREADY_SENT</code> 这个错误。这个错误表明你试图发送 Trailer 信息，但是此时不允许发送，因为 Trailer 已经被发送过了或者已经太晚了。</p><p>这通常发生在以下场景：</p><ul><li>你已经调用过一次发送 Trailers 的方法，并且试图再次发送它。</li><li>响应的正文数据已经完全发送给客户端，这时候再发送 Trailers 是不允许的。</li></ul><p>下面，让我举个例子来更详细地说明这个问题。</p><p>假设你在使用 Node.js 的 <code>http2</code> 模块创建一个服务器，你想在响应结束时发送一些附加的信息作为 Trailer：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送一些头部信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 写入响应体</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 此时尝试发送 Trailer</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Custom-Trailer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">value1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 响应体结束</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 如果在这里再次尝试发送 Trailer，将会抛出 ERR_HTTP2_TRAILERS_ALREADY_SENT 错误</span></span>
<span class="line"><span style="color:#616E88;">  // 因为上面已经调用了 stream.end()，响应已经结束，不能再发送 Trailers</span></span>
<span class="line"><span style="color:#616E88;">  // stream.addTrailers({</span></span>
<span class="line"><span style="color:#616E88;">  //     &#39;Another-Custom-Trailer&#39;: &#39;value2&#39;</span></span>
<span class="line"><span style="color:#616E88;">  // });</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，如果取消注释最后的 <code>stream.addTrailers</code> 调用并执行，你将会看到 <code>ERR_HTTP2_TRAILERS_ALREADY_SENT</code> 错误。发生这种情况是因为流已经完成（通过 <code>stream.end()</code>），此时不允许添加更多的 Trailer 信息。</p><p>要修复这个错误，确保只在数据传输之前或过程中添加 Trailer，并且只添加一次。一旦调用了 <code>stream.end()</code> 结束响应，就不能再发送任何 Trailer 了。</p><p>希望这个解释有助于理解 <code>ERR_HTTP2_TRAILERS_ALREADY_SENT</code> 错误以及如何在实践中避免它。</p><h3 id="err-http2-trailers-not-ready" tabindex="-1"><a class="header-anchor" href="#err-http2-trailers-not-ready"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_trailers_not_ready" target="_blank" rel="noopener noreferrer">ERR_HTTP2_TRAILERS_NOT_READY</a></span></a></h3><p>当然，让我帮你了解这个错误。</p><p><code>ERR_HTTP2_TRAILERS_NOT_READY</code>是一个特定于 Node.js 中 HTTP/2 功能的错误代码。在 Node.js 中，HTTP/2 是一个协议，它允许更高效、更快速的数据传输。和 HTTP/1 相比，它引入了一些新的概念，比如流、帧和补充数据（trailers）。</p><p>在 HTTP/2 中，补充数据（trailers）是在主要的响应头部和正文之后发送的额外的键值对集合。它们通常用来包含一些不在主请求开始时就知晓的元数据。但是，我们只能在消息正文完全发送之后才能发送补充数据。</p><p>现在，让我们回到<code>ERR_HTTP2_TRAILERS_NOT_READY</code>错误。在 Node.js 中，如果你试图在 HTTP/2 响应的数据流还没有结束或者准备好发送补充数据之前就添加补充数据，那么你会遇到这个错误。实际上，这意味着在数据流的末尾标记被发送之前，你不能设置补充数据。</p><p>这里有一个简单的例子来说明这一点：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP/2 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送一些数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 我们试图直接发送trailer，但数据流还没有结束，这将导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获并打印 ERR_HTTP2_TRAILERS_NOT_READY 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 结束数据流</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们创建了一个基本的 HTTP/2 服务器并监听传入的数据流。当数据流事件发生时，我们试图写入一些数据并紧接着添加补充数据。但是，因为我们没有调用<code>stream.end()</code>来结束数据流，所以此时添加补充数据是不允许的，这会抛出<code>ERR_HTTP2_TRAILERS_NOT_READY</code>错误。</p><p>正确的做法是在调用<code>stream.end()</code>之后再添加补充数据，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ... 前面的代码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送一些数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 在数据流结束时再添加补充数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addTrailers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-MD5</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">someValue</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 结束数据流</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ... 后面的代码</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，<code>addTrailers</code>方法被放置在<code>finish</code>事件回调中，这样可以确保只有在流完全结束后才尝试添加补充数据，从而避免<code>ERR_HTTP2_TRAILERS_NOT_READY</code>错误。</p><p>总结起来，<code>ERR_HTTP2_TRAILERS_NOT_READY</code>就是一个错误提示，提醒开发者他们试图在一个 HTTP/2 流还未结束时添加补充数据，这是违反协议规则的。通过适当地管理你的数据流，并在流结束时添加补充数据，可以避免这个问题。</p><h3 id="err-http2-unsupported-protocol" tabindex="-1"><a class="header-anchor" href="#err-http2-unsupported-protocol"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_unsupported_protocol" target="_blank" rel="noopener noreferrer">ERR_HTTP2_UNSUPPORTED_PROTOCOL</a></span></a></h3><p><code>ERR_HTTP2_UNSUPPORTED_PROTOCOL</code>是一个在 Node.js 中用于指示 HTTP/2 操作失败的错误代码，原因是使用了不支持的网络协议。HTTP/2 是一种网络通信协议，它是 HTTP 协议（负责在互联网上传输网页数据）的第二个主要版本。</p><p>在 Node.js 中，如果你尝试使用 HTTP/2 模块与服务器进行通信，但服务器不支持 HTTP/2 或者配置有误，就可能遇到<code>ERR_HTTP2_UNSUPPORTED_PROTOCOL</code>错误。例如，HTTP/2 需要使用 TLS（传输层安全性协议，一种加密通信协议），如果客户端和服务器之间的连接不是通过 TLS 建立的，那么就不能使用 HTTP/2，从而可能引发这个错误。</p><p>下面通过几个实际应用的例子来说明这个错误：</p><h3 id="例子-1-连接不支持-http-2-的服务器" tabindex="-1"><a class="header-anchor" href="#例子-1-连接不支持-http-2-的服务器"><span>例子 1：连接不支持 HTTP/2 的服务器</span></a></h3><p>假设你有一个服务器，它只支持 HTTP/1.1，并且没有开启或者配置 TLS。当你的 Node.js 应用尝试使用 HTTP/2 客户端与该服务器建立连接时，会发生错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试连接到只支持HTTP/1.1的服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能输出 ERR_HTTP2_UNSUPPORTED_PROTOCOL</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-2-错误的协议使用" tabindex="-1"><a class="header-anchor" href="#例子-2-错误的协议使用"><span>例子 2：错误的协议使用</span></a></h3><p>如果你不小心将 HTTP/2 客户端指向了一个需要其他协议比如 FTP 或 WebSocket 的服务器地址，同样会出现<code>ERR_HTTP2_UNSUPPORTED_PROTOCOL</code>错误，因为 HTTP/2 客户端预期通讯使用的是 HTTP/2 协议。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试使用HTTP/2协议连接到需要FTP协议的服务器地址</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ftp://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里也会输出 ERR_HTTP2_UNSUPPORTED_PROTOCOL</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解决办法" tabindex="-1"><a class="header-anchor" href="#解决办法"><span>解决办法：</span></a></h3><p>要解决此类问题，确保：</p><ol><li>你尝试连接的服务器支持 HTTP/2。</li><li>服务器适当地配置了 TLS。</li><li>在客户端和服务器之间正确地使用了 TLS 加密连接。</li></ol><p>如果你正在学习编程并且遇到这个错误，你应该检查你的代码是否正确地连接到了正确的服务器，并且服务器配置得当。可能需要咨询服务器管理员或更详细地阅读服务器的文档来确认这些细节。</p><h3 id="err-illegal-constructor" tabindex="-1"><a class="header-anchor" href="#err-illegal-constructor"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_illegal_constructor" target="_blank" rel="noopener noreferrer">ERR_ILLEGAL_CONSTRUCTOR</a></span></a></h3><p><code>ERR_ILLEGAL_CONSTRUCTOR</code> 是 Node.js 中的一个错误代码，表示你尝试以不合法的方式调用了一个构造函数。在 JavaScript 中，构造函数用来创建新的对象实例。但是，并不是所有的函数都可以被当作构造函数使用。</p><p>例如，一些内置的对象比如 <code>Promise</code>，<code>Number</code> 和其他的全局对象提供了构造函数，让你可以创建这些类型的新实例。然而，有些特殊的对象，它们的构造函数并不是为了直接被调用的，或者是根本没有暴露出来给开发者直接使用。如果你尝试去做这样的事，Node.js 就会抛出 <code>ERR_ILLEGAL_CONSTRUCTOR</code> 这个错误。</p><p>让我们来看几个例子：</p><h3 id="实例-1-错误地使用-promise-构造函数" tabindex="-1"><a class="header-anchor" href="#实例-1-错误地使用-promise-构造函数"><span>实例 1：错误地使用 Promise 构造函数</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确的方法来创建一个 Promise</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myPromise</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resolve</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> reject</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 做一些异步操作，然后解决（resolve）或拒绝（reject）这个 promise</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的方法 - 试图直接调用 Promise 构造函数</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myPromise</span><span style="color:#81A1C1;"> =</span><span style="color:#8FBCBB;"> Promise</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印出 ERR_ILLEGAL_CONSTRUCTOR 的错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，正确的方式是使用 <code>new</code> 关键字来创建一个新的 <code>Promise</code> 实例。第二种情况没有使用 <code>new</code>，就尝试调用 <code>Promise()</code>，这导致了错误的产生。</p><h3 id="实例-2-试图实例化内置的-math-对象" tabindex="-1"><a class="header-anchor" href="#实例-2-试图实例化内置的-math-对象"><span>实例 2：试图实例化内置的 Math 对象</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myMathInstance</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Math</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // Math 不是一个构造函数，不能这样使用</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里也会打印出 ERR_ILLEGAL_CONSTRUCTOR 的错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Math</code> 是 JavaScript 的一个内置对象，它提供了一组数学常量和函数。它不像 <code>Date</code> 或者 <code>Array</code> 那样有一个构造函数，因此尝试去 &quot;实例化&quot; 它会导致 <code>ERR_ILLEGAL_CONSTRUCTOR</code> 错误。</p><h3 id="实例-3-试图继承内置对象-error-的错误用法" tabindex="-1"><a class="header-anchor" href="#实例-3-试图继承内置对象-error-的错误用法"><span>实例 3：试图继承内置对象 Error 的错误用法</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyError</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Error</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myErrorInstance</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> MyError</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 没有使用 new 来调用</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里同样会产生 ERR_ILLEGAL_CONSTRUCTOR 的错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们自定义了一个错误类 <code>MyError</code>，它继承自内置的 <code>Error</code> 类。创建 <code>MyError</code> 的实例时必须使用 <code>new</code> 关键字。如果省略 <code>new</code> 直接调用 <code>MyError()</code> 将会触发 <code>ERR_ILLEGAL_CONSTRUCTOR</code> 错误。</p><p>当你在 Node.js 中遇到 <code>ERR_ILLEGAL_CONSTRUCTOR</code> 这个错误时，检查你的代码是否试图以非法的方式调用或实例化一个构造函数。通常，你需要确保使用 <code>new</code> 关键字来创建对象实例，并且确保那些你认为是构造函数的确实是可以被用作构造函数的。</p><h3 id="err-import-attribute-type-incompatible" tabindex="-1"><a class="header-anchor" href="#err-import-attribute-type-incompatible"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_attribute_type_incompatible" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE</a></span></a></h3><p>好的，让我们聊聊 Node.js 中的 <code>[ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE]</code> 这个错误。</p><p>在 Node.js 中，你可能会使用 <code>import</code> 语句来加载模块或者文件。ES6 (ECMAScript 2015) 引入了这种模块导入语法。不过，在 Node.js 中，除了传统的导入方式，你还可以指定一些额外的属性，这些属性会影响如何导入模块。</p><p>例如，如果你正在导入一个 JSON 文件，你可能会这样写：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> data</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在上面这行代码中，<code>assert { type: &#39;json&#39; }</code> 就是一个导入属性，它告诉 Node.js 你期望导入的文件是一个 JSON 类型的文件。</p><p>现在，来到 <code>[ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE]</code> 错误。这个错误发生的时候，通常意味着你在 <code>import</code> 语句中指定了一个与模块实际类型不兼容的属性。也就是说，你告诉 Node.js 去以某种特定的方式解析一个模块，但是这个模块并不符合那种格式。</p><p>让我们举几个例子来具体说明：</p><p><strong>错误示例 1：</strong></p><p>假设你有一个文本文件 <code>example.txt</code>，内容如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Hello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后，你尝试用下面的 JavaScript 代码来导入这个 txt 文件，但是却指定它为 JSON 类型：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> text</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这时，Node.js 会抛出 <code>[ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE]</code> 错误，因为你告诉它 <code>example.txt</code> 是一个 JSON 文件，但实际上它是纯文本，不是 JSON 格式。</p><p><strong>错误示例 2：</strong></p><p>如果你有一个 JavaScript 模块 <code>module.js</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> default</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This is a JavaScript module.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后你尝试这样导入它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./module.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再次，由于你错误地声明了导入文件的类型（你告诉 Node.js 这是一个 CSS 文件），Node.js 将无法正确处理这个模块，并且会抛出 <code>[ERR_IMPORT_ATTRIBUTE_TYPE_INCOMPATIBLE]</code> 错误。</p><p>修复这个错误的方法很简单——确保你使用正确的属性类型来匹配你正在导入的资源的实际类型。如果你不确定，或者不需要任何特殊的文件解析，通常可以省略这个属性断言。</p><p>请记住，随着 Node.js 的版本更新和 JavaScript 语言规范的演进，导入属性的使用和支持可能会发生变化。所以你遇到问题时，查看最新的 Node.js 文档总是一个好主意。</p><h3 id="err-import-attribute-missing" tabindex="-1"><a class="header-anchor" href="#err-import-attribute-missing"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_attribute_missing" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ATTRIBUTE_MISSING</a></span></a></h3><p>在 Node.js 中，当我们谈论模块时，通常指的是可以被其他文件导入并使用的代码片段。Node.js 支持两种主要类型的模块系统：CommonJS 和 ES Modules (ESM)。</p><p>现在，你提到的 <code>ERR_IMPORT_ATTRIBUTE_MISSING</code> 错误与 ES Modules 相关。在 Node.js v21.7.1 中，当你尝试使用 <code>import</code> 语句加载一个模块，但是没有正确地指明需要的额外属性时，就会触发这个错误。</p><p>在 ESM 中，你可以用 <code>import</code> 关键字来载入模块，比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> someDefaultExport</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>但是，在某些情况下，你可能需要通过一个 HTML-like 的语法（称作 import assertions）来指定一些额外的信息。举个例子，假设我们想导入一个 JSON 文件作为模块，我们需要告诉 Node.js，我们正在导入的内容是 JSON 格式的，像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myData</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你省略了 <code>assert { type: &#39;json&#39; }</code> 这部分，Node.js 就不知道你想以什么方式处理这个文件，因此会抛出 <code>ERR_IMPORT_ATTRIBUTE_MISSING</code> 错误。</p><p>让我们通过一个实际的例子来说明这一点：</p><ol><li><p>假设你有一个包含配置信息的 JSON 文件，名为 <code>config.json</code>：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">port</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 3000</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>现在，你想在你的 Node.js 应用中使用这个配置信息。你创建了一个 <code>app.js</code> 文件，并试图这样导入 JSON 文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> config</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./config.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里缺少了 assert 属性</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">host</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 期望输出 localhost</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>当你运行 <code>node app.js</code> 时，由于 <code>import</code> 语句没有提供必要的 <code>type</code> 断言，Node.js 不知道怎么处理导入的 <code>config.json</code>，会抛出 <code>ERR_IMPORT_ATTRIBUTE_MISSING</code> 错误。</p></li><li><p>为了修复这个错误，你需要修改 <code>app.js</code> 文件中的 <code>import</code> 语句，加上 <code>assert { type: &#39;json&#39; }</code>，如下所示：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> config</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./config.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">host</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 现在应该正确输出 localhost</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>保存文件并再次运行 <code>node app.js</code>，这次它应该能够正确地导入配置信息，而不会抛出任何错误。</p></li></ol><p>总之，<code>ERR_IMPORT_ATTRIBUTE_MISSING</code> 错误提示你在导入模块时缺少了必须的属性声明，这是必须的，特别是在导入非 JavaScript 内容（如 JSON 或 WebAssembly）的时候。始终确保按照你导入资源的类型提供正确的断言，这样你的应用程序才能正确地加载和使用这些资源。</p><h3 id="err-import-attribute-unsupported" tabindex="-1"><a class="header-anchor" href="#err-import-attribute-unsupported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_attribute_unsupported" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ATTRIBUTE_UNSUPPORTED</a></span></a></h3><p>在 Node.js 中，错误代码 <code>ERR_IMPORT_ATTRIBUTE_UNSUPPORTED</code> 指的是当你尝试使用 JavaScript 的模块（ESM）导入语法时，如果你在导入语句中使用了不被支持的属性，就会遇到这个错误。</p><p>在 JavaScript 的 ES Modules 功能中，基本的导入语法看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> something</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然而，随着技术的发展，人们试图为这种导入语句增加额外的属性以支持更多的场景。例如，有一个提案希望支持动态导入条件，它可能会让你写出类似这样的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> something</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上述代码示例中，<code>assert { type: &#39;json&#39; }</code> 就是一个导入属性，它指定我们要导入的模块是 JSON 类型的文件。</p><p>但是，截至我知识更新前（2023 年），Node.js 可能还不支持所有这些新增的导入属性。如果你使用了 Node.js 不认识或者不支持的属性，就会抛出 <code>ERR_IMPORT_ATTRIBUTE_UNSUPPORTED</code> 这个错误。</p><p>让我们举一个实际的例子：</p><p>假设你有一个名为 <code>data.json</code> 的文件，并且你希望通过 ES Modules 语法将其作为一个 JSON 模块导入到你的 JavaScript 文件中。你可能会写下如下代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> data</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你的 Node.js 版本不支持导入属性（比如 <code>assert { type: &#39;json&#39; }</code>），执行以上代码就会产生 <code>ERR_IMPORT_ATTRIBUTE_UNSUPPORTED</code> 错误。</p><p>解决办法可能包括几个方向：</p><ol><li>如果某些属性对于当前版本的 Node.js 来说是必需的，那么检查并升级到支持该属性的最新 Node.js 版本。</li><li>不使用不支持的属性，找一个替代方案来实现你的需求。</li><li>跟踪 Node.js 的新版本和提案的进展，等待 Node.js 团队引入支持。</li></ol><p>重要的是，随着 Node.js 的不断变化和进步，一些之前不被支持的特性可能在将来的版本中得到支持。因此，遇到这种错误时，查阅官方文档和社区讨论是非常有帮助的。</p><h3 id="err-incompatible-option-pair" tabindex="-1"><a class="header-anchor" href="#err-incompatible-option-pair"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_incompatible_option_pair" target="_blank" rel="noopener noreferrer">ERR_INCOMPATIBLE_OPTION_PAIR</a></span></a></h3><p><code>ERR_INCOMPATIBLE_OPTION_PAIR</code> 是 Node.js 中的一个错误代码，它表示你在运行 Node.js 应用程序或者使用 Node.js API 的时候，提供了两个不兼容的选项。当你使用的某些参数或配置不能同时使用时，Node.js 就会抛出这个错误。</p><p>例如，假设有一个命令行工具，它允许你使用两个选项：<code>--read</code> 和 <code>--write</code>，但是由于设计上的原因，这两个选项不能一起使用。如果你尝试同时传递这两个选项给该工具，就可能会触发类似 <code>ERR_INCOMPATIBLE_OPTION_PAIR</code> 的错误。</p><p>这里给你举一个具体的例子：</p><p>假设我们有一个 Node.js 脚本，它允许用户通过命令行选择以只读模式（<code>--readonly</code>）或者只写模式（<code>--writeonly</code>）操作文件。但是，出于安全考虑，开发者决定这两种模式不能同时启用。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> argv</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">yargs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">argv</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 用户尝试使用 --readonly 和 --writeonly 两个选项</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">argv</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readonly</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9;"> argv</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writeonly</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">ERR_INCOMPATIBLE_OPTION_PAIR: --readonly and --writeonly cannot be used together.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设接下来是对文件的处理逻辑</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">argv</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">readonly</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The file will be opened in read-only mode.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">argv</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">writeonly</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The file will be opened in write-only mode.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果用户运行这个脚本并尝试同时使用 <code>--readonly</code> 和 <code>--writeonly</code> 这两个选项，比如输入命令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>node script.js --readonly --writeonly</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>那么他们将会收到如下错误信息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error: ERR_INCOMPATIBLE_OPTION_PAIR: --readonly and --writeonly cannot be used together.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个错误是编程者故意设计的，用来告知用户这两个选项不应该被同时使用。</p><p>在 Node.js 标准库中，也存在一些函数和方法，它们接受参数时会有类似的限制。如果你在使用 Node.js API 时遇到 <code>ERR_INCOMPATIBLE_OPTION_PAIR</code> 错误，最好的做法是回到文档中查看相关函数的参数规范，确保你没有同时使用了不兼容的选项。</p><p>记住，在编程中，阅读文档是解决问题的重要手段。当你遇到任何不确定的行为或错误时，Node.js 的官方文档是非常好的资源来帮助你理解问题所在，并找到正确的解决方案。</p><h3 id="err-input-type-not-allowed" tabindex="-1"><a class="header-anchor" href="#err-input-type-not-allowed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_input_type_not_allowed" target="_blank" rel="noopener noreferrer">ERR_INPUT_TYPE_NOT_ALLOWED</a></span></a></h3><p>在 Node.js 中，<code>ERR_INPUT_TYPE_NOT_ALLOWED</code>是一个错误代码，它表示你尝试使用了一种不被允许的输入类型。在 Node.js 的某些函数或方法中，参数需要符合特定的类型，比如字符串、数字或者是一个对象。如果你传递了一个不正确的类型，Node 就可能抛出这个错误。</p><p>这个错误通常与 Node.js 内部的 API 调用有关，尤其是当 Node.js 期待一个特定类型的输入时，但接收到的实际上是其他类型的输入时。这个错误是 Node.js v21.7.1 引入的新特性之一。</p><p>让我们通过几个简单的例子来解释这个错误。</p><p>假设有一个 Node.js 函数只接受字符串作为输入：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> processInput</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> input</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">string</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_INPUT_TYPE_NOT_ALLOWED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 剩下的处理逻辑...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果你尝试传递一个非字符串类型的变量给<code>processInput</code>函数，比如一个数字或者对象，那么它将会抛出<code>ERR_INPUT_TYPE_NOT_ALLOWED</code>错误。</p><p>现在，让我们用一个更具体的 Node.js API 的例子。考虑到文件系统模块（fs），假设你正在使用<code>fs.writeFileSync()</code>函数写文件，这个函数期望得到文件路径作为字符串和要写入的数据。如果你不小心传递了一个非字符串类型的路径，就会遇到此问题。</p><p>正确的调用方式应该是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的调用方式，路径是一个字符串</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误的调用方式可能是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的调用方式，路径不是一个字符串，而是一个数字</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到ERR_INPUT_TYPE_NOT_ALLOWED错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个错误的例子里，我们尝试将数字<code>12345</code>作为文件名传递给<code>writeFileSync</code>函数，这明显是不正确的，因为文件名应该是一个字符串。Node.js 会检查传递的参数类型，并且因为找到了不匹配的类型，所以会抛出<code>ERR_INPUT_TYPE_NOT_ALLOWED</code>错误。</p><p>每次遇到这个错误时，都应该检查你的代码中的相关函数调用，确保你传递的参数是正确的类型。如果文档指出一个参数应该是字符串，确保你没有错误地传递了其他类型的值，像数字或对象等。这样就可以避免<code>ERR_INPUT_TYPE_NOT_ALLOWED</code>错误的发生。</p><h3 id="err-inspector-already-activated" tabindex="-1"><a class="header-anchor" href="#err-inspector-already-activated"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_already_activated" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_ALREADY_ACTIVATED</a></span></a></h3><p>好的，Node.js 中的 <code>ERR_INSPECTOR_ALREADY_ACTIVATED</code> 错误是关于 Node.js 的调试器的一个错误。在解释这个错误之前，我先简单介绍一下 Node.js 和它的调试器。</p><p>Node.js 是一个可以让你使用 JavaScript 语言编写服务器端代码的运行时环境。它非常适合处理高并发、I/O 密集型的网络应用。Node.js 自带了一个内置的调试工具，这个工具可以让我们检查和调试正在运行的 Node.js 应用程序。</p><p>当你启动 Node.js 的调试器，并且想要再次激活或者启动同一个调试会话时，就会遇到 <code>ERR_INSPECTOR_ALREADY_ACTIVATED</code> 这个错误。这个错误的意思是说调试器已经在运行中，你不能再次启动它。每个 Node.js 进程只能启动一个调试会话。</p><p>以下是几个实际的场景，你可能会遇到这个错误：</p><ol><li><p>假设你在命令行上启动了 Node.js 的调试器，使用如下命令：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect</span><span style="color:#A3BE8C;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个命令会开启对 <code>your-script.js</code> 文件的调试。如果你在不关闭当前调试会话的情况下，尝试在另一个命令行窗口重复上面的命令，你将会得到 <code>ERR_INSPECTOR_ALREADY_ACTIVATED</code> 错误，因为调试器已经在第一次的命令中被激活了。</p></li><li><p>在一些自动化工具或脚本中，你可能会无意中多次启动调试器，例如：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 如果在程序中添加了这两行代码：</span></span>
<span class="line"><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">9229</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">9229</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 第二次调用</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二次调用 <code>open</code> 方法时，会抛出 <code>ERR_INSPECTOR_ALREADY_ACTIVATED</code> 错误，因为你已经在第一次调用时启动了调试器。</p></li></ol><p>要解决这个错误，你需要确保在任何给定时间只有一个调试器会话在运行。如果你意外地碰到了这个错误，检查你的代码或者你的启动命令，确保没有多次激活调试器。如果是在命令行操作，关闭已经打开的调试会话，然后重新启动你的 Node.js 应用即可。</p><h3 id="err-inspector-already-connected" tabindex="-1"><a class="header-anchor" href="#err-inspector-already-connected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_already_connected" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_ALREADY_CONNECTED</a></span></a></h3><p><code>ERR_INSPECTOR_ALREADY_CONNECTED</code> 是 Node.js 中特定的一个错误代码，它属于运行时错误。在 Node.js 中，错误代码通常用来唯一标识和描述出现的问题。当你看到这个错误时，它意味着你尝试建立一个到 Node.js 的检查器（inspector）的连接，但是检查器已经有一个活跃的连接了。</p><p>Node.js 的检查器允许开发者连接调试工具到正在运行的 Node.js 进程，以便进行代码的断点调试、性能分析等。通常情况下，你会希望在任何时间只有一个调试会话连接到应用程序。如果你尝试创建另一个连接，当已经有一个存在时，Node.js 就会抛出 <code>ERR_INSPECTOR_ALREADY_CONNECTED</code> 错误。</p><p>举个例子来解释：</p><ol><li>假设你在本机上运行了一个 Node.js 应用程序，并启用了检查器。</li><li>你打开了 Chrome 浏览器，输入了 <code>chrome://inspect</code> 并连接到了你的 Node.js 应用程序进行调试。</li><li>然后，不关闭第一个连接，你尝试再次从另一个浏览器窗口或者调试工具连接到相同的 Node.js 应用程序。</li><li>此时，因为检查器已经有了一个活动的连接，Node.js 就会报告 <code>ERR_INSPECTOR_ALREADY_CONNECTED</code> 错误。</li></ol><p>要解决这个错误，你需要确保在任何时候只有一个调试客户端连接到 Node.js 检查器。如果你意外地遇到了这个错误，检查你是否已经打开了多个调试会话，确保关闭其他所有调试会话，然后重试连接。</p><h3 id="err-inspector-closed" tabindex="-1"><a class="header-anchor" href="#err-inspector-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_closed" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_CLOSED</a></span></a></h3><p>Node.js 是一个运行在服务端的 JavaScript 环境，可以让你使用 JavaScript 来编写服务器端代码。Node.js 提供了很多内建模块，帮助开发者完成不同的任务，比如文件系统操作、网络请求等。</p><p>在 Node.js 中，有时会涉及到调试代码。调试是一种找出程序中错误（也称为“bugs”）和问题的过程。Node.js 有一个叫做 Inspector 的功能，它提供了一个调试器，可以让开发者检查运行中的 Node.js 应用程序，并且可以实时地查看变量值、设置断点、单步执行代码等。</p><p>当你在 Node.js 中看到 <code>ERR_INSPECTOR_CLOSED</code> 这个错误时，这意味着你尝试去使用 Inspector 来进行调试，但是由于某些原因，Inspector 已经关闭了，导致你无法继续使用它来调试你的代码。</p><p>比如说，你可能在命令行中启动了 Node.js 调试器，然后连接了一个调试客户端 (比如 Chrome DevTools) 到 Node.js 进程。如果在调试过程中，Inspector 关闭了（例如，可能是因为 Node.js 进程结束了），但你的调试客户端还在尝试发送命令或获取信息，就会触发 <code>ERR_INSPECTOR_CLOSED</code> 错误。</p><p>这里有一个简单的例子说明：</p><p>假设你正在用以下命令启动 Node.js 的调试器：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect-brk</span><span style="color:#A3BE8C;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个命令启动了 Node.js 的调试器，并使得你的脚本在开始执行前暂停，以便你可以将调试工具连接上来。</p><p>你可能会打开 Chrome 浏览器，输入 <code>chrome://inspect</code> 并连接到你的 Node.js 进程。现在，你可以在开发者工具中查看变量、设置断点并单步执行代码。</p><p>如果在这个过程中，Node.js 进程由于某些原因（比如按下 Ctrl+C 或者代码中有未捕获的异常导致进程退出）而结束了，调试器也随之关闭了。但是，如果你的浏览器调试工具仍然试图与已经关闭的调试器通信，那么就会遇到 <code>ERR_INSPECTOR_CLOSED</code> 错误。</p><p>要解决这个问题，你通常需要重新启动 Node.js 进程，并再次连接调试工具。如果你频繁遇到这个问题，你可以检查你的代码看是否有使 Node.js 非正常结束的 bug，或者确认是否正确地管理了调试器的生命周期。</p><h3 id="err-inspector-command" tabindex="-1"><a class="header-anchor" href="#err-inspector-command"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_command" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_COMMAND</a></span></a></h3><p>好的，我会直接回答你的问题。</p><p><code>ERR_INSPECTOR_COMMAND</code>这个错误是在 Node.js 中与调试器（Inspector）交互时可能遇到的一个错误类型。在 Node.js v21.7.1 中，如果你使用的 Node.js 内置的调试工具或 API 发送给 V8 引擎的调试命令无效、不被识别或者以某种方式出错了，就有可能抛出这个错误。</p><p>首先，让我们理解一下背景：</p><h3 id="node-js-和-v8-引擎" tabindex="-1"><a class="header-anchor" href="#node-js-和-v8-引擎"><span>Node.js 和 V8 引擎</span></a></h3><ul><li>Node.js 是一个运行在服务器上的 JavaScript 环境，它允许你用 JavaScript 编写后端代码。</li><li>V8 引擎是 Google 开发的 JavaScript 引擎，它也是 Node.js 的核心组成部分，负责解析和执行 JavaScript 代码。</li></ul><h3 id="调试器-inspector" tabindex="-1"><a class="header-anchor" href="#调试器-inspector"><span>调试器（Inspector）</span></a></h3><ul><li>调试器是一个用于检查和调试代码的工具，它可以让你设置断点、观察变量值、单步执行代码等。</li><li>Node.js 提供了一个 Inspector API，它允许你通过网络协议与 Node.js 进程中的 V8 引擎进行通信，进行调试操作。</li></ul><p>当你在 Node.js 中用调试器与 V8 引擎交互时，你会发送一些特定的命令来控制调试过程，比如设置断点、获取当前执行的栈信息等。如果这个过程中发送的命令有误，Node.js 就会抛出<code>ERR_INSPECTOR_COMMAND</code>错误。</p><h3 id="例子" tabindex="-1"><a class="header-anchor" href="#例子"><span>例子</span></a></h3><p>假设你正在使用 Node.js Inspector API 编写一个脚本来和 Node.js 的调试器通信，以下是一个非常简化的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Session</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们发送了一个格式错误的命令</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">post</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Debugger.nonExistentCommand</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 这里我们可能会遇到 ERR_INSPECTOR_COMMAND 错误，</span></span>
<span class="line"><span style="color:#616E88;">    // 因为发送了一个不存在的命令：&#39;Debugger.nonExistentCommand&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们尝试发送一个名为<code>&#39;Debugger.nonExistentCommand&#39;</code>的命令，但因为这个命令并不存在，所以 Node.js 会返回<code>ERR_INSPECTOR_COMMAND</code>错误。</p><h3 id="如何处理这个错误-2" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-2"><span>如何处理这个错误</span></a></h3><p>当你遇到<code>ERR_INSPECTOR_COMMAND</code>错误时，应该检查你的调试命令是否正确，是否使用了正确的 API 方法和参数。通常，目前最新的 Node.js 文档会列出所有有效的调试命令和它们的参数，这样你就可以确认你的命令是否有误。</p><p>总结一下，<code>ERR_INSPECTOR_COMMAND</code>是一个与 Node.js 调试相关的错误，表示你发送给 V8 引擎的调试命令出现了问题。处理这个错误的关键是确保你的命令是正确的，并且按照 Node.js 文档中描述的那样使用 Inspector API。</p><h3 id="err-inspector-not-active" tabindex="-1"><a class="header-anchor" href="#err-inspector-not-active"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_not_active" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_NOT_ACTIVE</a></span></a></h3><p>Node.js 中的<code>ERR_INSPECTOR_NOT_ACTIVE</code>错误是一个特定类型的错误，它表明你尝试进行的操作需要 Node.js 的检查器（Inspector）功能，但是这个功能在当前的运行环境中没有被激活或者启用。</p><p>Node.js 的检查器允许开发人员对正在运行的 Node.js 程序进行检查和调试。这种功能类似于浏览器提供的开发者工具，可以让你检查变量的值、单步执行代码、查看调用栈等等。</p><p>通常情况下，如果你看到了<code>ERR_INSPECTOR_NOT_ACTIVE</code>这个错误，意味着你的代码或者使用的某个工具尝试连接到 Node.js 的检查器接口，但是这个接口没有被启用。</p><p>如何解决这个问题？首先，确保当你启动 Node.js 程序时，要加上正确的标志来启用检查器。这通常是通过添加<code>--inspect</code>或者<code>--inspect-brk</code>标志来完成的。比如：</p><ol><li><code>node --inspect your-app.js</code> - 这将启动你的 Node.js 应用并且激活检查器接口。</li><li><code>node --inspect-brk your-app.js</code> - 类似于上面的命令，但是会在第一行代码执行之前暂停，以便给你时间来打开一个调试器并连接上去。</li></ol><p><strong>实际例子：</strong></p><p>假设你正在写一个 Web 服务器，并且你想调试它。</p><p>没有启用检查器，简单地运行：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在，如果你的服务器代码里有一段是尝试连接到 Node.js 的检查器接口的，比如使用了某些库或工具，那么你可能会遇到<code>ERR_INSPECTOR_NOT_ACTIVE</code>错误。</p><p>为了解决这个问题，你需要这样启动你的服务器：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect</span><span style="color:#A3BE8C;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者如果你想在代码开始执行前就暂停（这对于调试初始化阶段的代码很有用），你可以使用：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect-brk</span><span style="color:#A3BE8C;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>一旦启动了带有检查器的 Node.js 进程，你可以使用浏览器（如 Chrome）或者专门的 IDE（如 Visual Studio Code）来连接到这个检查器接口。通常在浏览器中输入<code>chrome://inspect/</code>并查找目标设备来连接你的 Node.js 进程即可。</p><p>注意：为了让检查器能够连接，你的应用可能需要在没有其他错误的情况下正常启动。如果你的应用在启动时遇到了其他错误，那么即使你使用了<code>--inspect</code>标志，检查器也可能无法正常工作，因为程序本身没能顺利运行起来。</p><h3 id="err-inspector-not-available" tabindex="-1"><a class="header-anchor" href="#err-inspector-not-available"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_not_available" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_NOT_AVAILABLE</a></span></a></h3><p><code>ERR_INSPECTOR_NOT_AVAILABLE</code> 是一个错误类型，它是在 Node.js 中使用 <code>inspector</code> 模块时抛出的。如果你尝试使用 Node.js 的调试器或性能分析工具，但这些工具无法正常启动或不可用，就会遇到这个问题。</p><p>让我们先介绍一下背景知识。Node.js 有一个内置模块叫做 <code>inspector</code>，这个模块允许开发者连接到运行中的 Node.js 进程进行检查，就像你可以在浏览器中检查网页代码一样。通过 <code>inspector</code> 模块，你可以做很多事情，比如设置断点、查看调用栈、进行性能分析等。</p><p>现在，假设你想分析你的 Node.js 应用程序的性能，以确定哪些函数执行时间最长。你可以使用 <code>inspector</code> 来启动 Node.js 的性能分析器。但是，如果 <code>inspector</code> 不可用（也就是说，Node.js 没有编译支持调试器的功能或者由于某些原因被禁用了），你会收到 <code>ERR_INSPECTOR_NOT_AVAILABLE</code> 错误。</p><p>错误的实际应用例子可能如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">inspector</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">url</span><span style="color:#D8DEE9FF;">() </span><span style="color:#81A1C1;">===</span><span style="color:#81A1C1;"> undefined</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Inspector is not available</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试导入 <code>inspector</code> 模块，并利用 <code>url()</code> 方法来查看是否可以连接到 Node.js 的调试器。如果返回值是 <code>undefined</code>，那么调试器不可用，我们抛出一个错误信息。</p><p>通常，遇到这个错误的情况很少，因为大多数默认的 Node.js 安装都包含<code>inspector</code>模块。但如果你在特定的环境下运行 Node.js，比如某些限制较多的生产环境，或者你使用了一个特别编译的 Node.js 版本，它可能没有包含这个模块，那么你就可能遇到 <code>ERR_INSPECTOR_NOT_AVAILABLE</code> 这个错误。</p><p>解决方法通常涉及以下步骤：</p><ol><li>确认你使用的 Node.js 版本是官方提供的标准版本。</li><li>检查你的 Node.js 是否是以某种方式编译的，该方式排除了 <code>inspector</code> 模块。</li><li>如果你在容器里运行 Node.js（例如 Docker 容器），确认相关配置没有禁用调试器。</li><li>查阅文档或社区寻求帮助，了解如何启用 <code>inspector</code> 功能。</li></ol><p>记住，这类错误通常发生在初始化检查或调试代码时，并不会影响你的主要应用逻辑。因此，即使你遇到了这个错误，你的应用通常还是可以运行的，只是不能使用 Node.js 提供的调试和性能分析工具。</p><h3 id="err-inspector-not-connected" tabindex="-1"><a class="header-anchor" href="#err-inspector-not-connected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_not_connected" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_NOT_CONNECTED</a></span></a></h3><p>当你在 Node.js 中遇到<code>ERR_INSPECTOR_NOT_CONNECTED</code>这个错误时，它通常意味着你试图使用 Node.js 的调试器或检查器功能，但是出于某种原因，没有成功建立连接。</p><p>Node.js 内置了一个叫做 Inspector 的工具，这个工具允许你调试和分析运行中的 Node.js 程序。例如，你可以用它来设置断点（程序执行到某一行时暂停），查看变量的值，或者跟踪性能问题等。</p><p>要启动 Inspector，你通常需要在启动 Node.js 应用程序时加上特定的标志（例如 <code>--inspect</code> 或 <code>--inspect-brk</code>）。然后，你可以通过一个支持 Inspector 协议的客户端，比如 Chrome 浏览器的开发者工具，来连接到这个正在运行的 Node.js 进程。</p><p>以下是几个实际的例子:</p><ol><li><p>启动 Node.js 应用并开启调试：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect</span><span style="color:#A3BE8C;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这会启动 Node.js 应用，并且应用将准备好接受调试器的连接。</p></li><li><p>如果你想在应用开始时就暂停执行（例如，你想在初次代码执行前设置断点），你可以使用：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --inspect-brk</span><span style="color:#A3BE8C;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这会在第一行代码执行前暂停，等待调试器连接。</p></li><li><p>使用 Chrome 浏览器作为调试客户端：<br> 打开 Chrome 浏览器，输入 <code>chrome://inspect</code> 并回车。点击 “Open dedicated DevTools for Node”，这样就会打开开发者工具，并自动连接到 Node.js 进程。</p></li></ol><p>如果在尝试进行以上操作时出现了<code>ERR_INSPECTOR_NOT_CONNECTED</code>错误，那么可能的原因有：</p><ul><li>没有启动 Node.js 应用程序带有正确的调试标志。</li><li>调试端口（默认是 9229）可能被其他进程占用或被防火墙阻止。</li><li>试图连接调试器的时间太晚，可能已经错过了连接窗口期。</li><li>Node.js 运行在一个不支持调试器连接的环境中，比如某些容器化环境可能没有暴露必要的端口。</li></ul><p>在任何情况下，处理这个错误的第一步就是确认 Node.js 进程是否正确运行并开启了监听调试连接的端口，以及确保没有任何网络或权限问题阻碍了调试器的连接。</p><h3 id="err-inspector-not-worker" tabindex="-1"><a class="header-anchor" href="#err-inspector-not-worker"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_inspector_not_worker" target="_blank" rel="noopener noreferrer">ERR_INSPECTOR_NOT_WORKER</a></span></a></h3><p>好的，我来解释一下 Node.js 中的 <code>[ERR_INSPECTOR_NOT_WORKER]</code> 错误。</p><p>在 Node.js 中，<code>[ERR_INSPECTOR_NOT_WORKER]</code> 是一个错误代码，代表了一个特定类型的问题，即你试图在非工作线程(Worker threads)中使用检查器（Inspector）功能。这个错误是当你尝试在主线程中进行一些本应在工作线程中执行的调试或检查行为时触发的。</p><p>首先，解释一下几个概念：</p><ol><li><strong>Node.js</strong>: 是一个基于 Chrome V8 JavaScript 引擎的 JavaScript 运行环境，可以让你在服务器端运行 JavaScript 代码。</li><li><strong>Inspector</strong>: Node.js 的检查器，它允许开发者调试和分析 Node.js 应用。它提供了一个接口给开发工具（比如 Chrome 开发者工具），让其能连接到 Node.js 应用上进行调试。</li><li><strong>工作线程（Worker threads）</strong>: 在 Node.js 环境中，主线程外的线程叫做工作线程。它们可以用来处理计算密集型任务，从而不阻塞主线程。</li></ol><p>现在我们来看看 <code>ERR_INSPECTOR_NOT_WORKER</code> 错误的情景。在 Node.js 中，如果你在主线程启动了 Inspector，并尝试在主线程中做一些只能在 worker 线程里做的事情，那么 Node.js 就会抛出 <code>ERR_INSPECTOR_NOT_WORKER</code> 错误。这通常意味着你的代码有逻辑错误，你需要将那部分代码移动到 worker 线程中去执行。</p><p><strong>实际例子</strong>：</p><p>想象你写了一段 Node.js 代码，希望利用多线程来加速一个数据处理任务。你创建了一个工作线程来执行这个任务，并且你想要对这个工作线程进行调试。但是，如果你错误地在主线程启动了 Inspector 然后尝试调试工作线程，你可能会遇到 <code>ERR_INSPECTOR_NOT_WORKER</code> 错误。</p><p>正确的方式是，在你创建的工作线程内部启动 Inspector，并在那里设置断点或其他调试操作。</p><p>这是一个简化的代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 这里是主线程代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">主线程: 工作线程已经启动</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里是工作线程代码</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设我们在这里尝试启动 Inspector</span></span>
<span class="line"><span style="color:#616E88;">    // 但在 Node.js 中这个操作是不被允许的</span></span>
<span class="line"><span style="color:#616E88;">    // 所以会抛出 ERR_INSPECTOR_NOT_WORKER 错误</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> inspector</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    inspector</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">9229</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> true</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // ... 这里是工作线程的任务 ...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_INSPECTOR_NOT_WORKER</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">只有在工作线程中才能启动 Inspector</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出其他错误</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，如果 <code>inspector.open</code> 被调用在非工作线程（即主线程）中，Node.js 将会抛出 <code>ERR_INSPECTOR_NOT_WORKER</code> 错误。正确的做法是确保 Inspector 相关的代码只在工作线程中被调用。</p><h3 id="err-internal-assertion" tabindex="-1"><a class="header-anchor" href="#err-internal-assertion"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_internal_assertion" target="_blank" rel="noopener noreferrer">ERR_INTERNAL_ASSERTION</a></span></a></h3><p>Node.js 中的 <code>[ERR_INTERNAL_ASSERTION]</code> 是一个错误类型，它指示在 Node.js 的内部发生了一个断言失败。所谓断言（assertion），是一种编程中常用的检查手段，用于保证代码在执行过程中某些条件总是为真。如果这些条件不为真，程序就会抛出错误，因为这通常表明程序内部有一个逻辑错误，或是出现了不符合预期的情况。</p><p>在 Node.js 中，这个错误通常是由 Node.js 的内部函数或方法触发的，不是由用户代码直接引起的。换句话说，当你遇到这个错误时，很有可能是 Node.js 自身的一个 bug，而非你的应用代码有问题。然而，在极少数情况下，也可能是因为用户的代码以某种方式触发了 Node.js 的一个边缘情况。</p><p>例子方面，因为 <code>[ERR_INTERNAL_ASSERTION]</code> 错误涉及 Node.js 的内部实现，普通用户很难自行构造出一个例子来演示这类错误。但是我可以给你一个模拟的场景：</p><p>假设 Node.js 有一个内部函数 <code>internalFunction</code>，该函数期望其参数 <code>number</code> 总是一个正数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> internalFunction</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">number</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这是一个内部断言，确保传入的数字总是大于0</span></span>
<span class="line"><span style="color:#88C0D0;">  assert</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">number</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number should be a positive value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 做一些基于这个假设的操作...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果由于某些原因，内部代码调用了 <code>internalFunction</code> 并且传入了一个非正数，那么断言会失败，这将导致一个 <code>[ERR_INTERNAL_ASSERTION]</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">internalFunction</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这会触发断言失败，因为 -1 不是正数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在实际应用中，你作为开发者不需要（也不太可能）处理这种错误。如果你在你的 Node.js 应用程序中碰到了这个错误，最佳的做法是搜索相关的 Node.js issue，看是否已经有人报告了相同的问题，或者提交一个新的 issue 到 Node.js 的 GitHub 仓库，以便 Node.js 团队可以修复它。同时，确保你使用的 Node.js 版本是最新的，因为错误可能已经在新版本中被修复。</p><h3 id="err-invalid-address-family" tabindex="-1"><a class="header-anchor" href="#err-invalid-address-family"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_address_family" target="_blank" rel="noopener noreferrer">ERR_INVALID_ADDRESS_FAMILY</a></span></a></h3><p><code>ERR_INVALID_ADDRESS_FAMILY</code> 是 Node.js 中的一个错误码，当你尝试在不支持指定网络地址族（例如 IPv4 或 IPv6）的 API 上操作时，就会遇到这个错误。</p><p>首先，了解一下网络地址族的概念。在互联网中，我们通常使用 IP 地址来识别每台机器。这些 IP 地址分为两类：IPv4 和 IPv6。IPv4 地址由四组数字组成，如 <code>192.168.1.1</code>，而 IPv6 地址则更长，看起来像 <code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>。</p><p>当你在 Node.js 中编程时，有时你需要指定使用哪种类型的 IP 地址。如果你指明了一个操作只适用于 IPv4 地址，但却提供了一个 IPv6 地址，Node.js 就会抛出 <code>ERR_INVALID_ADDRESS_FAMILY</code> 错误。</p><p>举几个例子：</p><p><strong>例子 1：创建 TCP 服务器</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 TCP 服务器，仅接受 IPv4 连接</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> family</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 4</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2001:0db8:85a3:0000:0000:8a2e:0370:7334</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试启动一个只接受 IPv4 连接的 TCP 服务器，并尝试监听一个 IPv6 地址。因为设置了 <code>family: 4</code>（意味着只接受 IPv4），同时却提供了一个 IPv6 地址进行监听，Node.js 就会抛出 <code>ERR_INVALID_ADDRESS_FAMILY</code> 错误。</p><p><strong>例子 2：DNS 解析</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dns</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dns</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试使用 IPv4 方法解析一个 IPv6 地址</span></span>
<span class="line"><span style="color:#D8DEE9;">dns</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">lookup</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> family</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 4</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> family</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">地址:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> address</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">地址族:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> family</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们使用 <code>dns</code> 模块的 <code>lookup</code> 函数来解析域名 <code>example.com</code> 的 IP 地址，并要求返回结果为 IPv4 格式。现实中并不会抛出 <code>ERR_INVALID_ADDRESS_FAMILY</code> 错误，因为 <code>example.com</code> 很可能同时拥有 IPv4 和 IPv6 地址，且 DNS 解析会根据请求的地址族返回正确类型的地址。但是，如果有一个特定场景强制要求使用 IPv4 地址去访问一个仅有 IPv6 地址的资源，那么 <code>ERR_INVALID_ADDRESS_FAMILY</code> 错误便有可能发生。</p><p>要解决 <code>ERR_INVALID_ADDRESS_FAMILY</code> 的问题，确保你使用的地址与指定的地址族匹配。如果你的应用需要同时支持 IPv4 和 IPv6，那么请不要在 API 调用中硬编码地址族，允许它根据实际情况自动选择使用 IPv4 或 IPv6。</p><h3 id="err-invalid-arg-type" tabindex="-1"><a class="header-anchor" href="#err-invalid-arg-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_arg_type" target="_blank" rel="noopener noreferrer">ERR_INVALID_ARG_TYPE</a></span></a></h3><p><code>ERR_INVALID_ARG_TYPE</code> 是 Node.js 中一个常见的错误类型，它表示函数接收到了错误类型的参数。这意味着当你在代码中调用一个函数或方法时，你需要传递特定类型的参数（比如字符串、数字等），但是你传递的参数类型不正确。</p><p>让我们来看一个简单的例子：</p><p>假设在 Node.js 中有一个函数叫 <code>addNumbers</code>，它的功能是将两个数字相加。这个函数期望接收两个数字类型的参数。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> addNumbers</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> ||</span><span style="color:#81A1C1;"> typeof</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TypeError</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">The &quot;a&quot; and &quot;b&quot; arguments must be of type number.</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你尝试用非数字类型的值来调用这个函数，比如一个字符串：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> addNumbers</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">not a number</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>那么就会引发一个 <code>TypeError</code> 错误，并给出一条信息说明 <code>a</code> 和 <code>b</code> 参数必须是数字。在 Node.js 的更严格的上下文中，这会被表现为 <code>ERR_INVALID_ARG_TYPE</code>。</p><p>Node.js 自身内部的函数和方法也会抛出相同类型的错误，当你调用它们时如果传递了错误类型的参数。例如，内置的 <code>fs.writeFile</code> 函数，它用于向文件写入内容，期望第一个参数是文件路径（应该是字符串），第二个参数是要写入的数据：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的调用方式</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Node.js!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The file has been saved!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的调用方式，这里第一个参数错误地传入了一个数字。</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">123456</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Node.js!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里会捕获到 ERR_INVALID_ARG_TYPE 的错误。</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>fs.writeFile</code> 的第一个参数不是一个字符串，Node.js 会抛出 <code>ERR_INVALID_ARG_TYPE</code> 错误，告诉你传递了错误类型的参数。</p><p>处理这种类型的错误通常需要检查你的代码，确保所有参数都符合预期的类型。开发者工具和静态类型检查工具（如 TypeScript）可以帮助你在编码阶段避免这类错误。</p><h3 id="err-invalid-arg-value" tabindex="-1"><a class="header-anchor" href="#err-invalid-arg-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_arg_value" target="_blank" rel="noopener noreferrer">ERR_INVALID_ARG_VALUE</a></span></a></h3><p><code>ERR_INVALID_ARG_VALUE</code> 是 Node.js 中的一个错误类型，表示函数接收到了无效的参数值。在编程中，函数通常需要特定类型或格式的输入值才能正确工作。如果传递给函数的参数值不符合期望，Node.js 就会抛出 <code>ERR_INVALID_ARG_VALUE</code> 错误。</p><p>这个错误</p><h3 id="err-invalid-async-id" tabindex="-1"><a class="header-anchor" href="#err-invalid-async-id"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_async_id" target="_blank" rel="noopener noreferrer">ERR_INVALID_ASYNC_ID</a></span></a></h3><p><code>ERR_INVALID_ASYNC_ID</code> 是一个错误类型，在 Node.js 中代表了一个非法的异步操作标识符（async ID）。在 Node.js 的异步跟踪机制中，每一次异步操作都会分配一个唯一的标识符，也就是 async ID。当这个 ID 不正确、无效或者不匹配时，Node.js 就会抛出 <code>ERR_INVALID_ASYNC_ID</code> 错误。</p><p>在 Node.js 中，异步操作是指那些不会立即完成并且可能需要一段时间才能得到结果的操作。例如读取文件、请求网络数据、设置定时器等。异步操作允许 Node.js 在等待这类操作完成的同时去处理其他事情，这样可以提高程序的效率和响应性。</p><p>下面我们来通过几个例子更加具体地理解 <code>ERR_INVALID_ASYNC_ID</code>。</p><h3 id="实际运用的例子-11" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-11"><span>实际运用的例子</span></a></h3><p><strong>注意</strong>：以下例子是为了说明概念，但并不是推荐你在实际代码中使用的做法。出现 <code>ERR_INVALID_ASYNC_ID</code> 通常是由于内部错误或者使用了 Node.js 内部 API 的不正确方式。</p><h4 id="示例-1-使用-async-hooks-模块错误示例" tabindex="-1"><a class="header-anchor" href="#示例-1-使用-async-hooks-模块错误示例"><span>示例 1: 使用 async_hooks 模块错误示例</span></a></h4><p>Node.js 提供了一个名为 <code>async_hooks</code> 的模块，它用于跟踪系统中的异步资源（比如异步操作）。如果你尝试使用一个不存在或已经被销毁的 async ID 来执行某些操作，Node.js 就会抛出 <code>ERR_INVALID_ASYNC_ID</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> async_hooks</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">async_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们有一个无效的 async ID 值</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> invalidAsyncId</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 123456</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试触发这个无效的 async ID</span></span>
<span class="line"><span style="color:#D8DEE9;">  async_hooks</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">triggerAsyncId</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">invalidAsyncId</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将捕获并打印 ERR_INVALID_ASYNC_ID 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们错误地使用了一个不存在的 <code>async ID</code> 去触发一个异步回调，这导致 Node.js 抛出了 <code>ERR_INVALID_ASYNC_ID</code> 异常。</p><h4 id="示例-2-内部-api-使用不当" tabindex="-1"><a class="header-anchor" href="#示例-2-内部-api-使用不当"><span>示例 2: 内部 API 使用不当</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> async_hooks</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">async_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的异步操作，比如读取文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取当前执行的异步 ID</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> eid</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> async_hooks</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">executionAsyncId</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 试图使用一个不相关的 async ID 来执行某些操作</span></span>
<span class="line"><span style="color:#D8DEE9;">  async_hooks</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emitDestroy</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">eid</span><span style="color:#81A1C1;"> +</span><span style="color:#B48EAD;"> 99999</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 故意使用一个错误的 ID</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将捕获并打印 ERR_INVALID_ASYNC_ID 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在第二个例子中，我们再次使用了错误的 <code>async ID</code>，试图销毁一个不存在的异步资源，这同样会导致 <code>ERR_INVALID_ASYNC_ID</code> 错误的产生。</p><h3 id="总结-2" tabindex="-1"><a class="header-anchor" href="#总结-2"><span>总结</span></a></h3><p>简单来说，异步操作在 Node.js 中非常常见，而 <code>ERR_INVALID_ASYNC_ID</code> 错误与 async ID 相关的异常。正常情况下，开发者很少直接接触到这个错误，因为它更多地关联于 Node.js 的内部机制或者不恰当地使用了 <code>async_hooks</code> 模块。当你遇到 <code>ERR_INVALID_ASYNC_ID</code> 时，通常表示你尝试进行了某些不合理的异步操作跟踪行为，或者是使用了错误的 async ID。如果你在编写常规应用程序时遇到这个错误，很可能是因为某些内部逻辑出现了问题，需要仔细检查你的代码以找到问题源头。</p><h3 id="err-invalid-buffer-size" tabindex="-1"><a class="header-anchor" href="#err-invalid-buffer-size"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_buffer_size" target="_blank" rel="noopener noreferrer">ERR_INVALID_BUFFER_SIZE</a></span></a></h3><p>Node.js 中的 <code>[ERR_INVALID_BUFFER_SIZE]</code> 是一个错误代码，它代表你尝试操作的缓冲区（Buffer）大小不正确。在 Node.js 中，Buffer 类是用来处理二进制数据流的一种方式，比如文件读写或者网络通信中的数据传输。</p><p>当你在 Node.js 中执行某些操作需要创建或者处理 Buffer 对象时，如果提供了一个无效的大小参数，就可能会触发这个错误。有效的 Buffer 大小应该是一个介于 0 和 <code>buffer.constants.MAX_LENGTH</code> 之间的整数。如果你提供了一个负数、非数字、太大或太小的值作为 Buffer 的大小，Node.js 就会抛出 <code>ERR_INVALID_BUFFER_SIZE</code> 错误。</p><p>举例来说：</p><ol><li><p><strong>读取文件</strong>: 假设你想要从文件中读取数据到 Buffer。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果文件太大，超过了 Buffer 最大长度限制，那么 <code>readFile</code> 方法会抛出 <code>ERR_INVALID_BUFFER_SIZE</code> 错误。</p></li><li><p><strong>创建大的 Buffer</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> bufferSize</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Number</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MAX_SAFE_INTEGER</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 非常大的数值</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">bufferSize</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_INVALID_BUFFER_SIZE 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试分配一个非常大的 Buffer，如果 <code>bufferSize</code> 超过了允许的最大长度，就会抛出错误。</p></li><li><p><strong>TCP 数据通信</strong>: 当你使用 TCP 协议进行网络通信时，可能会基于 Buffer 发送和接收数据。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">port</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> hugeData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这里是一个非常大的字符串</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hugeData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果 buffer 太大，这里可能会输出 ERR_INVALID_BUFFER_SIZE</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>hugeData</code> 转换成的 Buffer 超过了最大限制，尝试发送这个 Buffer 将会导致错误。</p></li></ol><p>总的来说，<code>ERR_INVALID_BUFFER_SIZE</code> 错误提示我们正在处理的 Buffer 的尺寸不符合要求。修复这个问题通常包括检查提供给 Buffer 相关方法的大小参数，并确保它们在有效范围内。</p><h3 id="err-invalid-char" tabindex="-1"><a class="header-anchor" href="#err-invalid-char"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_char" target="_blank" rel="noopener noreferrer">ERR_INVALID_CHAR</a></span></a></h3><p><code>ERR_INVALID_CHAR</code> 是 Node.js 中的一个错误代码，表示程序中出现了无效字符。在 Node.js 中，许多操作都是基于文本的，比如读取文件、发送 HTTP 请求等。当这些操作中涉及的字符串包含不应该出现的字符时，就可能会触发 <code>ERR_INVALID_CHAR</code> 错误。</p><p>例如，如果你尝试将一个包含非法字符的文件名传递给 <code>fs</code> 模块的函数（<code>fs</code> 模块用于处理文件系统操作），Node.js 会抛出这个错误。</p><p>下面举几个实际运用中可能遇到 <code>ERR_INVALID_CHAR</code> 的例子：</p><h3 id="例子-1-文件名包含非法字符" tabindex="-1"><a class="header-anchor" href="#例子-1-文件名包含非法字符"><span>例子 1：文件名包含非法字符</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们要创建一个名为 &quot;test:file.txt&quot; 的文件，在大多数操作系统中，文件名不能包含冒号。</span></span>
<span class="line"><span style="color:#616E88;">// 这里尝试这样做，将会导致错误。</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">test:file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在这里，错误对象将包含 ERR_INVALID_CHAR</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File has been written</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，因为某些操作系统（特别是 Windows）不允许文件名中包含冒号（:），所以尝试创建这样命名的文件会触发 <code>ERR_INVALID_CHAR</code> 错误。</p><h3 id="例子-2-url-包含非法字符" tabindex="-1"><a class="header-anchor" href="#例子-2-url-包含非法字符"><span>例子 2：URL 包含非法字符</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP 请求并尝试请求一个 URL，该 URL 中包含了空格，这是非法的。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/illegal url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果 URL 不合法，这里将会输出 ERR_INVALID_CHAR</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，HTTP 协议中的 URL 是不允许包含空格的。如果你尝试使用包含空格的 URL 发起请求，就会触发 <code>ERR_INVALID_CHAR</code>。</p><h3 id="处理方法" tabindex="-1"><a class="header-anchor" href="#处理方法"><span>处理方法：</span></a></h3><p>当遇到 <code>ERR_INVALID_CHAR</code> 错误时，一般需要检查相关的字符串是否包含了非法字符，并将其修正为合法的格式。这通常意味着对输入数据进行校验和清理。</p><p>总结起来，<code>ERR_INVALID_CHAR</code> 就是 Node.js 告诉你：“嘿，你给我的这串字符里有些东西不对劲，请检查一下，然后再给我正确的字符。” 通过检查和修改代码中的字符串或文件名，可以避免这种错误的发生。</p><h3 id="err-invalid-cursor-pos" tabindex="-1"><a class="header-anchor" href="#err-invalid-cursor-pos"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_cursor_pos" target="_blank" rel="noopener noreferrer">ERR_INVALID_CURSOR_POS</a></span></a></h3><p><code>[ERR_INVALID_CURSOR_POS]</code> 是 Node.js 中的一个错误码，它表示你尝试移动控制台光标到一个不能被接受的位置。在命令行界面（CLI）中，光标是指示你当前输入位置的闪烁小方块或线条。在 Node.js 程序中，你可以使用特定的模块来控制光标在终端中的位置，比如 readline 模块。</p><p>这个错误通常出现在你使用了一些 API，比如 <code>readline.cursorTo()</code> 或 <code>readline.moveCursor()</code>，并且提供了无效的光标位置。这个位置可能超出了终端窗口的尺寸范围，例如，一个负值或者超过窗口宽度和高度的值。</p><p>下面是一些例子：</p><h3 id="实际运用例子-1" tabindex="-1"><a class="header-anchor" href="#实际运用例子-1"><span>实际运用例子</span></a></h3><p>想象一下，我们有一个简单的 Node.js 应用程序，它需要在终端窗口中移动光标。我们使用 <code>readline</code> 模块来完成这项工作。</p><h4 id="正确的移动光标示例" tabindex="-1"><a class="header-anchor" href="#正确的移动光标示例"><span>正确的移动光标示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readline</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">readline</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 将光标移动到终端的第 10 行、第 20 列位置</span></span>
<span class="line"><span style="color:#D8DEE9;">readline</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cursorTo</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 20</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这里是第 10 行，第 20 列</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码会正确执行，因为我们给 <code>cursorTo()</code> 函数提供了有效的行和列数。</p><h4 id="导致-err-invalid-cursor-pos-错误的示例" tabindex="-1"><a class="header-anchor" href="#导致-err-invalid-cursor-pos-错误的示例"><span>导致 <code>[ERR_INVALID_CURSOR_POS]</code> 错误的示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readline</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">readline</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试将光标移动到一个无效的位置</span></span>
<span class="line"><span style="color:#D8DEE9;">readline</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cursorTo</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">10</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">如果没有错误，这条信息将不会出现</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这次，我们故意给 &#39;cursorTo()&#39; 函数提供了一个负值和一个极大值，这可能超出了终端窗口的尺寸限制。当 Node.js 尝试执行这个操作时，它会抛出 <code>[ERR_INVALID_CURSOR_POS]</code> 错误，因为这个位置是无效的。</p><h3 id="如何处理这个错误-3" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-3"><span>如何处理这个错误</span></a></h3><p>遇到 <code>[ERR_INVALID_CURSOR_POS]</code> 错误时，首先要做的是检查你正在尝试设置的光标位置是否合理，确保传递给相关函数的行和列参数都是在你的终端尺寸范围内，也就是说都应该是非负数，并且不大于终端的宽度和高度。</p><p>你还可以通过编程方式获取终端的尺寸，以帮助防止这种类型的错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> rows</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> columns</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">终端大小：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">columns</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">列 x </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">rows</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">行</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取终端尺寸后，你可以根据这个范围来设置光标位置。这样做可以最大限度地减少由于光标位置无效而引发的错误。</p><h3 id="err-invalid-fd" tabindex="-1"><a class="header-anchor" href="#err-invalid-fd"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_fd" target="_blank" rel="noopener noreferrer">ERR_INVALID_FD</a></span></a></h3><p><code>ERR_INVALID_FD</code> 是 Node.js 中的一个错误代码，表示 &quot;无效的文件描述符&quot;。在 Node.js 中，文件描述符是指那些代表打开文件、套接字或其他类似资源的整数值。当你尝试使用一个无效的、已经关闭的文件描述符，或者操作系统无法识别的文件描述符进行某项操作时，就可能会遇到 <code>ERR_INVALID_FD</code> 错误。</p><p>通俗来说，文件描述符就像是餐馆里每个桌子上的号码牌。服务员（Node.js）用这个号码牌找到相应的桌子（文件），然后提供服务（读写数据等）。如果号码牌不对，或者这个号码牌对应的桌子已经不存在了，服务员就会告诉你出错了，也就是 <code>ERR_INVALID_FD</code>。</p><p>让我们举几个具体的例子来说明这个概念：</p><ol><li><p><strong>尝试从一个已经关闭的文件中读取数据：</strong><br> 假设你用 Node.js 编写了一段代码，首先你打开了一个文件进行读写操作，完成操作之后，你关闭了这个文件。但是，由于某种原因，你的代码又尝试去读取这个已经关闭的文件，这时候就会出现 <code>ERR_INVALID_FD</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 打开文件获取文件描述符</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fd</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">openSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">r</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 关闭文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">closeSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次从该文件描述符读取内容，将会抛出 ERR_INVALID_FD 错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>错误地使用文件描述符：</strong><br> 如果你尝试对一个非文件描述符的值执行文件操作，比如传入一个字符串或者错误的数字，Node.js 将无法识别它作为有效的文件描述符，同样会报出 <code>ERR_INVALID_FD</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里假设我们错误地将文件描述符设置为字符串</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fd</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some_invalid_fd</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试从该 &quot;文件描述符&quot; 读取内容，将会抛出 ERR_INVALID_FD 错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>文件描述符超出范围：</strong><br> 在 Unix-like 系统中，每个进程有限制它可以打开的文件数量。如果你尝试引用一个超出这个范围的文件描述符，也会触发 <code>ERR_INVALID_FD</code> 错误。</p></li></ol><p>解决 <code>ERR_INVALID_FD</code> 错误的方法通常涉及确保你的文件描述符是有效的，并且你没有尝试对一个已经关闭的文件执行操作。处理文件时要记得正确管理文件的打开和关闭，避免资源泄漏也是很重要的。</p><h3 id="err-invalid-fd-type" tabindex="-1"><a class="header-anchor" href="#err-invalid-fd-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_fd_type" target="_blank" rel="noopener noreferrer">ERR_INVALID_FD_TYPE</a></span></a></h3><p>当你在使用 Node.js 时，有时可能会遇到各种错误信息，理解它们将有助于你更好地进行调试。<code>ERR_INVALID_FD_TYPE</code> 是 Node.js 中的一种错误类型，它通常与文件描述符（file descriptor）的用法有关。现在我会尽量用简单易懂的语言解释这个错误，并给出一些例子。</p><p>首先，我们得知道什么是文件描述符（FD）。在操作系统中，文件描述符是一个数字，它代表了一个打开的文件、套接字(socket)、管道(pipe)或其他输入/输出资源。它像是这个资源的标签，让系统能够识别和管理资源。在 Node.js 中，我们经常利用文件描述符来进行文件操作，网络通信等。</p><p><code>ERR_INVALID_FD_TYPE</code> 错误意味着你尝试对一个不正确类型的文件描述符执行操作。举个例子，如果你尝试读取一个用于网络通信的文件描述符，而不是用于文件操作的文件描述符，就会引发这个错误。</p><h3 id="实际运用的例子-12" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-12"><span>实际运用的例子：</span></a></h3><p>假设我们有以下几个场景：</p><p><strong>例子 1: 错误地使用文件描述符</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 打开一个文件获取文件描述符</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">r</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fd</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设我们想要写数据到文件，但我们只有读权限的文件描述符</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 这里我们可能会得到 ERR_INVALID_FD_TYPE 错误，因为文件是以读模式打开的</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error writing to file:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#616E88;">    // 关闭文件描述符</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例子 2: 使用已关闭的文件描述符</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">r</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fd</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 正确地使用文件描述符来读取内容</span></span>
<span class="line"><span style="color:#D8DEE9;">  fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1024</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> bytesRead</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 之后我们关闭文件描述符</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">      // 接下来，试图再次使用这个文件描述符</span></span>
<span class="line"><span style="color:#D8DEE9;">      fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1024</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">          // 这里会报错，因为文件描述符已经被关闭了</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error reading from file:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述两个例子中，如果你收到了 <code>ERR_INVALID_FD_TYPE</code> 错误，它通常是告诉你：你尝试的操作与文件描述符当前的状态或类型不匹配。这要求你检查文件描述符是否是正确的类型，并且是处于有效状态，即它还没有被关闭，同时你拥有适当的权限去进行当前的操作。</p><p>总结一下，处理这个错误的关键是要理解你的文件描述符指向什么类型的资源，你有哪些权限，以及确保在操作前该描述符是处于打开状态的。希望这个解释和例子能帮助你理解 <code>ERR_INVALID_FD_TYPE</code> 的含义。</p><h3 id="err-invalid-file-url-host" tabindex="-1"><a class="header-anchor" href="#err-invalid-file-url-host"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_file_url_host" target="_blank" rel="noopener noreferrer">ERR_INVALID_FILE_URL_HOST</a></span></a></h3><p>Node.js 中的<code>ERR_INVALID_FILE_URL_HOST</code>错误通常与文件 URL 相关。在 Node.js 中，你有时可能会处理包含文件路径的 URL，而这些 URL 遵循特定的格式。</p><p>一个文件 URL 的标准格式如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>file://hostname/path/to/file</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>其中，<code>hostname</code>是文件所在的主机名（对于本地文件，这通常为空或为<code>localhost</code>），而<code>path/to/file</code>是到文件的路径。</p><p>当你尝试使用一个文件 URL，但 URL 的主机名部分不正确时，就会抛出<code>ERR_INVALID_FILE_URL_HOST</code>错误。在大多数操作系统中，访问本地文件系统时，我们期望该主机名为空或指向本机（<code>localhost</code>）。如果在文件 URL 中提供了一个无效的主机名，Node.js 就会抛出这个错误，因为它不知道如何处理这个非法的主机名。</p><p>例如，假设有以下几种情况：</p><p><strong>有效的文件 URL：</strong></p><ol><li><code>file:///C:/path/to/file.txt</code> - Windows 上的一个有效的本地文件 URL。</li><li><code>file:///etc/config</code> - UNIX/Linux 系统上的有效的本地文件 URL。</li></ol><p><strong>无效的文件 URL（可能导致<code>ERR_INVALID_FILE_URL_HOST</code>）：</strong></p><ol><li><code>file://hostname/path/to/file.txt</code> - 如果<code>hostname</code>不是有效的主机名。</li><li><code>file://somehost/etc/config</code> - 在大多数本地文件系统场景中，<code>somehost</code>是无效的。</li></ol><p>来看一个实际的例子，在 Node.js 代码中，你可能会尝试使用内置的<code>fs</code>模块以 URL 的形式读取一个文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file://hostname/path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileUrl</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">contents</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">contents</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试把一个文件 URL 传递给<code>fs.readFile</code>方法。如果<code>hostname</code>部分不符合预期—比如，它不是空的或者是<code>localhost</code>（对本地文件而言）—Node.js 将无法找到文件，并且会抛出<code>ERR_INVALID_FILE_URL_HOST</code>错误。</p><p>为了修正这个问题，你需要确保文件 URL 格式正确。如果你正在尝试访问本地文件，那么 URL 应该没有主机名部分，或者主机名应该是<code>localhost</code>。更正后的代码示例可能如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file:///path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 注意这里没有主机名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileUrl</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">contents</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">contents</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An error occurred:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正后的例子中，我们去除了<code>hostname</code>部分（或者可以将其替换为<code>localhost</code>），这样 Node.js 就能够正确处理本地文件的 URL 并读取相应的文件内容了。</p><h3 id="err-invalid-file-url-path" tabindex="-1"><a class="header-anchor" href="#err-invalid-file-url-path"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_file_url_path" target="_blank" rel="noopener noreferrer">ERR_INVALID_FILE_URL_PATH</a></span></a></h3><p>当你在 Node.js 中使用文件 URLs（以<code>file://</code>开头的 URLs）来访问文件系统时，如果文件 URL 的路径部分不符合 Node.js 的期望或者规定的格式，就会抛出 <code>ERR_INVALID_FILE_URL_PATH</code> 错误。在 Node.js v21.7.1 版本中，这个错误代表着文件 URL 的路径是无效的。</p><p>举个例子，如果你尝试用文件 URL 去读取本地文件，但是你提供的路径是错误的，比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> pathToFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">file://C:/path/to/your/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设你在Windows操作系统上</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pathToFile</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果路径不对，这里会收到ERR_INVALID_FILE_URL_PATH错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码例子中，我们想要通过 Node.js 的文件系统模块（<code>fs</code>）来读取一个文本文件。我们给<code>readFile</code>函数提供了一个 URL，但是这个 URL 必须正确指向一个文件。如果这个路径有问题，比如它不遵循 Node.js 所支持的文件 URL 格式，那么就会产生<code>ERR_INVALID_FILE_URL_PATH</code>错误。</p><p>正确写法应该确保文件 URL 的路径适用于你的操作系统。例如，在 Windows 系统中，你需要三个斜杠（<code>///</code>），并且可能需要替换掉驱动器后面的冒号：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> pathToFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">file:///C:/path/to/your/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 注意这里有三个斜杠，并且没有冒号</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>而在类 Unix 系统（如 Linux 或 macOS）中，只需两个斜杠，因为文件路径本身以斜杠开始：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> pathToFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">file:///path/to/your/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 类Unix系统的路径</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>记住，当你在代码中处理文件路径时，特别是在跨平台（不同操作系统）开发时，你需要特别注意文件路径的正确性。如果你碰到 <code>ERR_INVALID_FILE_URL_PATH</code> 这个错误，首先检查你的文件 URL 是否正确地指向了一个实际存在的文件，同时也要确保它符合 Node.js 的文件 URL 格式规范。</p><h3 id="err-invalid-handle-type" tabindex="-1"><a class="header-anchor" href="#err-invalid-handle-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_handle_type" target="_blank" rel="noopener noreferrer">ERR_INVALID_HANDLE_TYPE</a></span></a></h3><p><code>ERR_INVALID_HANDLE_TYPE</code> 是 Node.js 中的一个错误码，当你尝试对某个对象进行操作，但是该对象的类型不符合期望的操作类型时，会抛出这种类型的错误。</p><p>在 Node.js 中，&quot;handle&quot;通常指的是一个引用，它可以代表诸如文件、网络套接字、定时器等资源。每种资源类型支持特定的操作集。如果你尝试对一个资源执行它不支持的操作，Node.js 就会抛出 <code>ERR_INVALID_HANDLE_TYPE</code> 错误。</p><p>比如说，文件句柄（handle）应该用来进行读写文件的操作，而网络套接字句柄用于网络通信。如果你试图将一个文件句柄当作网络套接字来使用，那么 Node.js 就会告诉你这不是有效的操作。</p><p>下面是一些可能会导致 <code>ERR_INVALID_HANDLE_TYPE</code> 错误的例子：</p><h3 id="例子-1-错误地使用定时器" tabindex="-1"><a class="header-anchor" href="#例子-1-错误地使用定时器"><span>例子 1：错误地使用定时器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们创建了一个定时器，然后错误地尝试关闭它，</span></span>
<span class="line"><span style="color:#616E88;">// 就像关闭一个文件句柄一样。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> timer</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里我们尝试使用 fs.close 来关闭定时器，这是不合适的，</span></span>
<span class="line"><span style="color:#616E88;">// 因为 fs.close 是用来关闭文件句柄的。</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">timer</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法关闭定时器</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这将导致 ERR_INVALID_HANDLE_TYPE 错误，</span></span>
<span class="line"><span style="color:#616E88;">// 因为我们尝试使用一个针对文件句柄的 API 来操作一个定时器句柄。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-2-错误地操作流" tabindex="-1"><a class="header-anchor" href="#例子-2-错误地操作流"><span>例子 2：错误地操作流</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个服务器，它监听连接并发送一个消息</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is listening</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 获取服务器的句柄</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverHandle</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> server</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">_handle</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们不知道这个句柄的正确用途，</span></span>
<span class="line"><span style="color:#616E88;">// 并尝试将其当作一个文件描述符来操作</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">serverHandle</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 这里会收到 ERR_INVALID_HANDLE_TYPE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法写入数据到服务器句柄</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这两个例子中，关键点在于理解句柄（handle）表示对底层资源的引用，并且你必须使用正确的 API 和方法来操作它们。当你不遵循这个规则时，Node.js 将通过抛出 <code>ERR_INVALID_HANDLE_TYPE</code> 错误来告诉你发生了什么问题。当你遇到这个错误时，你应该检查你的代码，看看是否有使用错误类型的 handle 的情况。</p><h3 id="err-invalid-http-token" tabindex="-1"><a class="header-anchor" href="#err-invalid-http-token"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_http_token" target="_blank" rel="noopener noreferrer">ERR_INVALID_HTTP_TOKEN</a></span></a></h3><p>在 Node.js 中，<code>ERR_INVALID_HTTP_TOKEN</code> 错误代码表示你试图在 HTTP 请求或响应中使用了一个无效的标记（Token），这通常指的是 HTTP 头部中字段名或者某些特定值不符合规范。</p><p>HTTP 头部由很多键值对构成，每一对键值对定义了请求或者响应的一个属性。比如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Content-Type: application/json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里的&quot;Content-Type&quot;就是键，而&quot;application/json&quot;是值，它们共同声明了发送内容的类型是 JSON 格式。</p><p>在 HTTP 规范中，字段名必须是有效的令牌字符，也就是说它们只能包括字母、数字以及一些特定的符号，比如连字符 <code>-</code> 和下划线 <code>_</code>。如果字段名包括了空格、中文字符、控制字符或者其他一些特殊字符，那么就会违反 HTTP 协议的要求，就可能产生 <code>ERR_INVALID_HTTP_TOKEN</code> 错误。</p><p>下面给出几个可能导致 <code>ERR_INVALID_HTTP_TOKEN</code> 的例子：</p><p><strong>例子 1：使用无效字符的 HTTP 头字段名</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试设置一个包含空格的无效 HTTP 头字段名</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid Header Name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试设置一个名为 <code>&#39;Invalid Header Name&#39;</code> 的 HTTP 头。因为名称中包含空格，这是不允许的，所以当 Node.js 尝试发送这个响应时，它会抛出 <code>ERR_INVALID_HTTP_TOKEN</code> 错误。</p><p><strong>例子 2：使用无效字符的 HTTP 头字段值</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 HTTP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试设置一个包含控制字符的无效 HTTP 头字段值</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Valid-Header-Name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#EBCB8B;">\u0007</span><span style="color:#A3BE8C;">some-value</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试将 HTTP 头 <code>&#39;Valid-Header-Name&#39;</code> 的值设为包含 ASCII 控制字符 <code>\u0007</code> (响铃字符) 的字符串。这同样是不被允许的，所以 Node.js 也会因此抛出 <code>ERR_INVALID_HTTP_TOKEN</code> 错误。</p><p>要解决这个问题，确保你的 HTTP 头部字段名和值遵守 HTTP 规范，避免使用任何非法字符。记住，HTTP 头字段名通常都是由字母、数字、连字符和下划线组成的。</p><h3 id="err-invalid-ip-address" tabindex="-1"><a class="header-anchor" href="#err-invalid-ip-address"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_ip_address" target="_blank" rel="noopener noreferrer">ERR_INVALID_IP_ADDRESS</a></span></a></h3><p><code>ERR_INVALID_IP_ADDRESS</code>是一个错误代码，它在 Node.js 中代表了一个特定类型的错误，即无效的 IP 地址错误。当你在编写使用网络功能的 Node.js 程序时，如果你试图使用不正确格式的 IP 地址，Node.js 会抛出这个错误。</p><p>要理解这个错误，我们首先需要知道什么是 IP 地址。IP 地址是用于标识互联网上每一台计算机或设备的数字标签。最常见的 IP 地址有两种格式：IPv4 和 IPv6。IPv4 地址由四组数字组成，每组数字的范围是 0 到 255，例如<code>192.168.1.1</code>；而 IPv6 地址则更复杂，由八组四个十六进制数表示，如<code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code>。</p><p>当你在 Node.js 中使用网络 API，比如创建服务器、发起网络请求等操作时，通常需要指定 IP 地址。如果你提供了一个格式不正确的 IP 地址，Node.js 无法处理，并会抛出<code>ERR_INVALID_IP_ADDRESS</code>错误来告诉你，你输入的 IP 地址是无效的。</p><p>举例说明：</p><ol><li>创建 HTTP 服务器并监听无效 IP 地址：</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试监听一个无效的IP地址</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">123.456.789.000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试让服务器监听<code>123.456.789.000</code>这个 IP 地址，但这不是一个有效的 IPv4 地址，因为每个数字部分不能超过 255。运行这段代码会导致抛出<code>ERR_INVALID_IP_ADDRESS</code>的错误。</p><ol start="2"><li>发起网络请求到无效 IP 地址：</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试发起请求到一个无效的IP地址</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://123.456.789.000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里处理响应</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_INVALID_IP_ADDRESS</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">提供的IP地址无效！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试发起一个 HTTP GET 请求到<code>http://123.456.789.000</code>，同样因为 IP 地址无效，会在事件监听器中捕获<code>ERR_INVALID_IP_ADDRESS</code>错误。</p><p>解决这类错误的方法非常简单，就是确保你提供的 IP 地址是符合规范的。检查你的 IP 地址是否正确输入，没有笔误，并且符合 IPv4 或 IPv6 的格式要求。如果不确定 IP 地址，可以使用本地地址<code>127.0.0.1</code>（对于 IPv4）或<code>::1</code>（对于 IPv6），这两个地址通常用于指代你自己的计算机。</p><h3 id="err-invalid-mime-syntax" tabindex="-1"><a class="header-anchor" href="#err-invalid-mime-syntax"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_mime_syntax" target="_blank" rel="noopener noreferrer">ERR_INVALID_MIME_SYNTAX</a></span></a></h3><p><code>ERR_INVALID_MIME_SYNTAX</code> 是一个错误类型，它在 Node.js 中表示你提供的 MIME 类型字符串不符合有效的语法格式。MIME，全称为多用途互联网邮件扩展（Multipurpose Internet Mail Extensions），是一种标准，用于描述文档的媒体类型。</p><p>在 Node.js 或任何网络应用中，当你处理文件上传、下载、HTTP 请求和响应等操作时，通常会涉及到 MIME 类型。例如，当你发送一个 HTML 文件时，其 MIME 类型可能是 <code>text/html</code>；发送图片时，可能是 <code>image/png</code> 或 <code>image/jpeg</code> 等。</p><p>如果你在使用 Node.js 的某个 API 时，比如设置 HTTP 响应头部（Header）或者解析请求体，并且提供了格式不正确的 MIME 类型字符串，Node.js 就会抛出 <code>ERR_INVALID_MIME_SYNTAX</code> 错误。</p><p>下面我们通过几个例子来看看这个错误是怎么产生的：</p><h3 id="示例-1-设置-http-响应内容类型" tabindex="-1"><a class="header-anchor" href="#示例-1-设置-http-响应内容类型"><span>示例 1: 设置 HTTP 响应内容类型</span></a></h3><p>假设你正在编写一个简单的 web 服务器，你想要设置正确的 Content-Type 响应头部。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 设置正确的 MIME 类型</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 发送响应</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">`&lt;`h1&gt;Hello World`&lt;`/h1&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码工作的很好，因为 <code>&#39;text/html&#39;</code> 是一个有效的 MIME 类型。但是，如果你错误地输入了:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">texthtml</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的斜杠</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Node.js 就会因为 backslash (<code>\</code>) 不是合法的 MIME 类型字符而抛出 <code>ERR_INVALID_MIME_SYNTAX</code> 错误。</p><h3 id="示例-2-使用-mime-类型解析库" tabindex="-1"><a class="header-anchor" href="#示例-2-使用-mime-类型解析库"><span>示例 2: 使用 MIME 类型解析库</span></a></h3><p>Node.js 生态系统中有许多库可以帮助你处理 MIME 类型，比如 <code>mime</code> 包。如果你使用了这样的库，并且给它提供了格式不正确的 MIME 类型字符串，它也可能内部抛出 <code>ERR_INVALID_MIME_SYNTAX</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> mime</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">mime</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> type</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> mime</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getType</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file.wrong-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">type</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 如果 MIME 类型无效，这里就会捕获到错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中, 如果 <code>getType</code> 方法无法解析提供的文件扩展名为有效的 MIME 类型，就可能引发错误。</p><h3 id="解决方法-4" tabindex="-1"><a class="header-anchor" href="#解决方法-4"><span>解决方法</span></a></h3><p>要避免这种错误，你需要确保你使用的 MIME 类型字符串是有效的。你可以查阅标准的 MIME 类型列表，或者使用专门的库来帮助生成和验证 MIME 类型。</p><p>总之，<code>ERR_INVALID_MIME_SYNTAX</code> 就是告诉你提供的 MIME 类型字符串不符合预期格式。修复这个问题通常涉及到检查和纠正你的 MIME 类型定义。</p><h3 id="err-invalid-module" tabindex="-1"><a class="header-anchor" href="#err-invalid-module"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_module" target="_blank" rel="noopener noreferrer">ERR_INVALID_MODULE</a></span></a></h3><p><code>ERR_INVALID_MODULE</code>是 Node.js 中的一个错误代码，代表你试图在你的应用程序中加载了一个无效的模块。在 Node.js 里，一个模块通常是一段可复用的代码，可以包含函数、对象或类等。你可以通过使用<code>require</code>函数（在 CommonJS 模块系统中）或通过<code>import</code>语句（在 ES Modules 系统中）来加载模块。</p><p>这个错误可能发生的情景包括但不限于：</p><ol><li>你尝试导入的模块文件不存在。</li><li>你导入的模块有语法错误或其他问题，无法被 Node.js 正确解析。</li><li>你试图以错误的方式导入模块（比如混淆了 CommonJS 和 ES 模块的语法）。</li><li>你的 Node.js 版本不支持你正尝试使用的模块特性或语法。</li></ol><p>现在让我们举几个实际的例子：</p><h3 id="例子-1-模块文件不存在" tabindex="-1"><a class="header-anchor" href="#例子-1-模块文件不存在"><span>例子 1：模块文件不存在</span></a></h3><p>假设你有一个项目，想要导入一个名为<code>math.js</code>的模块，但这个文件其实并不存在于你指定的路径中。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> math</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./math</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果<code>math.js</code>文件没有在项目的相同目录中，Node.js 会抛出<code>ERR_INVALID_MODULE</code>错误，提示你模块无法找到。</p><h3 id="例子-2-语法错误" tabindex="-1"><a class="header-anchor" href="#例子-2-语法错误"><span>例子 2：语法错误</span></a></h3><p>考虑以下<code>math.js</code>模块：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">x</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> y</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  retrun</span><span style="color:#D8DEE9;"> x</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> y</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里有个拼写错误，应该是return而不是retrun</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你尝试加载这个模块时：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> math</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./math</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>由于<code>math.js</code>中有语法错误（<code>retrun</code>拼写错误），Node.js 将无法解析此模块，并可能抛出<code>ERR_INVALID_MODULE</code>错误。</p><h3 id="例子-3-混淆模块系统" tabindex="-1"><a class="header-anchor" href="#例子-3-混淆模块系统"><span>例子 3：混淆模块系统</span></a></h3><p>如果你在使用 CommonJS 风格的<code>require</code>时尝试加载一个 ES 模块，或者反过来，在使用<code>import</code>语句时尝试加载一个 CommonJS 模块，这也可能导致<code>ERR_INVALID_MODULE</code>错误。</p><p>例如，在 CommonJS 中这样加载 ES 模块可能就会出错：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./myModule.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设myModule.mjs是一个ES模块</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>反之，在 ES 模块中这样加载 CommonJS 模块也会出错：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myModule.cjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设myModule.cjs是一个CommonJS模块</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>解决<code>ERR_INVALID_MODULE</code>错误的方法取决于具体的错误原因。你可能需要检查模块路径是否正确、修复语法错误、确认模块兼容性或确保你的 Node.js 版本支持所需功能。在开发中，仔细阅读错误信息并逐步调试通常能帮助你定位问题所在。</p><h3 id="err-invalid-module-specifier" tabindex="-1"><a class="header-anchor" href="#err-invalid-module-specifier"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_module_specifier" target="_blank" rel="noopener noreferrer">ERR_INVALID_MODULE_SPECIFIER</a></span></a></h3><p><code>ERR_INVALID_MODULE_SPECIFIER</code> 是 Node.js 中的一个错误类型，它表示你尝试加载或导入一个模块时，提供的模块标识符（即模块的名字或路径）是不合法或无效的。在 Node.js 中，模块可以是本地文件、包或者核心模块内建于 Node.js 本身中。</p><p>这类错误可能出现在以下几种情况：</p><ol><li>路径格式错误：如果你的模块路径格式不正确，Node.js 就会抛出 <code>ERR_INVALID_MODULE_SPECIFIER</code> 错误。</li><li>使用了不支持的特性或者协议：比如尝试使用非标准的 URL 协议来加载模块。</li><li>模块解析规则问题：当 Node.js 在解析 ES6 模块的路径时遇到问题，也可能会发生这个错误。</li></ol><p>让我们通过几个例子来理解这个错误：</p><h3 id="示例-1-错误的文件路径" tabindex="-1"><a class="header-anchor" href="#示例-1-错误的文件路径"><span>示例 1: 错误的文件路径</span></a></h3><p>假设你有一个 Node.js 项目，并且想要导入一个叫做 <code>math.js</code> 的自定义模块。如果你错误地指定了文件路径，就会触发 <code>ERR_INVALID_MODULE_SPECIFIER</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./mat.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设实际文件名应该是 math.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="示例-2-不支持的-url-协议" tabindex="-1"><a class="header-anchor" href="#示例-2-不支持的-url-协议"><span>示例 2: 不支持的 URL 协议</span></a></h3><p>如果你尝试使用不被 Node.js 支持的协议来导入模块，比如试图直接从网页地址导入，同样会出现错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https://example.com/math.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Node.js 通常不支持通过 HTTP 或 HTTPS 协议导入模块，除非使用特定的加载器或工具。</p><h3 id="示例-3-相对路径问题" tabindex="-1"><a class="header-anchor" href="#示例-3-相对路径问题"><span>示例 3: 相对路径问题</span></a></h3><p>在导入模块时，如果没有正确使用相对路径（以 <code>./</code> 或 <code>../</code> 开头），也会导致问题。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">math.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将尝试加载 node_modules 中的一个模块，而不是当前目录下的 math.js 文件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>要修复此类 <code>ERR_INVALID_MODULE_SPECIFIER</code> 错误，必须确保你正在使用正确的路径和文件名，并且遵循 Node.js 的模块解析规则和标准。检查拼写错误、路径问题，并确保使用适当的相对或绝对路径，这些都是排除这类错误的关键步骤。</p><h3 id="err-invalid-object-define-property" tabindex="-1"><a class="header-anchor" href="#err-invalid-object-define-property"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_object_define_property" target="_blank" rel="noopener noreferrer">ERR_INVALID_OBJECT_DEFINE_PROPERTY</a></span></a></h3><p><code>ERR_INVALID_OBJECT_DEFINE_PROPERTY</code> 是一个错误码，它代表在 Node.js 环境中出现了一个特定的错误。当你使用 JavaScript 的 <code>Object.defineProperty()</code> 方法尝试在一个对象上定义新属性时，如果传入的参数不正确或者操作违反了一些规则，Node.js 就会抛出这个错误。</p><p><code>Object.defineProperty()</code> 方法是用来在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回这个对象。这个方法接收三个参数：1) 要在其上定义属性的对象，2) 属性的名称，3) 描述符对象，包含了可枚举、可写、可配置、值等特性。</p><p>下面是几个例子，展示了如何正确和错误地使用 <code>Object.defineProperty()</code> 方法：</p><h3 id="正确的使用方式" tabindex="-1"><a class="header-anchor" href="#正确的使用方式"><span>正确的使用方式</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确地定义了一个名为 &#39;newProperty&#39; 的新属性，初始值为 100</span></span>
<span class="line"><span style="color:#D8DEE9;">Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">defineProperty</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">newProperty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  value</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  writable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  enumerable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  configurable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">newProperty</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们在 <code>obj</code> 对象上成功定义了一个名为 <code>newProperty</code> 的新属性，我们指定了属性的值以及其他几个特性。</p><h3 id="错误的使用方式导致-err-invalid-object-define-property" tabindex="-1"><a class="header-anchor" href="#错误的使用方式导致-err-invalid-object-define-property"><span>错误的使用方式导致 <code>ERR_INVALID_OBJECT_DEFINE_PROPERTY</code></span></a></h3><p>错误情形 1 - 使用非法的属性描述符：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里尝试定义一个属性，但属性描述符是一个字符串而不是一个对象，这是不合法的</span></span>
<span class="line"><span style="color:#D8DEE9;">  Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">defineProperty</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">invalidProperty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">not an object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出 ERR_INVALID_OBJECT_DEFINE_PROPERTY 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误情形 2 - 定义属性描述符冲突的特性：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里尝试定义一个既是可写也是访问器属性，这是不允许的，因为 writable 和 get 特性是互斥的</span></span>
<span class="line"><span style="color:#D8DEE9;">  Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">defineProperty</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">anotherInvalidProperty</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    value</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 100</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    writable</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 可写</span></span>
<span class="line"><span style="color:#88C0D0;">    get</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      return</span><span style="color:#B48EAD;"> 100</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#616E88;"> // 同时又有 getter，这是不允许的</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出 ERR_INVALID_OBJECT_DEFINE_PROPERTY 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际应用中，开发者应该仔细检查 <code>Object.defineProperty()</code> 方法的用法，确保按照 API 文档提供的参数规格来传参，避免上述错误的发生。</p><p>简单来说，如果你在 Node.js 中遇到了 <code>ERR_INVALID_OBJECT_DEFINE_PROPERTY</code> 错误，那么你应该检查你的 <code>Object.defineProperty()</code> 调用，看看是否有参数传递错误或是描述符对象中的属性设置不合法。通过修正这些问题，就可以解决这个错误。</p><h3 id="err-invalid-package-config" tabindex="-1"><a class="header-anchor" href="#err-invalid-package-config"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_package_config" target="_blank" rel="noopener noreferrer">ERR_INVALID_PACKAGE_CONFIG</a></span></a></h3><p><code>ERR_INVALID_PACKAGE_CONFIG</code>是 Node.js 中的一个错误代码，它指示 Node.js 在尝试加载和解析一个包（package）的配置时发现了不合法或无法理解的内容。通常这个错误与<code>package.json</code>文件有关。</p><p><code>package.json</code>文件是 Node.js 项目中非常重要的文件，它描述了项目的元数据、依赖关系、脚本等信息。如果在<code>package.json</code>文件中有格式错误、未知字段或不兼容的值，Node.js 会抛出<code>ERR_INVALID_PACKAGE_CONFIG</code>错误。</p><p>例如，考虑以下几种情况，当 Node.js 遇到这些情况时可能会触发<code>ERR_INVALID_PACKAGE_CONFIG</code>错误：</p><ol><li><p><strong>JSON 格式错误</strong>：<code>package.json</code>必须是有效的 JSON。如果你漏掉了引号、逗号或者使用了注释（正常的 JSON 不支持注释），这将导致 JSON 无效。</p><p>错误示例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#D8DEE9;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#B48EAD;">1.0</span><span style="color:#D8DEE9;">.</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span></span>
<span class="line"><span style="color:#A3BE8C;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确示例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>未知的字段</strong>：如果你在<code>package.json</code>中包含了 Node.js 不认识的字段，也可能导致此错误。</p><p>错误示例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">nonexistentField</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some value</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，&quot;nonexistentField&quot;并不是<code>package.json</code>文件的标准字段。</p></li><li><p><strong>字段类型或值不正确</strong>：如果字段的值类型或内容不符合预期，也会触发错误。</p><p>错误示例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">dependencies</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#616E88;"> // 这应该是一个对象</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确示例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">dependencies</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">^4.17.1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>使用了不支持的特性</strong>：如果<code>package.json</code>中使用了当前 Node.js 版本不支持的特性，比如某个新的字段或者模块解析策略，也可能导致错误。</p></li></ol><p>如何修复这个问题？首先，需要仔细检查<code>package.json</code>文件的内容，确认 JSON 格式正确，所有字段都是可识别的，并且字段的值类型和内容都是合法的。在修改后，可以使用在线 JSON 验证工具来确保没有语法错误。</p><p>当然，Node.js 的错误消息通常会给出一些线索，帮助你定位问题。如果看到<code>ERR_INVALID_PACKAGE_CONFIG</code>错误，可以查看错误消息的详细部分，了解哪个包或哪行代码触发了错误，从而进行对应的修复。</p><h3 id="err-invalid-package-target" tabindex="-1"><a class="header-anchor" href="#err-invalid-package-target"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_package_target" target="_blank" rel="noopener noreferrer">ERR_INVALID_PACKAGE_TARGET</a></span></a></h3><p><code>ERR_INVALID_PACKAGE_TARGET</code> 是 Node.js 中的一个错误类型，它表示在处理 Node.js 包（package）时遇到了无效的包目标。</p><p>Node.js 支持使用 <code>package.json</code> 文件来定义和管理项目依赖。<code>package.json</code> 中可以指定多种配置选项，其中“exports”字段是用来控制模块导出的方式和路径的。当你在 <code>package.json</code> 的 &quot;exports&quot; 字段中指定的路径或者导出目标不符合预期格式或者规则时，就会抛出 <code>ERR_INVALID_PACKAGE_TARGET</code> 错误。</p><p>这里举两个具体的例子来解释：</p><h3 id="例子-1-无效的文件路径" tabindex="-1"><a class="header-anchor" href="#例子-1-无效的文件路径"><span>例子 1：无效的文件路径</span></a></h3><p>假设我们有一个 Node.js 项目，其结构如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>my-node-app/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   └── index.js</span></span>
<span class="line"><span>└── package.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>package.json</code> 中的 &quot;exports&quot; 字段指向一个不存在的文件，就会出现 <code>ERR_INVALID_PACKAGE_TARGET</code> 错误。比如：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-node-app</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./dist/main.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们期望打包后的代码位于 <code>dist/main.js</code>，但实际上我们的项目结构中并没有 <code>dist</code> 目录。试图导入此包时，Node.js 将无法找到 <code>main.js</code> 文件，并抛出 <code>ERR_INVALID_PACKAGE_TARGET</code> 错误。</p><h3 id="例子-2-违反模块封装原则" tabindex="-1"><a class="header-anchor" href="#例子-2-违反模块封装原则"><span>例子 2：违反模块封装原则</span></a></h3><p>Node.js 允许包的作者通过 &quot;exports&quot; 字段限制哪些文件可以被外部导入，以实现模块的封装。如果 &quot;exports&quot; 字段的配置与实际导入请求不一致，也会抛出 <code>ERR_INVALID_PACKAGE_TARGET</code> 错误。</p><p>考虑以下 <code>package.json</code> 配置：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-node-app</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">./features/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/features/</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，我们只对外暴露 <code>src/features/</code> 目录下的内容，使得导入时必须使用 <code>import feature from &#39;my-node-app/features/some-feature&#39;;</code> 的形式。如果有人尝试导入非 <code>features</code> 目录下的文件，比如 <code>import utils from &#39;my-node-app/utils&#39;;</code>，将会因为 &quot;exports&quot; 字段没有配置对应的导出目标而抛出 <code>ERR_INVALID_PACKAGE_TARGET</code> 错误。</p><h3 id="err-invalid-performance-mark" tabindex="-1"><a class="header-anchor" href="#err-invalid-performance-mark"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_performance_mark" target="_blank" rel="noopener noreferrer">ERR_INVALID_PERFORMANCE_MARK</a></span></a></h3><p><code>ERR_INVALID_PERFORMANCE_MARK</code> 是一个错误类型，它在 Node.js 中表示你尝试引用了一个不存在的性能标记（performance mark）。性能标记是在代码中设置的特定点，它们用来测量代码执行过程中的时间，这可以帮助开发者了解他们的应用程序或脚本在运行时的性能表现。</p><p>在 Node.js 中，我们可以使用内置的 <code>performance</code> 模块来创建和管理性能标记。这个模块提供了一个高精度的时间度量工具，允许你记录下代码的开始执行时间和结束执行时间，这样就可以计算出代码的执行时间。</p><p>这里有一个简单的例子来说明如何正确地创建和使用性能标记：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> PerformanceObserver</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置一个性能标记</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">start_task</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 执行一些要被测量的代码</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 100000000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 假设这里有一些复杂的操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置另一个性能标记</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">end_task</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 计算两个标记之间的时间差</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">measure</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">task_time</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">start_task</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">end_task</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用PerformanceObserver来获取测量结果</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obs</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> PerformanceObserver</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> measurements</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> items</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEntriesByName</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">task_time</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    measurements</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forEach</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">measurement</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">任务耗时：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">measurement</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">duration</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">obs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">observe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> entryTypes</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">measure</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们使用 <code>performance.mark()</code> 方法来设置名为 <code>start_task</code> 和 <code>end_task</code> 的性能标记。然后执行一段可能会耗时的代码。之后，我们通过调用 <code>performance.measure()</code> 来测量这两个标记之间的时间差，这个差值代表了我们想要监控代码块的执行时间。最后，我们利用 <code>PerformanceObserver</code> 来输出测量得到的执行时间。</p><p>如果你尝试使用一个未定义的性能标记名称作为 <code>performance.measure()</code> 方法的参数，你将会遇到 <code>ERR_INVALID_PERFORMANCE_MARK</code> 错误。以下是一个可能导致这个错误的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试计算一个不存在的性能标记</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">measure</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">task_time</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">nonexistent_start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">nonexistent_end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会捕获 ERR_INVALID_PERFORMANCE_MARK 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试测量两个不存在的性能标记 <code>nonexistent_start</code> 和 <code>nonexistent_end</code> 之间的时间差。由于这两个标记没有事先使用 <code>performance.mark()</code> 方法设置，所以会抛出 <code>ERR_INVALID_PERFORMANCE_MARK</code> 错误。</p><h3 id="err-invalid-protocol" tabindex="-1"><a class="header-anchor" href="#err-invalid-protocol"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_protocol" target="_blank" rel="noopener noreferrer">ERR_INVALID_PROTOCOL</a></span></a></h3><p><code>ERR_INVALID_PROTOCOL</code> 是 Node.js 中的一个错误代码，当你在某些网络操作中使用了不合法或不支持的协议时，就会抛出这个错误。在 Node.js 中，协议通常指的是访问和交互数据时使用的规则集，比如 HTTP、HTTPS、FTP 等。</p><p>举个例子来说明：</p><p>假设你正在尝试创建一个 HTTP 服务器，但是由于某种原因，你错误地将协议写成了 &quot;HTP&quot; 而不是 &quot;HTTP&quot;。Node.js 在尝试使用这个不正确的协议时，就会抛出 <code>ERR_INVALID_PROTOCOL</code> 错误。</p><p>下面是一个具体的错误示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设有一个函数用来根据协议类型创建服务器</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> createServer</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">protocol</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">protocol</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Unsupported protocol: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">protocol</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试用错误的协议 &quot;HTP&quot; 来创建服务器</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 在这里捕获并处理错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: Unsupported protocol: HTP</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际的 Node.js v21.7.1 环境中，这个错误可能发生在使用核心模块如 <code>http</code>, <code>https</code> 或者其他需要指定协议的模块时。</p><p>请注意，上述代码只是为了演示 <code>ERR_INVALID_PROTOCOL</code> 错误如何被抛出，实际上 Node.js 的内部错误更加复杂，会涉及到底层的 API 调用。在实际开发中，你应该总是确保使用正确的协议字符串，并且遵循 API 文档中的指导。</p><p>此外，随着 Node.js 版本的迭代更新，错误处理的机制可能会有变化，所以建议查阅最新的官方文档获取准确的信息。</p><h3 id="err-invalid-repl-eval-config" tabindex="-1"><a class="header-anchor" href="#err-invalid-repl-eval-config"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_repl_eval_config" target="_blank" rel="noopener noreferrer">ERR_INVALID_REPL_EVAL_CONFIG</a></span></a></h3><p><code>ERR_INVALID_REPL_EVAL_CONFIG</code> 是 Node.js 中的一个特定错误类型，它出现在你尝试使用不当配置 Read-Eval-Print Loop (REPL) 环境时。REPL 是一种简单的、交互式的编程环境，用于执行用户输入的代码并立即显示结果。Node.js 自带的 REPL 可以通过在命令行中运行 <code>node</code> 命令来启动。</p><p>通常情况下，用户不需要修改 REPL 的默认设置即可使用。但是，如果你想自定义 REPL 的一些行为，Node.js 提供了一些选项可以配置，比如可以自定义“评估函数”（eval function），这个函数负责处理并执行你输入的每条命令。</p><p>如果你在自定义 REPL 时提供了一个无效的配置项给这个评估函数，例如你传入了一个不是函数类型的值，或者你的函数签名与预期不符，就会触发<code>ERR_INVALID_REPL_EVAL_CONFIG</code>错误。</p><p>下面是一个示例场景，我将展示如何错误地配置 REPL，并导致<code>ERR_INVALID_REPL_EVAL_CONFIG</code>错误：</p><p>首先，一个正常的自定义 REPL 配置可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> repl</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">repl</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myEval</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">cmd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> filename</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里是自定义处理输入命令的逻辑</span></span>
<span class="line"><span style="color:#88C0D0;">  callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> eval</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">cmd</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">repl</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> prompt</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&gt; </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> eval</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> myEval</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个自定义的评估函数<code>myEval</code>，并且使用<code>repl.start</code>启动了 REPL 会话，同时传入了一个对象作为配置，指定<code>prompt</code>为<code>&#39;&gt; &#39;</code>，并且<code>eval</code>选项被设置为我们的自定义函数<code>myEval</code>。</p><p>现在，假设我们错误地配置了<code>eval</code>参数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> repl</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">repl</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里我们错误地把一个字符串传给了 eval 配置，</span></span>
<span class="line"><span style="color:#616E88;">// 而不是一个函数</span></span>
<span class="line"><span style="color:#D8DEE9;">repl</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> prompt</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&gt; </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> eval</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">这不是一个函数</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，由于<code>eval</code>参数期待一个函数，而我们传入了一个字符串，Node.js 将无法正确地以函数形式调用这个字符串，因此它会抛出<code>ERR_INVALID_REPL_EVAL_CONFIG</code>错误，提示你配置的<code>eval</code>选项无效。</p><p>要解决这个问题，确保<code>eval</code>选项得到一个合适的函数参数，该函数满足接收命令字符串、上下文、文件名和回调函数作为参数，并在内部处理这些值。</p><h3 id="err-invalid-repl-input" tabindex="-1"><a class="header-anchor" href="#err-invalid-repl-input"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_repl_input" target="_blank" rel="noopener noreferrer">ERR_INVALID_REPL_INPUT</a></span></a></h3><p><code>ERR_INVALID_REPL_INPUT</code> 是 Node.js 中的一种特定错误类型，它主要出现在你使用 Node.js 的 REPL 环境时。REPL 代表“Read-Eval-Print Loop”，即“读取-求值-输出 循环”，这是一个交互式的编程环境，让你能够输入 JavaScript 代码，并立即得到执行结果。</p><p>当你在 Node.js 的 REPL 环境中输入了不正确的指令或不能理解的内容时，Node.js 可能会抛出 <code>ERR_INVALID_REPL_INPUT</code> 错误。这意味着你输入的东西没有按照预期工作，因为它可能不符合 JavaScript 语法规则，或者是 REPL 不支持的命令。</p><p>举个例子：</p><p>假设你打开了 Node.js 的 REPL 环境（通常在终端或命令提示符窗口中输入 <code>node</code> 并回车就可以启动），然后试图输入一些非法的指令，如下所示：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">&gt;</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">invalidCommand</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上面的 <code>.invalidCommand</code> 不是一个有效的 REPL 命令。在这种情况下，Node.js 就可能会抛出 <code>ERR_INVALID_REPL_INPUT</code> 错误，表示你输入的内容无法被识别或执行。</p><p>为了更好地理解这个错误并避免在实际操作中遇到它，你应该确保：</p><ol><li>输入的代码片段是合法的 JavaScript 代码。</li><li>使用的命令是 REPL 环境支持的。Node.js REPL 支持一些特殊命令，这些都以点（<code>.</code>）开头，例如 <code>.help</code> 查看帮助信息，<code>.exit</code> 退出 REPL 环境等。</li></ol><p>如果你收到了这个错误，通常的解决方法是检查你的输入，确保它们是有效的 JavaScript 代码或者是合法的 REPL 命令。如果有任何疑问，你可以在 REPL 中输入 <code>.help</code> 来获取可用命令的列表和相关信息。</p><h3 id="err-invalid-return-property" tabindex="-1"><a class="header-anchor" href="#err-invalid-return-property"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_return_property" target="_blank" rel="noopener noreferrer">ERR_INVALID_RETURN_PROPERTY</a></span></a></h3><p><code>ERR_INVALID_RETURN_PROPERTY</code> 是 Node.js 中的一个错误类型，它会在特定的 API 函数中抛出。这个错误通常发生于当一个函数预期返回一个对象或者某种类型的属性，但是实际上返回了意外的值类型或结构时。</p><p>例如，假设我们有一个 Node.js 的 API 函数要求你返回一个具有特定属性的对象。如果你没有按照预期返回正确的属性，或者属性值的类型不对，Node.js 就会抛出 <code>ERR_INVALID_RETURN_PROPERTY</code> 错误。</p><p>让我给你举一个实际的例子来说明这一点：</p><p>假设 Node.js 核心模块提供了一个名为 <code>getDetails()</code> 的函数，该函数预期返回一个包含 <code>name</code> 和 <code>age</code> 属性的对象。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> getDetails</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 正确的返回应该像这样：</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    age</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 30</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 如果函数返回如下结果，则可能会抛出 ERR_INVALID_RETURN_PROPERTY 错误</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    fullname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Alice Wonderland</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 错误的属性名</span></span>
<span class="line"><span style="color:#88C0D0;">    age</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">30</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 错误的属性值类型（应该是数字而不是字符串）</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，<code>getDetails()</code> 函数应该返回一个包含 <code>name</code> 和 <code>age</code> 属性的对象，其中 <code>name</code> 应该是一个字符串，<code>age</code> 应该是一个数字。如果返回的对象中包含了不正确的属性名 <code>fullname</code> 或者属性 <code>age</code> 的值是一个字符串而不是数字，Node.js 就会抛出 <code>ERR_INVALID_RETURN_PROPERTY</code> 错误。</p><p>再举一个可能遇到这类错误的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyReadableStream</span><span style="color:#81A1C1;"> extends</span><span style="color:#D8DEE9FF;"> stream</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;font-weight:bold;">Readable</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  _read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 这里，_read 方法应该调用 this.push 方法来添加数据到流中</span></span>
<span class="line"><span style="color:#616E88;">    // 如果直接返回数据而不是使用 this.push 方法，将会导致错误。</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这是错误的，因为 _read 应该不返回任何值。</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyReadableStream</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上的例子创建了一个自定义的可读流，但是在 <code>_read</code> 方法中直接返回了一个字符串，这不符合 Node.js 流 API 的规范。正确的做法是调用 <code>this.push(data)</code> 来传递数据，而不是直接从 <code>_read</code> 方法返回。</p><p>记住，具体的错误详情和应对方案应参考相应版本的 Node.js 文档，因为 Node.js 是在不断发展的，API 和错误处理也可能随之变化。</p><h3 id="err-invalid-return-property-value" tabindex="-1"><a class="header-anchor" href="#err-invalid-return-property-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_return_property_value" target="_blank" rel="noopener noreferrer">ERR_INVALID_RETURN_PROPERTY_VALUE</a></span></a></h3><p><code>ERR_INVALID_RETURN_PROPERTY_VALUE</code> 是 Node.js 中的一个错误类型，当你在某些特定的 Node.js API 中使用了不正确的返回值时，会遇到这个错误。在编程中，我们常常需要调用各种函数和方法，有些函数和方法可能要求我们按照一定的格式或类型返回数据。如果我们没有按照预期的格式或类型来返回数据，Node.js 就会抛出一个错误提示，<code>ERR_INVALID_RETURN_PROPERTY_VALUE</code> 就是这样一种情况。</p><p>为了更好地理解这个错误，让我们举个例子。假设 Node.js 提供了一个叫做 <code>validateOptions</code> 的函数，这个函数接收一个对象作为参数，并要求返回值也是一个包含特定属性的对象。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> validateOptions</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这个函数期望返回一个包含 isValid 属性的对象</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">someCondition</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> isValid</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 错误：返回的对象缺少 isValid 属性</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> valid</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 应该是 { isValid: false }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果我们调用这个函数并且返回了一个不包含 <code>isValid</code> 属性的对象，Node.js 就会抛出 <code>ERR_INVALID_RETURN_PROPERTY_VALUE</code> 错误，因为返回的对象不符合函数的要求。</p><p>现在让我们想象一个实际运用的场景，在 Node.js 中，有很多异步操作通常通过 Promises 来处理。例如，当你读取文件时，可以使用 <code>fs.promises.readFile()</code> 函数。这个函数期待一个特定的返回值格式。如果在某个地方，你自己写了一个类似的函数，但是返回了错误的数据格式，就会触发 <code>ERR_INVALID_RETURN_PROPERTY_VALUE</code> 错误。</p><p>看下面这个例子：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> customReadFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filepath</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> content</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filepath</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 假设我们需要返回包含 text 属性的对象</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> text</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> content</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果发生错误，可能会想返回错误信息</span></span>
<span class="line"><span style="color:#616E88;">    // 但是，这里返回的格式与上面成功时的格式不一致，可能导致问题</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> error</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这不符合外部代码的预期</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> processFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filepath</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> customReadFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filepath</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 外部代码期待 result 总是有 text 属性，否则可能会抛出 ERR_INVALID_RETURN_PROPERTY_VALUE 错误</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">hasOwnProperty</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">text</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_INVALID_RETURN_PROPERTY_VALUE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">text</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 调用 processFile 并传入文件路径</span></span>
<span class="line"><span style="color:#88C0D0;">processFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>customReadFile</code> 函数在错误处理时返回的对象格式与正常逻辑中返回的对象格式不一致，那么当 <code>processFile</code> 函数检查结果并没有找到预期的 <code>text</code> 属性时，它会抛出 <code>ERR_INVALID_RETURN_PROPERTY_VALUE</code> 错误。这种错误提示开发者他们在返回数据时，未能满足 API 或者调用方对于返回值的期望结构或数据类型。</p><h3 id="err-invalid-return-value" tabindex="-1"><a class="header-anchor" href="#err-invalid-return-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_return_value" target="_blank" rel="noopener noreferrer">ERR_INVALID_RETURN_VALUE</a></span></a></h3><p>在 Node.js 中，<code>ERR_INVALID_RETURN_VALUE</code>是一种特定类型的错误，它通常发生在一个函数或者操作返回了一个不合法或者预期之外的值。当你看到这个错误时，基本上意味着代码某个部分的执行结果不是被调用者所期待的。</p><p>例如，根据 Node.js 的文档，有些函数或者 API 期望得到特定类型或结构的返回值。如果返回了错误的类型或格式，Node.js 就会抛出<code>ERR_INVALID_RETURN_VALUE</code>错误。</p><h4 id="实际运用的例子-13" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-13"><span>实际运用的例子：</span></a></h4><ol><li><strong>HTTP 服务器回调</strong>：当你创建一个 HTTP 服务器，并且在回调函数中需要写入响应给客户端时，这个回调函数的返回值通常应该是<code>undefined</code>。如果回调函数尝试返回其他值，可能会触发<code>ERR_INVALID_RETURN_VALUE</code>。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> true;</span><span style="color:#616E88;"> // 这里错误地返回了一个true，而不是简单地结束函数或返回undefined</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这可能会导致ERR_INVALID_RETURN_VALUE错误，</span></span>
<span class="line"><span style="color:#616E88;">// 因为createServer的回调不期望任何返回值。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>Readable Stream 的_read 方法</strong>：如果你自定义一个可读流，并且覆盖了内置的<code>_read</code>方法，在这个方法里面，你不应该返回任何值。如果违反了这个规则，也会引发<code>ERR_INVALID_RETURN_VALUE</code>错误。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Readable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyReadable</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Readable</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  _read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ...读取数据的逻辑...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 不应该有返回语句</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果这里错误地返回了一个空数组，则会触发ERR_INVALID_RETURN_VALUE错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>Promises 和 async 函数</strong>：在使用异步函数或者 Promise 时，返回值应该遵循对应的规范。比如，async 函数总是返回一个 Promise，如果你尝试返回一个非 Promise 值，这条规则并不会触发错误。但如果你在某些特定被设计用来处理 Promise 的 API 中返回了错误的值，那么可能会引起<code>ERR_INVALID_RETURN_VALUE</code>。</li></ol><p>要注意的是，实际编程中遇到<code>ERR_INVALID_RETURN_VALUE</code>的情况可能与 Node.js 版本和特定 API 的实现细节有关。随着 Node.js 的更新，可能会有新的场景产生这种错误，因此最好的做法是查阅最新的 Node.js 文档来了解具体的错误场景。同时，仔细阅读错误信息和堆栈跟踪，可以帮助快速定位并解决问题。</p><h3 id="err-invalid-state" tabindex="-1"><a class="header-anchor" href="#err-invalid-state"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_state" target="_blank" rel="noopener noreferrer">ERR_INVALID_STATE</a></span></a></h3><p><code>ERR_INVALID_STATE</code> 是 Node.js 中的一个错误代码，表示在执行某个操作时，系统或对象的状态不符合预期。出现这种错误通常意味着程序试图进行某些操作，但是由于当前的状态不正确，所以无法完成。</p><p>在编程中，我们经常需要确保某些条件满足后才能执行特定的操作。比如说，你不能从一个未打开的文件中读取数据，或者不能向一个已经关闭的网络连接发送数据。如果你尝试这样做，Node.js 就会抛出一个 <code>ERR_INVALID_STATE</code> 错误。</p><p>我来举几个实例说明一下：</p><ol><li><p><strong>文件操作</strong>：<br> 假设你要从一个文件中读取数据，你需要先打开文件，然后读取内容，最后关闭文件。如果你在打开文件之前就尝试读取，或者在关闭文件之后还想继续读取，那么就可能触发 <code>ERR_INVALID_STATE</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可读流</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> readerStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">input.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 关闭流</span></span>
<span class="line"><span style="color:#D8DEE9;">readerStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次使用流读取数据将会引起 ERR_INVALID_STATE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">readerStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HTTP 请求</strong>：<br> 当你使用 Node.js 发起 HTTP 请求，并且在请求的某个阶段不当操作时，也可能遇到 <code>ERR_INVALID_STATE</code> 错误。例如，在请求被发送后修改请求头信息是不允许的，因为它已经处于只读状态。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">STATUS: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试在请求结束后改变请求头信息</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 这里会捕获 ERR_INVALID_STATE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Stream 操作</strong>：<br> 对于 Node.js 中的 Stream（流），状态管理非常关键。你不能在流被销毁后继续写入数据，否则会遇到 <code>ERR_INVALID_STATE</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Writable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myWritable</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Writable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ...</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myWritable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 在流被销毁后尝试写入数据会触发 ERR_INVALID_STATE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  myWritable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>当你看到 <code>ERR_INVALID_STATE</code> 错误时，应该仔细检查逻辑中是否有违反对象状态要求的操作。调整代码顺序、检查状态条件或确保资源被正确地管理和释放，这些都是解决这类问题的方法。记住，良好的状态管理和异常处理是编写稳定程序的关键要素。</p><h3 id="err-invalid-sync-fork-input" tabindex="-1"><a class="header-anchor" href="#err-invalid-sync-fork-input"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_sync_fork_input" target="_blank" rel="noopener noreferrer">ERR_INVALID_SYNC_FORK_INPUT</a></span></a></h3><p>错误 <code>[ERR_INVALID_SYNC_FORK_INPUT]</code> 出现在 Node.js 环境中，它是在你使用 <code>child_process.fork()</code> 方法以同步方式发送数据时，如果发送的输入不是一个有效的值或者无法被序列化成可以在进程间通信的格式，Node.js 就会抛出这个错误。</p><p>首先解释一下 <code>child_process.fork()</code> 方法。这个方法用于在 Node.js 中创建一个子进程，它允许父进程和新创建的子进程之间通过消息传递进行通信。<code>fork()</code> 是专门为 Node.js 模块设计的，并且它自动地在子进程中运行 Node.js 模块（即一个 <code>.js</code> 文件）。和其他进程通信机制相比，<code>fork()</code> 提供了一种非常简便的方式来实现父子进程间的双向通信。</p><p>下面是一个关于如何使用 <code>child_process.fork()</code> 的基本示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// parent.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个子进程来运行 child.js 文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送一个简单的消息到子进程</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听子进程发回的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">收到子进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在 child.js 中</span></span>
<span class="line"><span style="color:#616E88;">// 处理父进程发送过来的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">子进程收到父进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 做一些处理然后将结果发送回父进程</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> echo</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> message</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，父进程使用 <code>fork()</code> 创建了一个子进程并执行 <code>child.js</code> 文件。父进程通过 <code>child.send()</code> 方法发送一个对象 <code>{ hello: &#39;world&#39; }</code> 给子进程。当子进程使用 <code>process.on(&#39;message&#39;)</code> 收到这个对象时，它会做一些操作（此处只是打印信息），然后通过 <code>process.send()</code> 发送一个回应给父进程。</p><p>现在回到 <code>[ERR_INVALID_SYNC_FORK_INPUT]</code> 错误，这个错误可能在尝试发送不能序列化的数据时发生，比如包含函数、正则表达式或者其他不能通过 IPC（Inter-Process Communication，进程间通信）管道发送的 JavaScript 对象类型。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 如果尝试发送以下消息，那么会产生 ERR_INVALID_SYNC_FORK_INPUT 错误，因为函数不能通过 IPC 发送</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> myFunction</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {}</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 或者发送一个带有循环引用的对象也会出错，因为 JSON 序列化不能处理循环引用</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> circularObject</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">circularObject</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">self</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> circularObject</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">circularObject</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于函数和带有循环引用的对象不能被序列化为一个字符串，所以 Node.js 无法将其通过 IPC 发送到子进程，从而抛出了 <code>[ERR_INVALID_SYNC_FORK_INPUT]</code> 错误。</p><p>为了避免这个错误，确保你发送的数据是可以被序列化的，通常意味着发送简单的对象、数组、数值、字符串等原始类型。如果需要传输复杂类型，考虑使用其他方法，比如共享文件、数据库或其他 IPC 机制。</p><h3 id="err-invalid-this" tabindex="-1"><a class="header-anchor" href="#err-invalid-this"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_this" target="_blank" rel="noopener noreferrer">ERR_INVALID_THIS</a></span></a></h3><p>Node.js 中的 <code>[ERR_INVALID_THIS]</code> 错误通常是指当一个函数或者方法没有被正确地作为对象的一部分调用时，你会遇到这个问题。在 JavaScript 中，<code>this</code> 关键字是一个特殊的变量，它指向当前执行上下文中的对象。如果你不按预期使用 <code>this</code>，Node.js 就会抛出 <code>[ERR_INVALID_THIS]</code> 错误。</p><p>来看几个例子：</p><h3 id="例子-1-错误的-this-使用" tabindex="-1"><a class="header-anchor" href="#例子-1-错误的-this-使用"><span>例子 1：错误的 <code>this</code> 使用</span></a></h3><p>假设你有一个对象和一个方法，你希望通过这个对象调用该方法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myObject</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  myMethod</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> ()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确的 this 使用，应该指向 myObject</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">myObject</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">myMethod</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确调用，this 指向 myObject</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但如果你将这个方法从对象中取出来单独调用，就会失去 <code>this</code> 的上下文：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> method</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> myObject</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">myMethod</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">method</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误！`this` 不再指向 myObject，可能导致 [ERR_INVALID_THIS] 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-2-类构造器中的错误-this-使用" tabindex="-1"><a class="header-anchor" href="#例子-2-类构造器中的错误-this-使用"><span>例子 2：类构造器中的错误 <code>this</code> 使用</span></a></h3><p>在 Node.js 中定义一个类，并尝试以错误的方式实例化它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyClass</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#81A1C1;"> instanceof</span><span style="color:#D8DEE9FF;"> MyClass)) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TypeError</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">        &#39;</span><span style="color:#A3BE8C;">Class constructor MyClass cannot be invoked without &quot;new&quot;</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> instance</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> MyClass</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误调用，没有使用 &quot;new&quot; 关键字</span></span>
<span class="line"><span style="color:#616E88;">// 这将抛出 TypeError，可能表现为 [ERR_INVALID_THIS]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的调用应该使用 <code>new</code> 关键字，如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> instance</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyClass</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确调用</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="例子-3-严格模式下误用-this" tabindex="-1"><a class="header-anchor" href="#例子-3-严格模式下误用-this"><span>例子 3：严格模式下误用 <code>this</code></span></a></h3><p>在 JavaScript 的严格模式(strict mode)下，未绑定的函数（即没有明确的调用对象）中的 <code>this</code> 值会是 <code>undefined</code>，而不是全局对象。试图在这种情况下访问 <code>this</code> 的属性会导致错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">use strict</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myFunction</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在严格模式下，这里的 `this` 是 `undefined`</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">someProperty</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误！因为 `this` 是 `undefined`，无法读取 `someProperty`</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">myFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要防止这种情况，确保你总是在适当的上下文中调用函数，或者使用 <code>.bind()</code> 方法显式设置 <code>this</code> 的值。</p><p>总结一下，<code>[ERR_INVALID_THIS]</code> 错误说明你尝试了一个操作，但提供给操作的 <code>this</code> 值并不符合所期待的。理解 <code>this</code> 在 JavaScript 中的工作方式，以及在什么上下文中使用函数或方法是很重要的，这样可以帮助你避免遇到这种类型的错误。</p><h3 id="err-invalid-tuple" tabindex="-1"><a class="header-anchor" href="#err-invalid-tuple"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_tuple" target="_blank" rel="noopener noreferrer">ERR_INVALID_TUPLE</a></span></a></h3><p><code>ERR_INVALID_TUPLE</code>是 Node.js 中的一个错误代码，表示你在使用 Node.js 的某个功能时，提供了一个不正确格式的元组(tuple)。在编程语言中，元组通常是一个固定大小的值列表，每个值可以是不同类型的。这个错误通常发生在用到元组的 API 中，如果调用时传递的参数不满足 API 期望的结构或类型，就会触发该错误。</p><p>举例来说，在 Node.js 中，某些函数可能期望接收一个元组作为参数，这个元组需要按照特定的顺序和数据类型包含元素。假设有个 API 函数期望接收一个由两部分组成的元组，第一部分是字符串，第二部分是数字。如果你不按照这个要求来传递参数，就会出现<code>ERR_INVALID_TUPLE</code>错误。</p><p>以下是几个实际运用的假想例子：</p><p><strong>例子 1 - 错误的元组格式</strong></p><p>假设 Node.js 有一个函数<code>processTuple</code>，它期望接收一个元组，其中包含一个字符串和一个数字：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> processTuple</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">tuple</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里的函数预期tuple是一个元组，例如：[&#39;hello&#39;, 123]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的调用方式</span></span>
<span class="line"><span style="color:#88C0D0;">processTuple</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 123</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果你错误地传入了其他格式，比如只有一个元素的数组，或者元素类型不匹配</span></span>
<span class="line"><span style="color:#88C0D0;">processTuple</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 少了数字</span></span>
<span class="line"><span style="color:#88C0D0;">processTuple</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">123</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 元素顺序颠倒</span></span>
<span class="line"><span style="color:#88C0D0;">processTuple</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 123</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 没有使用数组封装元素</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 上面错误的调用可能会导致抛出ERR_INVALID_TUPLE错误。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例子 2 - API 期望特定元组结构</strong></p><p>假设 Node.js 的某个 API 函数，<code>addToQueue</code>，其要求输入参数是一个元组，由一个客户 ID（字符串）和他们的订单号（数字）组成：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> addToQueue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">customerOrderTuple</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 函数处理逻辑...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的调用</span></span>
<span class="line"><span style="color:#88C0D0;">addToQueue</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">customer123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 7890</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的调用将导致 ERR_INVALID_TUPLE 异常</span></span>
<span class="line"><span style="color:#88C0D0;">addToQueue</span><span style="color:#D8DEE9FF;">([</span><span style="color:#B48EAD;">7890</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">customer123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 反了</span></span>
<span class="line"><span style="color:#88C0D0;">addToQueue</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">onlyCustomer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 缺少订单号</span></span>
<span class="line"><span style="color:#88C0D0;">addToQueue</span><span style="color:#D8DEE9FF;">([</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">customer123</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">notANumber</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 订单号应该是数字</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这些例子中，如果我们没有按照函数期望的结构传递元组，Node.js 就会抛出<code>ERR_INVALID_TUPLE</code>错误。当你开发 Node.js 程序并看到这个错误时，你应该检查调用问题函数时使用的参数，确保你提供的元组格式符合该函数的要求。</p><h3 id="err-invalid-uri" tabindex="-1"><a class="header-anchor" href="#err-invalid-uri"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_uri" target="_blank" rel="noopener noreferrer">ERR_INVALID_URI</a></span></a></h3><p><code>ERR_INVALID_URI</code> 是一个错误类型，它在 Node.js 中表示你提供的 URI（统一资源标识符）格式不正确或者无效。URI 是互联网上用来标识资源的字符串，比如网址。</p><p>当你在 Node.js 的代码中使用某些函数或模块去处理 URI，如果该 URI 不符合规范，Node.js 就会抛出 <code>ERR_INVALID_URI</code> 错误。比如，这个错误可能会在你使用 <code>http</code> 或 <code>https</code> 模块发送请求、解析 URI 字符串时遇到。</p><p>下面我会通过几个简单的例子来演示：</p><h3 id="例子-1-http-请求错误的-uri" tabindex="-1"><a class="header-anchor" href="#例子-1-http-请求错误的-uri"><span>例子 1：HTTP 请求错误的 URI</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一个格式错误的URI</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestOptions</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https://this is not a valid uri.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 当尝试发送请求时，将会产生 ERR_INVALID_URI 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestOptions</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 这里的代码不会执行，因为URI不正确</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 打印错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="例子-2-url-模块解析错误的-uri" tabindex="-1"><a class="header-anchor" href="#例子-2-url-模块解析错误的-uri"><span>例子 2：URL 模块解析错误的 URI</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> URL</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试创建一个新的URL对象，但是传入的字符串不是有效的URI</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> myUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ht@tp://www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_INVALID_URI 异常</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在第一个例子中，我们尝试对一个格式错误的 URI 发起 HTTP 请求，Node.js 检测到 URI 格式不正确，所以抛出了 <code>ERR_INVALID_URI</code> 错误。在第二个例子中，我们尝试使用 URL 构造函数去解析一个无效的 URL 字符串，同样的，Node.js 抛出了 <code>ERR_INVALID_URI</code> 错误。</p><p>为了避免这类错误，你需要确保使用正确的 URI 格式。通常正确的 URI 应该包含协议（如<code>http://</code>或<code>https://</code>），后跟域名或 IP 地址，再加上可选的端口、路径、查询参数等。</p><p>例如，有效的 URI 示例：</p><ul><li><code>http://www.example.com</code></li><li><code>https://api.myservice.com/user?id=123</code></li><li><code>ftp://files.example.net:21/directory/file.txt</code></li></ul><p>每次你在编码中操作 URI 时，都要确保它们是经过正确格式化的，以避免 <code>ERR_INVALID_URI</code> 这样的错误。</p><h3 id="err-invalid-url" tabindex="-1"><a class="header-anchor" href="#err-invalid-url"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_url" target="_blank" rel="noopener noreferrer">ERR_INVALID_URL</a></span></a></h3><p>在 Node.js 中，<code>ERR_INVALID_URL</code> 是一个专门的错误类型，用来表示 URL（统一资源定位符）格式不正确或无效。在网络编程中，URLs 是用于找到互联网上资源（如网页、图像、文件等）的地址。如果你尝试使用一个格式不正确的 URL，Node.js 就会抛出 <code>ERR_INVALID_URL</code> 错误。</p><p>让我们具体来看什么是一个有效的 URL。一个典型的 URL 包括以下几个部分：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>protocol://hostname:port/path?query_string#fragment_id</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>protocol</strong>: 通讯协议，如 <code>http</code>, <code>https</code>, <code>ftp</code> 等。</li><li><strong>hostname</strong>: 主机名，通常是服务器的域名或 IP 地址。</li><li><strong>port</strong>: 端口号，用于访问服务器上的特定服务，默认情况下是 80 端口(http)或者 443 端口(https)。</li><li><strong>path</strong>: 访问服务器上特定资源的路径。</li><li><strong>query_string</strong>: 查询字符串，以键值对形式发送给服务器的数据。</li><li><strong>fragment_id</strong>: 片段标识符，用于指向页面内的某个部分（通常是锚点）。</li></ul><p>现在，假设你在 Node.js 中使用了不完整或格式有误的 URL，就可能遇到 <code>ERR_INVALID_URL</code> 错误。比如：</p><p><strong>例子 1：使用 <code>url</code> 模块解析 URL</strong></p><p>在 Node.js 中，<code>url</code> 模块提供了一些实用的函数来解析和构造 URLs。如果你尝试解析一个格式不正确的 URL ，它会抛出 <code>ERR_INVALID_URL</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">url</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> myURL</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> URL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">htp://www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里协议 &#39;htp&#39; 是无效的</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ERR_INVALID_URL</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例子 2：使用 <code>http</code> 模块发起请求</strong></p><p>当你使用 <code>http</code> 或 <code>https</code> 模块发送网络请求时，如果提供了无效的 URL，也会遇到 <code>ERR_INVALID_URL</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里没有提供协议，也是一个无效的 URL</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">://www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理响应...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ERR_INVALID_URL</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些例子说明了 <code>ERR_INVALID_URL</code> 错误是如何在 URL 格式问题出现时被触发的。要避免这个错误，确保你提供的 URL 是正确和合法的，包括协议、主机名等。如果你在代码中捕获到这个错误，通常需要检查你的 URL 是否书写正确，并且包含所有必需的组件。</p><p>希望这个解释清晰地帮助你理解了 <code>ERR_INVALID_URL</code> 在 Node.js 中的含义以及如何处理它。</p><h3 id="err-invalid-url-scheme" tabindex="-1"><a class="header-anchor" href="#err-invalid-url-scheme"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_url_scheme" target="_blank" rel="noopener noreferrer">ERR_INVALID_URL_SCHEME</a></span></a></h3><p>好的，让我来解释一下 <code>ERR_INVALID_URL_SCHEME</code> 这个错误，以及它在 Node.js 中是如何发生的。</p><p>首先，URL 是统一资源定位符（Uniform Resource Locator）的缩写。每一个 URL 都有一个 scheme，也就是我们通常说的协议，它决定了如何访问一个资源。例如，在 URL <code>http://www.example.com</code> 中，<code>http</code> 就是它的 scheme，指的是要通过 HTTP 协议来访问 <code>www.example.com</code>。</p><p>在 Node.js 中，很多模块和函数都会处理 URL，比如 HTTP 模块用于创建 web 服务器或客户端，而文件系统（fs）模块则用于操作本地文件系统。当你使用这些模块中的某些功能时，如果提供了不正确的 URL scheme，Node.js 就会抛出 <code>ERR_INVALID_URL_SCHEME</code> 错误。</p><p>这个错误通常意味着你尝试对 URL 采取了一个不支持的操作，因为你给的 URL 的 scheme 与该操作不匹配。下面是几个例子：</p><ol><li><p><strong>读取本地文件：</strong><br> 假设你想通过 fs 模块来读取本地文件，正确的方式是使用 <code>file://</code> scheme。如果你错误地使用了 <code>http://</code>，Node.js 将无法理解你想通过 HTTP 协议读取本地文件，这显然是不合适的。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> readFile</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file:///path/to/your/local/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果这里用错了scheme, 会输出 ERR_INVALID_URL_SCHEME</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>使用 HTTP 客户端：</strong><br> 当你使用 HTTP 模块来发起网络请求时，URL 需要使用 <code>http://</code> 或 <code>https://</code> scheme。如果你尝试使用 <code>file://</code>，Node.js 将会报告 <code>ERR_INVALID_URL_SCHEME</code> 错误，因为你不能通过文件协议来发送网络请求。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file:///path/to/resource</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里如果用了错误的scheme, 会输出 ERR_INVALID_URL_SCHEME</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>WebSocket 连接：</strong><br> 如果你要建立一个 WebSocket 连接，你应该使用 <code>ws://</code> 或 <code>wss://</code> scheme。如果你用了 <code>http://</code>，WebSocket 客户端会抛出 <code>ERR_INVALID_URL_SCHEME</code> 错误，因为 WebSocket 需要自己特定的协议。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> WebSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ws</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ws</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> WebSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http://example.com/socket</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">open</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> open</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">something</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里如果用了错误的scheme, 会输出 ERR_INVALID_URL_SCHEME</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>总结一下，<code>ERR_INVALID_URL_SCHEME</code> 表示你尝试对一个 URL 进行了不适合其 scheme 的操作。你应该检查你的代码，确保使用了正确的 scheme。这通常意味着根据你要做的操作选择 <code>http://</code>, <code>https://</code>, <code>file://</code> 等等。</p><h3 id="err-ipc-channel-closed" tabindex="-1"><a class="header-anchor" href="#err-ipc-channel-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_ipc_channel_closed" target="_blank" rel="noopener noreferrer">ERR_IPC_CHANNEL_CLOSED</a></span></a></h3><p>在 Node.js 中，<code>IPC</code> 是 Inter-Process Communication 的缩写，中文意思是“进程间通信”。Node.js 允许通过 IPC 通道来实现父子进程之间的消息传递。这个通道本质上是一个可以进行双向通信的管道。</p><p><code>ERR_IPC_CHANNEL_CLOSED</code> 错误会发生在尝试通过一个已经关闭的 IPC 通道发送消息时。这种错误通常表明程序逻辑中存在一些问题，导致在不恰当的时间（例如，通道已经关闭后）尝试与另一个进程通信。</p><p>举个例子，假设你有一个主进程（父进程），它创建了一个子进程来执行某些任务。两者通过 IPC 通道通信。如果因为某些原因，这个 IPC 通道被关闭了，然后父进程或子进程试图通过这个已关闭的通道发送消息，就会引发 <code>ERR_IPC_CHANNEL_CLOSED</code> 错误。</p><p>下面是一个简单的示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// fork 方法用于创建一个子进程，参数是子进程要运行的脚本文件名</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">subprocess.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设在这个点子进程意外退出了，导致 IPC 通道关闭</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">exit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">子进程退出，退出码 </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试通过已关闭的 IPC 通道发送消息，将会抛出 ERR_IPC_CHANNEL_CLOSED 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 一段时间后，子进程自然退出</span></span>
<span class="line"><span style="color:#D8DEE9;">  child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">kill</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 2000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，在子进程退出之后，主进程仍然尝试使用 <code>child.send()</code> 发送消息，由于 IPC 通道已经随着子进程的退出而关闭，所以 Node.js 将会抛出 <code>ERR_IPC_CHANNEL_CLOSED</code> 错误。</p><p>解决这一问题的方法通常包括确保通道仍然开启时再发送消息，或者更一般地，处理好进程间通信的时序和异常情况。例如，监听 <code>close</code> 或 <code>error</code> 事件，并在这些事件触发时停止尝试通信。</p><h3 id="err-ipc-disconnected" tabindex="-1"><a class="header-anchor" href="#err-ipc-disconnected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_ipc_disconnected" target="_blank" rel="noopener noreferrer">ERR_IPC_DISCONNECTED</a></span></a></h3><p>好的，首先我们来理解一下什么是 Node.js。Node.js 是一个开源的、跨平台的 JavaScript 运行环境，它允许你在服务器端运行 JavaScript 代码。这意味着你可以使用 JavaScript 来编写能够响应网络请求、读取或写入文件、与数据库进行交互等后端功能。</p><p>接下来，谈谈 IPC。IPC 代表进程间通信(Inter-Process Communication)，是指在不同进程之间传输数据或信号的方法。在 Node.js 中，如果你创建了一个主进程和一个或多个子进程，这些进程可能需要相互通信。Node.js 为此提供了一种机制，子进程可以通过 IPC 通道发送消息给父进程，反之亦然。</p><p>现在，我们来看看<code>ERR_IPC_DISCONNECTED</code>错误。当你在 Node.js 程序中使用 IPC 时，如果尝试发送消息或关闭已经断开连接的 IPC 通道时，就会遇到这个错误。换句话说，当通信管道不再连接两个进程（例如，其中一个进程已退出或终止），但你仍然尝试通过它进行通信时，你的程序就会抛出<code>ERR_IPC_DISCONNECTED</code>错误。</p><p>让我们通过一个例子来更具体地理解这个错误：</p><p>假设你有一个 Node.js 应用程序，其中有一个主进程负责启动子进程，并且主进程与子进程通过 IPC 通道进行通信。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 主进程代码 main.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个子进程</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送一个消息给子进程</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GREET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Child process!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听子进程发来的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">来自子进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设某处代码导致子进程提前终止</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">kill</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将终止子进程</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在子进程终止后尝试发送消息</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PING</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 因为子进程已经终止, 这里会抛出ERR_IPC_DISCONNECTED错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法发送消息，IPC通道已断开:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 2000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 子进程代码 child.js</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GREET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出 &quot;Hello, Child process!&quot;</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RESPONSE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> message</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello, Parent process!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，主进程创建了一个子进程，并向其发送消息。然后它模拟了一个场景：在 1 秒后，子进程被杀死。接着，在 2 秒后，主进程试图再次向子进程发送消息，但因为子进程已经不存在了，所以发送操作会失败，并且会捕获到<code>ERR_IPC_DISCONNECTED</code>错误。</p><p>总结起来，<code>ERR_IPC_DISCONNECTED</code>错误发生在 Node.js 应用程序中的两个进程（通常是父进程和子进程）尝试通过已经断开的 IPC 通道进行通信时。处理这类错误的最佳实践包括在发送消息之前检查进程是否仍然活着，或者妥善处理可能发生的异常。</p><h3 id="err-ipc-one-pipe" tabindex="-1"><a class="header-anchor" href="#err-ipc-one-pipe"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_ipc_one_pipe" target="_blank" rel="noopener noreferrer">ERR_IPC_ONE_PIPE</a></span></a></h3><p><code>ERR_IPC_ONE_PIPE</code> 是 Node.js 中的一个错误代码，它属于系统错误（也称为操作系统错误）。IPC 代表“Inter-Process Communication”，即进程间通信。在 Node.js 中，进程间通信常用于主进程与子进程之间的信息传递。</p><p>出现 <code>ERR_IPC_ONE_PIPE</code> 错误意味着有一个问题出现在 IPC 通道的设置上。具体来说，这个错误表示当你尝试通过 IPC 创建子进程时，至少需要一个管道（pipe）。管道是一种允许两个进程进行单向通信的机制。</p><p>为了更好地理解这个概念，我们可以举一个实际的例子。</p><p>假设你正在编写一个 Node.js 应用程序，并且你想要创建一个子进程来执行某些任务，同时还想让父进程和子进程能够彼此通信。Node.js 提供了 <code>child_process</code> 模块来帮助我们完成这项工作。其中的 <code>fork()</code> 方法可以用来创建一个子进程并建立一个 IPC 通道以便通信。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确使用 fork，IPC 通道将被自动创建</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_script.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 父进程发送消息给子进程</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听从子进程接收到的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">收到来自子进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们没有直接遇到 <code>ERR_IPC_ONE_PIPE</code> 错误，因为 <code>fork()</code> 方法默认就会为我们创建 IPC 通道。然而，如果我们使用 <code>spawn()</code> 方法并且不正确地设置 <code>stdio</code> 选项，就可能会遇到这个错误。</p><p>例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> spawn</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的使用 spawn，没有为 IPC 设置管道</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> spawn</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_script.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // stdio: &#39;inherit&#39; 不会创建 IPC 通道，导致 ERR_IPC_ONE_PIPE 错误</span></span>
<span class="line"><span style="color:#88C0D0;">  stdio</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">inherit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试发送消息将失败，因为没有 IPC 通道</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_IPC_ONE_PIPE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上错误示例中，我们使用 <code>spawn()</code> 并且设置 <code>stdio</code> 为 <code>&#39;inherit&#39;</code>，这样做并不会为 IPC 创建一个管道。因此，当我们尝试使用 <code>send()</code> 方法发送消息时，会遇到 <code>ERR_IPC_ONE_PIPE</code> 错误，因为子进程没有通过 IPC 通道与父进程连接。</p><p>纠正这个问题的方法是在调用 <code>spawn()</code> 时使用正确的 <code>stdio</code> 配置，其中包括 <code>&#39;ipc&#39;</code> 来指明需要 IPC 通道：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> spawn</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用 spawn 并正确设置 stdio 以包含 IPC 通道</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> spawn</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_script.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  stdio</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">pipe</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ipc</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 添加 &#39;ipc&#39; 以使 IPC 通道可用</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 现在可以发送消息了</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">收到来自子进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正后的例子中，通过将 <code>stdio</code> 的第四个参数设置为 <code>&#39;ipc&#39;</code>，我们创建了一个 IPC 通道，现在父进程和子进程就可以通过 <code>.send()</code> 和 <code>.on(&#39;message&#39;)</code> 进行通信，而不会抛出 <code>ERR_IPC_ONE_PIPE</code> 错误了。</p><h3 id="err-ipc-sync-fork" tabindex="-1"><a class="header-anchor" href="#err-ipc-sync-fork"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_ipc_sync_fork" target="_blank" rel="noopener noreferrer">ERR_IPC_SYNC_FORK</a></span></a></h3><p><code>ERR_IPC_SYNC_FORK</code>是一个错误类型，它出现在 Node.js 中。在详细解释这个错误之前，让我们先了解一些背景知识。</p><p>IPC 是“Inter-Process Communication”的缩写，意思是“进程间通信”。在计算机科学中，进程是运行着的程序的实例。进程间通信允许不同的进程（可能是在同一台机器上或者分布在网络中的不同机器上）之间传递信息或数据。</p><p>Node.js 具有一个称为<code>child_process</code>的模块，它允许你从 Node.js 程序内部启动新的子进程，并与这些子进程进行通信。这在你需要执行一些耗时任务或希望并行处理多项工作时非常有用。</p><p>当你使用<code>child_process.fork()</code>方法来创建一个新的 Node.js 进程时，新的子进程会自动设置 IPC 通信管道以便父进程和子进程之间可以发送消息。这种通信方式通常是异步的，也就是说，发送消息和接收消息不会阻塞各自的进程。</p><p>然而，<code>ERR_IPC_SYNC_FORK</code>错误会发生在父进程尝试通过同步的方式（即立即等待结果，阻塞当前进程直到完成）发送一个 IPC 消息给刚刚通过<code>fork()</code>创建的子进程时。由于 Node.js 设计为非阻塞的，这种做法违反了 Node.js 的基本原则，因此会抛出<code>ERR_IPC_SYNC_FORK</code>错误。</p><p>下面是一个简单的例子，演示如何正确和错误地使用<code>child_process.fork()</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确使用例子：异步通信</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> fork</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> child</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> fork</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">child_script.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设 &#39;child_script.js&#39; 是一个有效的脚本文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 异步地向子进程发送消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听子进程发来的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">收到子进程的消息:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误使用例子：尝试同步通信会抛出 ERR_IPC_SYNC_FORK 错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里没有提供同步发送消息的API，但如果尝试这样做，就会导致错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  child</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sendSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> hello</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // sendSync() 方法是假想的，实际上并不存在</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_IPC_SYNC_FORK</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">不能同步发送消息给子进程！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，第一部分代码展示了如何正确地异步发送消息给子进程。而在错误使用的例子中，尽管没有实际的<code>sendSync()</code>方法，但它说明了如果存在这样的同步消息发送方式，那么尝试使用它将会抛出<code>ERR_IPC_SYNC_FORK</code>错误。</p><p>要解决<code>ERR_IPC_SYNC_FORK</code>错误，确保总是以异步方式使用 IPC 通信，而不是尝试阻塞父进程等待子进程的响应。</p><h3 id="err-loader-chain-incomplete" tabindex="-1"><a class="header-anchor" href="#err-loader-chain-incomplete"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_loader_chain_incomplete" target="_blank" rel="noopener noreferrer">ERR_LOADER_CHAIN_INCOMPLETE</a></span></a></h3><p><code>ERR_LOADER_CHAIN_INCOMPLETE</code>是 Node.js 中的一种错误类型，这个错误发生在使用 ES 模块加载器时。在 Node.js 中，ES 模块是使用<code>import</code>和<code>export</code>语句来导入和导出模块的一种方式。</p><p>当你在 Node.js 中使用 ES 模块时，系统会通过一个加载器（loader）去解析和加载你需要的模块。这个加载器需要能够找到并且加载所有模块依赖的链条上的每一个模块。如果加载器无法完成这个任务，比如说有一个模块没有被正确地解析或者加载，那么就会抛出<code>ERR_LOADER_CHAIN_INCOMPLETE</code>错误。</p><p>这个错误通常是因为以下原因之一引起的：</p><ol><li>一个模块的路径不正确，导致加载器无法找到它。</li><li>模块的导出和导入没有匹配好，比如你尝试导入了一个不存在的导出。</li><li>文件或者包权限问题，加载器因为没有权限而无法读取某个文件。</li></ol><p>举个实际运用的例子，假设你有下面两个 JavaScript 文件，一个名为<code>mathUtil.js</code>，还有一个名为<code>app.js</code>。</p><p><code>mathUtil.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ES模块导出一个函数</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>app.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 尝试从&#39;mathUtil.js&#39;导入add函数</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./mathUtil.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 应该输出3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在正常情况下，当你运行<code>app.js</code>时，加载器应该能够找到<code>mathUtil.js</code>文件，然后导入<code>add</code>函数，并且正常运行。</p><p>但如果我们将<code>mathUtil.js</code>的文件名改错，或者移动到另一个位置，使得<code>app.js</code>里的导入路径不正确，比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 此时路径错误，加载器找不到&#39;mathUtil.js&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./wrongPath/mathUtil.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>那么加载器就无法找到<code>mathUtil.js</code>文件，因此无法导入<code>add</code>函数，最终会抛出<code>ERR_LOADER_CHAIN_INCOMPLETE</code>错误，提示模块加载链不完整。</p><p>如果遇到这个错误，你需要检查导入路径是否正确、确保所需要的所有模块都已经正确导出并可以被加载器访问。</p><h3 id="err-manifest-assert-integrity" tabindex="-1"><a class="header-anchor" href="#err-manifest-assert-integrity"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_assert_integrity" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_ASSERT_INTEGRITY</a></span></a></h3><p><code>ERR_MANIFEST_ASSERT_INTEGRITY</code> 是一个特定类型的错误，它在 Node.js 中出现时表明一个资源的完整性检查失败了。这种完整性检查通常是用来验证从网络上下载或者通过其他方式接收到的文件是否未被篡改且完好无损。</p><p>在 Node.js v21.7.1 中，当你使用内置模块例如 <code>fs</code> (文件系统) 载入或运行代码、导入模块、或是加载资源时，Node.js 可以对这些操作涉及的文件进行完整性校验。如果你指定了一个“完整性清单”（integrity manifest），即一系列文件和它们期望的哈希值，Node.js 将会计算每个文件的实际哈希值，并与你提供的清单进行比较。</p><p>这里有两个实际应用的例子：</p><ol><li><p><strong>下载远程资源</strong>：<br> 假设你正在编写一个需要从互联网下载资源的 Node.js 应用。你想确保所下载的文件没有在传输过程中被篡改或损坏。为此，你可以事先得知文件的哈希值（如一个 SHA-256 哈希），并在下载后验证文件的实际哈希值是否与预期相符。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> createHash</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> pipeline</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> createReadStream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> createWriteStream</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> promisify</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">util</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> got</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">got</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 一个流行的 HTTP 请求库</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> downloadAndCheckFile</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> expectedHash</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> downloadStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> got</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileWriterStream</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./downloaded-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 使用 pipeline 并等待下载完成</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#88C0D0;"> promisify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pipeline</span><span style="color:#D8DEE9FF;">)(</span><span style="color:#D8DEE9;">downloadStream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fileWriterStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 创建哈希</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> fileReaderStream</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./downloaded-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    fileReaderStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    fileReaderStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      const</span><span style="color:#D8DEE9;"> calculatedHash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">calculatedHash</span><span style="color:#81A1C1;"> ===</span><span style="color:#D8DEE9;"> expectedHash</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">File integrity verified!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Integrity check failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用该函数进行文件下载和完整性检查</span></span>
<span class="line"><span style="color:#88C0D0;">downloadAndCheckFile</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">https://example.com/some-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">expected-file-hash-value</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>模块加载完整性校验</strong>：<br> 如果你在 Node.js 项目中安装了第三方依赖，通常通过 npm 或 yarn 这样的包管理器进行，它们支持生成一个 <code>package-lock.json</code> 或 <code>yarn.lock</code> 文件。这些锁文件中会包含每个包的具体版本信息和对应的哈希值。当你之后安装或更新项目依赖时，npm/yarn 会检查每个包的哈希值，确保它们未被篡改。</p><p>如果完整性校验失败，<code>ERR_MANIFEST_ASSERT_INTEGRITY</code> 错误就会被触发，提示开发者所获取的包可能存在风险，无法确保其为原始的、可信的代码。</p></li></ol><p>总而言之，<code>ERR_MANIFEST_ASSERT_INTEGRITY</code> 错误是 Node.js 用于确保代码和资源安全性的机制之一，使开发者能够确信他们所使用的文件与预期的是一致的，从而防止潜在的安全威胁。</p><h3 id="err-manifest-dependency-missing" tabindex="-1"><a class="header-anchor" href="#err-manifest-dependency-missing"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_dependency_missing" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_DEPENDENCY_MISSING</a></span></a></h3><p><code>[ERR_MANIFEST_DEPENDENCY_MISSING]</code> 是一个错误类型，它在 Node.js 中标示了一个特定的问题。这个错误发生在 Node.js 尝试根据一个称为“包清单（package manifest）”或<code>package.json</code>文件的配置来加载一个模块或包时，但是所需要的依赖项在该清单中没有列出。</p><p>在 Node.js 中，每个项目通常有一个<code>package.json</code>文件，它包含了关于项目的元数据信息以及项目依赖的模块列表（即项目所需的其他代码库）。当你运行一个 Node.js 应用程序时，Node 会查看这个<code>package.json</code>文件，并确保所有列出的依赖都已经安装在<code>node_modules</code>目录下。</p><p>如果 Node.js 在启动或执行过程中遇到了缺少必要模块的情况，那么它会抛出<code>ERR_MANIFEST_DEPENDENCY_MISSING</code>错误。这通常意味着<code>package.json</code>文件中列出的依赖项和实际安装在你的项目中的依赖项不一致。</p><p>让我们通过几个实际运用的例子来解释这个错误：</p><p><strong>例子 1: 未安装依赖</strong><br> 假设你的<code>package.json</code>文件中指定了一个依赖<code>express</code> （一个流行的 Node.js web 应用框架），像这样：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-app</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">dependencies</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">^4.17.1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后你尝试运行你的应用程序，但是你忘记了先运行<code>npm install</code>命令来安装这些依赖。此时，Node.js 会尝试加载<code>express</code>模块但找不到它，因此会抛出<code>ERR_MANIFEST_DEPENDENCY_MISSING</code>错误。</p><p><strong>解决方法</strong>：运行<code>npm install</code>来安装所有列出的依赖项。</p><p><strong>例子 2: 清单文件和实际依赖不匹配</strong><br> 可能你在开发过程中手动添加了一些代码库到<code>node_modules</code>目录，但是忘记了更新<code>package.json</code>文件。假如你的代码中有以下引用：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> lodash</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">lodash</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你直接复制粘贴了<code>lodash</code>库文件到<code>node_modules</code>而没有使用<code>npm</code>命令进行安装。当 Node.js 尝试查找<code>package.json</code>文件中的<code>lodash</code>条目时，会发现它不存在，这又会导致<code>ERR_MANIFEST_DEPENDENCY_MISSING</code>错误。</p><p><strong>解决方法</strong>：使用<code>npm install lodash --save</code>来正确安装<code>lodash</code>并自动将其添加到<code>package.json</code>文件中。</p><p>以上就是<code>ERR_MANIFEST_DEPENDENCY_MISSING</code>错误的概述以及解决这类错误的一些基本方法。在实践中，确保始终通过合适的 npm 命令（如<code>npm install packageName</code>）来管理你的依赖，以及确保你的<code>package.json</code>始终保持最新状态，是避免这种错误的关键。</p><h3 id="err-manifest-integrity-mismatch" tabindex="-1"><a class="header-anchor" href="#err-manifest-integrity-mismatch"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_integrity_mismatch" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_INTEGRITY_MISMATCH</a></span></a></h3><p><code>ERR_MANIFEST_INTEGRITY_MISMATCH</code> 是 Node.js 中的一个错误代码，它表示在验证资源的完整性时出现了不匹配。这個错误跟所谓的“完整性清单（integrity manifest）”有关，这通常是一个包括了文件和它们相对应的哈希值（一个可以代表文件内容的独特字符串）的列表。Node.js 用这个列表来确认文件是否被更改过或损坏。</p><p>在 Node.js 中，这种验证通常发生在使用如 npm 或 yarn 这类包管理器安装依赖时。当你安装一个包时，包管理器会检查下载的文件是否与发布者声明的哈希值相匹配。如果不匹配，就会抛出 <code>ERR_MANIFEST_INTEGRITY_MISMATCH</code> 错误，因为这通常意味着文件可能已经被篡改或损坏，从而可能影响程序的运行安全和稳定性。</p><h3 id="实际例子-7" tabindex="-1"><a class="header-anchor" href="#实际例子-7"><span>实际例子</span></a></h3><p>假设你正在创建一个 Node.js 应用，并且你想要安装一个叫做 <code>express</code> 的包，使得你能快速搭建一个服务器。</p><ol><li>在终端中，你运行命令 <code>npm install express</code>。</li><li>npm 将联系 npm 仓库，并获取到 <code>express</code> 包的信息以及其依赖。</li><li>下载 <code>express</code> 包文件期间，npm 同时会检查文件的完整性。</li><li>如果文件的哈希值与 npm 仓库中记录的不相符，npm 就会抛出 <code>ERR_MANIFEST_INTEGRITY_MISMATCH</code> 错误。</li></ol><h3 id="处理这个错误的方法" tabindex="-1"><a class="header-anchor" href="#处理这个错误的方法"><span>处理这个错误的方法：</span></a></h3><ul><li><strong>再次尝试安装</strong>：网络问题有时会导致文件下载不完整或损坏，重新尝试可能解决问题。</li><li><strong>清除缓存</strong>：执行 <code>npm cache clean --force</code> 清除本地缓存，然后再尝试安装。</li><li><strong>检查 npm 源</strong>：确保你使用的是正确并且可靠的 npm 源。</li><li><strong>手动验证</strong>：有时候，即便是发布者也可能上传了错误的哈希值，这时你可以联系维护者或检查 issue 跟踪系统看是否别人遇到了同样的问题。</li></ul><p>通过以上方法，你可以解决由于 <code>ERR_MANIFEST_INTEGRITY_MISMATCH</code> 引起的安装问题，确保你的依赖安全无误地加入到你的项目中。</p><h3 id="err-manifest-invalid-resource-field" tabindex="-1"><a class="header-anchor" href="#err-manifest-invalid-resource-field"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_invalid_resource_field" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_INVALID_RESOURCE_FIELD</a></span></a></h3><p>在 Node.js 中，错误代码 <code>ERR_MANIFEST_INVALID_RESOURCE_FIELD</code> 是与 Node.js 的特性 &quot;Package Exports&quot; 相关的。为了更好地理解这个错误，我们首先需要知道 Node.js 的模块系统和 Package Exports 特性。</p><p>Node.js 允许你将代码组织成模块，这样可以使得代码易于管理和复用。在 Node.js 中，一个包（package）通常是指一个目录，里面包含了一个 <code>package.json</code> 文件。这个 <code>package.json</code> 文件描述了包的元数据，并且定义了包的入口点和其他设置。</p><p>在较新版本的 Node.js 中，<code>package.json</code> 文件中可以使用 &quot;exports&quot; 字段来更精确地控制模块的导出方式。通过 &quot;exports&quot; 字段，包作者可以定义哪些子路径可以被外部访问和如何解析它们。这提供了显式而不是隐式地控制包结构对外公开的部分，增加了封装性和安全性。</p><p>现在，让我们回到 <code>ERR_MANIFEST_INVALID_RESOURCE_FIELD</code> 这个错误代码。当你在 <code>package.json</code> 文件的 &quot;exports&quot; 字段中使用了不正确的格式或者值时，Node.js 就会抛出这个错误。比如说，&quot;exports&quot; 字段应该是一个对象，如果你不小心设置成了字符串或者其他类型的值，Node.js 会提示这个错误。</p><p>例子：</p><p>假设你正在创建一个名为 “my-library” 的 Node.js 包，并且你想要只导出 <code>src/main.js</code> 文件作为包的主入口点。你可能会在 <code>package.json</code> 文件中写下：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/main.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你这样设置 &quot;exports&quot; 字段为一条字符串，Node.js 将不能识别这个字段，因为按照规范它应该是一个对象描述符。正确的 “exports” 字段设置应该类似于以下：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/main.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的设置表示，当外部代码 <code>import</code> 或者 <code>require</code> 你的 ”my-library“ 时，实际上它们获取的是 <code>./src/main.js</code> 文件。</p><p>如果你设置了 &quot;exports&quot; 字段并且格式有误，Node.js 在运行时就会抛出 <code>ERR_MANIFEST_INVALID_RESOURCE_FIELD</code> 错误，告诉你 &quot;exports&quot; 字段里有无效的配置。</p><p>解决这个问题的办法是检查你的 <code>package.json</code> 文件，确保 &quot;exports&quot; 字段遵循正确的格式和语法规则。如果你对 &quot;exports&quot; 字段不熟悉，阅读 Node.js 官方文档中关于模块导出的章节可以帮助你更好地理解如何使用这个特性。</p><h3 id="err-manifest-invalid-specifier" tabindex="-1"><a class="header-anchor" href="#err-manifest-invalid-specifier"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_invalid_specifier" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_INVALID_SPECIFIER</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的 <code>ERR_MANIFEST_INVALID_SPECIFIER</code> 错误。</p><p>这个错误是 Node.js 在处理模块加载时可能会遇到的。Node.js 允许你使用模块化的方式组织代码，每个文件或包可以被认为是一个模块。在 Node.js 中，有一个叫做 &quot;package.json&quot; 的文件通常用来描述一个包（也就是项目或模块集合）的各种信息，如版本、依赖项等。</p><p>其中有一个特性，允许你定义一个名为 <code>&quot;exports&quot;</code> 的字段来控制模块如何对外提供接口。这可以帮助包的作者限定哪些部分是公开可用的，并且确保私有或内部模块不会被外部使用。</p><p>当出现 <code>ERR_MANIFEST_INVALID_SPECIFIER</code> 错误时，意味着 Node.js 尝试根据 package.json 文件中的 <code>&quot;exports&quot;</code> 字段解析模块导出时，发现了一个不符合要求的指定器（specifier）。指定器就是用来指定如何加载某个模块的字符串。</p><p>具体来说，可能有以下几种情况会引起这个错误：</p><ol><li><code>&quot;exports&quot;</code> 字段里面的路径指定不正确。</li><li>使用了非法的字符或者模式来指定路径。</li><li><code>&quot;exports&quot;</code> 字段的格式本身就写得不正确。</li></ol><p>下面举一个例子来说明这个问题：</p><p>假设你有一个 Node.js 项目，它的结构大致如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>/my-node-project</span></span>
<span class="line"><span>    /src</span></span>
<span class="line"><span>        index.js</span></span>
<span class="line"><span>    package.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你的 <code>package.json</code> 可能看起来像这样：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-node-project</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">./feature</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/feature.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的配置表示，当其他模块想要导入你项目中的 <code>feature</code> 模块时，应该使用 <code>&quot;./feature&quot;</code> 这个指定器，并且实际对应的文件是 <code>src/feature.js</code>。</p><p>如果你在 <code>&quot;exports&quot;</code> 字段中犯了一个错误，比如将路径写错：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">./feature</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./wrong/path/to/feature.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么当其他代码尝试通过正确的指定器 <code>&quot;./feature&quot;</code> 导入模块时，因为找不到对应的文件路径，Node.js 就会抛出 <code>ERR_MANIFEST_INVALID_SPECIFIER</code> 错误。</p><p>为了避免这种错误，当编辑 <code>package.json</code> 文件时，你需要仔细检查 <code>&quot;exports&quot;</code> 字段中指定路径的正确性，并确保它们是有效的文件系统路径。同时，在新版本的 Node.js 中测试你的包，以确保没有任何指定路径的问题，也是一个好习惯。</p><h3 id="err-manifest-parse-policy" tabindex="-1"><a class="header-anchor" href="#err-manifest-parse-policy"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_parse_policy" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_PARSE_POLICY</a></span></a></h3><p>好的，<code>ERR_MANIFEST_PARSE_POLICY</code>是 Node.js 中的一个错误类型，它与 Node.js 的新功能——Package Policies 有关。在 Node.js 的某些版本中（尤其是当你使用了实验性的或者边缘的特性时），会引入一些对于包（也就是模块或者应用程序）的管理和控制规则，这被称为 Package Policies。</p><p>首先，我们需要知道什么是 Manifest 文件。在 Node.js 中，通常指的是<code>package.json</code>文件，它包含了关于 Node.js 项目的元数据，比如项目名称、版本、依赖等。然而，在这里提到的 Manifest 可能指的是专门为 Package Policies 设计的一个配置文件，用来限制和管理模块的使用。</p><p>当 Node.js 运行时尝试解析这个 Manifest 文件，如果文件格式不正确或者包含无法理解的策略描述，Node.js 就会抛出<code>ERR_MANIFEST_PARSE_POLICY</code>错误。这意味着 Manifest 文件中定义的策略不能被 Node.js 正确识别或者执行。</p><p>现在让我们举个例子：</p><p>假设你有一个 Node.js 项目，为了确保代码的安全性，你想要限制只能加载来自特定源的模块。你可能会创建一个 Manifest 文件，并写下以下内容：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">importAssertions</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">dependencies</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">some-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#8FBCBB;">integrity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha384-oqVuAfXRKap7fdgcCY5...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#616E88;"> // 这是一个hash值，用于校验模块内容</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果上述 Manifest 文件存在任何语法错误，或者 Node.js 无法理解里面的某些字段或者值（例如，如果 Node.js 没有实现某个特定的策略，或者策略描述有误），当 Node.js 尝试加载该 Manifest 文件时，就会抛出<code>ERR_MANIFEST_PARSE_POLICY</code>错误。</p><p>为了解决这个错误，你需要检查并确保 Manifest 文件格式正确，所有策略都被当前版本的 Node.js 所支持，并且没有任何笔误或错误的值。</p><p>由于 Package Policies 是 Node.js 中较新的功能，可能还处于实验阶段，所以在使用这些功能时要特别小心，确保你使用的 Node.js 版本支持你正在使用的策略，并且跟踪 Node.js 的更新，因为这些策略和特性可能会随时间发生变化。</p><h3 id="err-manifest-tdz" tabindex="-1"><a class="header-anchor" href="#err-manifest-tdz"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_tdz" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_TDZ</a></span></a></h3><p><code>ERR_MANIFEST_TDZ</code>是 Node.js 中的一个错误类型，代表 &quot;Temporal Dead Zone&quot;（暂时性死区）。这个概念来自于 JavaScript 的<code>const</code>和<code>let</code>关键字，用于声明变量。当你使用<code>const</code>或<code>let</code>声明变量时，这个变量在声明之前不能被访问，否则会引发一个引用错误。这段代码所在的区域就称为暂时性死区（TDZ）。</p><p>然而，<code>ERR_MANIFEST_TDZ</code>并不是直接与<code>const</code>和<code>let</code>的使用相关，而是与 Node.js 中的模块加载机制有关。在 v21.7.1 版本中，Node.js 尝试使用一种名为“导入映射”的新功能来指定模块如何被导入。如果一个模块的导入映射不正确或者在初始化过程中提前引用了，就可能触发<code>ERR_MANIFEST_TDZ</code>错误。</p><p>让我们通过一个例子来解释这个错误：</p><p>假设你有一个 Node.js 项目，其中包含了一个名为<code>config.json</code>的文件，它定义了一些配置信息。你希望使用导入映射功能来指定某模块应该从<code>config.json</code>导入配置。导入映射可能在一个名为<code>package.json</code>的文件中定义，看起来可能像这样：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">imports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">#config</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./config.json</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这里你把<code>#config</code>标记映射到了项目根目录下的<code>config.json</code>文件。</p><p>然后，在你的 JavaScript 代码中，你可能试图这样导入配置：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> config</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">#config</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这是正确的操作，但如果你在导入映射生效之前就尝试执行这条导入语句，比如导入语句位于初始化模块的逻辑之上（在导入映射的 TDZ 内），就可能触发<code>ERR_MANIFEST_TDZ</code>错误。</p><p>实际例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 错误示例：可能导致 ERR_MANIFEST_TDZ</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> config</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">#config</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这行代码在导入映射生效之前执行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">config</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的操作应该确保所有初始化逻辑完成后再导入模块</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要解决这个问题，你需要确保你的导入语句在模块系统准备好以后才执行。通常情况下，这意味着你需要检查你的<code>package.json</code>文件，确认导入映射的定义是正确的，并且没有代码试图在初始化过程中过早地访问这些映射。</p><p>总结一下，<code>ERR_MANIFEST_TDZ</code>是关于模块导入时序的一个错误，确保你的导入映射已经定义好，并且在正确的时间点使用它们可以避免这个错误。</p><h3 id="err-manifest-unknown-onerror" tabindex="-1"><a class="header-anchor" href="#err-manifest-unknown-onerror"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_manifest_unknown_onerror" target="_blank" rel="noopener noreferrer">ERR_MANIFEST_UNKNOWN_ONERROR</a></span></a></h3><p>Node.js 中的<code>ERR_MANIFEST_UNKNOWN_ONERROR</code>是一个特定类型的错误，它与 Node.js 的子系统“Policy Manifests”有关。为了解释这个错误，我们需要先了解 Policy Manifests 是什么以及它们是如何工作的。</p><p><strong>Policy Manifests 介绍</strong></p><p>在 Node.js 中，Policy Manifests 是一种用于增强代码安全性的机制。通过使用 Policy Manifests，开发者能够定义一组规则，告诉 Node.js 哪些资源（如脚本、模块）是可信的。这些规则记录在一个名为“package-integrity.json”的文件中。当 Node.js 加载代码时，会检查这些资源是否符合政策清单中定义的规则，例如，是否拥有正确的数字签名或哈希值。</p><p><strong>ERR_MANIFEST_UNKNOWN_ONERROR 解释</strong></p><p><code>ERR_MANIFEST_UNKNOWN_ONERROR</code>错误出现的情况通常与开发者在实现 Policy Manifests 时遇到了某些问题。具体来说，当 Node.js 尝试处理一个未知的<code>onerror</code>事件时，就会抛出这个错误。</p><p>对于 Policy Manifests 来说，<code>onerror</code>是一个处理事件，用于对资源加载失败进行自定义处理。如果在 Policy Manifests 中提到了<code>onerror</code>处理器，但是 Node.js 不知道如何执行它（可能因为处理器名称写错或者处理器没有正确实现），那么就会引发<code>ERR_MANIFEST_UNKNOWN_ONERROR</code>错误。</p><p><strong>实际例子</strong></p><p>假设你正在开发一个 Node.js 应用，并且想要确保应用只加载已经验证过的第三方库。你决定使用 Policy Manifests 来定义一个规则，只允许加载具有特定哈希值的脚本文件。</p><ol><li>你创建了一个名为<code>package-integrity.json</code>的 Policy Manifest 文件。</li><li>在这个文件中，你列出了允许加载的每个资源的哈希值。</li><li>你还定义了一个<code>onerror</code>处理器，用于处理任何违反政策规则的加载尝试。</li></ol><p>让我们来看看<code>package-integrity.json</code>可能的内容：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">resources</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">https://example.com/library.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#8FBCBB;">integrity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha384-oqVuAfXRKap7fdgcCY5uykM6+R9AAQ4CyQ/keZx3fHjgJ3lN2kfjDH/cM7EvLavu</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">onerror</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">handleResourceError</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后你在 Node.js 的应用代码中实现了<code>handleResourceError</code>函数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> handleResourceError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">resource</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error loading resource </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">resource</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你不慎将<code>onerror</code>的属性名写成了<code>onError</code>（注意大小写不同），那么 Node.js 会找不到名为<code>handleResourceError</code>的处理器。因此，当尝试加载一个不符合规则的资源时，Node.js 会抛出<code>ERR_MANIFEST_UNKNOWN_ONERROR</code>错误，因为它不知道如何处理这个错误事件。</p><p>修复这个错误很简单，只需要确保 Policy Manifest 文件中的<code>onerror</code>属性和你的函数实现匹配即可。</p><p>希望这个解释能帮助你理解<code>ERR_MANIFEST_UNKNOWN_ONERROR</code>错误和 Policy Manifests 的基础概念。在开发 Node.js 应用时，记得仔细检查你的 Policy Manifest 文件和相关的错误处理逻辑！</p><h3 id="err-memory-allocation-failed" tabindex="-1"><a class="header-anchor" href="#err-memory-allocation-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_memory_allocation_failed" target="_blank" rel="noopener noreferrer">ERR_MEMORY_ALLOCATION_FAILED</a></span></a></h3><p><code>ERR_MEMORY_ALLOCATION_FAILED</code> 这个错误在 Node.js 中表示程序尝试分配内存时失败了。简单来说，就是当 Node.js 试图为某些操作获得更多的内存空间，但系统无法提供所需的内存量时，你会看到这个错误。</p><p>Node.js 是一个运行在服务器上的 JavaScript 环境，这意味着它需要内存来存储数据、执行代码等。平时我们使用电脑或手机应用程序时，操作系统会负责分配给每个应用程序一定的内存来运行。但是如果应用程序需要的内存超过了系统能够提供的最大限额，那么操作系统可能会拒绝分配更多内存，导致 <code>ERR_MEMORY_ALLOCATION_FAILED</code> 错误发生。</p><p>下面我会给你举一些实际的例子：</p><ol><li><p><strong>大型文件处理</strong><br> 假设你有一个 Node.js 应用程序，需要读取一个非常大的文件（比如几个 GB），如果你尝试一次性将整个文件内容加载到内存中，这可能导致内存分配失败，因此你会遇到 <code>ERR_MEMORY_ALLOCATION_FAILED</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试一次性读取巨大的文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">huge-file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法分配足够的内存来读取文件: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理文件内容...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>大量数据处理</strong><br> 如果你的 Node.js 应用正在处理大量的数据，例如在一个循环中创建了大量的对象而没有适当地释放内存，那么随着时间的推移，这些对象占用的内存可能会累积起来，最终导致内存分配失败。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> hugeArray</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 100000000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 创建大量对象</span></span>
<span class="line"><span style="color:#D8DEE9;">    hugeArray</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fill</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">*</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">内存分配失败: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>内存泄漏</strong><br> 如果你的应用程序有内存泄漏问题，即分配了内存但没有正确释放，随着应用程序的运行，未释放的内存会持续累计。最终，可能会耗尽可用内存，导致 <code>ERR_MEMORY_ALLOCATION_FAILED</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> leakMemory</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> leakedObjects</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> []</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">  setInterval</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 模拟内存泄漏，每次循环都保存一些对象在数组中不被释放</span></span>
<span class="line"><span style="color:#D8DEE9;">    leakedObjects</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> data</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Buffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">leakMemory</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>解决 <code>ERR_MEMORY_ALLOCATION_FAILED</code> 错误通常包括：</p><ul><li>检查代码以确保内存被有效管理和释放。</li><li>分批次处理大数据集，而不是一次性处理。</li><li>使用流（Streams）来处理大型文件。</li><li>增加 Node.js 可以使用的内存限制（如果系统资源允许）。</li></ul><h3 id="err-message-target-context-unavailable" tabindex="-1"><a class="header-anchor" href="#err-message-target-context-unavailable"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_message_target_context_unavailable" target="_blank" rel="noopener noreferrer">ERR_MESSAGE_TARGET_CONTEXT_UNAVAILABLE</a></span></a></h3><p>当你在使用 Node.js 进行编程时，会遇到各种错误和异常。这些错误通常会提供一个特定的错误代码，你可以用这个代码来快速了解发生了什么问题，并且如何解决它。在 Node.js v21.7.1 中，<code>ERR_MESSAGE_TARGET_CONTEXT_UNAVAILABLE</code> 是一个具体的错误代码。</p><p><code>ERR_MESSAGE_TARGET_CONTEXT_UNAVAILABLE</code> 错误是在 Node.js 的多线程环境下出现的，尤其是涉及 <code>worker_threads</code> 模块时。在 Node.js 中，你可以创建 worker 线程来执行一些耗时的操作，以此方式不会阻塞主线程。当你尝试从</p><h3 id="err-method-not-implemented" tabindex="-1"><a class="header-anchor" href="#err-method-not-implemented"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_method_not_implemented" target="_blank" rel="noopener noreferrer">ERR_METHOD_NOT_IMPLEMENTED</a></span></a></h3><p><code>ERR_METHOD_NOT_IMPLEMENTED</code> 是在 Node.js 中抛出的一个特定错误类型，指的是你尝试调用的某个方法或功能没有被实现。换句话说，这意味着代码中存在一个占位函数或者一个类的方法，但它还没有具体的功能代码实现。</p><p>假设有一个库或框架，开发者提供了一些方法的接口，但并未完成所有方法的具体实现，在这种情况下，如果你尝试使用其中未实现的方法，Node.js 就会抛出 <code>ERR_METHOD_NOT_IMPLEMENTED</code> 错误。</p><p>我们来举几个例子：</p><h3 id="例子-1-http-服务器响应方法未实现" tabindex="-1"><a class="header-anchor" href="#例子-1-http-服务器响应方法未实现"><span>例子 1：HTTP 服务器响应方法未实现</span></a></h3><p>想象你正在创建一个 HTTP 服务器，并且想定义一个处理 PATCH 请求的路由。但是，你忘记了为这个请求类型编写处理函数。看下面的简单示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">method</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">PATCH</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 假设这里我们还没有实现对 PATCH 请求的处理</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">emit</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#81A1C1;">      new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_METHOD_NOT_IMPLEMENTED: PATCH method not implemented</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你向服务器发送 PATCH 请求时，你会得到一个 <code>ERR_METHOD_NOT_IMPLEMENTED</code> 错误，因为此时你还没有为该方法编写处理代码。</p><h3 id="例子-2-类中的方法未实现" tabindex="-1"><a class="header-anchor" href="#例子-2-类中的方法未实现"><span>例子 2：类中的方法未实现</span></a></h3><p>考虑到你有一个表示动物的类，并且你有一个方法 <code>makeSound()</code> 来输出动物的叫声：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> Animal</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    this</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">  makeSound</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 这里假设我们还没有实现 makeSound 方法</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">ERR_METHOD_NOT_IMPLEMENTED: makeSound method not implemented</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 Animal 实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myAnimal</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Animal</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Mystery Creature</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 尝试调用未实现的方法</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  myAnimal</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">makeSound</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，当你尝试调用 <code>myAnimal.makeSound()</code> 的时候，因为 <code>makeSound</code> 方法还没有被实际实现，所以会抛出 <code>ERR_METHOD_NOT_IMPLEMENTED</code> 错误。</p><p>在实际开发中，如果你遇到了 <code>ERR_METHOD_NOT_IMPLEMENTED</code> 错误，通常需要回到你的代码中检查是否遗漏了某个方法的实现部分，或者是否正确地引用了需要的模块和类。解决这类错误的关键在于完善代码实现或等待第三方库作者更新缺失的功能。</p><h3 id="err-missing-args" tabindex="-1"><a class="header-anchor" href="#err-missing-args"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_args" target="_blank" rel="noopener noreferrer">ERR_MISSING_ARGS</a></span></a></h3><p>在 Node.js 中，<code>ERR_MISSING_ARGS</code> 错误是一个特定类型的错误，用来标识函数调用时缺少必要的参数或者参数不足。当你看到这个错误时，通常意味着你没有按照预期提供足够的信息给一个函数或者方法，导致它无法正常执行。</p><p>举几个实例：</p><h3 id="实例-1-文件操作" tabindex="-1"><a class="header-anchor" href="#实例-1-文件操作"><span>实例 1: 文件操作</span></a></h3><p>假设你想读取一个文件的内容，在 Node.js 中可以使用 <code>fs.readFile</code> 方法。这个方法至少需要两个参数：文件路径和一个回调函数。如果忽略其中任何一个，Node.js 就会抛出 <code>ERR_MISSING_ARGS</code> 错误。</p><p>正确的使用方式：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的调用，提供了文件路径和回调函数</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误的使用方式（触发 <code>ERR_MISSING_ARGS</code>）：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的调用，缺少回调函数</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 这里会抛出 ERR_MISSING_ARGS 错误，因为没有提供回调函数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实例-2-http-服务器" tabindex="-1"><a class="header-anchor" href="#实例-2-http-服务器"><span>实例 2: HTTP 服务器</span></a></h3><p>创建一个简单的 HTTP 服务器，你需要使用 <code>http.createServer</code> 方法，并且至少传入一个请求处理器函数作为参数。如果没有提供这个参数，也会出现 <code>ERR_MISSING_ARGS</code> 错误。</p><p>正确的使用方式：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建服务器并提供请求处理函数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误的使用方式（触发 <code>ERR_MISSING_ARGS</code>）：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试创建服务器但没有提供请求处理函数</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 这会抛出 ERR_MISSING_ARGS 错误，因为缺少请求处理函数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实例-3-事件监听" tabindex="-1"><a class="header-anchor" href="#实例-3-事件监听"><span>实例 3: 事件监听</span></a></h3><p>在 Node.js 中添加事件监听器通常需要两个参数：事件名称和处理该事件的函数。如果你在给事件绑定监听器时遗漏了其中一个参数，就会引发 <code>ERR_MISSING_ARGS</code> 错误。</p><p>正确的使用方式：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确地为 &#39;event&#39; 事件绑定监听器</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">an event occurred!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误的使用方式（触发 <code>ERR_MISSING_ARGS</code>）：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> EventEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myEmitter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> EventEmitter</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误地尝试监听 &#39;event&#39;，但没有提供处理函数</span></span>
<span class="line"><span style="color:#D8DEE9;">myEmitter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">event</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 这里会抛出 ERR_MISSING_ARGS 错误，因为缺少事件处理函数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，当你遇到 <code>ERR_MISSING_ARGS</code> 错误时，你应该检查你的代码中是否有函数或方法调用缺少了必要的参数，确保每个函数或方法都获得了它所需的全部信息。通过仔细阅读文档和错误信息，你可以找到哪个参数缺失，并相应地进行修复。</p><h3 id="err-missing-option" tabindex="-1"><a class="header-anchor" href="#err-missing-option"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_option" target="_blank" rel="noopener noreferrer">ERR_MISSING_OPTION</a></span></a></h3><p><code>ERR_MISSING_OPTION</code> 是 Node.js 中一个特定类型的错误，它通常出现在你调用某些需要必填选项的函数或命令时，而你没有提供所需的选项。这个错误会告诉你缺少了一个必要的参数或配置。</p><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它允许你使用 JavaScript 来编写服务器端代码。在 Node.js 中，很多内置模块和第三方模块都有一些函数或者方法需要接收特定的配置选项来正常工作。如果这些必须的选项没有被正确地传递，就可能抛出 <code>ERR_MISSING_OPTION</code> 错误。</p><h3 id="实例解释与示例" tabindex="-1"><a class="header-anchor" href="#实例解释与示例"><span>实例解释与示例</span></a></h3><p>假设我们有一个 Node.js 模块，它允许我们读取文件，并且要求我们指定文件的路径作为必填选项。如果我们调用这个模块的函数时忘记了提供文件路径，那么就会抛出 <code>ERR_MISSING_OPTION</code> 错误。</p><p>以下是可能遇到 <code>ERR_MISSING_OPTION</code> 错误的几个实际例子：</p><h4 id="读取文件-1" tabindex="-1"><a class="header-anchor" href="#读取文件-1"><span>读取文件</span></a></h4><p>Node.js 的 <code>fs</code> 模块（文件系统模块）提供了一个方法 <code>readFile</code>，用于读取文件的内容。如果我们调用 <code>readFile</code> 方法但是没有传入文件路径，Node.js 将会抛出 <code>ERR_MISSING_OPTION</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确调用应该传入文件路径</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果调用时忘记传入文件路径，将会抛出ERR_MISSING_OPTION错误</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 缺少文件路径参数</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出ERR_MISSING_OPTION错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建服务器" tabindex="-1"><a class="header-anchor" href="#创建服务器"><span>创建服务器</span></a></h4><p>Node.js 的 <code>http</code> 模块允许你创建 HTTP 服务器。如果你使用 <code>createServer</code> 方法但是忽略了回调函数，Node.js 可能会抛出 <code>ERR_MISSING_OPTION</code> 错误，因为回调函数通常是处理请求和响应的必要部分。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确调用应该传入一个回调函数来处理请求和响应</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果调用时忘记传入回调函数，将会抛出ERR_MISSING_OPTION错误</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> serverWithoutCallback</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 缺少回调函数参数</span></span>
<span class="line"><span style="color:#D8DEE9;">serverWithoutCallback</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在这一步会抛出ERR_MISSING_OPTION错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-cli-工具" tabindex="-1"><a class="header-anchor" href="#使用-cli-工具"><span>使用 CLI 工具</span></a></h4><p>有些 Node.js 的命令行工具（CLI）也会要求必填选项。如果在命令行中运行这些工具时忘记了必要的选项，同样会抛出 <code>ERR_MISSING_OPTION</code> 错误。例如，一个虚构的 CLI 工具可能要求 <code>-f</code> 或 <code>--file</code> 参数来指定输入文件：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">## 假设cli-tool是一个需要文件路径的命令行工具</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">cli-tool</span><span style="color:#A3BE8C;"> -f</span><span style="color:#A3BE8C;"> /path/to/input.file</span><span style="color:#616E88;"> # 正确的使用方式</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">cli-tool</span><span style="color:#616E88;"> # 忘记提供-f或--file参数，将会导致ERR_MISSING_OPTION错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际开发中，每当你看到 <code>ERR_MISSING_OPTION</code> 错误时，首先检查相关文档或源代码以确认是否有任何必填的选项被遗漏。通常，错误消息本身会给出一些提示，告诉你缺少了哪个具体的选项。</p><h3 id="err-missing-passphrase" tabindex="-1"><a class="header-anchor" href="#err-missing-passphrase"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_passphrase" target="_blank" rel="noopener noreferrer">ERR_MISSING_PASSPHRASE</a></span></a></h3><p>在 Node.js 中，<code>ERR_MISSING_PASSPHRASE</code>错误是指当你尝试使用加密功能，比如创建一个 HTTPS 服务器或者进行数据的加密和解密，而且你使用了需要密码(passphrase)的私钥时出现的问题。如果你没有提供正确的密码，就会抛出这个错误。</p><p>私钥通常用于加密通信，确保信息安全地在网络上传输。为了进一步提高安全性，私钥可以通过密码（也称作&quot;passphrase&quot;）来保护，防止未授权的使用。如果私钥被设置了密码保护，但是在使用它的时候没有提供或者提供了错误的密码，Node.js 就会报告<code>ERR_MISSING_PASSPHRASE</code>错误。</p><p>这里有几个实际运用的例子：</p><h3 id="例子-1-创建-https-服务器" tabindex="-1"><a class="header-anchor" href="#例子-1-创建-https-服务器"><span>例子 1：创建 HTTPS 服务器</span></a></h3><p>假如你想要创建一个 HTTPS 服务器，你需要 SSL 证书和相关的私钥文件。如果你的私钥是用密码保护的，你在创建服务器的时候需要提供这个密码。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取SSL证书和私钥文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-private-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-certificate.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  passphrase</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">your-passphrase</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这里是你的私钥密码</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTPS服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你没有在<code>options</code>对象中提供<code>passphrase</code>属性或者提供了错误的密码，那么你将会得到<code>ERR_MISSING_PASSPHRASE</code>错误。</p><h3 id="例子-2-使用-crypto-模块加密数据" tabindex="-1"><a class="header-anchor" href="#例子-2-使用-crypto-模块加密数据"><span>例子 2：使用 crypto 模块加密数据</span></a></h3><p>Node.js 的<code>crypto</code>模块允许你进行各种加密操作。下面是一个使用加密私钥对数据进行签名的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 要签名的数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">important data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取私钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-private-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> privateKeyObject</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createPrivateKey</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> privateKey</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  passphrase</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">your-passphrase</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 提供正确的密码</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用私钥签名数据</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sign</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SHA256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> signature</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> sign</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sign</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">privateKeyObject</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">signature</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个<code>privateKeyObject</code>，如果在调用<code>crypto.createPrivateKey()</code>时没有提供正确的<code>passphrase</code>属性，就会导致<code>ERR_MISSING_PASSPHRASE</code>错误。</p><h3 id="处理这个错误" tabindex="-1"><a class="header-anchor" href="#处理这个错误"><span>处理这个错误</span></a></h3><p>处理<code>ERR_MISSING_PASSPHRASE</code>错误最直接的办法就是确保在需要密码的地方提供了正确的密码。如果密码不应该存在，可能就是私钥文件本身没有被正确生成或者已被破坏。确保私钥文件是安全的，并且使用正确的方法生成和存储。如果你是私钥的合法用户并且知道密码，记得在代码中正确地传递这个密码。</p><h3 id="err-missing-platform-for-worker" tabindex="-1"><a class="header-anchor" href="#err-missing-platform-for-worker"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_platform_for_worker" target="_blank" rel="noopener noreferrer">ERR_MISSING_PLATFORM_FOR_WORKER</a></span></a></h3><p>Node.js 中的 <code>[ERR_MISSING_PLATFORM_FOR_WORKER]</code> 错误指的是当你尝试在一个 <code>Worker</code> 线程中使用某些特定的 Node.js API 功能时，发现那个功能并不支持在 <code>Worker</code> 线程中运行。简单来说，就是有些 Node.js 的功能是只能在主线程中使用的，不能在后台的工作线程（Worker threads）中使用。</p><p>在 Node.js 中，<code>Worker</code> 线程是一种可以执行 JavaScript 或者 Wasm 代码的轻量级线程，通常用于在后台执行 CPU 密集型任务或者长时间运行的操作，以避免阻塞主线程（也就是 Node.js 应用的初始线程，处理客户端请求等事务）。</p><p>让我们通过一个例子来更加具体地理解这个错误：</p><p>假设你正在编写一个 Node.js 脚本，需要在后台执行一些复杂计算，以避免主线程阻塞。为了实现这个目标，你决定使用 <code>Worker</code> 线程。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 这段代码在主线程中运行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 创建一个新的Worker线程去执行 &#39;worker.js&#39;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./worker.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这段代码在worker线程中运行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设存在一个仅在主线程中可用的Node.js API</span></span>
<span class="line"><span style="color:#88C0D0;">  someMainThreadOnlyAPI</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，如果 <code>someMainThreadOnlyAPI</code> 是一个只能在主线程中使用的 API，而你尝试在 <code>Worker</code> 线程里调用它，那么就会触发 <code>[ERR_MISSING_PLATFORM_FOR_WORKER]</code> 错误。</p><p>为了处理这个问题，你需要确保只有那些支持在 <code>Worker</code> 纑程中运行的 API 被放在 <code>Worker</code> 的脚本里，同时主线程专用的 API 应该保留在主线程中使用。</p><p>当前（截至知识更新日期），Node.js 文档中并未明确列出哪些 API 不能在 <code>Worker</code> 线程中使用，所以在开发时可能需要通过测试、文档和社区支持来确定。如果你遇到了 <code>[ERR_MISSING_PLATFORM_FOR_WORKER]</code> 错误，最好的办法是检查你尝试在 <code>Worker</code> 线程中使用的 API 是否确实受到支持，并寻找可用的替代方法或将任务移回主线程处理。</p><h3 id="err-module-not-found" tabindex="-1"><a class="header-anchor" href="#err-module-not-found"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_module_not_found" target="_blank" rel="noopener noreferrer">ERR_MODULE_NOT_FOUND</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的<code>ERR_MODULE_NOT_FOUND</code>错误，并通过一些实例来帮助你理解。</p><p>首先，<code>ERR_MODULE_NOT_FOUND</code>是一个特定类型的错误，它会在 Node.js 试图加载一个模块但没有找到时发生。模块是 Node.js 中可以重用的代码块，通常包含函数或者对象，我们通过<code>require()</code>函数或者在 ES6 模块中使用<code>import</code>语句来加载它们。</p><p>这个错误可能出现的原因有很多，比如：</p><ol><li>你尝试加载的模块名字拼写错误。</li><li>该模块没有安装在你的项目中，或者安装位置不正确。</li><li>你正在使用的路径指向错误，也就是说 Node.js 无法在该路径下找到对应的模块文件。</li></ol><h3 id="实际例子-8" tabindex="-1"><a class="header-anchor" href="#实际例子-8"><span>实际例子</span></a></h3><p>假设我们有一个简单的 Node.js 应用程序，其中需要引入一个名为<code>lodash</code>的库（一个非常流行的 JavaScript 实用工具库）。</p><p><strong>例子 1：模块名字拼写错误</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 错误的拼写</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> _</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">lodahs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 代码其余部分...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你运行上面的代码，Node.js 将会抛出<code>ERR_MODULE_NOT_FOUND</code>错误，因为没有名为<code>lodahs</code>的模块存在。正确的名称应该是<code>lodash</code>。</p><p><strong>例子 2：模块未安装</strong></p><p>如果你没有在项目中安装<code>lodash</code>，但尝试去加载它，同样会导致<code>ERR_MODULE_NOT_FOUND</code>错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设没有安装lodash，但试图加载</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> _</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">lodash</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 代码其余部分...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，你需要通过 npm（Node.js 的包管理器）安装它：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">npm</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> lodash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>例子 3：路径错误</strong></p><p>当你尝试导入一个本地模块，但提供了错误的路径时，也会遇到这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设有一个localModule.js在项目的根目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 路径错误</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./wrong/path/to/localModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 代码其余部分...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你需要确保提供正确的相对路径或绝对路径来指向模块所在的位置。</p><p>修正后的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确的路径</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./localModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 代码其余部分...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总之，当遇到<code>ERR_MODULE_NOT_FOUND</code>错误时，你需要检查模块的名称、是否已经安装以及路径是否正确。一旦确定了问题所在，修复起来通常都是直截了当的。</p><h3 id="err-multiple-callback" tabindex="-1"><a class="header-anchor" href="#err-multiple-callback"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_multiple_callback" target="_blank" rel="noopener noreferrer">ERR_MULTIPLE_CALLBACK</a></span></a></h3><p>在 Node.js 中，<code>ERR_MULTIPLE_CALLBACK</code>是一个错误代码，表示某个回调函数被不正确地多次调用了。在异步编程中，通常情况下，每个异步操作对应的回调函数只应该被调用一次，以传递操作结果或者错误信息。</p><p>为了更好地理解这个概念，我们需要先讲清楚几个关键点：</p><ol><li><p><strong>异步编程</strong>：指的是当一个任务在执行中时，程序可以继续运行，而不必等待这个任务完成。在 JavaScript 和 Node.js 中，异步编程通常通过回调（callbacks）、Promises、或者 async/await 实现。</p></li><li><p><strong>回调函数</strong>：在异步操作结束后运行的函数，它能够获取操作的结果或错误。</p></li></ol><p>现在，让我举几个具体的例子来说明<code>ERR_MULTIPLE_CALLBACK</code>出现的情景。</p><h3 id="例子-1-文件读取错误" tabindex="-1"><a class="header-anchor" href="#例子-1-文件读取错误"><span>例子 1: 文件读取错误</span></a></h3><p>假设你正在使用 Node.js 的<code>fs</code>模块来异步读取文件内容：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">读取文件时发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 处理数据...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在正常情况下，如果读取成功，回调函数会接收到两个参数，<code>err</code>为<code>null</code>，而<code>data</code>包含文件内容。如果发生错误，<code>err</code>将是一个错误对象，此时你通常处理错误然后退出。但是，如果你错误地调用了回调函数超过一次，就可能触发<code>ERR_MULTIPLE_CALLBACK</code>错误。</p><h3 id="例子-2-错误的回调使用" tabindex="-1"><a class="header-anchor" href="#例子-2-错误的回调使用"><span>例子 2: 错误的回调使用</span></a></h3><p>看看这段有问题的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> doSomethingAsync</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 假设执行了某些操作可能会抛出异常</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">出错了！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确调用回调处理异常</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误！再次调用回调</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">doSomethingAsync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">回调函数中捕获的错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">成功完成操作</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这段代码的问题是在<code>try...catch</code>块里，回调函数被调用了两次。第一次是正确的，处理了错误；但紧接着第二次调用就造成了<code>ERR_MULTIPLE_CALLBACK</code>错误，因为标准的约定是回调函数只应该被调用一次。</p><h3 id="错误处理建议" tabindex="-1"><a class="header-anchor" href="#错误处理建议"><span>错误处理建议</span></a></h3><p>当出现<code>ERR_MULTIPLE_CALLBACK</code>错误时，你应该检查相关代码，确保每个异步操作对应的回调函数只被调用一次。这通常涉及到代码逻辑的审查，确保无论是在正常流程还是错误处理流程中，回调都不会被多次执行。</p><p>总结：<code>ERR_MULTIPLE_CALLBACK</code>错误表明在 Node.js 的异步编程中，存在回调函数被错误地多次调用的情况。在真实的编程环境中，应当避免这种情况，确保每个异步任务的回调只执行一次，这样才能保持代码的正确性和可预测性。</p><h3 id="err-napi-cons-function" tabindex="-1"><a class="header-anchor" href="#err-napi-cons-function"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_cons_function" target="_blank" rel="noopener noreferrer">ERR_NAPI_CONS_FUNCTION</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它让开发者能够使用 JavaScript 来编写后端代码。Node.js 提供了许多内置模块和 API，允许开发者执行文件系统操作，网络请求等。</p><p>在 Node.js 中，有一个叫做 N-API 的功能，它是一个用来构建原生插件的 API。原生插件是一些用 C 或 C++ 写的模块，可以直接与 Node.js 的运行时进行交互，通常用于那些对性能要求较高或需要对操作系统底层进行直接操作的场合。</p><h3 id="err-napi-cons-function-1" tabindex="-1"><a class="header-anchor" href="#err-napi-cons-function-1"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_cons_function" target="_blank" rel="noopener noreferrer">ERR_NAPI_CONS_FUNCTION</a></span></a></h3><p>这个错误是指在使用 N-API 创建或操作原生对象时遇到的问题。具体来说，<code>ERR_NAPI_CONS_FUNCTION</code> 错误会在你尝试从 JavaScript 调用一个不是构造函数(constructor)的原生函数时抛出。</p><p>当我们在 JavaScript 中创建一个新实例时，通常会使用 <code>new</code> 关键字，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyClass</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myInstance</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyClass</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，<code>MyClass</code> 是一个构造函数，我们通过调用 <code>new MyClass()</code> 来创建它的一个实例。</p><p>但如果你在使用 C 或 C++ 编写的原生插件，并且尝试用 JavaScript 的 <code>new</code> 关键字去实例化一个不是构造函数的原生函数，就会遇到 <code>ERR_NAPI_CONS_FUNCTION</code> 错误。这通常意味着你尝试了一个不正确的操作，可能是因为 API 的误用。</p><p>例子:</p><p>假设你有一个用 C++ 编写的原生 Node.js 插件，里面定义了一个函数 <code>NativeFunction</code>，但这个函数并不是一个构造函数。如果你试图在 JavaScript 中像这样使用它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> nativeAddon</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">native-addon</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> instance</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> nativeAddon</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NativeFunction</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设 NativeFunction 不是构造函数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，如果 <code>NativeFunction</code> 没有被设计为一个构造函数，而你却试图使用 <code>new</code> 关键字来调用它，Node.js 就会抛出 <code>ERR_NAPI_CONS_FUNCTION</code> 错误。</p><p>解决办法是确保你只对那些确实设计成构造函数的原生函数使用 <code>new</code> 关键字。通常，原生插件的文档会说明哪些函数是构造函数，应该如何正确地使用它们。</p><p>总结一下，<code>ERR_NAPI_CONS_FUNCTION</code> 错误表示你尝试将一个非构造函数作为构造函数来使用。当使用 N-API 开发或使用原生插件时，需要确保遵循其 API 的规则和约定，并仔细阅读相关文档以避免此类错误。</p><h3 id="err-napi-invalid-dataview-args" tabindex="-1"><a class="header-anchor" href="#err-napi-invalid-dataview-args"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_invalid_dataview_args" target="_blank" rel="noopener noreferrer">ERR_NAPI_INVALID_DATAVIEW_ARGS</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 JavaScript 引擎的 JavaScript 运行环境，它允许你在服务器端执行 JavaScript 代码。在 Node.js 中，N-API 是一个用于构建原生插件的 API，它提供了一组稳定的面向 C 语言的接口。这些接口使得可以不受 Node.js 版本变化影响而构建原生扩展。</p><p><code>ERR_NAPI_INVALID_DATAVIEW_ARGS</code> 是一个错误类型，在 Node.js 的 N-API 中使用时会遇到。当你试图通过不正确的参数创建或操作 <code>DataView</code> 对象时，就会抛出这个错误。<code>DataView</code> 对象是 ECMAScript（JavaScript 的规范）中一种可以从二进制 ArrayBuffer 对象中读写多种数值类型的接口。</p><p>下面我将通过一个简单的例子来解释：</p><p>假设你想操作一个二进制数据缓冲区，你可能会使用 <code>ArrayBuffer</code> 和 <code>DataView</code>。下面的代码是正确创建和使用 <code>DataView</code> 对象的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建一个16字节的ArrayBuffer</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> view</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> DataView</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 使用这个ArrayBuffer创建一个DataView</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">view</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 32</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在第0个字节位置设置值为32的Int8（一个字节的整数）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> view</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 读取第0个字节上的Int8的值</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：32</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但如果你在创建 <code>DataView</code> 对象时没有按照预期传入正确的参数，比如省略了 <code>ArrayBuffer</code> 或者给出了错误的字节偏移量（offset）或长度（length），那么将会出现 <code>ERR_NAPI_INVALID_DATAVIEW_ARGS</code> 错误。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 假设我们错误地尝试传递额外的参数或省略必需的参数</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> view</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> DataView</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 17</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误: 字节偏移量超出buffer的长度</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到ERR_NAPI_INVALID_DATAVIEW_ARGS错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际运用中，你通常会在处理文件、网络传输数据、或者任何需要在底层对二进制数据进行操作的场合使用 <code>DataView</code>。由于 <code>DataView</code> 提供了多种方法来读写不同大小和类型的数据，因此它非常适用于开发者需要对数据格式有细致控制的应用场景。</p><p>总结一下，<code>ERR_NAPI_INVALID_DATAVIEW_ARGS</code> 是 Node.js 中 N-API 相关操作 <code>DataView</code> 时出错的提示，表明你在创建或操作 <code>DataView</code> 时传入了无效或不正确的参数。正确处理这些参数对于确保程序能够正常操作二进制数据来说是至关重要的。</p><h3 id="err-napi-invalid-typedarray-alignment" tabindex="-1"><a class="header-anchor" href="#err-napi-invalid-typedarray-alignment"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_invalid_typedarray_alignment" target="_blank" rel="noopener noreferrer">ERR_NAPI_INVALID_TYPEDARRAY_ALIGNMENT</a></span></a></h3><p>当然，让我来解释一下这个错误。</p><p>在 Node.js 中，N-API 是一个用于构建原生插件的 API。原生插件允许 Node.js 代码直接调用 C 或 C++库，以便执行可能需要更多性能的任务。在使用 N-API 时，我们有时会操作类似于 JavaScript 中的 TypedArray 的数据结构，只不过它们是在 C 或 C++层面上。</p><p><code>ERR_NAPI_INVALID_TYPEDARRAY_ALIGNMENT</code> 错误是说你试图在原生模块中使用一个 TypedArray，但是它的内存对齐不符合要求。内存对齐通常是指数据在内存中的起始地址应该是某个数（比如 2、4、8 等）的倍数。这是因为 CPU 访问对齐的内存通常会更快，而且某些硬件平台甚至要求对齐才能正常工作。</p><p>现在，举个例子来说明这个问题：</p><p>想象一下，你正在编写一个 Node.js 的原生扩展，这个扩展将要处理图像数据。每个像素都由一个 32 位整数表示，因此你决定使用一个类型化数组(TypedArray)来高效地处理这些像素值。</p><p>在 C++代码中，你可能有以下代码片段：</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" data-title="cpp" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>void ProcessImage(const Napi::CallbackInfo&amp; info) {</span></span>
<span class="line"><span>  // 第一个参数是传入的TypedArray</span></span>
<span class="line"><span>  Napi::TypedArrayOf`&lt;`uint32_t&gt; imageArray = info[0].As`&lt;`Napi::TypedArrayOf`&lt;`uint32_t&gt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // 这里假设TypedArray的数据必须是4字节对齐的，因为它是32位的整数数组</span></span>
<span class="line"><span>  if (!imageArray.Data() || (reinterpret_cast`&lt;`uintptr_t&gt;(imageArray.Data()) % 4) != 0) {</span></span>
<span class="line"><span>    Napi::Error::New(info.Env(), &quot;The TypedArray must be aligned to 4-byte boundaries&quot;).ThrowAsJavaScriptException();</span></span>
<span class="line"><span>    return;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // ...这里会有处理图像的代码...</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果传入的<code>TypedArray</code>没有正确对齐（即，它的数据开始位置不是 4 的倍数），你的原生扩展就会抛出一个错误。在 Node.js 中，如果 N-API 检测到这样的问题，它会生成<code>ERR_NAPI_INVALID_TYPEDARRAY_ALIGNMENT</code>错误。</p><p>实际上，Node.js 中的 N-API 可能会自动处理某些对齐问题，但如果你在处理性能敏感的代码时自己管理内存对齐，就可能会遇到这种错误。</p><p>简单来说，<code>ERR_NAPI_INVALID_TYPEDARRAY_ALIGNMENT</code>是告诉你：你给原生模块的输入数据（在这个案例中是图像数据的 TypedArray）不满足内存对齐的要求，你需要确保传给原生模块的数据在内存中正确对齐。</p><h3 id="err-napi-invalid-typedarray-length" tabindex="-1"><a class="header-anchor" href="#err-napi-invalid-typedarray-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_invalid_typedarray_length" target="_blank" rel="noopener noreferrer">ERR_NAPI_INVALID_TYPEDARRAY_LENGTH</a></span></a></h3><p><code>ERR_NAPI_INVALID_TYPEDARRAY_LENGTH</code> 是一个错误代码，它属于 Node.js 中的一系列标准错误类型之一。这个特定的错误是在 Node.js 的原生插件接口（N-API）中遇到的，而 N-API 是一个允许你使用 C 或 C++ 编写与 JavaScript 代码交互的模块的 API。</p><p>当你在使用 N-API 创建或操作 TypedArray（一种能够存储特定数据类型的紧凑型数组）时，如果传入的长度参数无效或者不合规范，就会抛出 <code>ERR_NAPI_INVALID_TYPEDARRAY_LENGTH</code> 错误。TypedArray 可以是 Int8Array、Uint8Array、Int16Array 等等，它们都有固定的长度和存储机制来确保性能优化。</p><p>实际运用的例子：</p><p>假设你正在开发一个 Node.js 的原生扩展，并且希望通过 N-API 来创建一个新的 <code>Uint8Array</code> 类型的 TypedArray，代码可能如下：</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>##include `&lt;`node_api.h&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 假设我们有一个名为 &quot;CreateTypedArray&quot; 的函数</span></span>
<span class="line"><span>napi_value CreateTypedArray(napi_env env, napi_callback_info info) {</span></span>
<span class="line"><span>    napi_status status;</span></span>
<span class="line"><span>    napi_value result;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 创建一个长度为 -10 的 Uint8Array，这里故意设置了一个无效值</span></span>
<span class="line"><span>    status = napi_create_typedarray(env, napi_uint8_array, -10, NULL, 0, &amp;result);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if (status != napi_ok) {</span></span>
<span class="line"><span>        // 如果状态不是 napi_ok，表示有错误发生</span></span>
<span class="line"><span>        napi_throw_error(env, NULL, &quot;Invalid typed array length&quot;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return result;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们尝试创建一个长度为 <code>-10</code> 的 <code>Uint8Array</code>。由于数组的长度不能是负数，所以调用 <code>napi_create_typedarray</code> 函数时会失败，并返回一个错误状态。当我们检查到错误状态后，手动抛出一个错误信息 &quot;Invalid typed array length&quot;。在真实的 Node.js 环境中，这将触发一个 <code>ERR_NAPI_INVALID_TYPEDARRAY_LENGTH</code> 错误。</p><p>正常情况下，我们应该总是确认传递给 API 调用的长度是有效的，通常是非负整数，以避免这类错误。如果你正在使用 JavaScript 而不是 C/C++ 编写代码，那么通常不需要担心这个错误，因为这个错误主要涉及底层的原生代码与 Node.js 接口之间的交互。</p><h3 id="err-napi-tsfn-call-js" tabindex="-1"><a class="header-anchor" href="#err-napi-tsfn-call-js"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_tsfn_call_js" target="_blank" rel="noopener noreferrer">ERR_NAPI_TSFN_CALL_JS</a></span></a></h3><p>好的，我会尽量详细且通俗地解释这个错误。</p><p>Node.js 中的<code>ERR_NAPI_TSFN_CALL_JS</code>是一个与 N-API（Node.js API）相关的错误代码。N-API 是 Node.js 提供的一个稳定的 API 层，它允许原生插件的编写者不必担心 Node.js 版本之间的差异。它旨在抽象出底层的 V8 和 libuv 等库，使得原生模块（通常用 C 或者 C++编写）能够在 Node.js 的不同版本上运行无需重新编译。</p><p>在你提到的 Node.js v21.7.1 版本中，<code>ERR_NAPI_TSFN_CALL_JS</code>具体是指&quot;Threadsafe Function&quot;（线程安全函数）调用产生的错误。简单来说，线程安全函数是一种可以从任何线程安全地调用 JavaScript 函数的机制。当我们在原生代码（比如 C/C++模块）中工作，并希望将数据传回给 JavaScript 代码执行时，就会使用到它。</p><p>然而，如果在线程中调用 JavaScript 时发生了错误，例如如果 JavaScript 侧的函数已经被垃圾收集器回收，或者在调用过程中发生了其他错误，就会返回<code>ERR_NAPI_TSFN_CALL_JS</code>错误。</p><p>下面举一个简化的例子：</p><p>假设你正在编写一个原生 Node.js 模块，它需要在后台线程中执行一些计算任务，然后将结果传回到 JavaScript 环境。</p><ol><li>你首先创建了一个线程安全函数，该函数代表着 JavaScript 中的一个回调函数。</li><li>在后台线程中，你完成了一些计算。</li><li>现在你想要将计算结果通过线程安全函数传递回 JavaScript。</li></ol><p>如果在这个过程中，JavaScript 的回调函数因为某些原因不可用了（比如被垃圾回收了），那么尝试调用它会触发<code>ERR_NAPI_TSFN_CALL_JS</code>错误。</p><p>以下是如何在 C++扩展中可能使用线程安全函数的伪代码：</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" data-title="cpp" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>##include `&lt;`napi.h&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 假设这是一个在后台线程中被调用的函数</span></span>
<span class="line"><span>void BackgroundTask(Napi::ThreadSafeFunction tsfn) {</span></span>
<span class="line"><span>    // 执行一些操作...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 现在尝试将结果回传给JavaScript</span></span>
<span class="line"><span>    auto status = tsfn.BlockingCall([](Napi::Env env, Napi::Function jsCallback) {</span></span>
<span class="line"><span>        // 调用JavaScript的回调函数</span></span>
<span class="line"><span>        jsCallback.Call({Napi::String::New(env, &quot;计算结果&quot;)});</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if (status != napi_ok) {</span></span>
<span class="line"><span>        // 如果状态不是napi_ok，说明调用出现问题，可能会引发ERR_NAPI_TSFN_CALL_JS</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// JS调用这个原生函数来开始后台任务</span></span>
<span class="line"><span>Napi::Value StartBackgroundTask(const Napi::CallbackInfo&amp; info) {</span></span>
<span class="line"><span>    Napi::Env env = info.Env();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 获取传入的JavaScript回调函数</span></span>
<span class="line"><span>    Napi::Function jsCallback = info[0].As`&lt;`Napi::Function&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 创建线程安全函数</span></span>
<span class="line"><span>    Napi::ThreadSafeFunction tsfn = Napi::ThreadSafeFunction::New(</span></span>
<span class="line"><span>        env,</span></span>
<span class="line"><span>        jsCallback,         // JavaScript函数</span></span>
<span class="line"><span>        &quot;Resource Name&quot;,    // 资源名称（用于调试）</span></span>
<span class="line"><span>        0,                  // 附加数据</span></span>
<span class="line"><span>        1                   // 可以同时运行的线程数量</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 启动后台线程</span></span>
<span class="line"><span>    std::thread(BackgroundTask, tsfn).detach();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return env.Undefined();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 初始化扩展，注册`StartBackgroundTask`函数</span></span>
<span class="line"><span>NAPI_MODULE_INIT() {</span></span>
<span class="line"><span>    exports.Set(&quot;startBackgroundTask&quot;, Napi::Function::New(env, StartBackgroundTask));</span></span>
<span class="line"><span>    return exports;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果<code>jsCallback</code>在<code>BlockingCall</code>尝试执行时已经无效了，就会引发<code>ERR_NAPI_TSFN_CALL_JS</code>错误。实际应用中，需要确保管理好资源，并合理处理这类错误情况。</p><h3 id="err-napi-tsfn-get-undefined" tabindex="-1"><a class="header-anchor" href="#err-napi-tsfn-get-undefined"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_tsfn_get_undefined" target="_blank" rel="noopener noreferrer">ERR_NAPI_TSFN_GET_UNDEFINED</a></span></a></h3><p><code>ERR_NAPI_TSFN_GET_UNDEFINED</code> 这个错误代码是 Node.js 中与 N-API 相关的一个特定错误。N-API 是 Node.js 提供的一个抽象层，允许开发者编写可跨不同 Node.js 版本运行的本地插件。</p><p>在解释这个错误之前，我们需要理解以下几个概念：</p><ol><li><strong>N-API (Node-API)</strong>: 它是一个用于构建原生插件的 API 层，主要目的是提供维护和兼容性的稳定性，并允许原生模块和 Node.js 之间的交互。</li><li><strong>Thread-safe Function (TSFN)</strong>: 在 N-API 中, Thread-safe Functions 允许你从任何线程安全地调用 JavaScript 函数。</li></ol><p><code>ERR_NAPI_TSFN_GET_UNDEFINED</code> 错误通常表示程序尝试使用一个已经无法再取得 JavaScript 函数引用的 thread-safe function。当一个 thread-safe function 被完全释放或当您尝试在没有正确关联 JavaScript 函数的情况下调用它时，可能会遇到这个错误。</p><p>现实中的例子可能非常技术化，因为它涉及到底层的原生模块开发，但我可以给你一个简化的场景来说明这个错误是如何发生的。</p><p>假设你正在写一个 Node.js 插件，这个插件需要执行一些耗时的计算，而且你想在不阻塞 Node.js 主线程的情况下完成这项工作。你决定在另一个线程中执行计算，并在计算完成后使用 thread-safe function 将结果传回 Node.js 的主线程。</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>##include `&lt;`node_api.h&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 一个简单的计算函数</span></span>
<span class="line"><span>void PerformComputation(napi_env env, void* data) {</span></span>
<span class="line"><span>    // ... 执行一些计算 ...</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 当计算完成后回调 Node.js 的函数</span></span>
<span class="line"><span>void CallJs(napi_env env, napi_value js_cb, void* context, void* data) {</span></span>
<span class="line"><span>    // ... 将结果传递给 JavaScript 回调函数 ...</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 注册 thread-safe function</span></span>
<span class="line"><span>napi_value RegisterCallback(napi_env env, napi_callback_info info) {</span></span>
<span class="line"><span>    napi_value work_name;</span></span>
<span class="line"><span>    napi_create_string_utf8(env, &quot;work&quot;, NAPI_AUTO_LENGTH, &amp;work_name);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    napi_threadsafe_function tsfn;</span></span>
<span class="line"><span>    napi_create_threadsafe_function(env, /* js function */, NULL, work_name,</span></span>
<span class="line"><span>                                    0, 1, NULL, NULL, NULL, CallJs, &amp;tsfn);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 启动新线程并传入 tsfn</span></span>
<span class="line"><span>    // ...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return NULL;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在某个时候由于某种原因 JavaScript 回调函数变成 <code>undefined</code>（可能是因为错误的代码逻辑或者其他问题），接着你尝试通过此 thread-safe function 来调用这个 JavaScript 函数，就会抛出 <code>ERR_NAPI_TSFN_GET_UNDEFINED</code> 错误。</p><p>处理这种错误通常意味着你需要仔细检查你的代码确保 thread-safe function 在整个生命周期内都有一个有效的 JavaScript 函数可以回调。此外，还需要确保 thread-safe function 没有过早地被销毁或释放。</p><h3 id="err-napi-tsfn-start-idle-loop" tabindex="-1"><a class="header-anchor" href="#err-napi-tsfn-start-idle-loop"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_tsfn_start_idle_loop" target="_blank" rel="noopener noreferrer">ERR_NAPI_TSFN_START_IDLE_LOOP</a></span></a></h3><p>好的，让我们聊一下 Node.js 中的 <code>[ERR_NAPI_TSFN_START_IDLE_LOOP]</code> 错误吧。首先，为了更好地理解这个错误，我们需要知道几个关键概念：Node.js、N-API 和线程安全函数(thread-safe function)。</p><ol><li><p><strong>Node.js</strong> 是一个基于 Chrome V8 引擎的 JavaScript 运行时环境，它让开发者可以使用 JavaScript 来编写服务器端程序。</p></li><li><p><strong>N-API</strong> 是 Node.js 提供的一个稳定的 API 层，允许原生模块（通常是用 C 或 C++编写的扩展）与 Node.js 的 JavaScript 运行时进行交互。它的目的是减少 Node.js 升级对原生模块的影响，并避免重复编译。</p></li><li><p><strong>线程安全函数（Thread-safe function, TSFN）</strong> 是 N-API 提供的一种机制，使得原生代码能够安全地调用 JavaScript 函数，即便这些调用是从不同的线程发起的。在多线程环境下，直接操作 JavaScript 运行时可能会引起冲突，因为 JavaScript 本身是单线程的。TSFN 提供了一种安全的方式来从任何线程向 JavaScript 运行时队列发送回调。</p></li></ol><p>现在我们来谈谈 <code>ERR_NAPI_TSFN_START_IDLE_LOOP</code> 错误：</p><p>这个错误是指线程安全函数试图启动一个空闲循环，但是失败了。在 Node.js 中，线程安全函数可以被配置为在没有消息处理时进入一个空闲状态，等待有新的任务到来。如果启动这样一个空闲循环出现问题，就会抛出 <code>ERR_NAPI_TSFN_START_IDLE_LOOP</code> 错误。</p><p>通俗来说，想象你有一个工厂（Node.js 程序）里面有很多工人（线程），他们通过管道（N-API）将产品（数据）送到仓库（JavaScript 运行时）。为了避免工人们同时塞东西进一个管道造成堵塞，你规定了一个送货流程（TSFN）。但是现在，当工人们没有东西送的时候，他们应该等待而不是一直盯着管道，这就是所谓的“空闲循环”。如果由于某种原因，比如管道坏了或者规则出错，导致工人无法进入等待状态，那么这个 <code>ERR_NAPI_TSFN_START_IDLE_LOOP</code> 就会发生。</p><p>实际运用例子：<br> 举个例子，假设你正在编写一个原生模块，这个模块要从网络上异步获取数据。你会在一个单独的线程中处理网络请求，一旦数据到达，你想通知 JavaScript 做进一步的处理。为了安全地从那个线程调用 JavaScript 回调，你会使用线程安全函数。如果在尝试设置这个线程安全函数的空闲循环时发生了错误，就可能会遇到 <code>ERR_NAPI_TSFN_START_IDLE_LOOP</code>。</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>##include `&lt;`node_api.h&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 假设以下函数是在原生模块中定义的回调函数</span></span>
<span class="line"><span></span></span>
<span class="line"><span>void CallJs(napi_env env, napi_value js_callback, void* context, void* data) {</span></span>
<span class="line"><span>    // 此函数将在后台线程调用 JavaScript 传递的回调函数</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>napi_value Init(napi_env env, napi_value exports) {</span></span>
<span class="line"><span>    napi_value js_callback;</span></span>
<span class="line"><span>    // 创建一个线程安全函数</span></span>
<span class="line"><span>    napi_threadsafe_function tsfn;</span></span>
<span class="line"><span>    napi_create_threadsafe_function(</span></span>
<span class="line"><span>        env,</span></span>
<span class="line"><span>        js_callback,</span></span>
<span class="line"><span>        NULL /* async_resource */,</span></span>
<span class="line"><span>        NULL /* async_resource_name */,</span></span>
<span class="line"><span>        0 /* max_queue_size */,</span></span>
<span class="line"><span>        1 /* initial_thread_count */,</span></span>
<span class="line"><span>        NULL /* context */,</span></span>
<span class="line"><span>        NULL /* finalizer */,</span></span>
<span class="line"><span>        NULL /* finalize_hint */,</span></span>
<span class="line"><span>        CallJs,</span></span>
<span class="line"><span>        &amp;tsfn</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // 如果在下面的代码中启动空闲循环失败，则会抛出 ERR_NAPI_TSFN_START_IDLE_LOOP 错误</span></span>
<span class="line"><span>    // ...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return exports;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们创建了一个线程安全函数并试图对其进行一些配置。如果配置过程中出现问题导致空闲循环无法启动，就可能会抛出 <code>ERR_NAPI_TSFN_START_IDLE_LOOP</code> 错误。通常，这个错误是由内部错误引起的，作为普通 Node.js 开发者，你可能永远都不会见到它，除非你在编写涉及多线程操作的原生模块。</p><h3 id="err-napi-tsfn-stop-idle-loop" tabindex="-1"><a class="header-anchor" href="#err-napi-tsfn-stop-idle-loop"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_tsfn_stop_idle_loop" target="_blank" rel="noopener noreferrer">ERR_NAPI_TSFN_STOP_IDLE_LOOP</a></span></a></h3><p>好的，让我们来聊一聊 Node.js 中的<code>ERR_NAPI_TSFN_STOP_IDLE_LOOP</code>错误。</p><p>首先，需要了解这个错误属于 Node.js 中的 N-API（原生 API）的一部分。N-API 是一个 C 语言级别的 API，允许你编写可以跨 Node.js 版本运行的本地插件。它的主要目的是减少 Node.js 升级对本地插件造成的影响，并且提供一个稳固的 API。</p><p>当你在用 N-API 创建本地插件时，可能会使用到一种叫做“Thread-safe Function”（线程安全函数）的功能。这些函数可以允许你从任何线程安全地调用 JavaScript 代码。简单来说，就是你可以从不同的线程（比如后台工作线程）调用 JavaScript 函数，而不会导致竞态条件或崩溃。</p><p>现在，让我们看看<code>ERR_NAPI_TSFN_STOP_IDLE_LOOP</code>这个错误。这个错误发生在以下情况：</p><ul><li>你已经创建了一个线程安全函数。</li><li>你使用了这个函数，并开启了一个事件循环（event loop），使得你可以在后台线程执行任务并在任务完成时调用 JavaScript 函数。</li><li>当你不再需要这个线程安全函数，也就是说，你想停止这个后台的事件循环时，你会调用一个特定的方法来告诉 Node.js：&quot;我完成了，你可以停止事件循环了&quot;。</li></ul><p>如果事件循环已经处于非活跃状态，但你尝试去停止它，这时候就会抛出<code>ERR_NAPI_TSFN_STOP_IDLE_LOOP</code>错误。这个错误基本上是在告诉你：“事件循环已经停止了，你不能再停止一个已经不在运行的东西。”</p><p>下面我们用一个简化的例子去理解这个概念：</p><p>假设你有一个工厂，工厂里有一个生产线运转的信号灯（代表事件循环）。当工厂开始工作时，信号灯就亮起来了。每当一个新的零件被制造出来，你都会按下一个按钮来记录（这可以类比为调用线程安全函数）。</p><p>在某个点，你完成了今天的工作，所以你关闭信号灯，并通知大家可以回家了。但是如果你误操作，试图去关闭一个已经熄灭的信号灯，那么显然你的操作是没有意义的，因为信号灯已经是关闭状态了。</p><p>在 Node.js 中，如果你在代码中不小心多次尝试停止已经停止的事件循环，你就会遇到<code>ERR_NAPI_TSFN_STOP_IDLE_LOOP</code>错误。通常，这意味着你的代码里有逻辑错误，你需要检查为什么你会尝试去停止一个已经不活跃的事件循环。</p><p>处理这个错误的关键是确保你的逻辑能够正确判断何时停止事件循环，并且只在需要的时候去停止它。这通常涉及到对资源的有效管理和状态检查，以确保你的代码在正确的时间做正确的事情。</p><h3 id="err-not-building-snapshot" tabindex="-1"><a class="header-anchor" href="#err-not-building-snapshot"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_not_building_snapshot" target="_blank" rel="noopener noreferrer">ERR_NOT_BUILDING_SNAPSHOT</a></span></a></h3><p>Node.js 中的 <code>[ERR_NOT_BUILDING_SNAPSHOT]</code> 错误是用来表明代码试图在一个不支持该功能的上下文中运行了与快照(snapshot)相关的操作。快照在这里指的是 Node.js 的一个实验性功能，它可以允许你保存和加载 Node.js 应用程序的内存快照。</p><p>在 Node.js v21.7.1 版本中，如果你尝试使用某些特定的快照功能，但你并没有在构建 Node.js 时启用对快照的支持，那么就会抛出 <code>ERR_NOT_BUILDING_SNAPSHOT</code> 错误。简单来说，这个错误就是告诉你当前环境不支持你想进行的快照操作。</p><p>举个例子，Node.js 中有一个全局对象 <code>process</code>，这个对象提供了很多系统级别的操作和信息。其中可能包含了一些跟快照相关的方法，比如 <code>process._linkedBinding(&#39;node_snapshot&#39;)</code>。如果你在不支持快照的 Node.js 版本中调用了这样的方法，你就会遇到 <code>ERR_NOT_BUILDING_SNAPSHOT</code> 这样的错误提示。</p><p>具体实际应用场景较少，因为快照是一个实验性功能，通常只有在特定的开发或者测试环境中才会使用到。大多数普通应用程序开发者可能永远都不会直接接触到这个功能。</p><p>如果你看到这个错误，解决方案通常包括以下几个步骤：</p><ol><li>确认你是否真的需要使用快照功能。</li><li>如果需要，查阅 Node.js 的官方文档，了解如何正确地使用快照功能，并确保你的 Node.js 环境已经启用了快照支持。</li><li>如果你发现自己并不需要快照功能，那么检查你的代码，移除所有与快照相关的部分。</li><li>如果你在使用第三方库或模块时遭遇此问题，请联系相应的维护者，或查找相关文档了解更多信息。</li></ol><p>由于快照功能比较高级且特殊，所以作为编程新手，你可能不太需要关心这个错误，除非你在做一些非常具体的优化或者研究工作。</p><h3 id="err-not-in-single-executable-application" tabindex="-1"><a class="header-anchor" href="#err-not-in-single-executable-application"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_not_in_single_executable_application" target="_blank" rel="noopener noreferrer">ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</a></span></a></h3><p><code>ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</code> 是 Node.js 中的一个特定错误代码，它表示某个操作或功能尝试在不是单个可执行程序的应用程序环境中执行，但该操作或功能设计时仅适用于以单个可执行文件形式打包的 Node.js 应用程序。</p><p>让我们先了解一下背景知识：</p><p>Node.js 允许开发者通过工具如 <code>pkg</code>, <code>nexe</code> 或 <code>vercel/pkg</code> 将 JavaScript 应用程序打包成一个单独的可执行文件 (executable)。这意味着你可以把你的代码和 Node.js 运行时环境捆绑到一个文件里，用户就可以在没有安装 Node.js 的情况下运行你的程序。</p><p>现在，想象一下你正在使用一个 Node.js 功能，比如获取应用程序目录里面的资源文件的路径。如果你的应用程序是作为一个独立的可执行文件运行的，那么它通常需要以一种特殊的方式来处理这些资源，因为所有的文件实际上都被包含在了一个大的可执行文件里。</p><p>如果你调用了一个只有在单个可执行文件环境下才能正常工作的 API，但你的应用程序却不是以这种方式运行的，比如直接用 node 命令来启动脚本，Node.js 就会抛出 <code>ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</code> 错误。</p><p>来看几个例子：</p><ol><li><p><strong>解析应用程序内的资源路径：</strong><br> 假设你有一个 Node.js 应用程序，它需要从文件系统中读取一个配置文件。如果你的应用程序被打包成单个可执行文件，Node.js 提供了特殊的方法来获取这个文件的路径。如果你不是在一个单个可执行的环境里调用这个方法，就会遇到 <code>ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</code> 错误。</p></li><li><p><strong>写入日志文件：</strong><br> 通常，应用程序可能会写入日志到文件系统。如果你的应用程序被设计成单个可执行文件，并且你尝试使用专门为此设计的 API 来写日志，那么在非单个可执行文件环境下执行这些操作也会触发 <code>ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</code> 错误。</p></li></ol><p>要解决这个问题，有两种方法：</p><ul><li>确保你的应用程序被部署和运行是按照设计的单个可执行文件模式，使用相应的打包工具来创建可执行文件。</li><li>如果你不打算将应用程序打包成单个可执行文件，则需要避免使用那些专为单个可执行文件设计的 Node.js API，而是使用标准的 Node.js 方法来进行文件系统操作等。</li></ul><p>总之，<code>ERR_NOT_IN_SINGLE_EXECUTABLE_APPLICATION</code> 错误提醒开发者他们正在尝试进行一个仅当 Node.js 应用程序以单个可执行文件形式存在时才有意义的操作。</p><h3 id="err-not-supported-in-snapshot" tabindex="-1"><a class="header-anchor" href="#err-not-supported-in-snapshot"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_not_supported_in_snapshot" target="_blank" rel="noopener noreferrer">ERR_NOT_SUPPORTED_IN_SNAPSHOT</a></span></a></h3><p>Node.js 中的<code>ERR_NOT_SUPPORTED_IN_SNAPSHOT</code>错误通常与&quot;snapshot&quot;功能有关。Snapshots 在 Node.js 中是一个比较进阶的特性，它允许你将应用的状态“冻结”在某一时刻，然后快速启动应用到这个状态。</p><p>要理解<code>ERR_NOT_SUPPORTED_IN_SNAPSHOT</code>错误，我们需要先了解两个概念：</p><ol><li><p><strong>Snapshot（快照）</strong>：在编程和计算机科学中，快照是指在某一特定时刻对系统状态的完整副本。在 Node.js 中，V8 引擎（Node.js 底层使用的 JavaScript 引擎）可以创建启动时的快照。这意味着 Node.js 可以保存正在运行的应用程序的内存镜像，并在以后快速恢复到该状态。</p></li><li><p><strong>V8 引擎</strong>：V8 是 Google 开发的开源 JavaScript 引擎，它用于 Chrome 浏览器，同时也是 Node.js 的核心。V8 能够编译并执行 JavaScript 代码，同时也提供垃圾回收、调试等其他功能。</p></li></ol><p>现在，当你在 Node.js 中看到<code>ERR_NOT_SUPPORTED_IN_SNAPSHOT</code>错误时，这表示你正尝试执行一些在快照模式下不被支持的操作。例如，如果你试图在快照还原后立即打开一个文件或连接一个数据库，可能会遇到这样的错误，因为这些操作依赖于运行时的状态，而不是可以预先捕获在快照中的状态。</p><p>实际例子：<br> 假设你有一个 Node.js 应用程序，其中包含了一段设置定时器的代码，如下所示：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello after 100 milliseconds</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你在创建快照之前开始了这个定时器，那么在快照恢复时，定时器的状态可能无法正确地恢复，因为它涉及到了 Node.js 事件循环的具体时间点。在这种情况下，如果 V8 不支持在快照中正确恢复定时器，那么尝试恢复这个定时器可能就会触发<code>ERR_NOT_SUPPORTED_IN_SNAPSHOT</code>错误。</p><p>解决这类错误通常需要检查你的代码，确保你没有在需要快照的地方使用不被支持的特性。可能需要重新设计你的应用程序初始化流程，使其在恢复快照后再执行这些操作。</p><h3 id="err-no-crypto" tabindex="-1"><a class="header-anchor" href="#err-no-crypto"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_no_crypto" target="_blank" rel="noopener noreferrer">ERR_NO_CRYPTO</a></span></a></h3><p><code>ERR_NO_CRYPTO</code> 是 Node.js 中的一个错误代码，代表你尝试使用的 Node.js 版本没有包含加密特性。这通常发生在你使用了一个没有内置加密库（如 OpenSSL）的 Node.js 编译版本时。</p><p>当 Node.js 被编译时，有可能禁用其中的加密功能。例如，在某些许可证限制或出于减少最终二进制大小的目的下，加密支持会被去掉。如果你尝试在这样一个不支持加密的 Node.js 环境中调用需要加密模块的 API，Node.js 会抛出 <code>ERR_NO_CRYPTO</code> 错误。</p><p>举个简单的例子：</p><p>假设在 Node.js 程序中，你想使用加密模块来创建一个哈希值：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">//来源：doc.cherrychat.org 请勿rw哒商用doc.cherrychat.org</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_NO_CRYPTO</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">加密模块不可用。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这段代码中，我们尝试创建一个 SHA-256 哈希对象并对字符串 <code>&quot;my-password&quot;</code> 进行哈希处理。如果在一个没有加密支持的 Node.js 环境中运行这段代码，那么 <code>require(&#39;crypto&#39;)</code> 这行会导致 <code>ERR_NO_CRYPTO</code> 错误，因为 <code>crypto</code> 模块是 Node.js 的加密模块，它需要 Node.js 编译时包含 OpenSSL。</p><p>如果遇到这个问题，解决方法是使用一个包含加密支持的 Node.js 版本。通常情况下，从 Node.js 官方网站下载的预编译版本都是包含加密支持的，除非你特意选择了一个 &#39;without crypto&#39; 的版本。</p><p>总结一下，<code>ERR_NO_CRYPTO</code> 错误表示你正在使用的 Node.js 环境不支持加密操作。如果你需要进行加密处理，你应该确保你的 Node.js 版本是编译时包括了加密特性的。</p><h3 id="err-no-icu" tabindex="-1"><a class="header-anchor" href="#err-no-icu"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_no_icu" target="_blank" rel="noopener noreferrer">ERR_NO_ICU</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它让我们可以在服务器端运行 JavaScript 代码。Node.js 提供了很多内建的模块，允许开发者进行文件系统操作、网络请求等。</p><p><code>ERR_NO_ICU</code>是 Node.js 中的一个错误代码，它代表“International Components for Unicode (ICU)”不可用。ICU 是一个广泛使用的国际化库，提供了对复杂文本处理和全球化支持的功能，比如日期、时间格式化，货币、排序规则等多语言支持。</p><p>在 Node.js 中，如果你尝试使用需要 ICU 支持的功能而你的 Node.js 版本没有包含 ICU，则可能会遇到 <code>ERR_NO_ICU</code> 错误。</p><p>这个错误通常出现在以下几种情况：</p><ol><li><p><strong>使用不包含 ICU 的 Node.js 构建版本：</strong> Node.js 提供了多种构建版本，其中一些是没有内置 ICU 支持的“轻量版”。如果你下载并使用了这样的版本，当你尝试使用国际化相关功能时，就会遇到 <code>ERR_NO_ICU</code> 错误。</p></li><li><p><strong>显式地禁用 ICU：</strong> 即使在标准构建中，也有可能通过编译选项在安装 Node.js 时禁用 ICU。</p></li><li><p><strong>使用依赖 ICU 功能的模块但未正确配置：</strong> 如果你的应用程序依赖了某个第三方模块，该模块需要 ICU 功能支持，而你的 Node.js 环境没有配置好相应的 ICU 支持，也会导致 <code>ERR_NO_ICU</code> 错误。</p></li></ol><p>实际运用的例子：<br> 假设你正在编写一个国际化的网站，需要根据用户的语言偏好显示日期。在 JavaScript 中，你可能会使用 <code>Intl.DateTimeFormat</code> 来格式化日期：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> formattedDate</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> Intl</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DateTimeFormat</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">en-US</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">format</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Date</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">formattedDate</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：例如 &quot;3/19/2023&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你在不支持 ICU 的 Node.js 环境中运行上面的代码，将会抛出 <code>ERR_NO_ICU</code> 错误，因为 <code>Intl</code> 类及其方法通常需要 ICU 的支持来正常工作。</p><p>解决方式：<br> 要解决这个问题，你可以：</p><ul><li>下载并使用一个包含完整 ICU 支持的 Node.js 版本。</li><li>如果你确实需要使用自定义或较小的 ICU 数据集，可以根据官方文档的指示重新编译 Node.js，包含所需的 ICU 数据。</li><li>检查并确保任何第三方模块都与你使用的 Node.js 版本兼容，并且所有需要的国际化资源都已经正确配置。</li></ul><p>总之，<code>ERR_NO_ICU</code> 错误意味着你正在尝试使用 Node.js 的国际化功能，但你的当前环境没有包含必要的 ICU 支持。解决方法通常涉及到更换或重新编译 Node.js 版本以包含 ICU 支持，或者调整应用配置以确保国际化资源可用。</p><h3 id="err-non-context-aware-disabled" tabindex="-1"><a class="header-anchor" href="#err-non-context-aware-disabled"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_non_context_aware_disabled" target="_blank" rel="noopener noreferrer">ERR_NON_CONTEXT_AWARE_DISABLED</a></span></a></h3><p>Node.js 中的 <code>[ERR_NON_CONTEXT_AWARE_DISABLED]</code> 错误是一个特定类型的运行时错误，它出现在尝试加载不支持上下文感知的原生模块时。在 Node.js 中，原生模块通常是用 C 或 C++ 编写，并通过 Node.js 的 <code>require()</code> 函数加载到应用程序中。</p><h3 id="上下文感知原生模块是什么" tabindex="-1"><a class="header-anchor" href="#上下文感知原生模块是什么"><span>上下文感知原生模块是什么？</span></a></h3><p>在 Node.js 中，&quot;上下文&quot; 通常指的是与特定的全局对象（例如, <code>global</code> 或 <code>process</code>）相关联的执行环境。当你有一个应用程序，它可能会创建多个这样的上下文（例如，在使用 <code>vm</code> 模块或 Worker Threads 创建新的沙箱执行环境时），那么每个上下文都需要有其自己的一份原生模块副本。</p><p>如果一个原生模块是上下文感知的，这意味着它能够正确地在这些不同的上下文之间被加载和使用，而不会导致冲突或者错误。</p><h3 id="为什么会禁用非上下文感知的原生模块" tabindex="-1"><a class="header-anchor" href="#为什么会禁用非上下文感知的原生模块"><span>为什么会禁用非上下文感知的原生模块？</span></a></h3><p>Node.js 开发团队引入了对非上下文感知原生模块的限制，以促进更好的模块安全性和兼容性。当你启动 Node.js 应用程序并指定 <code>--no-force-context-aware</code> 标志时，你告诉 Node.js 不要强迫所有原生模块成为上下文感知的。但如果 Node.js 配置为需要上下文感知模块，那么任何试图加载的非上下文感知原生模块将会触发 <code>[ERR_NON_CONTEXT_AWARE_DISABLED]</code> 错误。</p><h3 id="如何解决这个错误-1" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误-1"><span>如何解决这个错误？</span></a></h3><ol><li><strong>更新原生模块：</strong> 查看该原生模块是否有更新版本，更新后的版本可能已经支持上下文感知。</li><li><strong>重新编译模块：</strong> 如果你有权限修改原生模块代码，你可以尝试更新它以支持上下文感知特性。</li><li><strong>更改 Node.js 启动参数：</strong> 在开发期间，你可以通过添加 <code>--force-context-aware</code> 标志来启动 Node.js，这样即使模块不是上下文感知的也允许它们被加载。</li></ol><h3 id="实例" tabindex="-1"><a class="header-anchor" href="#实例"><span>实例</span></a></h3><p>假设你有一个名为 <code>awesome-native-module</code> 的原生模块，它没有被设计成上下文感知的。当你尝试在你的 Node.js 应用程序中使用 <code>require(&#39;awesome-native-module&#39;)</code> 加载它时，如果 Node.js 要求所有原生模块都必须是上下文感知的，你就会遇到以下错误:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" data-title="console" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error [ERR_NON_CONTEXT_AWARE_DISABLED]: Loading non-context-aware native module in process-level context is disabled</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>为了解决这个问题，你要么更新 <code>awesome-native-module</code> 到支持上下文感知的版本，要么在 Node.js 启动参数中添加 <code>--force-context-aware</code> 来临时绕过这个限制。</p><p>希望这个解释帮助你理解 <code>[ERR_NON_CONTEXT_AWARE_DISABLED]</code> 错误及其解决方案！</p><h3 id="err-out-of-range" tabindex="-1"><a class="header-anchor" href="#err-out-of-range"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_out_of_range" target="_blank" rel="noopener noreferrer">ERR_OUT_OF_RANGE</a></span></a></h3><p><code>ERR_OUT_OF_RANGE</code> 是一个错误类型，它在 Node.js 中用于表示当一个函数的参数或者一个值没有达到预期范围时抛出的错误。它通常出现在你给函数提供了不正确的值，这个值可能太大、太小，或者完全是错误的类型。</p><p>当 Node.js 期望一个特定的值落在某个范围内，而这个值却超出了这个范围，就会抛出 <code>ERR_OUT_OF_RANGE</code> 错误。比如说，如果一个函数需要一个介于 1 到 10 之间的数字，但是你传递了 11 或者 0，就可能会引发这个错误。</p><h3 id="例子-1" tabindex="-1"><a class="header-anchor" href="#例子-1"><span>例子</span></a></h3><p><strong>示例 1：Buffer 的写入操作</strong></p><p>在 Node.js 中，<code>Buffer</code> 类是用来处理二进制数据的一个工具。如果你尝试往 <code>Buffer</code> 写入数据，但是指定了错误的偏移量或长度，那么就会抛出 <code>ERR_OUT_OF_RANGE</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">allocUnsafe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建一个长度为10的buffer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeUInt32BE</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">123</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 尝试从位置10开始写入一个无符号32位整数</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_OUT_OF_RANGE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">尝试写入的位置超出了Buffer的范围</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 其他类型的错误，重新抛出</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码中，我们创建了一个长度为 10 个字节的 <code>Buffer</code>，然后尝试从第 10 个字节的位置开始写入一个 32 位的无符号整数。因为 <code>Buffer</code> 的索引是从 0 开始的，所以合法的写入位置应该从 0 到 9。由于没有足够的空间来容纳这个 32 位的整数（它需要 4 个字节），代码将会抛出 <code>ERR_OUT_OF_RANGE</code> 错误。</p><p><strong>示例 2：TypedArray 的起始位置</strong></p><p>TypedArrays 是 JavaScript 中处理二进制数据的一种方式。如果你在创建一个 <code>TypedArray</code> 视图时提供了错误的起始位置，也会出现 <code>ERR_OUT_OF_RANGE</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> typedArray</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Int32Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> fromBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Int32Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">buffer</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 16</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 试图从一个不存在的偏移量创建TypedArray</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_OUT_OF_RANGE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">起始位置超出了ArrayBuffer的范围</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，<code>ArrayBuffer</code> 的大小是 8 字节，而 <code>Int32Array</code> 需要的起始位置单位是字节。由于我们尝试从 16 字节的位置开始创建一个新的 <code>Int32Array</code>，但 <code>buffer</code> 只有 8 字节长，因此这里会抛出 <code>ERR_OUT_OF_RANGE</code> 错误。</p><p>遇到 <code>ERR_OUT_OF_RANGE</code> 错误时，最好的做法是检查代码中提供给函数的参数或值是否满足函数的预期范围和类型。确保在调用之前，这些值已经被验证并确保其合法性。</p><h3 id="err-package-import-not-defined" tabindex="-1"><a class="header-anchor" href="#err-package-import-not-defined"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_package_import_not_defined" target="_blank" rel="noopener noreferrer">ERR_PACKAGE_IMPORT_NOT_DEFINED</a></span></a></h3><p><code>[ERR_PACKAGE_IMPORT_NOT_DEFINED]</code> 是一个错误类型，它发生在使用 ES6 模块（也称为 ECMAScript modules 或 ESM）时，一个模块试图导入另一个模块中没有被明确标记为导出的绑定或变量。</p><p>在 Node.js 中，ES6 模块使用 <code>import</code> 和 <code>export</code> 语法来共享代码。当你尝试导入一个模块，并且该模块并未定义你想要导入的特定导出时，Node.js 就会抛出 <code>[ERR_PACKAGE_IMPORT_NOT_DEFINED]</code> 错误。</p><p>下面是一些实际的例子:</p><h3 id="示例-1-错误的导入" tabindex="-1"><a class="header-anchor" href="#示例-1-错误的导入"><span>示例 1：错误的导入</span></a></h3><p>假设我们有两个文件，<code>mathUtil.js</code> 和 <code>app.js</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// mathUtil.js</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> const</span><span style="color:#88C0D0;"> add</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 注意这里我们只导出了一个方法`add`。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> subtract</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./mathUtil.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 这里我们试图导入`subtract`，但它在`mathUtil.js`中并没有被定义和导出。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">subtract</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行 <code>app.js</code> 时，将会收到类似以下的错误信息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>Error [ERR_PACKAGE_IMPORT_NOT_DEFINED]: The requested module &#39;./mathUtil.js&#39; does not provide an export named &#39;subtract&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>因为 <code>subtract</code> 在 <code>mathUtil.js</code> 中没有定义，所以无法导入，从而抛出了 <code>[ERR_PACKAGE_IMPORT_NOT_DEFINED]</code> 错误。</p><h3 id="示例-2-修复错误" tabindex="-1"><a class="header-anchor" href="#示例-2-修复错误"><span>示例 2：修复错误</span></a></h3><p>为了解决这个问题，我们可以在 <code>mathUtil.js</code> 文件中定义并导出 <code>subtract</code> 函数。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// mathUtil.js</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> const</span><span style="color:#88C0D0;"> add</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> const</span><span style="color:#88C0D0;"> subtract</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 现在我们添加了subtract函数，并将其导出。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，在 <code>app.js</code> 中我们就可以正常导入 <code>subtract</code> 函数了，而不会遇到 <code>[ERR_PACKAGE_IMPORT_NOT_DEFINED]</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> subtract</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./mathUtil.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：5</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">subtract</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出：3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，<code>[ERR_PACKAGE_IMPORT_NOT_DEFINED]</code> 错误通常意味着你尝试从某个模块导入一个未定义的导出。解决这个问题的方法是确保你尝试导入的所有内容都已经在相应的模块中被正确地定义和导出。</p><h3 id="err-package-path-not-exported" tabindex="-1"><a class="header-anchor" href="#err-package-path-not-exported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_package_path_not_exported" target="_blank" rel="noopener noreferrer">ERR_PACKAGE_PATH_NOT_EXPORTED</a></span></a></h3><p><code>[ERR_PACKAGE_PATH_NOT_EXPORTED]</code> 是一个错误类型，它在 Node.js 中指出了一种特定的问题：你尝试导入或加载一个模块时，这个模块的包（package）没有明确地导出你想要访问的路径。</p><p>在 Node.js 中，包通常是通过 <code>package.json</code> 文件中的 <code>&quot;exports&quot;</code> 字段来控制和管理其对外界可见的部分。如果一个包的作者决定只暴露某些功能而隐藏其他内部代码，他们会在 <code>&quot;exports&quot;</code> 字段里明确指定允许外部访问的路径。</p><p>当你尝试引入一个包中没有被导出的路径时，就会遇到 <code>[ERR_PACKAGE_PATH_NOT_EXPORTED]</code> 错误。</p><p>举个例子：</p><p>假设我们有一个名为 <code>my-library</code> 的包，它的 <code>package.json</code> 文件可能看起来像这样：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#8FBCBB;">./available-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/available-module.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的 <code>package.json</code> 文件中，<code>&quot;exports&quot;</code> 字段表明了 <code>my-library</code> 包只导出了一个模块：<code>&quot;./available-module&quot;</code>。</p><p>如果我们的应用程序想要使用 <code>my-library</code>，正确的方式是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确的导入方式</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> availableModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-library/available-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>但是如果我们尝试导入包中没有明确导出的其它路径，比如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 错误的导入方式，会抛出 [ERR_PACKAGE_PATH_NOT_EXPORTED] 错误</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> internalModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-library/internal-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>因为 <code>internal-module</code> 并没有在 <code>my-library</code> 的 <code>package.json</code> 中的 <code>&quot;exports&quot;</code> 字袾里声明，所以 Node.js 不知道这个模块是否可以被外部访问，于是就抛出了 <code>[ERR_PACKAGE_PATH_NOT_EXPORTED]</code> 错误。</p><p>要解决这个问题，你需要：</p><ol><li>确认你尝试访问的路径是存在的，并且被包的作者设计成对外部可见。</li><li>如果你是包的维护者，检查 <code>package.json</code> 是否正确设置了 <code>&quot;exports&quot;</code> 字段。</li></ol><p>希望这个解释帮助你了解什么是 <code>[ERR_PACKAGE_PATH_NOT_EXPORTED]</code> 错误，以及它是如何产生的。</p><h3 id="err-parse-args-invalid-option-value" tabindex="-1"><a class="header-anchor" href="#err-parse-args-invalid-option-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_parse_args_invalid_option_value" target="_blank" rel="noopener noreferrer">ERR_PARSE_ARGS_INVALID_OPTION_VALUE</a></span></a></h3><p>在 Node.js 中，<code>ERR_PARSE_ARGS_INVALID_OPTION_VALUE</code> 是一种错误类型，它会在你运行一个 Node.js 程序时出现，如果命令行参数指定了不正确的值。这个错误通常与程序期望的参数值相比，用户提供的值是无效的或者不匹配的情况有关。</p><p>让我们以一些实际的例子来说明这个错误：</p><h3 id="实例-1-错误的布尔标志" tabindex="-1"><a class="header-anchor" href="#实例-1-错误的布尔标志"><span>实例 1：错误的布尔标志</span></a></h3><p>假设你有一个 Node.js 脚本，它接受一个命令行参数 <code>--verbose</code>，这是一个布尔标志，意味着它应该被设置为<code>true</code>或者简单地省略（默认为<code>false</code>）。如果你尝试执行这个脚本并给这个标志一个非法的值，例如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> script.js</span><span style="color:#A3BE8C;"> --verbose=maybe</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在这里，布尔标志 <code>--verbose</code> 被赋予了一个非法值 <code>maybe</code>（布尔值应当是 true 或 false）。这可能触发 <code>ERR_PARSE_ARGS_INVALID_OPTION_VALUE</code> 错误，因为 <code>maybe</code> 不是一个有效的布尔值。</p><h3 id="实例-2-错误的数字选项" tabindex="-1"><a class="header-anchor" href="#实例-2-错误的数字选项"><span>实例 2：错误的数字选项</span></a></h3><p>考虑另外一个 Node.js 脚本，它接受一个称为 <code>--port</code> 的命令行参数，这个参数期望一个数字来表示网络端口号。如果你尝试用一个非数字值来执行这个脚本：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> server.js</span><span style="color:#A3BE8C;"> --port=abc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这同样可能会引发 <code>ERR_PARSE_ARGS_INVALID_OPTION_VALUE</code> 错误，因为 <code>abc</code> 不是一个有效的数字，并且 <code>--port</code> 参数期望一个数字。</p><h3 id="实例-3-超出范围的值" tabindex="-1"><a class="header-anchor" href="#实例-3-超出范围的值"><span>实例 3：超出范围的值</span></a></h3><p>最后，假设你有一个 Node.js 应用程序，它需要通过命令行参数 <code>--max-count</code> 来限制某个操作的最大计数，而这个参数被限制在 1 到 100 之间。如果你尝试传递一个超出这个范围的值：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> app.js</span><span style="color:#A3BE8C;"> --max-count=150</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>即使 <code>150</code> 是一个有效的数字，但它超出了预期的范围，所以也可能会触发 <code>ERR_PARSE_ARGS_INVALID_OPTION_VALUE</code> 错误。</p><h3 id="如何处理这个错误-4" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-4"><span>如何处理这个错误</span></a></h3><p>当你遇到 <code>ERR_PARSE_ARGS_INVALID_OPTION_VALUE</code> 错误时，最好的办法是检查你提供的命令行参数是否符合程序要求的格式和范围。查看文档或程序输出的帮助信息可以帮助你理解每个命令行参数的正确用法。</p><p>在编写 Node.js 脚本时，确保参数解析的代码能够清楚地指示哪些值是有效的，并且在检测到无效值时提供有用的错误消息，这样用户就可以快速地修正他们的输入。</p><h3 id="err-parse-args-unexpected-positional" tabindex="-1"><a class="header-anchor" href="#err-parse-args-unexpected-positional"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_parse_args_unexpected_positional" target="_blank" rel="noopener noreferrer">ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL</a></span></a></h3><p>好的，我来解释一下 Node.js 中的这个错误：<code>ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL</code>。</p><p>在 Node.js 程序中，我们通常需要给程序传入一些参数，以便根据不同的参数执行不同的任务。比如说，你可能会运行一个 node 程序，并告诉它要读取一个特定的文件。</p><p>命令行参数分为两类：</p><ol><li><strong>位置参数（Positional Arguments）</strong>：这些是没有指定名称的参数，它们的意义依赖于它们在命令行中的位置。</li><li><strong>选项（Options 或 Flags）</strong>：这些参数通常由一个或者多个短划线（- 或 --）开头，后面跟上参数名称和可能的值。</li></ol><p>当 Node.js 提示 <code>ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL</code> 错误时，它通常意味着你在命令行中提供了一个预期之外的位置参数。换句话说，Node.js 预期得到具有特定名称的参数（options），但是却收到了一个未命名的位置参数。</p><p>让我通过几个例子来解释这个概念。</p><h3 id="正确的参数使用方式" tabindex="-1"><a class="header-anchor" href="#正确的参数使用方式"><span>正确的参数使用方式</span></a></h3><p>假设我们有一个 Node.js 脚本，名为 <code>app.js</code>。这个脚本接受一个名为 <code>--file</code> 的选项，用于指明要处理的文件。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> app.js</span><span style="color:#A3BE8C;"> --file</span><span style="color:#A3BE8C;"> example.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里，<code>--file</code> 是一个命名了的选项，<code>example.txt</code> 是这个选项的值。</p><h3 id="导致错误的情况" tabindex="-1"><a class="header-anchor" href="#导致错误的情况"><span>导致错误的情况</span></a></h3><p>如果我们执行以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> app.js</span><span style="color:#A3BE8C;"> example.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里 <code>example.txt</code> 就变成了一个位置参数。如果 <code>app.js</code> 没有被设计为接受这样的位置参数，Node.js 就可能会抛出 <code>ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL</code> 错误，因为它没能识别这个不带选项标记的参数。</p><h3 id="如何修复错误" tabindex="-1"><a class="header-anchor" href="#如何修复错误"><span>如何修复错误</span></a></h3><p>要解决这个问题，你需要按照应用程序或脚本的说明来正确地传递参数。如果你是 <code>app.js</code> 的开发者，你需要检查你的代码，确保你正确地处理了命令行参数。如果你只是用户，那么你需要阅读文档，确保你按照程序的要求传递了正确格式的参数。</p><p>Node.js 中常用的库 <code>yargs</code> 或 <code>commander</code> 可以帮助开发者更容易地处理命令行参数，而且它们可以提供详细的错误信息，使用户更容易理解他们是否以错误的方式传递参数。</p><h3 id="err-parse-args-unknown-option" tabindex="-1"><a class="header-anchor" href="#err-parse-args-unknown-option"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_parse_args_unknown_option" target="_blank" rel="noopener noreferrer">ERR_PARSE_ARGS_UNKNOWN_OPTION</a></span></a></h3><p><code>ERR_PARSE_ARGS_UNKNOWN_OPTION</code> 是 Node.js 中的一个错误类型，它表示在解析命令行参数时遇到了一个未知的选项。Node.js 使用命令行参数来控制它的行为或者设置某些选项，如果你输入了 Node.js 不认识的选项，它就会抛出这个错误。</p><p>让我们通过几个例子来说明这一点。</p><p>假设你有下面的简单 Node.js 程序，保存为 <code>example.js</code> 文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>当你在终端运行这个程序时，通常使用如下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这将会打印出 &quot;Hello, World!&quot;。</p><p>Node.js 允许你使用各种命令行参数来影响其行为。例如，你可以使用 <code>--version</code> 参数来输出当前安装的 Node.js 版本：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --version</span></span>
<span class="line"><span style="color:#616E88;">## v21.7.1 (或其他版本号)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>但是，如果你尝试使用一个 Node.js 不识别的选项，比如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --makeMeASandwich</span><span style="color:#A3BE8C;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Node.js 无法识别 <code>--makeMeASandwich</code> 这个选项，因此它会抛出一个错误，告诉你那是一个未知的选项：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>node: bad option: --makeMeASandwich</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在 Node.js v21.7.1 中这个错误会被指定为 <code>ERR_PARSE_ARGS_UNKNOWN_OPTION</code>，这使得错误处理变得更加明确和具体化，开发者可以根据错误代码来诊断和修复问题。</p><p>总结一下，<code>ERR_PARSE_ARGS_UNKNOWN_OPTION</code> 就是 Node.js 在你尝试使用它不认识的命令行选项时给出的错误提示。正确使用命令行选项能够帮助你更好地控制 Node.js 的行为以及调试应用程序。</p><h3 id="err-performance-invalid-timestamp" tabindex="-1"><a class="header-anchor" href="#err-performance-invalid-timestamp"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_performance_invalid_timestamp" target="_blank" rel="noopener noreferrer">ERR_PERFORMANCE_INVALID_TIMESTAMP</a></span></a></h3><p>在 Node.js 中，<code>ERR_PERFORMANCE_INVALID_TIMESTAMP</code>是一个具体的错误类型，它属于性能（Performance）测量相关的错误。在 Node.js v21.7.1 的文档中，这个错误表示当你试图使用不正确的时间戳进行某些性能相关操作时，会抛出这种类型的错误。</p><p>时间戳通常用于记录事件发生的精确时间点。在 Node.js 中，可以使用内置的<code>performance</code>模块来精确地测量代码执行的时间。这个模块遵循了 Web 性能 API 标准，并提供了一个高分辨率的时间计量工具。</p><p>现在，让我们通过一些例子来更好地理解这个错误：</p><h3 id="正确使用时间戳的例子" tabindex="-1"><a class="header-anchor" href="#正确使用时间戳的例子"><span>正确使用时间戳的例子</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设这里有一些代码，你想测量其执行时间</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1000</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 一些运算或者操作</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">now</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">操作耗时：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">endTime</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> 毫秒</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码段展示了如何使用<code>performance.now()</code>来获取当前的时间戳，并计算出代码执行所花费的时间。<code>performance.now()</code>返回的是一个代表当前时间的高分辨率时间戳，单位是毫秒。</p><h3 id="导致err-performance-invalid-timestamp的例子" tabindex="-1"><a class="header-anchor" href="#导致err-performance-invalid-timestamp的例子"><span>导致<code>ERR_PERFORMANCE_INVALID_TIMESTAMP</code>的例子</span></a></h3><p>如果你尝试向<code>performance.timing</code>添加用户自定义的时间戳，但提供了无效的值（比如负数、非数字或超出范围的数），那么就会遇到<code>ERR_PERFORMANCE_INVALID_TIMESTAMP</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> PerformanceObserver</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试记录一个无效的时间戳</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">invalid-timestamp</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> startTime</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">50</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_PERFORMANCE_INVALID_TIMESTAMP 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我尝试创建一个名为<code>&#39;invalid-timestamp&#39;</code>的性能标记，但由于<code>startTime: -50</code>是一个无效的值（因为时间戳不能是负数），所以 Node.js 会抛出<code>ERR_PERFORMANCE_INVALID_TIMESTAMP</code>错误。</p><h3 id="如何避免这个错误-3" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误-3"><span>如何避免这个错误？</span></a></h3><p>要避免这个错误，确保你使用<code>performance</code>模块时提供合法有效的时间戳值。比如，使用<code>performance.now()</code>获取的时间戳总是有效的，或者确保传入的自定义时间戳是一个正的、合理的毫秒值。</p><p>如果你在编程实践中遇到这个错误，检查你所有与性能时间戳相关的代码，确保没有哪里误传入了无效的值。通过认真阅读错误信息和堆栈追踪，可以帮助你快速定位问题所在。</p><h3 id="err-performance-measure-invalid-options" tabindex="-1"><a class="header-anchor" href="#err-performance-measure-invalid-options"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_performance_measure_invalid_options" target="_blank" rel="noopener noreferrer">ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</a></span></a></h3><p>好的，来解释一下这个错误。</p><p>在 Node.js 中，<code>performance</code>是一个内建模块，用于提供性能测量相关的功能。你可以用它来计算代码块执行所需要的时间，这对于优化程序和分析性能瓶颈很有帮助。</p><p>当你在 Node.js 中使用<code>performance.measure()</code>方法时，你可能遇到一个名为<code>ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</code>的错误。这个错误发生的时候意味着你在调用<code>performance.measure()</code>方法时给它传递了一些不正确的参数。</p><p><code>performance.measure()</code>方法通常会接受两个参数：一个是测量的名称（name），另一个是可选参数，包括起始标记（startMark）和结束标记（endMark）。这些标记是之前你可能已经通过<code>performance.mark()</code>设置好的时间点。Node.js 就是通过比较这两个标记点来计算中间代码执行的时间。</p><p>如果在<code>performance.measure()</code>调用中传递了无效的起始标记或结束标记，或者传入的选项对象格式不符合要求，那么你就会得到<code>ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</code>错误。</p><p>让我们举个例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> PerformanceObserver</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置性能观察器，用于在测量完成后输出结果</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obs</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> PerformanceObserver</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  items</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEntries</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forEach</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">entry</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">entry</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">obs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">observe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> entryTypes</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">measure</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 开始和结束标记点</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 做一些耗时的操作...</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">B</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里我们正确地创建了一个测量</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">measure</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">A to B</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">A</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">B</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确用法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果我们尝试创建一个测量，但用了不存在的标记，将会引发错误</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">measure</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Invalid measure</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">NotExistStart</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">B</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果标记<code>&#39;NotExistStart&#39;</code>没有被之前任何<code>performance.mark()</code>调用创建过，那么调用<code>performance.measure(&#39;Invalid measure&#39;, &#39;NotExistStart&#39;, &#39;B&#39;)</code>时就会抛出<code>ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</code>错误。这是因为<code>&#39;NotExistStart&#39;</code>不是一个有效的起始标记。</p><p>总结一下，<code>ERR_PERFORMANCE_MEASURE_INVALID_OPTIONS</code>错误告诉你，在创建性能测量时传递了一些 Node.js 不能识别的参数。解决这个问题的方法就是检查你的<code>performance.measure()</code>调用，确认所有的标记都是先前定义过的，并且保证传递的参数格式正确。</p><h3 id="err-proto-access" tabindex="-1"><a class="header-anchor" href="#err-proto-access"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_proto_access" target="_blank" rel="noopener noreferrer">ERR_PROTO_ACCESS</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它使得开发者可以使用 JavaScript 来编写服务端代码。在 Node.js 中，有许多内置的错误类型用来表示不同种类的问题。<code>ERR_PROTO_ACCESS</code> 就是其中一种错误类型。</p><p><code>ERR_PROTO_ACCESS</code> 是一个特定于 Node.js 的错误代码，表示尝试非法地访问对象的 <code>__proto__</code> 属性。在 JavaScript 中，<code>__proto__</code> 属性是每个对象都有的一个内部属性，它指向该对象的原型。原型是一个对象，其他所有具有相同构造函数创建的对象都会继承其原型链上的方法和属性。</p><p>从 ECMAScript 2015 (ES6) 开始，直接操作 <code>__proto__</code> 被认为是一种不好的做法。因此，在更现代的 JavaScript 代码中，建议使用 <code>Object.getPrototypeOf()</code> 和 <code>Object.setPrototypeOf()</code> 方法来获取和设置原型，而不是直接操作 <code>__proto__</code>。</p><p>在 Node.js 中，如果你尝试使用某些方式违反正常操作来访问一个对象的 <code>__proto__</code> 属性，Node.js 将会抛出 <code>ERR_PROTO_ACCESS</code> 错误。这种保护机制有助于避免安全问题和维护代码的健壮性。</p><p>举例说明：</p><p>假设我们有如下的 JavaScript 代码段：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obj</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 不推荐的访问方式（可能导致 ERR_PROTO_ACCESS 错误）</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">__proto__)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 推荐的访问方式</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getPrototypeOf</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，直接访问 <code>obj.__proto__</code> 可能会在某些情况下触发 <code>ERR_PROTO_ACCESS</code> 错误，特别是如果 Node.js 环境采取了额外的安全措施来限制对 <code>__proto__</code> 的访问。然而，使用 <code>Object.getPrototypeOf(obj)</code> 是一种安全且被广泛认可的方法来获取对象的原型链。</p><p>需要注意的是，通常情况下，普通的 JavaScript 开发中不太可能遇到 <code>ERR_PROTO_ACCESS</code> 错误，除非你尝试执行一些非常规的原型链操作或者你的代码运行在具有特殊安全限制的环境中。</p><p>如果你遇到了这个错误，你应该检查你的代码，确保你没有做任何不安全或者不推荐的原型链操作，并且改用标准的 <code>Object.getPrototypeOf()</code> 或 <code>Object.setPrototypeOf()</code> 方法来处理原型相关的需求。这样既可以避免潜在的错误，也有利于代码的清晰性和未来的维护工作。</p><h3 id="err-require-esm" tabindex="-1"><a class="header-anchor" href="#err-require-esm"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_require_esm" target="_blank" rel="noopener noreferrer">ERR_REQUIRE_ESM</a></span></a></h3><h3 id="什么是-err-require-esm-错误" tabindex="-1"><a class="header-anchor" href="#什么是-err-require-esm-错误"><span>什么是 <code>[ERR_REQUIRE_ESM]</code> 错误？</span></a></h3><p>在 Node.js 中，<code>[ERR_REQUIRE_ESM]</code> 是一个错误代码，表示你试图用 CommonJS 的 <code>require</code> 方式去加载一个只能通过 ES Modules (ESM) 方式导入的 JavaScript 模块。ES Modules 是 ECMAScript（JavaScript 的标准）的官方模块系统，它和 Node.js 传统使用的 CommonJS 模块系统不同。</p><h3 id="为什么会出现这个错误" tabindex="-1"><a class="header-anchor" href="#为什么会出现这个错误"><span>为什么会出现这个错误？</span></a></h3><p>当你的 Node.js 代码尝试使用 <code>require()</code> 函数来导入一个文件，而该文件被指定为只能使用 ESM <code>import</code> 语法导入时，就会抛出 <code>[ERR_REQUIRE_ESM]</code> 错误。这通常发生在下面几种情况中：</p><ol><li>你尝试导入的文件或其所在的包在 <code>package.json</code> 中设置了 <code>&quot;type&quot;: &quot;module&quot;</code>，明确指明了这是一个 ES module。</li><li>文件扩展名是 <code>.mjs</code>，这是 ES module 的特殊扩展名。</li></ol><h3 id="如何解决这个错误-2" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误-2"><span>如何解决这个错误？</span></a></h3><p>要解决 <code>[ERR_REQUIRE_ESM]</code> 错误，你需要使用 ES Modules 的 <code>import</code> 语法代替 CommonJS 的 <code>require()</code>。这里有一些步骤帮助你进行转换：</p><h4 id="从-commonjs-到-es-modules-的转换" tabindex="-1"><a class="header-anchor" href="#从-commonjs-到-es-modules-的转换"><span>从 CommonJS 到 ES Modules 的转换</span></a></h4><ul><li>将 <code>require</code> 语句转换成 <code>import</code> 语句。</li><li>如果需要动态导入模块，使用 <code>import()</code> 函数代替 <code>require()</code>。</li></ul><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例：</span></a></h4><p>假设你有一个名为 <code>my-es-module.mjs</code> 的文件或者一个包含 <code>&quot;type&quot;: &quot;module&quot;</code> 的 <code>package.json</code> 文件，你应该这样导入：</p><p><strong>不正确的方式（CommonJS）：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./my-es-module</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>正确的方式（ES Modules）：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./my-es-module.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者如果你需要动态导入：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./my-es-module.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">myModule</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 使用 myModule</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，当使用 ES Modules 时，我们经常需要指定文件扩展名（比如 <code>.js</code> 或 <code>.mjs</code>），因为 Node.js 在处理 ES Modules 时并不会像处理 CommonJS 模块那样自动解析扩展名。</p><h3 id="实际例子-9" tabindex="-1"><a class="header-anchor" href="#实际例子-9"><span>实际例子：</span></a></h3><p>假设你有一个工具库，之前以 CommonJS 模块发布，在更新版本中它被转换为 ES Modules。</p><p><strong>旧版本（CommonJS）：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// math.js</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">add</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你可以这样使用它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> math</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./math</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: 5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>新版本（ES Modules）：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// math.js</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> b</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在你应该这样导入并使用它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> add</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./math.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: 5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结起来，<code>[ERR_REQUIRE_ESM]</code> 表示你需要将导入语法从 CommonJS 的 <code>require</code> 改为 ES Modules 的 <code>import</code>。实际开发中，遇到这个错误时，通常意味着你需要检查你的代码，并确认你是否使用了正确的模块导入语法。</p><h3 id="err-script-execution-interrupted" tabindex="-1"><a class="header-anchor" href="#err-script-execution-interrupted"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_script_execution_interrupted" target="_blank" rel="noopener noreferrer">ERR_SCRIPT_EXECUTION_INTERRUPTED</a></span></a></h3><p><code>ERR_SCRIPT_EXECUTION_INTERRUPTED</code> 是 Node.js 中的一个错误代码，它表示脚本执行被中断了。在 Node.js v21.7.1 或其他版本中，如果你正在运行一个 JavaScript 脚本，并且这个脚本在完成之前被外部操作强制停止，那么就可能会遇到这个错误。</p><p>这种情况通常发生在以下几种场景：</p><ol><li><p><strong>异步操作中断</strong>：当你的脚本在执行异步操作时（比如读取文件、请求网络资源等），如果因为某些原因这些操作没有按预期完成，而是被中断了，Node.js 可能会抛出 <code>ERR_SCRIPT_EXECUTION_INTERRUPTED</code> 错误。</p></li><li><p><strong>长时间运行的脚本</strong>：如果脚本运行时间过长，并且有一些机制去监控和管理这些脚本的运行（例如超时设置），当达到设定的限制时，执行可能会被中断，导致这个错误的产生。</p></li><li><p><strong>手动干预</strong>：在一些开发环境中，如果你通过按下 Ctrl+C 来强制结束脚本的运行，或者是使用任务管理器等工具杀死 Node.js 进程，这也可能导致 <code>ERR_SCRIPT_EXECUTION_INTERRUPTED</code> 错误。</p></li></ol><p>现在，让我们通过一个简单的例子来理解这个概念：</p><p>想象你有一个 Node.js 脚本，它被设计来处理一系列复杂的数据分析任务，这通常需要一段时间才能完成。这个脚本可能看起来像这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> complexDataAnalysis</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 模拟一个耗时的数据分析任务</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#B48EAD;"> 1e9</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    result</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> Math</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">random</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#D8DEE9;"> result</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">开始复杂数据分析</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> analysisResult</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> complexDataAnalysis</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">分析结果: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">analysisResult</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">分析过程中发生错误:</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">数据分析脚本执行完毕</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你运行这个脚本时，假设脚本中间被中断（可能是你自己中断了它，或者是由于系统资源不足导致操作系统终止了该进程），你可能会在命令行界面看到类似 <code>ERR_SCRIPT_EXECUTION_INTERRUPTED</code> 的错误消息。</p><p>值得注意的是，在实际编码过程中，<code>ERR_SCRIPT_EXECUTION_INTERRUPTED</code> 错误并不常见，因为大多数标准的 Node.js 代码执行路径都包含了适当的异常处理和退出策略，可以优雅地处理这些中断事件。不过，了解这个错误对于理解 Node.js 底层的运行机制和异常处理机制仍然很重要。</p><h3 id="err-script-execution-timeout" tabindex="-1"><a class="header-anchor" href="#err-script-execution-timeout"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_script_execution_timeout" target="_blank" rel="noopener noreferrer">ERR_SCRIPT_EXECUTION_TIMEOUT</a></span></a></h3><p>在 Node.js 中，<code>ERR_SCRIPT_EXECUTION_TIMEOUT</code>错误表示一个脚本或者某段代码执行的时间超过了预设的限制。换句话说，当你运行一个 Node.js 程序时，如果有一部分代码需要很长时间去完成，并且超过了系统或者环境设置的最大执行时间，就会抛出这个错误。</p><p>这种超时机制通常用于避免因为某些操作耗时太长而让整个程序处于挂起状态，保证程序的响应性和效率。例如，在网络请求、文件操作或者其他可能长时间运行而没有结果的场合，就会设置超时来避免无限期等待。</p><p>下面我们通过几个实际的例子来说明这个错误是怎样发生的：</p><h3 id="例子-1-http-请求超时" tabindex="-1"><a class="header-anchor" href="#例子-1-http-请求超时"><span>例子 1：HTTP 请求超时</span></a></h3><p>想象一下你写了一个 Node.js 的脚本来获取某个网页的内容。通常情况下，网络请求都要设置一个超时时间，以防服务器响应太慢或者根本不响应导致你的程序永远在等待。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 设置一个请求选项，其中包括了超时时长</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 443</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  timeout</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 设置超时时间为2000毫秒（2秒）</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">请求超时！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 超时后终止请求</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">请求遇到问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个例子中，如果在 2 秒内服务器没有响应，就会触发<code>timeout</code>事件，然后打印出“请求超时！”并终止请求。</p><h3 id="例子-2-自定义脚本超时" tabindex="-1"><a class="header-anchor" href="#例子-2-自定义脚本超时"><span>例子 2：自定义脚本超时</span></a></h3><p>如果你正在运行一个复杂的计算任务，你可能希望在任务运行超过一定时间后就停止它，以避免浪费资源。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> complexCalculation</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里是一个非常复杂的计算，可能会持续很长时间</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> TIMEOUT</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 10000</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 设置超时时间为10000毫秒（10秒）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> timeoutId</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_SCRIPT_EXECUTION_TIMEOUT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#D8DEE9;"> TIMEOUT</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  complexCalculation</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">  clearTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">timeoutId</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果计算完成，则清除超时</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个例子中，我们设置了一个超时器<code>setTimeout</code>，如果<code>complexCalculation</code>函数在 10 秒内没有执行完毕，就会抛出一个错误信息<code>ERR_SCRIPT_EXECUTION_TIMEOUT</code>。</p><p>在 Node.js v21.7.1 或任何具体版本中，如果看到类似<code>ERR_SCRIPT_EXECUTION_TIMEOUT</code>的错误，你需要检查你的代码是否有可能执行的非常缓慢，或者你是否正确地设置了需要的超时机制，并确保它们工作在合理的时限内。</p><h3 id="err-server-already-listen" tabindex="-1"><a class="header-anchor" href="#err-server-already-listen"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_server_already_listen" target="_blank" rel="noopener noreferrer">ERR_SERVER_ALREADY_LISTEN</a></span></a></h3><p><code>ERR_SERVER_ALREADY_LISTEN</code> 是 Node.js 中的一个错误代码，表示你尝试让一个服务器（如 HTTP 服务器）监听网络请求时出错了，因为这个服务器已经在监听某个端口了。</p><p>在计算机网络中，服务器通常通过“端口”来提供服务，这就像是门牌号码，告诉数据它该去哪里。当你启动一个 HTTP 服务器时，你会指定它监听一个端口，比如 80 端口是 HTTP 协议默认的端口，443 是 HTTPS 的默认端口。</p><p>举个例子，如果你有一段 Node.js 代码创建了一个 HTTP 服务器，并尝试让它监听 8080 端口：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这段代码会启动一个简单的 HTTP 服务器，监听本地机器上的 8080 端口。如果你尝试再次运行相同的 <code>.listen(8080)</code> 命令或者在另一个程序中也尝试监听同一个 8080 端口，就会抛出 <code>ERR_SERVER_ALREADY_LISTEN</code> 错误，因为一个端口同一时间只能被一个服务监听。</p><p>如果你不小心写了两次监听的代码，就会遇到这个错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 尝试第二次监听同一个端口会导致错误</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里不会被调用，因为端口已经在上面的代码中被监听了</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will not be printed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要解决这个问题，你需要确保对于每个端口，只有一个地方在调用 <code>.listen()</code> 方法。如果你需要重新启动服务器监听，你应该先关闭服务器，然后再重新监听。</p><p>示例代码，先关闭已经监听的服务器：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 在关闭服务器之后重新开始监听</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server restarted and running at http://127.0.0.1:8080/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，<code>ERR_SERVER_ALREADY_LISTEN</code> 错误就是告诉你，你试图监听一个已经被监听的端口，为了避免这个错误，检查你的代码中是否重复监听了端口，或者其他程序是否已经在使用该端口，并确保监听动作唯一。</p><h3 id="err-server-not-running" tabindex="-1"><a class="header-anchor" href="#err-server-not-running"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_server_not_running" target="_blank" rel="noopener noreferrer">ERR_SERVER_NOT_RUNNING</a></span></a></h3><p><code>ERR_SERVER_NOT_RUNNING</code> 是 Node.js 中的一个错误代码，它表示你尝试操作（如关闭或监听）一个网络服务器，但这个服务器在当前时刻并没有运行。在 Node.js 中，网络服务器通常是通过 <code>http</code> 或 <code>https</code> 模块创建的，用于处理网络请求，比如来自浏览器的 HTTP 请求。</p><p>当你使用 <code>server.close()</code> 方法尝试关闭一个服务器实例，如果这个实例此时没有启动并监听端口，就会抛出 <code>ERR_SERVER_NOT_RUNNING</code> 错误。同理，如果你尝试在一个未启动的服务器上进行某些操作，也可能遇到这个错误。</p><p>下面，我将提供一些简单的实际例子来说明这个错误是如何发生的：</p><h3 id="示例-1-关闭一个未启动的服务器" tabindex="-1"><a class="header-anchor" href="#示例-1-关闭一个未启动的服务器"><span>示例 1：关闭一个未启动的服务器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个服务器实例，但是不调用listen方法，因此它不会启动</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试关闭未启动的服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印 ERR_SERVER_NOT_RUNNING 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed successfully.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个 <code>http</code> 服务器，但是没有调用 <code>server.listen()</code> 方法来启动它。随后我们立即尝试关闭服务器，由于服务器未启动，因此回调函数接收到的 <code>err</code> 对象包含了 <code>ERR_SERVER_NOT_RUNNING</code> 错误。</p><h3 id="示例-2-重复关闭一个已经关闭的服务器" tabindex="-1"><a class="header-anchor" href="#示例-2-重复关闭一个已经关闭的服务器"><span>示例 2：重复关闭一个已经关闭的服务器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 启动服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 关闭服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server has been closed.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 再次尝试关闭服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">  server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会打印 ERR_SERVER_NOT_RUNNING 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server closed successfully.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先启动了服务器，然后关闭它。当服务器关闭后，我们尝试第二次关闭同一个服务器实例。由于服务器在第一次调用 <code>close</code> 方法后已经停止运行，第二次调用 <code>close</code> 方法会导致 <code>ERR_SERVER_NOT_RUNNING</code> 错误。</p><p>这个错误的关键点在于，它提示开发者正在对一个未启动或已停止的服务器执行操作，这通常是无效或不合适的。开发者应该检查服务器的状态或确保服务器在执行相关操作之前已正确启动。</p><h3 id="err-single-executable-application-asset-not-found" tabindex="-1"><a class="header-anchor" href="#err-single-executable-application-asset-not-found"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_single_executable_application_asset_not_found" target="_blank" rel="noopener noreferrer">ERR_SINGLE_EXECUTABLE_APPLICATION_ASSET_NOT_FOUND</a></span></a></h3><p><code>ERR_SINGLE_EXECUTABLE_APPLICATION_ASSET_NOT_FOUND</code> 是 Node.js 中的一个错误代码，它表示在一个被打包为单个可执行文件的 Node.js 应用中找不到所需的资源（asset）。当你使用了特定的工具将你的 Node.js 项目和所有的依赖文件都打包进一个单独的可执行文件，然后试图运行这个文件时，如果程序尝试访问一个在打包过程中没有被正确包含的资源文件，你就可能会遇到这个错误。</p><p>在 Node.js 中，&quot;资源&quot;可以指的是各种文件类型，比如：</p><ul><li>JavaScript 模块或脚本</li><li>JSON 文件</li><li>图片</li><li>CSS 文件</li><li>任何其他类型的静态文件</li></ul><p>想象一下，你有一个简单的 Node.js 网站项目，里面有以下结构：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>/my-node-app</span></span>
<span class="line"><span>  /public</span></span>
<span class="line"><span>    /images</span></span>
<span class="line"><span>      - logo.png</span></span>
<span class="line"><span>  /src</span></span>
<span class="line"><span>    - index.js</span></span>
<span class="line"><span>  - package.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 <code>index.js</code> 是你的主要服务器脚本，<code>public/images/logo.png</code> 是网站上显示的一个 logo 图片。</p><p>现在，如果你使用了例如 <code>pkg</code> 这样的工具来把你的应用打包成一个单独的可执行文件，那么你需要确保在打包过程中 <code>public/images/logo.png</code> 文件也被包含进去。如果没有被包含，而你的 <code>index.js</code> 脚本在运行时尝试访问这个图片，Node.js 就会抛出 <code>ERR_SINGLE_EXECUTABLE_APPLICATION_ASSET_NOT_FOUND</code> 错误，因为它在可执行文件中找不到这个图片。</p><p>假设在 <code>index.js</code> 里面有类似的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> app</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> express</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 静态文件目录</span></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">use</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/public</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> express</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">static</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">public</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 其他路由和逻辑...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">app</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>logo.png</code> 没有被包含在打包后的应用中，在客户端请求这个图片时，服务器会返回一个错误。</p><p>解决这个问题的方法通常包括：</p><ol><li>确保在打包过程中包含所有必需的资源。</li><li>检查打包工具的文档，看是否需要添加特定的配置选项来包含额外的资源文件。</li><li>如果某些资源是动态加载的或者路径在运行时确定，确保这些资源的处理逻辑也考虑到了单文件可执行环境的特殊情况。</li></ol><p>这个错误的关键在于打包应用时，要仔细管理和配置你的资源文件，确保它们能够正确地嵌入到最终的可执行文件中，以便在应用运行时能正常访问这些资源。</p><h3 id="err-socket-already-bound" tabindex="-1"><a class="header-anchor" href="#err-socket-already-bound"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_already_bound" target="_blank" rel="noopener noreferrer">ERR_SOCKET_ALREADY_BOUND</a></span></a></h3><p>好的，让我们来聊聊 Node.js 中的 <code>[ERR_SOCKET_ALREADY_BOUND]</code> 错误。</p><p>在网络编程中，socket 是用于通信的端点。当你想要建立一个网络服务，比如一个网站后台或者一个 API 服务时，你需要创建并且绑定一个 socket 到一个指定的端口上，这样外部的客户端才能通过那个端口与你的服务进行通信。</p><p>现在来说一下 <code>[ERR_SOCKET_ALREADY_BOUND]</code> 这个错误。这个错误发生在你尝试将一个 socket 绑定（bind）到一个已经被另一个 socket 绑定的端口时。简单来说，就是你试图使用一个已经在使用中的端口，而操作系统不允许一个端口被多个应用同时监听。</p><p>举一个实际的例子来说明这一点：</p><p>假设你正在开发一个网络应用，你写了一段代码来创建一个 HTTP 服务器，并且尝试监听端口 <code>3000</code> 来接收客户端的请求。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试监听端口 3000</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你运行这段代码，通常它会正常工作，并且你会看到控制台输出 “Server running on port 3000”。但如果你尝试再次运行相同的代码或者另一段程序也尝试监听端口 <code>3000</code>，你会得到 <code>[ERR_SOCKET_ALREADY_BOUND]</code> 错误，因为端口 <code>3000</code> 已经被第一个程序占用了。</p><p>解决这个问题的方法很简单：确保没有其他程序正在监听你想要使用的端口，或者选择一个不同的端口进行监听。</p><p>考虑以下更复杂的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 TCP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server1</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 此处我们绑定到端口 3001</span></span>
<span class="line"><span style="color:#D8DEE9;">server1</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3001</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server1 running on port 3001</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 再创建一个 TCP 服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server2</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果此处我们尝试再次绑定到端口 3001，会抛出 ERR_SOCKET_ALREADY_BOUND 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">server2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3001</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server2 running on port 3001</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>server1</code> 已经成功地监听了端口 <code>3001</code>。当 <code>server2</code> 也尝试去监听相同的端口时，系统会抛出 <code>[ERR_SOCKET_ALREADY_BOUND]</code> 错误。</p><p>因此，当你遇到这个错误时，你的第一步应该是检查是否有其他进程已经在使用你尝试绑定的端口。你可以使用操作系统提供的工具，比如在 UNIX 系统中可以使用 <code>lsof -i :端口号</code> 或在 Windows 中可以使用 <code>netstat -ano | findstr :端口号</code> 来查找哪个进程正在使用特定的端口。</p><h3 id="err-socket-bad-buffer-size" tabindex="-1"><a class="header-anchor" href="#err-socket-bad-buffer-size"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_bad_buffer_size" target="_blank" rel="noopener noreferrer">ERR_SOCKET_BAD_BUFFER_SIZE</a></span></a></h3><p><code>ERR_SOCKET_BAD_BUFFER_SIZE</code> 是一个错误代码，它在 Node.js 中表示操作系统级别的 Socket 缓冲区大小设置不正确或者失败。当你尝试设置 Socket（如 TCP 或 UDP 通讯中使用的接口）的缓冲区大小到一个不被操作系统支持的值时，就可能会遇到这个错误。</p><p>在 Node.js 中，你可以使用某些方法来设置 Socket 的发送（send buffer）和接收（receive buffer）缓冲区的大小。如果你设置的大小超出了操作系统所允许的范围，Node.js 就会抛出 <code>ERR_SOCKET_BAD_BUFFER_SIZE</code> 错误。</p><p>下面我们来举几个实际运用中可能会用到 Socket 缓冲区设置的例子：</p><h3 id="示例-1-创建-tcp-服务器和客户端" tabindex="-1"><a class="header-anchor" href="#示例-1-创建-tcp-服务器和客户端"><span>示例 1：创建 TCP 服务器和客户端</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 设置接收缓冲区的大小</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setRecvBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 设置发送缓冲区的大小</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setSendBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">收到客户端数据: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 向客户端回信</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8080</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器启动在8080端口</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建客户端连接</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createConnection</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">连接到服务器！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 发送数据到服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from client!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，服务器和客户端通过 TCP 连接进行通信。我们尝试使用 <code>setRecvBufferSize()</code> 和 <code>setSendBufferSize()</code> 方法来设置接收和发送的缓冲区大小。如果我们尝试设定的值不被操作系统支持，将会导致 <code>ERR_SOCKET_BAD_BUFFER_SIZE</code> 错误。</p><h3 id="示例-2-设置-udp-套接字的缓冲区" tabindex="-1"><a class="header-anchor" href="#示例-2-设置-udp-套接字的缓冲区"><span>示例 2：设置 UDP 套接字的缓冲区</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试设置缓冲区大小</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setRecvBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2048</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setSendBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2048</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_BAD_BUFFER_SIZE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法设置缓冲区大小，因为给定的大小不受支持。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 其他类型的错误，重新抛出</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 程序其他逻辑</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个例子中，我们创建了一个 UDP 套接字，并尝试设置其接收和发送缓冲区的大小。由于 <code>setRecvBufferSize()</code> 和 <code>setSendBufferSize()</code> 可能会抛出异常，所以我们用 try-catch 结构进行错误处理。如果捕获到的异常是 <code>ERR_SOCKET_BAD_BUFFER_SIZE</code> ，我们知道缓冲区大小设置失败了。</p><p>记住，这种类型的错误通常是由于指定了一个不合理的值导致的，因此确保你要设置的值在操作系统允许的范围内是很重要的。</p><h3 id="err-socket-bad-port" tabindex="-1"><a class="header-anchor" href="#err-socket-bad-port"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_bad_port" target="_blank" rel="noopener noreferrer">ERR_SOCKET_BAD_PORT</a></span></a></h3><p>Node.js 中的 <code>ERR_SOCKET_BAD_PORT</code> 错误是一个专门指示端口号问题的错误。在网络编程中，当你要让你的程序监听网络上的一个特定端口时，端口号必须符合一定的规则。</p><p>端口号是一个介于 0 到 65535 （含）之间的数字，它用于区分一台计算机上的不同网络服务。比如，网页通常由服务器在端口号 80 或 443 上提供服务。如果你尝试使用一个不在这个范围内的值作为端口号，或者尝试使用一些特殊意义的端口号（例如，低于 1024 的端口号通常保留给系统级服务），Node.js 就会抛出 <code>ERR_SOCKET_BAD_PORT</code> 错误。</p><h3 id="实例说明" tabindex="-1"><a class="header-anchor" href="#实例说明"><span>实例说明</span></a></h3><p>假设你正在编写一个 Node.js 应用，你想启动一个 web 服务器来监听 HTTP 请求。以下是创建服务器并尝试监听端口的代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的端口设置</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 错误的端口设置将导致 ERR_SOCKET_BAD_PORT 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will not be printed!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先导入了 <code>http</code> 模块，并创建了一个简单的 web 服务器。然后，我们让这个服务器监听端口 3000，这是一个正常的端口号，因此服务器可以成功启动。</p><p>但是，如果你尝试让服务器监听 <code>-1</code> 这样的无效端口号，Node.js 就会抛出 <code>ERR_SOCKET_BAD_PORT</code> 错误。因为 <code>-1</code> 显然不是一个有效的端口号，它不在允许的范围内。</p><p>类似地，如果你尝试监听端口 <code>99999</code>，你也会得到 <code>ERR_SOCKET_BAD_PORT</code> 错误，因为这个端口号超出了允许的最大值 65535。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 另一个错误的端口设置</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">99999</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will not be printed either!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，<code>ERR_SOCKET_BAD_PORT</code> 错误告诉你，你尝试使用的端口号是无效的，你需要选择一个正确的端口号来让你的应用正常工作。遵循端口号的规则，就可以避免这种类型的错误。</p><h3 id="err-socket-bad-type" tabindex="-1"><a class="header-anchor" href="#err-socket-bad-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_bad_type" target="_blank" rel="noopener noreferrer">ERR_SOCKET_BAD_TYPE</a></span></a></h3><p><code>ERR_SOCKET_BAD_TYPE</code> 是 Node.js 中的一个错误码，它表示尝试进行网络操作时遇到了不正确的 socket 类型。在 Node.js 应用程序中使用网络相关的模块（例如 <code>net</code>, <code>http</code>, <code>https</code>, <code>dgram</code> 等）时，如果你没有按照预期的方式配置或者使用这些模块中的 sockets，就可能会触发这个错误。</p><p>Sockets 是网络中的端点，用于发送和接收数据。在 Node.js 中，sockets 可以是流式的（stream-based, 例如 TCP 或 UNIX domain sockets）或数据报文的（datagram-based, 例如 UDP）。每种类型的 socket 都适用于特定的场景和协议。</p><p>当 Node.js 期望一个特定类型的 socket 被用于某个操作，但实际上传入了一个错误类型的 socket 时，就会抛出 <code>ERR_SOCKET_BAD_TYPE</code> 错误。</p><p>下面通过几个例子来说明这个错误可能如何发生：</p><h3 id="例子-1-错误地使用-tcp-socket" tabindex="-1"><a class="header-anchor" href="#例子-1-错误地使用-tcp-socket"><span>例子 1：错误地使用 TCP Socket</span></a></h3><p>假设你正在尝试使用 TCP socket 来发送 HTTP 请求，但你错误地创建了一个 UDP socket。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个UDP socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试使用HTTP模块的request方法，并传入UDP socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span></span>
<span class="line"><span style="color:#88C0D0;">    method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    // 这里传入的socket类型是不正确的，应该是TCP而不是UDP</span></span>
<span class="line"><span style="color:#88C0D0;">    createConnection</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">  (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // ...</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，HTTP 请求期望一个 TCP 类型的 socket，但是我们提供了一个 UDP socket。运行这段代码时，Node.js 会抛出 <code>ERR_SOCKET_BAD_TYPE</code> 错误。</p><h3 id="例子-2-在-http-服务器中使用非法的-socket-类型" tabindex="-1"><a class="header-anchor" href="#例子-2-在-http-服务器中使用非法的-socket-类型"><span>例子 2：在 HTTP 服务器中使用非法的 socket 类型</span></a></h3><p>假设你正在创建一个 HTTP 服务器，并且尝试将一个非法的 socket 传给它。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 意外地创建了一个UDP socket</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> illegalSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 这里应该是 &#39;tcp&#39; ，因为HTTP服务器需要TCP socket</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试使用错误类型的socket连接到服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">    illegalSocket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">address</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">port</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在此例中，我们意外地为 HTTP 服务器创建了一个 UDP socket，然后尝试使用它连接到服务器。当 <code>illegalSocket.connect</code> 调用时，会抛出 <code>ERR_SOCKET_BAD_TYPE</code>，因为 HTTP 服务器需要 TCP 类型的 socket 连接。</p><h3 id="如何解决这个错误-3" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误-3"><span>如何解决这个错误？</span></a></h3><p>要解决 <code>ERR_SOCKET_BAD_TYPE</code> 错误，你需要确保使用正确类型的 socket 与相应的协议或操作匹配。通常，这涉及到检查你的代码来确定是否使用了正确的模块和函数来创建和使用 sockets。</p><p>对于 TCP，你通常会使用 <code>net</code> 模块；对于 HTTP/HTTPS，你会使用 <code>http</code> 或 <code>https</code> 模块；对于 UDP，则使用 <code>dgram</code> 模块。每个模块都有其明确的用途和预期的 socket 类型。确保你遵循了每个协议和模块的正确用法，你就应该能够避免这个错误。</p><h3 id="err-socket-buffer-size" tabindex="-1"><a class="header-anchor" href="#err-socket-buffer-size"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_buffer_size" target="_blank" rel="noopener noreferrer">ERR_SOCKET_BUFFER_SIZE</a></span></a></h3><p><code>ERR_SOCKET_BUFFER_SIZE</code>是 Node.js 中的一个错误代码，它表示尝试设置或读取 socket 缓冲区大小时发生了问题。在 Node.js 中，一个 socket 是网络通讯的一个端点，用于发送和接收数据。每个 socket 都有一个缓冲区，这个缓冲区就像是内存中的一个临时存储区，用来保存正在发送或接收的数据。</p><p>为什么会出现<code>ERR_SOCKET_BUFFER_SIZE</code>错误？主要有两种情况：</p><ol><li>当你尝试给 socket 的缓冲区设置一个不合理的大小时。</li><li>当你尝试获取 socket 的缓冲区大小，但由于某些原因（比如系统限制）操作失败时。</li></ol><p>下面我们通过一些示例来进一步了解这个错误：</p><h3 id="实际运用的例子-14" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-14"><span>实际运用的例子</span></a></h3><h4 id="例子-1-设置-socket-缓冲区大小" tabindex="-1"><a class="header-anchor" href="#例子-1-设置-socket-缓冲区大小"><span>例子 1：设置 socket 缓冲区大小</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个TCP server</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 设置socket发送缓冲区的大小</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setSendBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 设置socket接收缓冲区的大小</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setRecvBufferSize</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_BUFFER_SIZE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法设置socket缓冲区大小。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器正在监听端口3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个 TCP 服务器，当新的客户端连接时，我们尝试设置该连接 socket 的发送和接收缓冲区大小为 1024 字节。如果出于任何原因（如提供了一个负数，或者超出了系统限制），设置缓冲区大小的操作失败了，我们会捕获到一个异常，并检查错误代码是否为<code>ERR_SOCKET_BUFFER_SIZE</code>，如果是，则输出相关的错误信息。</p><h4 id="例子-2-获取-socket-缓冲区大小" tabindex="-1"><a class="header-anchor" href="#例子-2-获取-socket-缓冲区大小"><span>例子 2：获取 socket 缓冲区大小</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个TCP server</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 获取socket发送缓冲区的大小</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> sendBufferSize</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getSendBufferSize</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">发送缓冲区大小: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">sendBufferSize</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 获取socket接收缓冲区的大小</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> recvBufferSize</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getRecvBufferSize</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">接收缓冲区大小: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">recvBufferSize</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生错误:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_BUFFER_SIZE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法获取socket缓冲区大小。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器正在监听端口3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们同样创建了一个 TCP 服务器，当新的客户端连接时，我们尝试获取该连接 socket 的发送和接收缓冲区的大小并打印出来。如果由于某些原因（例如底层系统调用失败），获取缓冲区大小的操作失败了，我们同样会捕获到异常，并判断是否是<code>ERR_SOCKET_BUFFER_SIZE</code>错误代码。</p><p>在编程时，处理错误是非常重要的，它可以帮助我们诊断问题所在，并且确保程序在出现问题时能够优雅地处理异常情况而不是直接崩溃。需要注意的是，<code>ERR_SOCKET_BUFFER_SIZE</code>错误通常表示底层的系统层面的问题，可能涉及到操作系统的配置或资源限制。</p><h3 id="err-socket-closed" tabindex="-1"><a class="header-anchor" href="#err-socket-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_closed" target="_blank" rel="noopener noreferrer">ERR_SOCKET_CLOSED</a></span></a></h3><p>在 Node.js 中，<code>ERR_SOCKET_CLOSED</code>是一个错误代码，代表尝试进行操作的 socket 已经关闭了。在网络编程中，&quot;socket&quot;用于表示两个节点之间的通信端点。当你使用 Node.js 的网络功能（例如 HTTP 服务器或客户端、TCP sockets 等）时，你可能会遇到这种类型的错误。</p><p>让我们通过一些简单的例子来说明这个错误是如何发生的。</p><h3 id="示例-1-tcp-服务器和客户端" tabindex="-1"><a class="header-anchor" href="#示例-1-tcp-服务器和客户端"><span>示例 1：TCP 服务器和客户端</span></a></h3><p>假设你有一个 TCP 服务器，它监听客户端的连接请求。当客户端连接到服务器后，它们可以进行数据的交换。如果服务器端的 socket 被关闭，然后你试图通过这个已关闭的 socket 发送数据，你将得到<code>ERR_SOCKET_CLOSED</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个TCP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">收到数据：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 假设在数据处理过程中，我们关闭了socket</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 然后尝试再次向客户端发送数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">更多数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">        // 这里我们会捕获ERR_SOCKET_CLOSED错误</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法发送数据，因为socket已关闭:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1234</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器正在监听端口1234</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码示例中，服务器在接收到数据并处理后立即关闭了 socket。此后，尝试再次使用同一个 socket 发送数据时，就会发生<code>ERR_SOCKET_CLOSED</code>错误。</p><h3 id="示例-2-http-服务器请求" tabindex="-1"><a class="header-anchor" href="#示例-2-http-服务器请求"><span>示例 2：HTTP 服务器请求</span></a></h3><p>HTTP 服务器在处理请求时，如果客户端提前关闭了连接，但服务器依然尝试写入响应，那么也可能会遇到<code>ERR_SOCKET_CLOSED</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 模拟一些异步操作，比如从数据库获取数据</span></span>
<span class="line"><span style="color:#88C0D0;">  setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 在异步操作完成后，尝试写入响应</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是来自服务器的响应</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">        // 如果客户端已经关闭了连接，则会捕获到ERR_SOCKET_CLOSED错误</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">无法发送响应，因为客户端关闭了连接:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HTTP服务器正在监听端口3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，由于服务器在进行异步操作时客户端可能关闭了连接，所以当服务器试图发送响应时，如果连接已经被客户端关闭了，就会出现<code>ERR_SOCKET_CLOSED</code>错误。</p><p>总结一下，<code>ERR_SOCKET_CLOSED</code>错误表明你正试图对一个已经关闭的 socket 执行操作。通常，这意味着你需要更好地管理 socket 的生命周期，确保你不会在 socket 关闭后尝试使用它。在实际编程中，你应该检查 socket 的状态或者捕获这类错误，以便优雅地处理这样的场景，而不是导致程序崩溃。</p><h3 id="err-socket-closed-before-connection" tabindex="-1"><a class="header-anchor" href="#err-socket-closed-before-connection"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_closed_before_connection" target="_blank" rel="noopener noreferrer">ERR_SOCKET_CLOSED_BEFORE_CONNECTION</a></span></a></h3><p>Node.js 中的 <code>ERR_SOCKET_CLOSED_BEFORE_CONNECTION</code> 是一个错误码，用来指示尝试进行网络操作时遇到了问题。具体来说，这个错误表示在网络连接建立之前，套接字（socket）已经被关闭了。</p><p>套接字是用于在网络上发送和接收数据的一种工具。在网络编程中，你通常需要创建一个套接字，并与远端的服务器或客户端建立连接，然后通过这个连接来交换数据。如果在尝试建立这样的连接之前，出于某种原因套接字已经关闭了，你就会遇到 <code>ERR_SOCKET_CLOSED_BEFORE_CONNECTION</code> 这个错误。</p><p>这里有几个实际运用的例子，帮助你理解这个错误是怎么发生的：</p><h3 id="示例-1-http-客户端请求" tabindex="-1"><a class="header-anchor" href="#示例-1-http-客户端请求"><span>示例 1: HTTP 客户端请求</span></a></h3><p>假设你有以下的 Node.js 代码片段，使用内置的 <code>http</code> 模块创建一个 HTTP 客户端发送请求：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在调用 <code>req.end()</code> 后，但在与服务器成功建立连接前，由于某种原因 <code>req</code> 对象被提前关闭了（可能是代码中其他部分导致的），那么就可能引发 <code>ERR_SOCKET_CLOSED_BEFORE_CONNECTION</code> 错误。</p><h3 id="示例-2-websocket-连接" tabindex="-1"><a class="header-anchor" href="#示例-2-websocket-连接"><span>示例 2: WebSocket 连接</span></a></h3><p>考虑你正在使用一个 WebSocket 库来与 WebSocket 服务器建立连接：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> WebSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ws</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ws</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> WebSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ws://www.example.com/socketserver</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">open</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> open</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> close</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Disconnected!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果在尝试和服务器建立连接之前，连接被关闭：</span></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将导致 `ERR_SOCKET_CLOSED_BEFORE_CONNECTION` 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>ws.close()</code> 方法被调用，在连接完全打开之前，WebSocket 将被关闭，这可以引起 <code>ERR_SOCKET_CLOSED_BEFORE_CONNECTION</code>。</p><h3 id="处理错误-1" tabindex="-1"><a class="header-anchor" href="#处理错误-1"><span>处理错误</span></a></h3><p>要处理这种类型的错误，你可以添加错误监听器到你的网络请求或连接代码中，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_CLOSED_BEFORE_CONNECTION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">Socket was closed before the connection could be established</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们注册了一个事件监听器来监听 <code>error</code> 事件。如果错误码是 <code>ERR_SOCKET_CLOSED_BEFORE_CONNECTION</code>，则输出特定的错误信息；否则输出通用错误信息。</p><p>确保在实际编码时检查所有可能导致套接字关闭的代码路径，并且正确地处理所有错误，以便程序能够优雅地恢复或退出。</p><h3 id="err-socket-connection-timeout" tabindex="-1"><a class="header-anchor" href="#err-socket-connection-timeout"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_connection_timeout" target="_blank" rel="noopener noreferrer">ERR_SOCKET_CONNECTION_TIMEOUT</a></span></a></h3><p>在 Node.js 中，<code>ERR_SOCKET_CONNECTION_TIMEOUT</code> 是一个特定类型的错误，它发生在网络操作中，当一个 socket（网络通信端点）连接尝试超过了指定的时间限制时。简单来说，这个错误告诉你，尝试连接到服务器或另一台计算机的操作花费的时间太长，没有在预定时间内完成。</p><p>让我们通过几个实际场景来理解这个错误：</p><h3 id="实例-1-http-请求" tabindex="-1"><a class="header-anchor" href="#实例-1-http-请求"><span>实例 1: HTTP 请求</span></a></h3><p>假设你正在使用 Node.js 编写一个程序，该程序需要从外部 API 获取数据。你可能会使用 <code>http</code> 或 <code>https</code> 模块来发起请求。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  timeout</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 2000</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 设置为2秒</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">parse</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection timed out!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">abort</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 终止请求</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们设置了一个 2 秒的超时时间。如果服务器在 2 秒之内没有响应，就会触发 <code>&#39;timeout&#39;</code> 事件，并且你将看到控制台打印出 &quot;Connection timed out!&quot; 的消息。此时，请求被终止。如果不处理这种情况，可能会导致 <code>ERR_SOCKET_CONNECTION_TIMEOUT</code> 错误。</p><h3 id="实例-2-tcp-客户端" tabindex="-1"><a class="header-anchor" href="#实例-2-tcp-客户端"><span>实例 2: TCP 客户端</span></a></h3><p>同样地，如果你正在建立一个 TCP 客户端去连接到一个 TCP 服务器，你也可能遇到这个错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Socket</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 3秒超时</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1337</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">127.0.0.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, server! Love, Client.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Received: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // kill client after server&#39;s response</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">timeout</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection timed out!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection closed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SOCKET_CONNECTION_TIMEOUT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The socket connection timed out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个 TCP 客户端，它尝试连接到本地主机上的端口 1337。如果在 3 秒内未能建立连接，则会触发 <code>timeout</code> 事件。如果在连接超时后，还试图进行网络操作，就可能引发 <code>ERR_SOCKET_CONNECTION_TIMEOUT</code> 的错误。</p><p>总结一下，<code>ERR_SOCKET_CONNECTION_TIMEOUT</code> 表示一个网络操作由于迟迟无法完成而被系统判定为超时。处理这类错误是非常重要的，因为它们可以帮助你的程序优雅地处理网络延迟或不可达的问题，提高用户体验和程序的鲁棒性。在编程时，确保正确设置超时参数，并监听相应的事件以便于及时作出反应。</p><h3 id="err-socket-dgram-is-connected" tabindex="-1"><a class="header-anchor" href="#err-socket-dgram-is-connected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_dgram_is_connected" target="_blank" rel="noopener noreferrer">ERR_SOCKET_DGRAM_IS_CONNECTED</a></span></a></h3><p><code>ERR_SOCKET_DGRAM_IS_CONNECTED</code> 是一个错误代码，指示在你使用 Node.js 中的 dgram 模块（用于实现 UDP Datagram sockets）时出现了特定的问题。这个错误表示你尝试执行的操作在当前的 socket 已经连接到远程地址和端口的情况下是不允许的。</p><p>在 Node.js 中，UDP sockets 可以是两种类型的：<code>connected</code> 和 <code>unconnected</code>。<code>unconnected</code> 的 sockets 可以向任何地址发送消息，并且可以接收任何来源的消息。而当你把 UDP socket <code>connect</code> 到一个特定的远程地址和端口时，它就成为了 <code>connected</code> 状态。在 <code>connected</code> 状态下，socket 只能接收来自于它已经连接了的远程地址的消息，也只能发送消息到这个远程地址。</p><p>当你对一个已经处于 <code>connected</code> 状态的 socket 尝试进行某些操作时，比如再次连接到另一个地址或者监听来自于非连接地址的消息，Node.js 会抛出 <code>ERR_SOCKET_DGRAM_IS_CONNECTED</code> 这个错误。</p><p>来看一些具体的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们连接到了 localhost 上的 12345 端口</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 连接成功后，socket 处于 connected 状态。</span></span>
<span class="line"><span style="color:#616E88;">  // 这时候如果我们尝试再次连接到另一个地址和端口，就会触发 ERR_SOCKET_DGRAM_IS_CONNECTED 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">54321</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_SOCKET_DGRAM_IS_CONNECTED 错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 因为 socket 已经 connect，所以下面的命令会正常工作，发送数据到 localhost 的 12345 端口</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 发送完成后关闭 socket</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码演示了如果你尝试对一个已经连接到某个端口的 UDP socket 执行再次连接的操作，你将会遇到 <code>ERR_SOCKET_DGRAM_IS_CONNECTED</code> 错误。避免这个错误很简单，就是要确保你不对已经连接的 socket 执行不允许的操作，例如再次连接。如果你需要向不同的地址或端口发送消息，你应该使用一个未连接的 socket，或者先调用 <code>socket.disconnect()</code> 方法断开当前的连接，然后再重新连接。</p><h3 id="err-socket-dgram-not-connected" tabindex="-1"><a class="header-anchor" href="#err-socket-dgram-not-connected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_dgram_not_connected" target="_blank" rel="noopener noreferrer">ERR_SOCKET_DGRAM_NOT_CONNECTED</a></span></a></h3><p><code>[ERR_SOCKET_DGRAM_NOT_CONNECTED]</code> 是一个错误代码，它表示在 Node.js 环境中的 Datagram 套接字（也就是用于 UDP 通信的套接字）尝试发送数据，但并没有建立连接或指定远程地址和端口。</p><p>在 Node.js 中，UDP（用户数据报协议）是一种无连接的网络协议，这意味着不同于 TCP 协议的长久连接，UDP 发送消息前不需要建立和维护连接。然而，即使是无连接的，Node.js 的 <code>dgram</code> 模块仍然让你有选择地“连接”到一个特定的地址和端口，这样就可以使用 <code>socket.send()</code> 方法来发送消息，而不必每次都指定远程的地址和端口。</p><p>出现 <code>[ERR_SOCKET_DGRAM_NOT_CONNECTED]</code> 错误一般是由以下几种情况造成的：</p><ol><li>你创建了一个 UDP 套接字，并且调用了 <code>send()</code> 方法来发送数据，但是没有指定目标地址和端口，同时在此之前也没有调用过 <code>connect()</code> 方法。</li><li>即使调用了 <code>connect()</code> 绑定了一个特定的远程地址和端口，但由于某些原因（比如网络问题），套接字实际上并没有成功连接到那个地址。</li></ol><p>我们通过下面的例子来更具体地理解这个错误：</p><h3 id="示例-1-未连接时发送数据" tabindex="-1"><a class="header-anchor" href="#示例-1-未连接时发送数据"><span>示例 1：未连接时发送数据</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试发送数据，但没有指定目标地址和端口</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会打印出 [ERR_SOCKET_DGRAM_NOT_CONNECTED] 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，我们创建了一个 UDP 套接字并尝试发送数据，但我们没有提供目标地址和端口，这就会导致 <code>[ERR_SOCKET_DGRAM_NOT_CONNECTED]</code> 错误。</p><h3 id="示例-2-正确使用-connect-方法" tabindex="-1"><a class="header-anchor" href="#示例-2-正确使用-connect-方法"><span>示例 2：正确使用 connect() 方法</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 首先用 connect() 方法指定目标地址和端口</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 然后发送数据</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">send</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Message sent!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，我们先调用了 <code>connect()</code> 方法，成功地为套接字指定了目标地址和端口，随后就可以安全地使用 <code>send()</code> 方法来发送数据，而不会遇到 <code>[ERR_SOCKET_DGRAM_NOT_CONNECTED]</code> 错误。</p><p>如果你碰到这个错误，检查你的代码确保在发送之前正确地指定了地址和端口，或者在 <code>send()</code> 方法中传入了这些参数。</p><h3 id="err-socket-dgram-not-running" tabindex="-1"><a class="header-anchor" href="#err-socket-dgram-not-running"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_dgram_not_running" target="_blank" rel="noopener noreferrer">ERR_SOCKET_DGRAM_NOT_RUNNING</a></span></a></h3><p><code>ERR_SOCKET_DGRAM_NOT_RUNNING</code> 是 Node.js 中的一个错误代码，它与 Datagram sockets（数据报套接字）相关。在 Node.js 中，当你尝试使用 <code>dgram</code> 模块进行网络通信时，可能会遇到这种类型的错误。</p><p><code>dgram</code> 模块用于实现 UDP 数据报通信。UDP（用户数据报协议）是一个简单的网络协议，提供了一种不可靠、无连接的方式来发送消息。这意味着消息（也称为数据报）被发送到网络上，但没有保障它们会达到目的地，也不会确认收到。</p><p>让我们来看一下发生 <code>ERR_SOCKET_DGRAM_NOT_RUNNING</code> 错误的情况以及如何理解它。</p><h3 id="发生场景" tabindex="-1"><a class="header-anchor" href="#发生场景"><span>发生场景：</span></a></h3><p>当你尝试关闭一个 UDP 套接字，但该套接字并没有启动或者已经关闭时，你会遇到这个错误。</p><h3 id="示例-1" tabindex="-1"><a class="header-anchor" href="#示例-1"><span>示例：</span></a></h3><p>假设我们有以下 Node.js 脚本，它创建了一个 UDP 套接字，并尝试在套接字未启动的情况下立即关闭它。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试关闭还没有开始运行的套接字</span></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">出错了: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">套接字成功关闭！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这段代码中，我们创建了一个名为 <code>socket</code> 的 UDP 套接字，然后立即使用 <code>close()</code> 方法尝试关闭它。因为我们没有启动套接字（比如用 <code>bind()</code> 方法去监听特定端口），所以执行上面的代码可能会触发 <code>ERR_SOCKET_DGRAM_NOT_RUNNING</code> 错误。</p><p>要修复这个错误，我们需要确保在调用 <code>close()</code> 方法之前，套接字已经开始运行。如果必须先启动套接字，我们可以这样修改代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dgram</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> socket</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> dgram</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">udp4</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">bind</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12345</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 监听端口 12345</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">UDP 套接字开始监听</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在某些事件发生后或者一段时间后关闭套接字</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">出错了: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">套接字成功关闭！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 等待 3 秒钟</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正版的示例中，我们使用 <code>bind()</code> 方法使套接字开始监听端口 <code>12345</code>。然后，我们设置了一个 3 秒的延时，之后才关闭套接字。这样做就避免了 <code>ERR_SOCKET_DGRAM_NOT_RUNNING</code> 错误，因为套接字在关闭之前确实已经开始运行。</p><h3 id="结论-1" tabindex="-1"><a class="header-anchor" href="#结论-1"><span>结论：</span></a></h3><p>要避免 <code>ERR_SOCKET_DGRAM_NOT_RUNNING</code> 错误，你需要确保在尝试关闭一个 UDP 套接字之前，该套接字已经通过 <code>bind()</code> 方法开始监听端口。这个错误是一个提示，告诉你操作不能完成，因为套接字并没有处在正确的状态。</p><h3 id="err-sri-parse" tabindex="-1"><a class="header-anchor" href="#err-sri-parse"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_sri_parse" target="_blank" rel="noopener noreferrer">ERR_SRI_PARSE</a></span></a></h3><p><code>ERR_SRI_PARSE</code> 是 Node.js 中的一个错误代码，表示在处理“子资源完整性”(Subresource Integrity, SRI)值时发生了解析错误。SRI 是一种安全特性，它允许浏览器或其他环境验证获取到的资源（如脚本、样式表等）是否未经篡改，确保内容的完整性。</p><p>SRI 通过为资源提供一个预期的加密散列值来工作。当你从网络上加载资源时，可以指定这个散列值。加载资源后，浏览器会计算资源的实际散列值，并将其与你提供的预期散列值进行比较。如果两者不匹配，那么浏览器就不会执行或应用该资源，因为这意味着资源可能被篡改。</p><p>在 Node.js 中，如果你在使用类似于网络请求库时尝试验证资源的 SRI 值，并且该值格式有误，那么就可能遇到 <code>ERR_SRI_PARSE</code> 错误。</p><p>举个实际的例子：</p><p>假设你正在开发一个 Node.js 应用程序，想要从互联网上下载一个 JavaScript 库，并检查它的 SRI 值以确保安全。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 预定义的正确SRI哈希值</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> expectedSriHash</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sha384-BaNesj...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 下载资源的函数</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> downloadResource</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> sriHash</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  https</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">      res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">        const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha384</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">base64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">hash</span><span style="color:#81A1C1;"> !==</span><span style="color:#D8DEE9;"> sriHash</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SRI Hash does not match!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">          console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">SRI Hash verified successfully!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">        }</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试使用错误格式的SRI散列值</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  downloadResource</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">https://example.com/some-library.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">this-is-not-a-valid-sri-hash</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_SRI_PARSE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">There was an error parsing the SRI hash: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果是其他错误，重新抛出异常</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先导入了 <code>crypto</code> 和 <code>https</code> 模块，然后定义了一个函数 <code>downloadResource</code> 来下载资源并验证其 SRI 哈希值。我们传递了一个错误格式的哈希值 &#39;this-is-not-a-valid-sri-hash&#39; 给 <code>downloadResource</code> 函数。</p><p>如果 <code>downloadResource</code> 函数中的 SRI 解析逻辑检查到提供的哈希值格式不正确，它将抛出一个错误，我们可以捕获这个错误并检查它的代码是否是 <code>ERR_SRI_PARSE</code>。在此例中，<code>catch</code> 语句将捕获错误并打印出相应的错误消息。</p><p>请注意，这只是一个简单的例子来解释 <code>ERR_SRI_PARSE</code> 错误和 SRI 的基本概念，实际上 Node.js 并没有内置的 SRI 验证功能，所以你可能需要使用第三方库或自己编写相应的逻辑来处理 SRI 验证。</p><h3 id="err-stream-already-finished" tabindex="-1"><a class="header-anchor" href="#err-stream-already-finished"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_already_finished" target="_blank" rel="noopener noreferrer">ERR_STREAM_ALREADY_FINISHED</a></span></a></h3><p>好的，Node.js 中的 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 错误是一个常见的错误类型，它涉及的是 Node.js 中流（Stream）的操作。在理解这个错误之前，我们需要简单了解一下什么是流。</p><p>流（Stream）在 Node.js 中是一种处理数据的方式，特别是当你需要处理大量数据，或者你想逐块处理文件内容时。流可以将数据分成小的部分，然后逐一处理这些部分，而不是等所有数据都准备好了再一次性处理。这种方式能够有效减少内存使用，并且可以加快处理速度。</p><p>现在来说说 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 这个错误。当你试图对一个已经结束的流执行写入或结束操作时，就会出现这个错误。换句话说，如果你尝试向一个已经关闭的流中添加数据，或者再次尝试关闭它，Node.js 就会抛出 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 错误。</p><p>让我们以一个例子来说明这个概念：</p><p>假设你正在写一个程序来读取一个大型文件，并将其内容复制到另一个文件中。你会使用流来逐步读取原始文件的内容，并逐步写入新文件。</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可读流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 创建一个可写流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writeStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 通过管道将读取的数据流向可写流</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">writeStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听 &#39;finish&#39; 事件，表示所有数据已经被写入到目标文件</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">finish</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">文件复制完成。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试再次结束流（这将导致错误）</span></span>
<span class="line"><span style="color:#D8DEE9;">  writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们首先创建了一个用于读取 <code>source.txt</code> 文件的可读流，并创建了一个用于写入 <code>destination.txt</code> 文件的可写流。我们使用 <code>.pipe()</code> 方法将读取的数据自动推送到可写流中。</p><p>当可写流的所有数据都已经成功写入目标文件时，<code>&#39;finish&#39;</code> 事件会被触发。此时，我们输出 “文件复制完成。” 的信息。接着，我们错误地尝试了一个多余的操作：再次调用 <code>writeStream.end()</code> 来结束流。因为流已经自动结束了（<code>.pipe()</code> 方法会处理好结束流的操作），所以第二次尝试结束同一个流会导致 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 错误。</p><p>实际上，在正常情况下，我们并不需要手动调用 <code>writeStream.end()</code>，因为 <code>.pipe()</code> 已经帮我们处理好了。如果我们确实需要在某个特定时间点结束写入流，只应该调用一次 <code>end()</code> 方法。如果你意外地多次调用这个方法，就会看到 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 错误。</p><p>总结一下，要避免 <code>[ERR_STREAM_ALREADY_FINISHED]</code> 错误，你需要确保：</p><ol><li>不要向一个已经结束的流中写入数据。</li><li>不要尝试多次结束同一个流。</li></ol><h3 id="err-stream-cannot-pipe" tabindex="-1"><a class="header-anchor" href="#err-stream-cannot-pipe"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_cannot_pipe" target="_blank" rel="noopener noreferrer">ERR_STREAM_CANNOT_PIPE</a></span></a></h3><p>在 Node.js 中，流（Streams）是处理数据流的一种抽象。流可以是可读的、可写的，或者既可读又可写。它们可以用来读取大文件、网络通信等。</p><p><code>ERR_STREAM_CANNOT_PIPE</code> 是 Node.js 中一个特定类型的错误，表示你试图进行一个“pipe”操作，但这个操作在当前的流状态下是不允许的。所谓的“pipe”操作，简单来说就是将一个流的输出直接连接到另一个流的输入，从而无需手动处理流经过的数据。</p><p>这个错误通常会发生在以下几种情况下：</p><ol><li>当你尝试给一个已经结束的流(pipe to a closed stream)添加管道时。</li><li>当流不支持管道操作的时候。</li></ol><p>举个例子来说明这个错误：</p><p>假设你有一个可读流和一个可写流，你想要将可读流中的数据传输到可写流中。正常情况下，你会这么做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readableStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writableStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">writableStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码创建了两个流，一个从<code>source.txt</code>文件读取数据的可读流，和一个向<code>destination.txt</code>文件写入数据的可写流。然后通过<code>.pipe()</code>方法将两个流连接起来，数据就可以从<code>source.txt</code>流向<code>destination.txt</code>。</p><p>如果由于某些原因，<code>writableStream</code> 在<code>.pipe()</code>调用之前被关闭了，那么会触发<code>ERR_STREAM_CANNOT_PIPE</code>错误，因为你不能将数据管道发送到一个已经结束的流。</p><p>以下是可能导致<code>ERR_STREAM_CANNOT_PIPE</code>错误的代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设此时 writableStream 已经被关闭</span></span>
<span class="line"><span style="color:#D8DEE9;">writableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 这里尝试将 readableStream 的输出 pipe 到已经关闭的 writableStream，会抛出 ERR_STREAM_CANNOT_PIPE 错误</span></span>
<span class="line"><span style="color:#D8DEE9;">readableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">writableStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误发生</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在使用流和<code>.pipe()</code>方法的时候，确保目标流是开放且可接收数据的，否则就会遇到 <code>ERR_STREAM_CANNOT_PIPE</code> 类型错误。当你的代码中出现这类错误时，检查流的状态和你的<code>pipe()</code>调用时机，确保它们的逻辑是正确的。</p><h3 id="err-stream-destroyed" tabindex="-1"><a class="header-anchor" href="#err-stream-destroyed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_destroyed" target="_blank" rel="noopener noreferrer">ERR_STREAM_DESTROYED</a></span></a></h3><p>在 Node.js 中，流（Stream）是处理流式数据的核心概念。流可以是可读的、可写的或者既可读又可写的。可读流允许 Node.js 从一个源头（比如文件、网络连接等）读取数据，而可写流则允许将数据写入到目的地。</p><p><code>ERR_STREAM_DESTROYED</code> 是 Node.js 中的一个错误代码，它表示尝试对已经被销毁的流进行操作。当流被销毁后，你不能再往里面写入数据，也不能再从中读取数据。</p><p>下面我会给你几个实际的例子来说明这个错误是怎么发生的，以及如何避免。</p><h3 id="可写流示例" tabindex="-1"><a class="header-anchor" href="#可写流示例"><span>可写流示例</span></a></h3><p>假设我们有一个可写流，比如用于写入文件的流：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个指向文件的可写流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writable</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 写入一些数据</span></span>
<span class="line"><span style="color:#D8DEE9;">writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 销毁流</span></span>
<span class="line"><span style="color:#D8DEE9;">writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次写入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will cause an error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们首先创建了一个名为<code>example.txt</code>的文件的可写流，并且往里写入了<code>&#39;Hello, World!&#39;</code>。然后我们调用了<code>writable.destroy()</code>方法来销毁这个流。一旦流被销毁，在此之后尝试调用<code>writable.write()</code>方法写入更多的数据，会触发<code>ERR_STREAM_DESTROYED</code>错误。</p><h3 id="可读流示例" tabindex="-1"><a class="header-anchor" href="#可读流示例"><span>可读流示例</span></a></h3><p>同样的错误也可以发生在可读流上，以下是一个简单的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个指向文件的可读流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readable</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听数据事件来读取数据块</span></span>
<span class="line"><span style="color:#D8DEE9;">readable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> bytes of data.</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 销毁流</span></span>
<span class="line"><span style="color:#D8DEE9;">readable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试在销毁流之后再次处理数据</span></span>
<span class="line"><span style="color:#D8DEE9;">readable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这个事件处理函数不应该被执行，因为流已经被销毁了</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个指向<code>example.txt</code>文件的可读流，并设置了一个监听器来接收并打印数据。然后我们销毁了这个流。如果之后试图再次监听<code>data</code>事件，虽然新的事件处理函数不会被调用（因为没有更多的数据会被流传递），但如果尝试执行像<code>readable.read()</code>这样的操作，就会触发<code>ERR_STREAM_DESTROYED</code>错误。</p><h3 id="如何避免err-stream-destroyed错误" tabindex="-1"><a class="header-anchor" href="#如何避免err-stream-destroyed错误"><span>如何避免<code>ERR_STREAM_DESTROYED</code>错误？</span></a></h3><p>避免该错误的最佳策略是确保你不对已销毁的流执行任何操作。你可以通过检查流的状态或者使用事件监听器来管理流的生命周期，确保流在销毁后不会被进一步操作。</p><p>例如，对于可写流，你可以监听<code>close</code>事件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">writable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Stream is closed, no more operations should be done.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于可读流，你也可以监听<code>close</code>事件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">readable</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Stream is closed, no more operations should be done.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结起来，<code>ERR_STREAM_DESTROYED</code>是告诉你：你正尝试操作一个已经结束其生命周期的流。正确的做法是在流完成其任务后（对于可写流是所有数据都写入了底层系统，对于可读流是所有数据都被读取完毕），再去销毁流，同时保证没有后续操作会影响到这个流。</p><h3 id="err-stream-null-values" tabindex="-1"><a class="header-anchor" href="#err-stream-null-values"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_null_values" target="_blank" rel="noopener noreferrer">ERR_STREAM_NULL_VALUES</a></span></a></h3><p><code>[ERR_STREAM_NULL_VALUES]</code> 是 Node.js 中的一个错误代码，它表示在处理流（streams）时遇到了一个问题。在 Node.js 里，流是一种用于读取或写入数据的抽象概念，比如从文件读取数据或将数据写入网络连接等。</p><p>这个特定的错误是指你试图往一个流中写入 <code>null</code> 值，但是流的配置没有设置允许接受 <code>null</code> 作为有效的数据值。在 Node.js 中，流可以通过 &#39;objectMode&#39; 选项来配置，当开启 &#39;objectMode&#39; 时，流可以接收任何 JavaScript 的值，包括对象、字符串、数字等，也包括 <code>null</code>。如果没有开启 &#39;objectMode&#39;，默认情况下流只能接收 Buffer 或字符串类型的数据。</p><p>以下是 <code>ERR_STREAM_NULL_VALUES</code> 错误可能发生的一些情境及示例：</p><h3 id="示例-1-写入流中不接受-null-值" tabindex="-1"><a class="header-anchor" href="#示例-1-写入流中不接受-null-值"><span>示例 1：写入流中不接受 null 值</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Writable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 writable 流，未开启 objectMode</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Writable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 在这里处理数据...</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试写入 null 值</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_STREAM_NULL_VALUES 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码中，我们创建了一个 writable 流然后尝试写入 <code>null</code> 值。因为没有开启 <code>objectMode</code>，所以会报 <code>ERR_STREAM_NULL_VALUES</code> 错误。</p><h3 id="示例-2-正确使用-objectmode-接受-null-值" tabindex="-1"><a class="header-anchor" href="#示例-2-正确使用-objectmode-接受-null-值"><span>示例 2：正确使用 objectMode 接受 null 值</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Writable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个 writable 流，开启 objectMode</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Writable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  objectMode</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;"> ===</span><span style="color:#81A1C1;"> null</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a null value.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确写入 null 值</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 不会抛出错误，因为开启了 objectMode</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正的示例中，我们通过在创建流时设置 <code>objectMode: true</code> 来告诉流，我们允许写入任何类型的数据，包括 <code>null</code>。因此，当写入 <code>null</code>时，不会抛出错误。</p><p>要解决 <code>ERR_STREAM_NULL_VALUES</code> 错误，通常有两种方法：</p><ol><li>避免往流中写入 <code>null</code> 值。</li><li>如果你需要传递 <code>null</code>，请确保在创建流时，使用 <code>{ objectMode: true }</code> 选项来允许 <code>null</code> 值。</li></ol><h3 id="err-stream-premature-close" tabindex="-1"><a class="header-anchor" href="#err-stream-premature-close"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_premature_close" target="_blank" rel="noopener noreferrer">ERR_STREAM_PREMATURE_CLOSE</a></span></a></h3><p>当我们在 Node.js 中谈到流（Stream），我们指的是处理数据的一种方式，就像水流从一端流到另一端。在 Node.js 中，流被用于读取或写入数据，特别是在处理大量数据或者来自外部源（比如文件、网络等）的数据时。流可以非常有效地处理数据，因为它们允许你在整个数据还没有完全可用时就开始处理数据片段。</p><p><code>ERR_STREAM_PREMATURE_CLOSE</code>是一个错误类型，在 Node.js 中，它通常意味着一个流被过早关闭了——也就是说，在流还没有完成它的全部操作之前它就被关闭了。这可能发生在以下几种情况：</p><ol><li>写入流：当你正在将数据写入一个流中，但这个流在你完成写入之前突然关闭了。</li><li>读取流：当你正在读取一个流的数据，但是这个流在你读取所有数据之前被关闭了。</li><li>转换流：当你有一个将数据从一种格式转换成另一种格式的流，如果这个转换流在转换完成之前关闭了，你也会看到这个错误。</li></ol><p>下面，我将通过一些实际的例子来说明这个错误是怎样发生的。</p><h3 id="示例-1-写入流中的错误" tabindex="-1"><a class="header-anchor" href="#示例-1-写入流中的错误"><span>示例 1：写入流中的错误</span></a></h3><p>假设你要将一些数据写入文件，代码可能类似于以下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个写入流</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> writeStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">output.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 写入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是一些文本数据</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设由于某种原因，流在结束前关闭了</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次写入</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">尝试写入更多数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，我们创建了一个写入流来向文件<code>output.txt</code>中写入数据。但在我们调用<code>destroy()</code>关闭流之后，我们试图再次写入数据。这将导致<code>ERR_STREAM_PREMATURE_CLOSE</code>错误，因为流已经被提前关闭了。</p><h3 id="示例-2-读取流中的错误" tabindex="-1"><a class="header-anchor" href="#示例-2-读取流中的错误"><span>示例 2：读取流中的错误</span></a></h3><p>现在假设你要从一个文件中读取数据：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个读取流</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">input.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">接收到 </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">length</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;"> 字节的数据。</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">没有更多数据。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在读取完成之前，流被关闭了</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">destroy</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个从<code>input.txt</code>文件中读取数据的流。我们监听了<code>data</code>事件来接收文件的数据片段，并在流结束时监听<code>end</code>事件。然而，如果我们过早地调用<code>destroy()</code>方法来关闭流，那么我们会得到<code>ERR_STREAM_PREMATURE_CLOSE</code>错误，因为我们试图在流能够完成它的工作之前关闭它。</p><h3 id="总结和解决方案" tabindex="-1"><a class="header-anchor" href="#总结和解决方案"><span>总结和解决方案</span></a></h3><p>出现<code>ERR_STREAM_PREMATURE_CLOSE</code>错误时，应该检查代码，确保不要在数据传输或处理过程中非预期地关闭流。你可以通过正确地管理你的流的打开和关闭操作来防止这个错误。在实践中，这通常意味着确保：</p><ul><li>只有在流中没有待处理或待写入的数据时才关闭流。</li><li>监听流的错误事件，并在出错时适当地处理这些错误，而不是忽视它们。</li><li>如果你在使用<code>pipe()</code>进行流的管道传输，确保正确地处理各种流事件，如<code>end</code>、<code>error</code>和<code>finish</code>。</li></ul><h3 id="err-stream-push-after-eof" tabindex="-1"><a class="header-anchor" href="#err-stream-push-after-eof"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_push_after_eof" target="_blank" rel="noopener noreferrer">ERR_STREAM_PUSH_AFTER_EOF</a></span></a></h3><p>好的，Node.js 中的 <code>ERR_STREAM_PUSH_AFTER_EOF</code> 错误是与流（stream）操作有关的错误。在详细解释这个错误之前，我们需要先理解 Node.js 中的流和 EOF 是什么。</p><p><strong>流（Streams）</strong>：在 Node.js 中，流是用来处理读取或写入数据的一种抽象机制。你可以将它想象成水流，数据就像是从一个地方流向另一个地方的水。流可以用来处理大量数据，例如从文件读取数据或者向文件写入数据，而不必一次性把所有数据放进内存。</p><p><strong>EOF（End of File）</strong>：EOF 是文件结束标记的简称，表示没有更多的数据可以从数据源（如文件）读取了。</p><p>现在，让我们回到 <code>ERR_STREAM_PUSH_AFTER_EOF</code> 这个错误。当你使用 Node.js 的流时，可能会遇到一种情况，就是你试图向一个已经结束的流中推送（push）数据。也就是说，流已经发出了结束信号（EOF），表明没有更多的数据会被发送，但是你的代码中还尝试再往这个流里面添加更多数据，这时候 Node.js 就会抛出 <code>ERR_STREAM_PUSH_AFTER_EOF</code> 错误。</p><p>举个例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Readable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个自定义的可读流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myReadableStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Readable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  read</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {},</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 推送数据 &#39;hello&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">myReadableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 发出 EOF 信号，表示没有更多数据</span></span>
<span class="line"><span style="color:#D8DEE9;">myReadableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 现在流已经结束了，如果我们再次尝试推送数据，就会出错</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  myReadableStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_STREAM_PUSH_AFTER_EOF 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们创建了一个可读流 <code>myReadableStream</code>，然后推送了一些数据 &#39;hello&#39;，接着通过推送 <code>null</code> 来告诉流已经没有更多的数据了（这就是发送 EOF 信号）。如果在发送 EOF 信号后我们再尝试推送新的数据 (&#39;world&#39;)，Node.js 就会抛出 <code>ERR_STREAM_PUSH_AFTER_EOF</code> 错误，因为我们违反了流的规则。</p><p>如果遇到这个错误，你应该检查代码，确保在流结束之后，不要再进行推送数据的操作。这通常意味着你需要在推送 EOF 信号后，对后续的数据推送操作做逻辑上的防护。</p><h3 id="err-stream-unshift-after-end-event" tabindex="-1"><a class="header-anchor" href="#err-stream-unshift-after-end-event"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_unshift_after_end_event" target="_blank" rel="noopener noreferrer">ERR_STREAM_UNSHIFT_AFTER_END_EVENT</a></span></a></h3><p><code>ERR_STREAM_UNSHIFT_AFTER_END_EVENT</code> 是 Node.js 中的一个错误代码，表示在流（stream）已经结束之后，你尝试向它添加（unshift）数据。在 Node.js 中，流是用于处理数据的抽象接口，比如读取文件、网络通信等。</p><p>在 Node.js 的流中，有四种基本类型的流：</p><ol><li>Readable - 用来读取数据。</li><li>Writable - 用来写入数据。</li><li>Duplex - 可以同时读取和写入数据。</li><li>Transform - 是一种特殊的 Duplex 流，在写入和读出数据时可以修改或转换数据。</li></ol><p>现在，想象一下我们有一个可读流（Readable Stream），它就像从一个水龙头流出水一样，你可以从中读取数据。当所有的数据都读取完毕时，会发出一个 <code>&#39;end&#39;</code> 事件，表示没有更多的数据可以读取了，流已经结束。</p><p>但如果在这个 <code>&#39;end&#39;</code> 事件之后，你尝试使用 <code>unshift</code> 方法将数据放回到流的开始部分，这就相当于你试图向已经关掉并且空了的水管里加水。Node.js 认为这是不允许的操作，因此会抛出 <code>ERR_STREAM_UNSHIFT_AFTER_END_EVENT</code> 错误。</p><p>让我们通过一个简单的例子来解释这一过程：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Readable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的可读流实例。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Readable</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 实现 _read 方法，但在这个例子中我们不需要它做任何事情。</span></span>
<span class="line"><span style="color:#88C0D0;">  read</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {},</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听 &#39;data&#39; 事件来读取数据。</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">接收到数据：</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">chunk</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听 &#39;end&#39; 事件表示数据已经读取完毕。</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">没有更多数据了。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试在 &#39;end&#39; 事件之后使用 unshift 方法。</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">unshift</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">额外的数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 这里会捕获错误，因为在 &#39;end&#39; 事件之后不能 unshift 数据。</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">出错了: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 向流中推送一些数据。</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 表示没有更多的数据需要被推送，这将触发 &#39;end&#39; 事件。</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码演示了创建一个可读流，并向其中推送了两次数据。然后通过调用 <code>myStream.push(null)</code> 来表示没有更多数据了。这将导致 <code>&#39;end&#39;</code> 事件被触发，输出 &quot;没有更多数据了。&quot;。紧接着，我们尝试使用 <code>unshift</code> 方法将数据放回流中，这将引起 <code>ERR_STREAM_UNSHIFT_AFTER_END_EVENT</code> 错误。</p><p>在实际应用中，你可能很少见到直接使用 <code>unshift</code> 方法，因为倾向于使用流的其他方法来处理数据。然而，如果你正在开发与流相关的库或者工具，了解这类错误及其背景是很重要的。</p><h3 id="err-stream-wrap" tabindex="-1"><a class="header-anchor" href="#err-stream-wrap"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_wrap" target="_blank" rel="noopener noreferrer">ERR_STREAM_WRAP</a></span></a></h3><p><code>ERR_STREAM_WRAP</code>是 Node.js 中的一个错误码，用于表示特定类型的流（stream）相关错误。在 Node.js 中，流是处理数据如读取或写入操作的抽象接口，它可以是来自文件、网络通信或其他源的数据。</p><p>这个错误通常在内部模块调用时发生，比如当某个内部操作期望得到一个流对象但实际上却没有得到时。用户端可能很少直接遇到这种错误，因为它与 Node.js 内部实现的细节有关。</p><p>举例说明：</p><p>假设我们正在尝试使用 HTTP 模块创建一个服务器，然后想要包装一个原始的套接字（socket）为 Node.js 流。如果在这个过程中执行了不正确的操作或者传递了一个不能正确转换为流的对象，那么就可能触发<code>ERR_STREAM_WRAP</code>错误。</p><p>下面的示例代码展示了一个简化的情景，虽然不是真正的实际应用，但可以帮助理解错误发生的情况：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">upgrade</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> socket</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> head</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们在这里进行一些操作，意图把socket包装成一个特殊的流对象</span></span>
<span class="line"><span style="color:#616E88;">  // 但是我们错误地将一个不支持流接口的对象传递给了包装函数</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> notAStream</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这只是一个普通对象，不是流</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 假设的包装函数，这里会尝试把notAStream当作流来操作</span></span>
<span class="line"><span style="color:#616E88;">  // 在真实的Node.js API中，这样的操作可能导致抛出ERR_STREAM_WRAP错误</span></span>
<span class="line"><span style="color:#88C0D0;">  wrapAsStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">notAStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里的wrapAsStream函数是假设的，实际上可能是Node.js内部的一些方法</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> wrapAsStream</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设的逻辑，检查obj是否是一个流对象</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">obj</span><span style="color:#81A1C1;"> instanceof</span><span style="color:#D8DEE9FF;"> require(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_STREAM_WRAP</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出这个错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 其他包装逻辑...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述代码中，当客户端请求进行协议升级（例如切换到 WebSockets）时，我们监听了<code>upgrade</code>事件。在事件处理函数中，我们本意是对<code>socket</code>进行某种包装，但是错误地传递了一个非流对象<code>notAStream</code>。在这个假设的<code>wrapAsStream</code>函数中，我们检查传递的对象是否为流，如果不是，我们抛出了一个<code>ERR_STREAM_WRAP</code>类型的错误。再次强调，这只是一个示例，实际 Node.js 中并不会直接这样使用。</p><p>在日常开发中，你很可能永远不会直接遇到<code>ERR_STREAM_WRAP</code>，因为这通常表示 Node.js 内部的错误或者是底层库的问题，而不是你的代码逻辑问题。如果你确实遇到了这个错误，最好检查你的代码看看是否有不当的流操作，或者查找相关的 Node.js bug 报告以确认是不是 Node.js 本身的问题。</p><h3 id="err-stream-write-after-end" tabindex="-1"><a class="header-anchor" href="#err-stream-write-after-end"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_write_after_end" target="_blank" rel="noopener noreferrer">ERR_STREAM_WRITE_AFTER_END</a></span></a></h3><p>当你在 Node.js 中使用流（Streams）时，会遇到很多不同类型的错误，其中一种就是<code>ERR_STREAM_WRITE_AFTER_END</code>错误。这个错误发生在尝试向一个已经关闭了的写入流（Writable Stream）中继续写入数据时。</p><p>在 Node.js 中，流分为可读(Streams.Readable)、可写(Streams.Writable)、双向(Streams.Duplex)和转换流(Streams.Transform)。可写流允许你向某个目标写入数据，比如文件、HTTP 响应或者任何其他类型的消费者。</p><p>举个例子，如果你在写一个文件，一旦调用了<code>stream.end()</code>方法，你就标志了这个写入过程的结束，之后你就不能再向这个流中写入任何数据了。如果你试图这么做，Node.js 将抛出<code>ERR_STREAM_WRITE_AFTER_END</code>错误。</p><p>下面是一个造成<code>ERR_STREAM_WRITE_AFTER_END</code>错误的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可以写入的流，写入到文件output.txt中</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> stream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">output.txt</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 写入&#39;Hello, World!&#39;到output.txt</span></span>
<span class="line"><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">### [ERR_STRING_TOO_LONG](https://nodejs.org/docs/latest/api/errors.html#err_string_too_long</span><span style="color:#D8DEE9;">)</span></span>
<span class="line"><span style="color:#D8DEE9;">好的</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">让我来为你详细解释一下</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> 中</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">ERR_STRING_TOO_LONG</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> 这个错误</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">在</span><span style="color:#D8DEE9;"> JavaScript</span><span style="color:#D8DEE9;"> 中</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">字符串是用来表示文本数据的一种数据类型</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">然而</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">由于内存和性能的限制</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">JavaScript</span><span style="color:#D8DEE9FF;">（</span><span style="color:#D8DEE9;">以及运行它的</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> 环境</span><span style="color:#D8DEE9FF;">）</span><span style="color:#D8DEE9;">对可以创建的最大字符串长度有一个上限</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">当你尝试创建或处理一个超过这个最大长度限制的字符串时</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> 就会抛出</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">ERR_STRING_TOO_LONG</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> 错误</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">这个错误是告诉你</span><span style="color:#D8DEE9FF;">：</span><span style="color:#D8DEE9;">你操作的字符串太长了</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> 无法处理它</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">实际上</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">这个错误在日常开发中不太常见</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">因为这个长度限制相当大</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">通常只有在处理非常大的数据集时才会遇到</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">举个例子</span><span style="color:#D8DEE9FF;">：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">假设</span><span style="color:#D8DEE9;"> Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js</span><span style="color:#D8DEE9;"> 的最大字符串长度限制是</span><span style="color:#B48EAD;"> 2</span><span style="color:#81A1C1;">^</span><span style="color:#B48EAD;">28</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;">（</span><span style="color:#D8DEE9;">这个数值只是假设</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">实际的最大长度可能更大或者更小</span><span style="color:#D8DEE9FF;">），</span><span style="color:#D8DEE9;">那么如果你尝试创建一个更长的字符串</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">比如这样</span><span style="color:#D8DEE9FF;">：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4;">```</span><span style="color:#A3BE8C;">javascript</span></span>
<span class="line"><span style="color:#A3BE8C;">let longString = &#39;a&#39;.repeat(Math.pow(2, 28)); // 重复 &#39;a&#39; 到达了极限长度</span></span>
<span class="line"><span style="color:#A3BE8C;">longString += &#39;extra characters&#39;; // 试图加上额外的字符</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在第二行代码执行时，你将会得到 <code>ERR_STRING_TOO_LONG</code> 错误，因为 <code>longString</code> 已经达到了 Node.js 能够处理的字符串的最大长度，再添加任何字符都会触发这个错误。</p><p>现实中遇到这个错误的情况可能包括：</p><ol><li>读取非常大的文件内容到一个字符串中。</li><li>处理巨大的日志数据。</li><li>构建大型的 JSON 字符串。</li></ol><p>如果你遇到了这个错误，你可能需要重新考虑你的应用程序设计，使用流(Streams)处理数据，或者将数据分割成更小的部分来处理，而不是一次性加载到一个巨大的字符串中。</p><h3 id="err-synthetic" tabindex="-1"><a class="header-anchor" href="#err-synthetic"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_synthetic" target="_blank" rel="noopener noreferrer">ERR_SYNTHETIC</a></span></a></h3><p><code>ERR_SYNTHETIC</code> 是 Node.js 中的一个错误代码，它用于表示一个“合成”的错误，也就是说这个错误不是由底层操作系统产生的，而是由 Node.js 运行时自己生成的。合成错误通常用来模拟系统级别的错误，或者在某些情况下显式地向开发者报告一个异常。</p><h3 id="详细解释" tabindex="-1"><a class="header-anchor" href="#详细解释"><span>详细解释</span></a></h3><p>在编程中，错误处理是非常关键的一部分，因为它帮助我们理解程序中出现了什么问题，并且能够适当地响应这些问题。在 Node.js 中，大部分错误都是由实际的系统调用产生的，比如文件读写失败、网络请求失败等。然而，有些时候，Node.js 需要表达一种错误状态，但这种状态并非来源于系统调用，此时就会用到合成错误。</p><p>合</p><h3 id="err-system-error" tabindex="-1"><a class="header-anchor" href="#err-system-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_system_error" target="_blank" rel="noopener noreferrer">ERR_SYSTEM_ERROR</a></span></a></h3><p>当你在编写 Node.js 程序时，可能会遇到各种错误和异常，它们可以帮助你理解什么地方出了问题。在 Node.js 中有一个特殊的错误类型叫做<code>ERR_SYSTEM_ERROR</code>。这个错误通常与底层操作系统的异常有关。</p><h3 id="什么是-err-system-error" tabindex="-1"><a class="header-anchor" href="#什么是-err-system-error"><span>什么是 <code>ERR_SYSTEM_ERROR</code>？</span></a></h3><p><code>ERR_SYSTEM_ERROR</code> 是一个表示操作系统级别错误的代码。当 Node.js 尝试执行某些与操作系统交互的操作（例如文件访问、网络通信等）时，如果操作系统返回了不符合预期的结果，Node.js 就会抛出这个错误。这意味着问题通常不在您的代码中，而是在更深层次的系统调用中。</p><h3 id="err-system-error-的原因" tabindex="-1"><a class="header-anchor" href="#err-system-error-的原因"><span><code>ERR_SYSTEM_ERROR</code> 的原因</span></a></h3><p>常见的引起<code>ERR_SYSTEM_ERROR</code>的原因包括：</p><ul><li>文件系统问题：比如权限不足、磁盘空间不足、文件锁定或文件不存在。</li><li>网络问题：比如网络连接中断、端口已被占用、DNS 解析失败。</li><li>操作系统限制：比如打开文件数量超过系统限制。</li></ul><h3 id="实际运用的例子-15" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-15"><span>实际运用的例子</span></a></h3><h4 id="示例-1-文件系统访问" tabindex="-1"><a class="header-anchor" href="#示例-1-文件系统访问"><span>示例 1：文件系统访问</span></a></h4><p>假设你有一个 Node.js 脚本，它试图读取一个不存在的文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果文件不存在，操作系统会告诉 Node.js 无法找到该文件，然后 Node.js 会抛出一个<code>ERR_SYSTEM_ERROR</code>错误。</p><h4 id="示例-2-网络请求" tabindex="-1"><a class="header-anchor" href="#示例-2-网络请求"><span>示例 2：网络请求</span></a></h4><p>考虑你正在创建一个 Web 服务器，并且尝试监听一个已经被其他应用占用的端口：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">80</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://127.0.0.1:80/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果端口 80 已经被占用，Node.js 将无法在该端口上启动服务器，并可能抛出<code>ERR_SYSTEM_ERROR</code>，表明系统级别的错误阻止了服务器的正常启动。</p><h3 id="处理-err-system-error" tabindex="-1"><a class="header-anchor" href="#处理-err-system-error"><span>处理 <code>ERR_SYSTEM_ERROR</code></span></a></h3><p>处理这类错误的策略依赖于具体的错误情况。一般来说，你可以检查错误对象的属性来获取更多信息，并根据这些信息采取合适的措施，例如更换端口号、清理磁盘空间或修改文件权限等。</p><p>最终，理解并处理<code>ERR_SYSTEM_ERROR</code>需要你对操作系统和 Node.js 的运作有一定的了解，并能够根据错误的具体情况作出反应。在实际开发过程中，详细的错误日志和文档能够帮助你更快地诊断和修复问题。</p><h3 id="err-tap-lexer-error" tabindex="-1"><a class="header-anchor" href="#err-tap-lexer-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tap_lexer_error" target="_blank" rel="noopener noreferrer">ERR_TAP_LEXER_ERROR</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它通常被用于创建高性能的服务器端应用程序。Node.js 具有异步非阻塞的 I/O 模型，这就意味着它可以处理大量并发连接而不会牺牲性能。</p><p>当你在 Node.js 中遇到<code>ERR_TAP_LEXER_ERROR</code>这个错误时，它通常指的是一个与 TAP（测试任何协议/Test Anything Protocol）输出解析相关的问题。TAP 是一种简单的文本基础协议，用于表示测试结果。这种格式主要被用在软件测试中，尤其是在自动化测试脚本中。</p><p>现在让我们谈谈这个错误可能出现的情况。虽然这种错误在日常开发中相对少见，但它可能会在以下几种场景中出现：</p><ol><li><p><strong>使用 Node.js 进行单元测试</strong>：如果你正在用 Node.js 编写单元测试，并且使用了 TAP 格式输出测试结果，那么如果 TAP 输出内容格式有误，你就可能遇到<code>ERR_TAP_LEXER_ERROR</code>。</p></li><li><p><strong>集成测试系统</strong>：在持续集成（CI）系统中，如果你的测试脚本产生的 TAP 输出不正确，那么 CI 系统在解析这些输出时也可能导致这个错误。</p></li></ol><p>下面通过一个例子来说明这个错误是如何产生的：</p><p>假设你正在使用 Node.js 的一个叫<code>tap</code>的测试框架来写测试。正常情况下，一个测试文件可能长这样：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tap</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">tap</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">tap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">equal</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> +</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">One plus one should equal two</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码段测试了 1 加 1 是否等于 2，并使用了 TAP 输出格式来报告结果。</p><p>如果测试输出没有按照 TAP 的规则来格式化，比如下面这段代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TAP version some-non-standard-content</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上述输出因为包含了&quot;some-non-standard-content&quot;这样的非标准内容，就可能导致 TAP 解析器无法识别格式，从而抛出<code>ERR_TAP_LEXER_ERROR</code>错误。</p><p>要解决这个问题，你需要确保所有 TAP 输出都符合规范。通常，这意味着检查测试脚本，或者修复可能导致格式错误的任何第三方库或工具。如果你使用的是某个特定的测试框架（如<code>tap</code>），请参阅该框架的文档以了解正确的 TAP 输出格式，并确认你的测试输出遵循了这些规则。</p><h3 id="err-tap-parser-error" tabindex="-1"><a class="header-anchor" href="#err-tap-parser-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tap_parser_error" target="_blank" rel="noopener noreferrer">ERR_TAP_PARSER_ERROR</a></span></a></h3><h3 id="err-tap-validation-error" tabindex="-1"><a class="header-anchor" href="#err-tap-validation-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tap_validation_error" target="_blank" rel="noopener noreferrer">ERR_TAP_VALIDATION_ERROR</a></span></a></h3><p>在 Node.js 中，错误代码 <code>ERR_TAP_VALIDATION_ERROR</code> 通常和 TAP (Test Anything Protocol) 相关的工具或库有关。TAP 是一种简单的协议，用于测试框架之间的通信，它输出可读性强的文本格式来表示测试结果。Node.js 中并没有内建支持 TAP，但是很多测试工具（如 tap, tape 等）会使用到这个协议。</p><p>当你看到<code>ERR_TAP_VALIDATION_ERROR</code>这个错误时，它意味着 Node.js 在执行与 TAP 相关的操作时遇到了验证问题。这可能是因为一个测试用例未按照预期的格式输出测试结果，或者是测试框架内部处理出现了问题。</p><p>由于你提到的是 Node.js v21.7.1 中的错误，而在 Node.js 的官方文档中没有直接列出这个错误代码，这说明它很可能是第三方库特定的错误，而不是 Node.js 核心自身的错误。</p><p>举一个实际的例子：假设你正在使用一个支持 TAP 输出的测试框架来运行你的测试脚本，如果测试脚本的输出格式不符合 TAP 规范，例如缺少了必要的字段或者字段内容格式不正确，那么测试框架可能无法正确解析测试结果，并抛出<code>ERR_TAP_VALIDATION_ERROR</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tap</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">tap</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设使用了名为 &#39;tap&#39; 的测试模块</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 一个简单的测试案例，我们故意写错以触发错误</span></span>
<span class="line"><span style="color:#D8DEE9;">tap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">test</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">An example test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">t</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这里我们故意不调用 t.end()，这通常是需要的来告诉tap测试结束了</span></span>
<span class="line"><span style="color:#616E88;">  // 这可能导致 &#39;ERR_TAP_VALIDATION_ERROR&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了解决这个错误，你需要仔细检查和跟踪你的测试代码，确保所有的测试输出都符合 TAP 规范。此外，确认你使用的测试框架或库版本是否和 Node.js 的版本兼容，以及是否有相关的 bug 修复更新。</p><p>如果你刚开始编程，这个错误可能显得比较深奥。但随着你对测试框架和 TAP 协议的了解加深，你将更容易理解和解决这类错误。记住，阅读官方文档和相关库的文档总是解决问题的好方法。</p><h3 id="err-test-failure" tabindex="-1"><a class="header-anchor" href="#err-test-failure"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_test_failure" target="_blank" rel="noopener noreferrer">ERR_TEST_FAILURE</a></span></a></h3><h3 id="err-tls-alpn-callback-invalid-result" tabindex="-1"><a class="header-anchor" href="#err-tls-alpn-callback-invalid-result"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_alpn_callback_invalid_result" target="_blank" rel="noopener noreferrer">ERR_TLS_ALPN_CALLBACK_INVALID_RESULT</a></span></a></h3><p>Node.js 中的<code>ERR_TLS_ALPN_CALLBACK_INVALID_RESULT</code>错误是涉及 TLS（传输层安全协议）和 ALPN（应用层协议协商）的一个特定类型的错误。在我们深入了解这个错误前，让我们先简单了解一下 TLS 和 ALPN 的基础。</p><p><strong>TLS（传输层安全协议）</strong>：<br> TLS 用于在网络连接上提供加密。当你访问一个网站时，如果地址以<code>https://</code>开头，那么这个连接就是通过 TLS 来保护的。TLS 确保数据在从你的浏览器发送到服务器的过程中不会被窃听或篡改。</p><p><strong>ALPN（应用层协议协商）</strong>：<br> ALPN 是 TLS 握手过程的一部分。它允许客户端和服务器协商在 TLS 连接上将要使用的具体应用层协议（如 HTTP/2, HTTP/1.1, spdy 等）。这种协商在 TLS 握手时完成，这意味着没有额外的往返延迟来建立安全连接并开始传输数据。</p><p>现在我们来谈谈<code>ERR_TLS_ALPN_CALLBACK_INVALID_RESULT</code>错误：</p><p>在 Node.js 中，当你使用 TLS 模块创建一个 TLS/SSL 服务器时，你可以定义一个<code>ALPNProtocols</code>选项，这告诉服务器支持哪些协议。同时，你还可以提供一个回调函数来动态决定对每个客户端连接使用哪个协议。</p><p>如果这个回调函数处理得不正确，比如它没有返回一个有效的协议（即它没有返回<code>ALPNProtocols</code>数组中列出的任何一个协议），或者它根本没有返回任何值，或者返回了非字符串的结果，那么 Node.js 就会触发<code>ERR_TLS_ALPN_CALLBACK_INVALID_RESULT</code>错误。</p><p>实际应用的例子：</p><p>假设你正在创建一个支持 HTTP/2 和 HTTP/1.1 的 HTTPS 服务器，并且你想根据客户端的请求来动态选择要使用的协议。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tls</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">tls</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  ALPNProtocols</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">h2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http/1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  SNICallback</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">servername</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> cb</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设我们根据服务器名字做一些逻辑处理来选择协议</span></span>
<span class="line"><span style="color:#616E88;">    // 这里我们直接返回&#39;无效&#39;作为演示，这会导致ERR_TLS_ALPN_CALLBACK_INVALID_RESULT错误</span></span>
<span class="line"><span style="color:#81A1C1;">    let</span><span style="color:#D8DEE9;"> chosenProtocol</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">invalid_protocol</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    cb</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#81A1C1;">      null</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      tls</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">key</span><span style="color:#ECEFF4;">,</span><span style="color:#88C0D0;"> cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> options</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cert</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">      chosenProtocol</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tls</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">server connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">authorized</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">authorized</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">unauthorized</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们在<code>SNICallback</code>中返回了一个不存在于<code>ALPNProtocols</code>数组中的协议字符串<code>&#39;invalid_protocol&#39;</code>。当 Node.js 尝试使用此结果时，它会触发`ERR_TLS_AL</p><h3 id="err-tls-alpn-callback-with-protocols" tabindex="-1"><a class="header-anchor" href="#err-tls-alpn-callback-with-protocols"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_alpn_callback_with_protocols" target="_blank" rel="noopener noreferrer">ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</a></span></a></h3><p>在 Node.js 中，当我们谈论<code>ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</code>错误时，我们实际上是在讨论安全通信的一个特定方面。为了更好地理解这一点，首先我们需要了解 TLS、ALPN 以及它们如何在 Node.js 中运作。</p><h3 id="tls" tabindex="-1"><a class="header-anchor" href="#tls"><span>TLS</span></a></h3><p>TLS（传输层安全协议）是一种加密协议，用于在网络中的两个端点之间提供安全通信。当你访问一个以<code>https://</code>开头的网站时，你就是在使用 TLS。</p><h3 id="alpn" tabindex="-1"><a class="header-anchor" href="#alpn"><span>ALPN</span></a></h3><p>ALPN（应用层协议协商）是 TLS 握手过程的一部分，允许客户端和服务器在建立 TLS 连接时确定将要使用的应用层协议（比如 HTTP/2 或者 HTTP/1.1）。</p><h3 id="err-tls-alpn-callback-with-protocols错误" tabindex="-1"><a class="header-anchor" href="#err-tls-alpn-callback-with-protocols错误"><span><code>ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</code>错误</span></a></h3><p>在 Node.js 中，如果你在使用 TLS 模块，并试图通过编程方式处理 ALPN 协议协商，可能会遇到<code>ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</code>错误。这个错误表示在尝试选择一个 ALPN 协议时出现了问题。通常，这是因为在 TLS 握手期间，在 ALPN 协议选择的回调函数中发送了无效的响应或没有发送任何响应。</p><p>这里我将给出一个简单的示例来说明这一点：</p><p>假设你正在创建一个 HTTPS 服务器，并想要根据客户端支持的协议列表来动态选择 ALPN 协议：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tls</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">tls</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 这是一个自定义函数，用来从客户端提供的协议列表中选择一个协议。</span></span>
<span class="line"><span style="color:#88C0D0;">  ALPNProtocols</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http/1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">h2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 实际上在Node.js里不需要像下面这样写，因为它已经内置了对于ALPN的支持。</span></span>
<span class="line"><span style="color:#616E88;">  // 但如果你确实像下面这样写了，那么就会出现&#39;ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS&#39;错误。</span></span>
<span class="line"><span style="color:#88C0D0;">  selectALPNProtocol</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> function</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">protocols</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 错误处理：不应该在这里调用callback函数，</span></span>
<span class="line"><span style="color:#616E88;">    // 因为Node.js会自动处理ALPN协议的选择。</span></span>
<span class="line"><span style="color:#616E88;">    // 如果你这样做了，就会出现ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS错误。</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http/1.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tls</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">server connected</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9;">    socket</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">authorized</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">authorized</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">unauthorized</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">welcome!</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server bound</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个代码中，如果你不小心提供了一个<code>selectALPNProtocol</code>函数并且在其中调用了回调函数，那么 Node.js 就会抛出<code>ERR_TLS_ALPN_CALLBACK_WITH_PROTOCOLS</code>错误，因为 Node.js 认为你正在试图重写内部的 ALPN 协议选择逻辑，而这个操作是不正确的。</p><p>正确的做法是你只需要提供<code>ALPNProtocols</code>选项，列出你的服务器支持的协议，然后 Node.js 会自动为每个连接选择最合适的协议。</p><h3 id="实际运用" tabindex="-1"><a class="header-anchor" href="#实际运用"><span>实际运用</span></a></h3><ul><li><strong>Web 服务器</strong>：使用 HTTPS 创建一个 Web 服务器，支持多个版本的 HTTP 协议（例如 HTTP/1.1 和 HTTP/2），并且让 Node.js 根据客户端的支持自动选择合适的协议。</li><li><strong>数据库连接</strong>：与支持 TLS 加密的数据库进行安全通信时，也可能需要配置 ALPN 选项，确保使用正确的协议连接数据库。</li><li><strong>微服务架构</strong>：在微服务架构中，很多内部通信需要加密，可以使用 TLS 和 ALPN 来保证这些通信的安全性和协议的正确选择。</li></ul><h3 id="err-tls-cert-altname-format" tabindex="-1"><a class="header-anchor" href="#err-tls-cert-altname-format"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_cert_altname_format" target="_blank" rel="noopener noreferrer">ERR_TLS_CERT_ALTNAME_FORMAT</a></span></a></h3><p>好的，这个错误 <code>ERR_TLS_CERT_ALTNAME_FORMAT</code> 是一个来自 Node.js 的特定错误类型，它和 TLS（传输层安全）协议以及证书有关。TLS 用于在网络上的两个端点之间提供加密连接，这样数据就可以安全地传输。</p><p>在 TLS 握手期间，服务器会向客户端发送其 TLS 证书，该证书包含了服务器的身份信息以及一些其他的重要元素。其中一个元素就是“subject alternative name”（简称 SAN），即主体备用名称。SAN 字段允许证书指定多个名称，比如域名或 IP 地址，这样同一个证书就可以用于多个不同的域名或者服务。</p><p>这个 <code>ERR_TLS_CERT_ALTNAME_FORMAT</code> 错误，就是在 Node.js 在处理 TLS 连接时发现证书中的 SAN 格式不正确时出现的。可能的原因包括：</p><ul><li>SAN 字段的值不符合预期的格式。</li><li>解析 SAN 字段时遇到了编码问题或无法理解的内容。</li></ul><p>我来举几个例子来说明：</p><ol><li><p>假设你正在搭建一个 HTTPS 服务器，并且你自己生成了一个 TLS 证书。如果在创建证书时，SAN 字段被设置成了一个不合法的值（比如，它应该是一个 DNS 名称，但你不小心写成了一段随意的文本），当 Node.js 尝试使用这个证书时，就会抛出 <code>ERR_TLS_CERT_ALTNAME_FORMAT</code> 错误。</p></li><li><p>另外一个例子，可能是你在配置一个 Node.js 应用程序，该程序需要与另一台使用 TLS 的服务器通信。如果该服务器的证书包含了一个格式错误的 SAN，当你的 Node.js 应用尝试连接并验证证书时，同样会遇到这个错误。</p></li></ol><p>处理这个错误的方法通常涉及到检查和修正 TLS 证书的 SAN 字段。这可能需要重新生成证书、使用专业工具检查证书格式或者联系证书颁发机构以解决问题。</p><p>Node.js 的错误机制有助于识别问题，使得开发人员能够采取措施进行调试和修复。当你遇到 <code>ERR_TLS_CERT_ALTNAME_FORMAT</code> 时，首先检查与证书相关的配置，确保所有的域名和 IP 地址都按照正确的格式列在了证书的 SAN 字段里。</p><h3 id="err-tls-cert-altname-invalid" tabindex="-1"><a class="header-anchor" href="#err-tls-cert-altname-invalid"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_cert_altname_invalid" target="_blank" rel="noopener noreferrer">ERR_TLS_CERT_ALTNAME_INVALID</a></span></a></h3><p><code>ERR_TLS_CERT_ALTNAME_INVALID</code> 是一个来自 Node.js 的错误类型，它涉及到 TLS（传输层安全协议）和 SSL（安全套接层）证书。TLS/SSL 是用来在网络上提供加密通信的技术，以确保数据传输的安全性。</p><p>当你使用 HTTPS 或其他需要 TLS/SSL 加密的服务时，服务器需要有一个有效的证书来证明自己的身份，并且确保它是你想要连接的正确服务器。这个证书包含了服务器的信息，例如它的域名（如 <code>example.com</code>）。当证书被创建时，会包括一项叫做&quot;主题备用名称&quot;（Subject Alternative Name, 简称 SAN）的字段，这里会列出所有该证书有效的域名。</p><p>如果你的 Node.js 应用尝试建立一个 HTTPS 连接到某个服务器，而该服务器提供的 TLS/SSL 证书中的 SAN 字段与你尝试连接的域名不匹配，Node.js 就会抛出 <code>ERR_TLS_CERT_ALTNAME_INVALID</code> 错误。现在让我们通过例子来进一步理解这个问题。</p><h3 id="实际运用的例子-16" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-16"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个 Node.js 程序来获取一个网站的内容。你决定使用 <code>https</code> 模块发起一个请求：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">状态码:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>www.example.com</code> 返回的证书中不包含 <code>www.example.com</code> 作为有效的域名，你的程序将打印一个错误，可能就是 <code>ERR_TLS_CERT_ALTNAME_INVALID</code>。</p><h3 id="原因" tabindex="-1"><a class="header-anchor" href="#原因"><span>原因</span></a></h3><ol><li><p><strong>证书仅为 IP 地址</strong>: 如果证书是为 IP 圾示例的，而不是域名，那么当你通过域名访问时，就会导致名称不匹配。</p></li><li><p><strong>证书与子域名不匹配</strong>: 例如，证书可能仅对 <code>example.com</code> 有效但不对 <code>subdomain.example.com</code> 有效。</p></li><li><p><strong>证书已过期</strong>: 一些证书在生成时会包含多个域名，但如果其中之一过期了，也可能导致这个错误。</p></li><li><p><strong>配置问题</strong>: 服务器配置不当，可能导致发送了错误的证书。</p></li></ol><h3 id="解决方法-5" tabindex="-1"><a class="header-anchor" href="#解决方法-5"><span>解决方法</span></a></h3><p>要解决 <code>ERR_TLS_CERT_ALTNAME_INVALID</code> 错误，通常需要从服务器端开始着手：</p><ul><li><strong>更新证书</strong>: 确保证书是最新的，并且包含了所有必要的域名。</li><li><strong>配置检查</strong>: 检查服务器的 TLS/SSL 设置，确保它为客户端提供了正确的证书。</li><li><strong>SAN 字段检查</strong>: 检查证书的 SAN 字段是否正确包含了你想要连接的域名。</li></ul><p>对于客户端来说，如果你确信服务器是可信的，你可以绕过这个错误进行测试（并不推荐在生产环境中这样做，因为这会使通信变得不安全），例如，在 Node.js 中你可以设置一个选项来忽略证书错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">env</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">NODE_TLS_REJECT_UNAUTHORIZED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>记住，永远不要在处理敏感数据的生产环境中忽视证书错误。</p><h3 id="err-tls-dh-param-size" tabindex="-1"><a class="header-anchor" href="#err-tls-dh-param-size"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_dh_param_size" target="_blank" rel="noopener noreferrer">ERR_TLS_DH_PARAM_SIZE</a></span></a></h3><p>在解释 <code>ERR_TLS_DH_PARAM_SIZE</code> 错误之前，我们需要理解一些背景知识。TLS（传输层安全性）是一种加密协议，用来保护网络通信不被恶意用户监听或篡改。DH（Diffie-Hellman）算法是一种密钥交换协议，常用于 TLS 中来安全地在两个通信方之间共享一个密钥。</p><p>当你使用 Node.js 创建一个使用 TLS 的服务器（例如，通过 https 模块）时，你可能会设置 DH 参数，这些参数用于在 TLS 握手期间帮助创建一个安全的连接。但是，为了确保连接的安全性，DH 参数必须足够大。历史上，这可能是 512 位或 1024 位，但随着计算能力的提高，这些大小已经不再安全。</p><p>现代系统通常推荐至少 2048 位的 DH 参数长度。<code>ERR_TLS_DH_PARAM_SIZE</code> 错误就是指你在使用 Node.js 时设定的 DH 参数大小不够，通常是小于 2048 位，因此 Node.js 给出了这个错误提示，告诉你需要增加 DH 参数的大小以确保 TLS 连接的安全性。</p><p>下面举一个实际的例子：</p><p>假设你正在用 Node.js 的<code>https</code>模块启动一个 HTTPS 服务器，并且你要配置自己的 Diffie-Hellman 参数。这里有一段示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取证书文件和私钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">server-cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 创建并设置DH参数，注意这里如果设置的是1024位，则会引发ERR_TLS_DH_PARAM_SIZE错误</span></span>
<span class="line"><span style="color:#616E88;">  // 因为它小于建议的2048位</span></span>
<span class="line"><span style="color:#88C0D0;">  dhparam</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDiffieHellman</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试用<code>crypto.createDiffieHellman</code>方法来生成 1024 位的 DH 参数。如果 Node.js 版本对 DH 参数的最小长度有更高的要求（比如至少 2048 位），那么在尝试启动这个服务器时，你将会遇到<code>ERR_TLS_DH_PARAM_SIZE</code>错误。解决这个问题的方法是增加 DH 参数的位数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ...前面的代码相同</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 修改这里，使用2048位或更高的DH参数</span></span>
<span class="line"><span style="color:#D8DEE9FF;">dhparam</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createDiffieHellman</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2048</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">generateKeys</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...后面的代码相同</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过调整参数位数，这个错误应该会消失，你的 TLS 服务器就能使用更加安全的 DH 参数来运行了。</p><h3 id="err-tls-handshake-timeout" tabindex="-1"><a class="header-anchor" href="#err-tls-handshake-timeout"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_handshake_timeout" target="_blank" rel="noopener noreferrer">ERR_TLS_HANDSHAKE_TIMEOUT</a></span></a></h3><p>好的，我会直接进入主题。</p><p><code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 是 Node.js 中的一个错误代码，表示在 TLS 握手过程中发生了超时。TLS，全称为传输层安全协议（Transport Layer Security），是一种用于在网络通信中提供隐私和数据完整性的加密协议。TLS 握手是建立加密通信链接的一个初始步骤，这个过程包括身份验证、协商加密算法、交换密钥信息等。</p><p>当你使用 Node.js 编写代码，并且涉及到需要通过 HTTPS 或其他 TLS 加密方式进行通信的情况时，比如请求一个网站或者与服务器进行数据传输，Node.js 会自动处理 TLS 握手的过程。</p><p>如果在这个握手阶段服务器没有在预定的时间内响应，Node.js 会抛出 <code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 错误。这个超时时间可能因为网络延迟、服务端响应慢或者服务器过载等多种原因而导致。</p><p>让我们来看几个可能遇到 <code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 的实际场景：</p><ol><li><strong>HTTPS 请求</strong>: 假设你正在尝试连接到一个 HTTPS 服务，可以使用 Node.js 的 <code>https</code> 模块发起请求。如果服务器处理请求的速度很慢或者无法及时响应，那么可能会引发 <code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 错误。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 443</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">出现问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>WebSocket 连接</strong>: 如果你使用 WebSocket 并且连接到一个 wss:// URL（即通过 TLS 加密的 WebSocket），也有可能遇到这个错误。WebSocket 客户端将尝试与服务器完成 TLS 握手，如果服务器响应太慢，就会超时。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> WebSocket</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ws</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> ws</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> WebSocket</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">wss://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">open</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> open</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">连接成功！</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">ws</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">连接时出现问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>创建 HTTPS 服务</strong>: 当你使用 Node.js 创建一个 HTTPS 服务器，客户端连接到这个服务器时也需要完成 TLS 握手。如果你的服务器不是很稳定或者由于某些原因无法及时完成握手，客户端可能会报告 <code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 错误。</li></ol><p>解决 <code>ERR_TLS_HANDSHAKE_TIMEOUT</code> 错误的方法通常包括检查和优化网络连接、确保服务器性能稳定以及调整超时设置。但请注意，增加超时时间并非解决问题的根本办法，更重要的是找出为什么会出现超时并解决潜在问题。</p><h3 id="err-tls-invalid-context" tabindex="-1"><a class="header-anchor" href="#err-tls-invalid-context"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_invalid_context" target="_blank" rel="noopener noreferrer">ERR_TLS_INVALID_CONTEXT</a></span></a></h3><p><code>ERR_TLS_INVALID_CONTEXT</code> 是一个错误类型，它在 Node.js 中表示有关 TLS（传输层安全性）的某个操作无法正确执行，因为其上下文（也就是用于该操作的数据或状态）不合法或者配置有误。</p><p>TLS 是一种加密协议，广泛应用于互联网通信过程中，以确保数据传输的安全性。比如，当你在浏览器中访问一个以 &quot;https://&quot; 开头的网站时，该网站与你的浏览器之间的数据交换就是通过 TLS 加密的。</p><p>在 Node.js 中，如果你在运行涉及到 TLS 的程序代码时遇到了 <code>ERR_TLS_INVALID_CONTEXT</code> 错误，这通常意味着你试图使用某些 TLS 相关功能，但是提供给这个功能的数据或设置不正确，导致 Node.js 不能正确执行相关的加密或解密操作。</p><h3 id="实际运用的例子-17" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-17"><span>实际运用的例子</span></a></h3><p>举个实际的例子来说明这个问题：</p><p>假设你正在编写一个 Node.js 程序，该程序需要创建一个 HTTPS 服务器，客户端可以通过 HTTPS 协议安全地与之通信。为此，你需要创建一个包含私钥和证书的 TLS 上下文。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 准备 TLS/SSL 证书和私钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">privkey.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建 HTTPS 服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们读取了存储在本地文件系统上的私钥 (<code>privkey.pem</code>) 和证书 (<code>cert.pem</code>)，然后创建了一个 HTTPS 服务器。如果这些文件不存在、格式不正确，或者不匹配，则尝试创建服务器时会抛出 <code>ERR_TLS_INVALID_CONTEXT</code> 错误。</p><p>例如，如果 <code>privkey.pem</code> 文件损坏或不是有效的私钥格式，Node.js 就无法使用它来建立安全的 TLS 上下文，进而无法启动 HTTPS 服务器。这将导致 <code>ERR_TLS_INVALID_CONTEXT</code> 错误的出现。</p><p>要解决这个问题，你需要确保提供给 <code>https.createServer</code> 函数的 <code>options</code> 对象中的 <code>key</code> 和 <code>cert</code> 属性指向有效的、格式正确的、且相互匹配的私钥和证书文件。</p><p>以上就是关于 <code>ERR_TLS_INVALID_CONTEXT</code> 错误在 Node.js 中的解释，以及一个可能遇到此错误的实际例子和解决方案。记住，在处理 TLS 或 SSL 时，总是要非常小心地确认所有的凭据和配置都是正确无误的。</p><h3 id="err-tls-invalid-protocol-method" tabindex="-1"><a class="header-anchor" href="#err-tls-invalid-protocol-method"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_invalid_protocol_method" target="_blank" rel="noopener noreferrer">ERR_TLS_INVALID_PROTOCOL_METHOD</a></span></a></h3><p>好的，让我们来聊一聊 Node.js 中的一个错误类型：<code>ERR_TLS_INVALID_PROTOCOL_METHOD</code>。</p><p>首先，要了解这个错误，我们需要知道 TLS 是什么。TLS（传输层安全）协议是用于在网络上进行安全通信的标准。当你访问一个使用 HTTPS 的网站时，就是在使用 TLS。它帮助保护你的数据不被其他人窃取或篡改。</p><p>Node.js 中的<code>ERR_TLS_INVALID_PROTOCOL_METHOD</code>错误会在 TLS 设置不正确时发生。具体来说，当你尝试创建一个安全的服务器或客户端，并为它指定了一个非法的协议方法时，会出现这个错误。</p><p>举个例子，假设你正在编写代码，想要启动一个 HTTPS 服务器。在 Node.js 中，你可能会使用<code>https</code>模块。当你配置这个服务器时，你需要指定一些 TLS 的选项，比如使用哪个版本的 TLS 协议。如果你提供了一个 Node.js 不支持的值，就会抛出<code>ERR_TLS_INVALID_PROTOCOL_METHOD</code>错误。</p><p>下面是一个示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取证书和私钥</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  secureProtocol</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1_method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 假设我们这里使用的是TLSv1</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTPS服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 Node.js 版本不再支持<code>TLSv1_method</code>（因为它很老旧，可能已经不安全），尝试运行这段代码就会导致<code>ERR_TLS_INVALID_PROTOCOL_METHOD</code>错误。你需要将<code>secureProtocol</code>改成有效的值，比如<code>&#39;TLSv1_2_method&#39;</code>来使用 TLS 版本 1.2，这是目前普遍认为安全的版本。</p><p>修正后的代码片段可能如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">cert.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  secureProtocol</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1_2_method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 使用TLS版本1.2</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实际开发中，我们很少需要手动指定使用哪个版本的 TLS 协议，因为 Node.js 会默认选择合适的版本。但是，如果你在特殊情况下需要这样做，请确保你选择的协议方法是当前 Node.js 版本所支持的。如果你不确定，可以查阅 Node.js 的文档或者使用默认设置。</p><h3 id="err-tls-invalid-protocol-version" tabindex="-1"><a class="header-anchor" href="#err-tls-invalid-protocol-version"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_invalid_protocol_version" target="_blank" rel="noopener noreferrer">ERR_TLS_INVALID_PROTOCOL_VERSION</a></span></a></h3><p>在 Node.js 中，<code>ERR_TLS_INVALID_PROTOCOL_VERSION</code> 是一个错误代码，表示尝试使用的 TLS（传输层安全性）协议版本不被支持。TLS 协议用于在客户端和服务器之间提供加密通信，确保数据传输的隐私和完整性。</p><p>这个错误通常在如下情况中出现：</p><ol><li>当你的 Node.js 服务尝试连接到另一个服务时，但是那个服务要求使用的 TLS 版本高于你的 Node.js 客户端所支持的版本。</li><li>或者，当你的 Node.js 服务器设置了特定的 TLS 版本限制，但是有客户端试图使用不被支持的更早版本来建立连接。</li></ol><p>对于第一个例子，假设你的 Node.js 客户端运行在一个旧版本上，它只支持 TLS 1.0，而你试图连接到的远程服务器已经配置为只接受 TLS 1.2 及以上版本的连接，这时就会发生 <code>ERR_TLS_INVALID_PROTOCOL_VERSION</code> 错误。</p><p>举个具体的代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 一个需要 TLS 1.2 的服务器地址</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 443</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  secureProtocol</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1_method</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 强制使用 TLS 1.0</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 如果 example.com 不支持 TLS 1.0 这里会打印 ERR_TLS_INVALID_PROTOCOL_VERSION 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们通过指定 <code>secureProtocol</code> 选项来强制 HTTPS 请求使用 TLS 1.0。如果服务器不允许这个版本的 TLS，我们就会看到 <code>ERR_TLS_INVALID_PROTOCOL_VERSION</code> 错误。</p><p>解决这类问题的方式通常包括：</p><ul><li>更新你的 Node.js 客户端至最新版本以支持较新的 TLS 协议。</li><li>如果你控制着服务器，可以将服务器配置为也支持较老的 TLS 版本（虽然出于安全考虑这通常不推荐）。</li></ul><p>总结一下，<code>ERR_TLS_INVALID_PROTOCOL_VERSION</code> 指出了一个关于 TLS 协议版本兼容性的问题。修正这个问题涉及确认并同步客户端与服务器端所支持的 TLS 版本。</p><h3 id="err-tls-invalid-state" tabindex="-1"><a class="header-anchor" href="#err-tls-invalid-state"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_invalid_state" target="_blank" rel="noopener noreferrer">ERR_TLS_INVALID_STATE</a></span></a></h3><h3 id="err-tls-protocol-version-conflict" tabindex="-1"><a class="header-anchor" href="#err-tls-protocol-version-conflict"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_protocol_version_conflict" target="_blank" rel="noopener noreferrer">ERR_TLS_PROTOCOL_VERSION_CONFLICT</a></span></a></h3><p>当你使用 Node.js 进行网络编程时，比如创建一个 HTTPS 服务器或者客户端，你会涉及到 TLS（传输层安全协议），这是一种保护网络通信免受窃听和篡改的标准技术。TLS 有不同的版本，随着时间推移，新版本带来了更好的安全性和功能。</p><p>在 Node.js 中，有时你可能需要指定使用哪个版本的 TLS 进行通信。例如，你可能有一个要求使用 TLS 1.2 版本的外部服务，或者你想确保你的服务器只接受使用较新 TLS 版本的连接。</p><p><code>ERR_TLS_PROTOCOL_VERSION_CONFLICT</code>错误发生在 Node.js 中你尝试设置不兼容的 TLS 协议版本时。也就是说，如果你同时试图强制 Node.js 使用两个不同的 TLS 版本，Node.js 就会抛出这个错误，因为它不能同时满足两个相互冲突的要求。</p><p>以下是造成<code>ERR_TLS_PROTOCOL_VERSION_CONFLICT</code>错误的一个实际例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取证书文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">private-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">certificate.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 指定使用TLS版本为TLSv1.2</span></span>
<span class="line"><span style="color:#88C0D0;">  minVersion</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1.2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 同时也指定最小支持版本为TLSv1.3，这会产生冲突！</span></span>
<span class="line"><span style="color:#88C0D0;">  maxVersion</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1.3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTPS服务器</span></span>
<span class="line"><span style="color:#D8DEE9;">https</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们试图创建一个安全的 HTTP 服务器。我们设置了 TLS 的最小版本为 TLS 1.2，但同时又将最大版本设置为 TLS 1.3。这意味着无法同时兼容这两个设置，因为它们之间存在冲突：你不能同时要求连接必须是 TLS 1.2 而又不能高于 TLS 1.3。这就像你告诉某人他们必须至少 6 英尺高但不能超过 5 英尺 10 英寸高一样——这是不可能的。</p><p>解决<code>ERR_TLS_PROTOCOL_VERSION_CONFLICT</code>错误通常很简单：只需确保你没有设置冲突的 TLS 版本要求。按照前面的例子，如果你想要服务器支持 TLS 1.2 和 TLS 1.3，你可以这样设置：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">private-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">certificate.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 设置最小支持版本为TLSv1.2</span></span>
<span class="line"><span style="color:#88C0D0;">  minVersion</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1.2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">  // 设置最大支持版本为TLSv1.3</span></span>
<span class="line"><span style="color:#88C0D0;">  maxVersion</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">TLSv1.3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在没有冲突，因为 TLS 1.2 和 TLS 1.3 之间的所有版本都是被接受的。记住，TLS 的版本选择应该基于你需要支持的客户端以及安全性需求。通常情况下，推荐使用最新的 TLS 版本，因为它提供了最好的安全保护。</p><h3 id="err-tls-psk-set-identiy-hint-failed" tabindex="-1"><a class="header-anchor" href="#err-tls-psk-set-identiy-hint-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_psk_set_identiy_hint_failed" target="_blank" rel="noopener noreferrer">ERR_TLS_PSK_SET_IDENTIY_HINT_FAILED</a></span></a></h3><p><code>ERR_TLS_PSK_SET_IDENTIY_HINT_FAILED</code> 是一个特定于 Node.js 的错误代码，它关联于 TLS（传输层安全）协议中的预共享密钥（PSK）身份提示设置失败的情况。</p><p>首先来解释一下涉及到的几个概念：</p><ol><li><p><strong>TLS (传输层安全)</strong>：这是一种加密通讯协议，旨在为网络通信提供安全性。当你访问一个 HTTPS 网站时，就是在使用 TLS。</p></li><li><p><strong>预共享密钥 (PSK)</strong>：在 TLS 协议中，预共享密钥是一种身份验证方法，它涉及到双方事先分享一个密钥（password-like secret），然后用这个密钥作为认证过程的一部分。</p></li><li><p>**身份提示</p></li></ol><h3 id="err-tls-renegotiation-disabled" tabindex="-1"><a class="header-anchor" href="#err-tls-renegotiation-disabled"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_renegotiation_disabled" target="_blank" rel="noopener noreferrer">ERR_TLS_RENEGOTIATION_DISABLED</a></span></a></h3><h3 id="err-tls-required-server-name" tabindex="-1"><a class="header-anchor" href="#err-tls-required-server-name"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_required_server_name" target="_blank" rel="noopener noreferrer">ERR_TLS_REQUIRED_SERVER_NAME</a></span></a></h3><p>当你在 Node.js 中使用安全的网络协议（比如 HTTPS）建立一个服务器时，你可能需要配置 TLS（传输层安全协议）。这是为了确保数据在客户端和服务器之间传输过程中的加密和安全。</p><p><code>ERR_TLS_REQUIRED_SERVER_NAME</code> 这个错误通常发生在你尝试创建一个使用 TLS 的服务器，但是没有正确地指定“服务器名称”（server name）或者说是“域名”（domain name）时。在 TLS 握手过程中，客户端会通过 Server Name Indication (SNI)来告诉服务器想要连接到的主机名。如果服务器没办法获取这个信息，就会抛出<code>ERR_TLS_REQUIRED_SERVER_NAME</code>错误。</p><p>让我们用一个例子来说明这个概念：</p><p>假设你正在创建一个简单的 HTTPS 服务器。在 Node.js 中，你可以使用<code>https</code>模块来实现这一点。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取密钥和证书文件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-private-key.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">your-certificate.pem</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTPS服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们首先加载了<code>https</code>模块，并且读取了私钥和证书文件（这些是生成 TLS 加密连接所必需的）。然后我们创建了一个 HTTPS 服务器，它可以处理请求并响应&quot;hello world&quot;。</p><p>正常情况下，如果你的程序配置正确，这段代码将能够顺利运行。但如果你的环境或代码中缺少了 SNI 相关的配置，那么当客户端尝试连接这个服务器而没有提供期望连接的服务器名称时，你可能会遇到<code>ERR_TLS_REQUIRED_SERVER_NAME</code>错误。</p><p>解决方法是确保客户端提供了一个有效的服务器名称，并且服务器也被正确配置以接收并处理 SNI。对于上述示例，通常服务器名称是由客户端在与服务器建立 TLS 连接时提供的，因此不需要在服务器代码中显式设置。但是，服务器配置必须包含有效的证书，证书里通常包含了域名信息，这样才能匹配客户端提供的服务器名称。</p><p>为了避免这个错误，请确保：</p><ul><li>客户端向服务器发送了正确的服务器名称。</li><li>服务器的 TLS 证书是有效的，并且包含了正确的服务器名称。</li></ul><p>最后，请注意，每当你升级 Node.js 版本时，都需要检查官方文档中关于 TLS 和错误处理的最新指南，因为随着 Node.js 的更新，相关的 API 和错误代码可能会有变动。</p><h3 id="err-tls-session-attack" tabindex="-1"><a class="header-anchor" href="#err-tls-session-attack"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_session_attack" target="_blank" rel="noopener noreferrer">ERR_TLS_SESSION_ATTACK</a></span></a></h3><p><code>ERR_TLS_SESSION_ATTACK</code> 是 Node.js 中的一个错误代码，它表示存在可能的 TLS 会话重放攻击。TLS（传输层安全性）是一种协议，用于在网络通信中提供加密。这样可以保护数据的隐私和完整性，使得第三方很难监听或篡改传输的信息。</p><p>当 TLS 会话被恶意地复制或重新使用时，就有可能发生所谓的“会话攻击”。简单来说，攻击者可能尝试利用之前已经建立的有效会话来伪装成合法用户，访问或窃取敏感信息。</p><p>在 Node.js v21.7.1 中，如果 Node.js 检测到可能的 TLS 会话重放攻击发生，那么它会触发一个 <code>ERR_TLS_SESSION_ATTACK</code> 错误。这通常是由于某些异常行为触发了内部的安全检测机制，比如一个会话标识符（Session ID）或会话票据（Session Ticket）被使用了多次。</p><p>这里举个简化的例子：</p><p>假设 Bob 访问了一个银行网站进行在线交易，并且与银行服务器之间建立了一个安全的 TLS 会话。这个会话有一个唯一的标识符，正常情况下只应该被用一次，以确保通信的安全。</p><p>然而，Alice 是一个攻击者，她设法截获了 Bob 的会话标识符，并尝试使用这个标识符来建立自己的 TLS 会话，伪装成 Bob 与银行服务器通信。</p><p>Node.js 在服务器端运行，如果配置正确，它会监控 TLS 会话的使用。当 Alice 尝试使用 Bob 的会话标识符时，Node.js 便会识别出这个重复使用的会话标识符并认为这是一个会话攻击。因此，Node.js 会抛出一个 <code>ERR_TLS_SESSION_ATTACK</code> 错误，并拒绝建立这个新的会话。</p><p>要处理这样的错误，开发人员需要确保他们的 Node.js 应用程序能够妥善响应这类安全问题，比如记录警告信息，断开与可疑客户端的连接等。</p><p>在实际应用中，大多数情况下你不需要手动处理这个错误，因为 Node.js 的内置 TLS 模块会自动为你管理这些安全风险。但是作为一个编程新手，了解这类潜在的安全问题对你来说是非常有益的。</p><h3 id="err-tls-sni-from-server" tabindex="-1"><a class="header-anchor" href="#err-tls-sni-from-server"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_sni_from_server" target="_blank" rel="noopener noreferrer">ERR_TLS_SNI_FROM_SERVER</a></span></a></h3><p>当你在使用 Node.js 进行网络编程时，尤其是涉及到安全的 HTTPS 协议时，你就可能会接触到 TLS 和 SNI 这两个概念。TLS（传输层安全性协议）是用来加密客户端和服务器之间通信的一个协议，而 SNI（服务器名称指示）是 TLS 的一个扩展，它允许服务器在同一个 IP 地址上托管多个 TLS 证书。</p><p><code>ERR_TLS_SNI_FROM_SERVER</code>错误是在 Node.js 中处理 TLS 连接时可能遇到的一个错误类型。这个错误表示服务器发送了一个意外的 SNI 响应。SNI 是用来告诉服务器客户端打算与哪个域名建立安全连接。举个例子，如果有一个服务器托管着 <code>example.com</code> 和 <code>another-example.com</code> 两个域名，并且每个域名都有自己的 TLS 证书，那么当客户端发起到 <code>example.com</code> 的 HTTPS 请求时，它会在 TLS 握手过程中通过 SNI 字段告诉服务器它期望连接到 <code>example.com</code>。如果服务器不正确地配置或者出现某些问题，它可能会返回与请求的域名不匹配的证书信息，这时客户端会抛出 <code>ERR_TLS_SNI_FROM_SERVER</code> 错误。</p><p>这里有一个简单的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> https</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 443</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> https</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">statusCode:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 处理响应...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_TLS_SNI_FROM_SERVER</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">服务器返回了一个意外的SNI响应</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个 HTTPS 请求到 <code>example.com</code>。如果一切正常，服务器将以状态码等信息作为响应。如果服务器的响应包含了一个错误的 SNI 信息，那么在 <code>&#39;error&#39;</code> 事件处理器中我们将捕获到 <code>ERR_TLS_SNI_FROM_SERVER</code> 错误，并输出一条错误消息。这可以帮助我们调试为什么 TLS 握手失败，并采取相应措施来解决问题。</p><p>一般情况下，这类错误更多是由服务器配置错误引起的，所以如果你是客户端开发人员遇到了这种错误，你可能需要联系服务器管理员来解决这个问题。如果你同时也负责服务器，那就需要检查服务器的 TLS 配置，确保每个域名都有正确的证书，并且服务器能根据客户端的 SNI 请求提供正确的证书。</p><h3 id="err-trace-events-category-required" tabindex="-1"><a class="header-anchor" href="#err-trace-events-category-required"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_trace_events_category_required" target="_blank" rel="noopener noreferrer">ERR_TRACE_EVENTS_CATEGORY_REQUIRED</a></span></a></h3><p>在 Node.js 中，<code>ERR_TRACE_EVENTS_CATEGORY_REQUIRED</code> 是一个错误代码，它表示当你尝试使用 Node.js 的跟踪事件功能时，必须指定至少一个类别。</p><p>跟踪事件是 Node.js 提供的一种性能分析工具，它允许开发者捕捉和记录 Node.js 运行时的各种事件。这对于理解应用程序的行为、进行性能调优和寻找瓶颈非常有用。</p><p>在使用跟踪事件功能时，你需要指定所关注的事件类别，因为 Node.js 可以生成非常多的事件类型，而我们通常只对其中的一部分感兴趣。事件类别可以帮助我们过滤感兴趣的事件，提高分析效率。</p><p>例如，假设我们想要跟踪 Node.js 应用中所有的 HTTP 请求并分析它们。Node.js 里有一个内置模块 <code>trace_events</code> 允许我们做到这点。但是在启动跟踪时，如果我们没有指定任何类别，就会遇到 <code>ERR_TRACE_EVENTS_CATEGORY_REQUIRED</code> 错误。</p><p>以下是一个如何正确使用 <code>trace_events</code> 模块的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> trace_events</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">trace_events</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个跟踪器，并且指定类别为 &#39;node.http&#39;（跟踪HTTP相关事件）</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> tracer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> trace_events</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createTracing</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  categories</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">node.http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 启动跟踪</span></span>
<span class="line"><span style="color:#D8DEE9;">tracer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">enable</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 现在，我们可以进行一些HTTP请求，然后它们会被跟踪</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 当我们完成事件跟踪后，可以禁用它</span></span>
<span class="line"><span style="color:#D8DEE9;">tracer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">disable</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 跟踪信息将被保存到一个文件中，我们可以使用该文件来分析事件</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> traceData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">tracer</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">traceData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 根据获取到的跟踪数据，我们可以进行进一步的性能分析</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，首先我们加载了 <code>trace_events</code> 模块，并通过调用 <code>createTracing</code> 函数创建了一个新的跟踪器对象。在创建跟踪器的时候，我们指定了一个类别：<code>node.http</code>，因为我们只关心 HTTP 相关的事件。</p><p>启用跟踪之后 (<code>tracer.enable()</code>), 我们的 Node.js 应用就开始记录所有指定类别的事件了。当我们完成跟踪并想停止记录时，我们调用 <code>tracer.disable()</code>。然后，我们可以读取和分析保存的跟踪数据，以便更好地理解我们的应用程序在处理 HTTP 请求时的表现。</p><p>如果我们忘记指定类别，或者传递一个空的类别列表，那么在尝试启用跟踪时 Node.js 就会抛出 <code>ERR_TRACE_EVENTS_CATEGORY_REQUIRED</code> 错误，提醒我们需要指定至少一个有效的事件类别才能继续。</p><h3 id="err-trace-events-unavailable" tabindex="-1"><a class="header-anchor" href="#err-trace-events-unavailable"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_trace_events_unavailable" target="_blank" rel="noopener noreferrer">ERR_TRACE_EVENTS_UNAVAILABLE</a></span></a></h3><h3 id="错误概述" tabindex="-1"><a class="header-anchor" href="#错误概述"><span>错误概述</span></a></h3><p>在 Node.js 中，<code>ERR_TRACE_EVENTS_UNAVAILABLE</code>是一个错误代码，它表示无法使用跟踪事件。这通常意味着你尝试启用或使用 Node.js 内置的跟踪功能，但因为一些原因该功能不可用。</p><h3 id="什么是跟踪事件" tabindex="-1"><a class="header-anchor" href="#什么是跟踪事件"><span>什么是跟踪事件？</span></a></h3><p>跟踪事件（Trace Events）是 Node.js 提供的一个性能监测工具，它可以帮助开发者了解程序在运行时的行为。通过跟踪事件，开发者可以收集有关应用程序性能的详细信息，例如函数调用时间、异步操作的执行以及其他系统级事件的日志。</p><h3 id="出现err-trace-events-unavailable的原因" tabindex="-1"><a class="header-anchor" href="#出现err-trace-events-unavailable的原因"><span>出现<code>ERR_TRACE_EVENTS_UNAVAILABLE</code>的原因</span></a></h3><p>可能有几个原因导致跟踪事件不可用：</p><ol><li><strong>编译时禁用</strong>: 如果 Node.js 在编译时没有包含跟踪事件的支持，那么试图使用这一功能将会触发<code>ERR_TRACE_EVENTS_UNAVAILABLE</code>错误。</li><li><strong>运行时限制</strong>: 在某些情况下，即使 Node.js 编译时包括了跟踪事件，运行时的环境也可能阻止这些事件的产生，例如安全策略或资源限制。</li><li><strong>版本问题</strong>: 如果你运行的 Node.js 版本由于某些原因移除了跟踪事件的支持，那么也会看到此错误。</li></ol><h3 id="如何正常使用跟踪事件" tabindex="-1"><a class="header-anchor" href="#如何正常使用跟踪事件"><span>如何正常使用跟踪事件</span></a></h3><p>要使用 Node.js 的跟踪事件功能，你通常需要在启动应用程序时添加特殊的命令行标志，如<code>--trace-events-enabled</code>。这会让 Node.js 在运行时生成一个跟踪文件，你可以用相应的工具分析这个文件。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --trace-events-enabled</span><span style="color:#A3BE8C;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>上面的命令会在运行<code>my-app.js</code>时启用跟踪事件记录，并且生成一个包含跟踪信息的文件。</p><h3 id="实际例子-10" tabindex="-1"><a class="header-anchor" href="#实际例子-10"><span>实际例子</span></a></h3><p>假设我们正在开发一个 Node.js 应用程序，并且想要对其性能进行分析。我们希望记录所有的异步操作来查看哪些部分可能导致性能瓶颈。</p><p>我们可以在启动应用程序时加上<code>--trace-events-enabled</code>标志：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --trace-events-enabled</span><span style="color:#A3BE8C;"> my-performance-intensive-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果 Node.js 配置正确，并且编译时包含了跟踪事件的支持，应用程序将会像平时一样运行，但额外地，它还会记录跟踪事件，并将这些信息保存到一个文件中。当应用程序结束后，我们可以使用专门的工具比如<code>chrome://tracing</code>在 Google Chrome 浏览器中加载生成的跟踪文件（通常是<code>.trace</code>扩展名），进行详细的性能分析。</p><h3 id="应对错误" tabindex="-1"><a class="header-anchor" href="#应对错误"><span>应对错误</span></a></h3><p>如果你在尝试启动具有跟踪事件的 Node.js 应用程序时遇到了<code>ERR_TRACE_EVENTS_UNAVAILABLE</code>错误，那么可能需要检查以下几点：</p><ul><li>确保你使用的 Node.js 版本支持跟踪事件。</li><li>检查 Node.js 是否是用支持跟踪事件的方式编译的。</li><li>查看是否有运行时设置或安全策略阻止了跟踪事件的使用。</li><li>寻找其他替代工具或方法进行性能分析。</li></ul><h3 id="err-transform-already-transforming" tabindex="-1"><a class="header-anchor" href="#err-transform-already-transforming"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_transform_already_transforming" target="_blank" rel="noopener noreferrer">ERR_TRANSFORM_ALREADY_TRANSFORMING</a></span></a></h3><p><code>ERR_TRANSFORM_ALREADY_TRANSFORMING</code>是一个错误类型，它属于 Node.js 中的一种特定的错误情况。这个错误通常发生在使用 Node.js 内置模块<code>stream</code>的<code>Transform</code>流时遇到。让我来更详细地解释一下。</p><p>首先，让我们理解一下什么是<code>Transform</code>流。在 Node.js 中，流（Streams）是处理数据如读写文件、网络通信等 I/O 操作的抽象概念。有四种基本类型的流：<code>Readable</code>、<code>Writable</code>、<code>Duplex</code>和<code>Transform</code>。其中，<code>Transform</code>流是一种特殊类型的<code>Duplex</code>流，它可以同时进行读和写操作，并且在写入和读出之间可以修改或转换数据。</p><p>当你使用<code>Transform</code>流时，你定义了一个<code>_transform</code>方法，这个方法负责处理输入数据并生成输出数据。每次新的数据块准备好被转换时，这个方法就会被调用。</p><p>现在，来看看<code>ERR_TRANSFORM_ALREADY_TRANSFORMING</code>错误。这个错误会发生在以下情况：</p><p>当你试图再次对一个已经正在处理转换任务的<code>Transform</code>流执行转换时。简而言之，就是当<code>_transform</code>方法还没有完成处理上一个数据块时，你又尝试对同一个流添加更多的数据进行转换。</p><p>这样做可能会导致数据处理混乱或者不同步，因此 Node.js 通过抛出<code>ERR_TRANSFORM_ALREADY_TRANSFORMING</code>错误来告诉你：“嘿，这个流当前正在处理转换，你不能在这个时候再次启动转换。”</p><p>下面是一个简单的例子来说明这个错误是怎样发生的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Transform</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个自定义的 Transform 流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myTransformStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Transform</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  transform</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 模拟异步转换过程</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      this</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">push</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toUpperCase</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试连续发送两个数据块到转换流</span></span>
<span class="line"><span style="color:#D8DEE9;">myTransformStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myTransformStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这行代码可能会导致 ERR_TRANSFORM_ALREADY_TRANSFORMING 错误</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 处理流输出</span></span>
<span class="line"><span style="color:#D8DEE9;">myTransformStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 处理流错误</span></span>
<span class="line"><span style="color:#D8DEE9;">myTransformStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Transform stream error:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了一个自定义的<code>Transform</code>流，并且在<code>_transform</code>方法里使用了<code>setTimeout</code>来模拟一个延迟的异步操作。然后，我们连续发送了两个数据块到这个流中。如果第一个数据块的处理（也就是大写转换）还没完成，第二个数据块就被送进来了，那么很可能触发`ERR</p><h3 id="err-transform-with-length-0" tabindex="-1"><a class="header-anchor" href="#err-transform-with-length-0"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_transform_with_length_0" target="_blank" rel="noopener noreferrer">ERR_TRANSFORM_WITH_LENGTH_0</a></span></a></h3><p>在 Node.js 中，<code>ERR_TRANSFORM_WITH_LENGTH_0</code>是一个特定的错误类型，它通常出现在使用流（streams）处理数据时。流是 Node.js 提供的一种处理读写数据的方式，能够高效地处理大文件或者数据流。</p><p>这个错误会发生在使用变换流（Transform streams）时。变换流是一种特殊类型的双工流（Duplex stream），可以在读取和写入数据时进行中间处理，比如压缩、加密或者转换数据格式。</p><p>当你创建一个变换流，并且在其 <code>_transform</code> 方法中调用 <code>callback</code> 函数传递了一个长度为 0 的 Buffer 或者字符串时，就会触发这个<code>ERR_TRANSFORM_WITH_LENGTH_0</code>错误。<code>_transform</code> 方法是你自定义的方法，用来指明如何处理流过的数据。</p><p>下面是一个例子：</p><p>假设你有一个变换流，它应该将所有传递进来的文本转换成大写形式。但是如果某次转换结果是空字符串，就会触发<code>ERR_TRANSFORM_WITH_LENGTH_0</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Transform</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> UppercaseTransform</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Transform</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  _transform</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> encoding</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 将输入数据（chunk）转换为字符串，并转化为大写</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> upperChunk</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toUpperCase</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">    // 如果转换后的字符串为空，则会导致一个 ERR_TRANSFORM_WITH_LENGTH_0 错误</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">upperChunk</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">length </span><span style="color:#81A1C1;">===</span><span style="color:#B48EAD;"> 0</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">      // 正确的做法是检查长度，并不调用callback传递空字符串</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">      // 否则正常传递转换后的数据</span></span>
<span class="line"><span style="color:#88C0D0;">      callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> upperChunk</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个变换流实例</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> uppercaseTransform</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> UppercaseTransform</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 处理数据</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdin</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">uppercaseTransform</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果用户输入的是空字符串或者只包含空白字符（全部被<code>.toUpperCase()</code>处理后长度为 0），按照错误的处理方式我们将触发<code>ERR_TRANSFORM_WITH_LENGTH_0</code>错误。正确的做法是在调用<code>callback</code>时不传递任何数据，即调用<code>callback(null);</code>。</p><p>要解决这个问题，你应该在转换数据并调用<code>callback</code>之前检查数据是否非空（<code>length &gt; 0</code>）。如果是空的，可以选择忽略这部分数据不传递，也可以根据你的应用逻辑决定是否需要结束流或者执行其他操作。</p><h3 id="err-tty-init-failed" tabindex="-1"><a class="header-anchor" href="#err-tty-init-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tty_init_failed" target="_blank" rel="noopener noreferrer">ERR_TTY_INIT_FAILED</a></span></a></h3><p>Node.js 是一个让 JavaScript 可以在服务器端运行的平台。它让 JavaScript 不仅仅能在浏览器中运行，还能用来编写创建网站后台、操作文件系统等各种需要服务器能力的应用。</p><p>在 Node.js 中，应用程序运行时可能会遇到各种错误，这些错误被分成了不同的类型以便于开发者理解和处理。在这里我们要谈的<code>ERR_TTY_INIT_FAILED</code>是 Node.js 的错误之一。</p><p>首先，让我们理解一下 TTY。TTY 是 Teletypewriter（电传打字机）的缩写，在计算机术语中通常指的是终端设备。你可以把它想象成一个窗口，通过这个窗口你可以与运行在计算机上的程序进行交互，比如输入命令和查看输出结果。</p><p>当 Node.js 尝试初始化一个 TTY 接口但是失败时，就会抛出<code>ERR_TTY_INIT_FAILED</code>错误。简单地说，这意味着 Node.js 想要设置或准备一个终端环境，以便程序可以和用户进行交互，但是由于某些原因这个过程没能成功。</p><p>实际例子中可能会遇到这个错误的情况：</p><ol><li><p><strong>操作系统权限问题</strong>：如果你在一个没有足够权限的环境中运行 Node.js 应用程序（比如你需要管理员权限才能执行的操作），那么在尝试初始化 TTY 时可能会失败。</p></li><li><p><strong>环境配置问题</strong>：在某些特定环境下（如 Docker 容器），如果 TTY 没有被正确配置，那么当 Node.js 尝试使用它时也可能会失败。</p></li><li><p><strong>硬件或驱动问题</strong>：在极少数的情况下，如果你的计算机的 TTY 相关硬件或驱动程序存在问题，那么 Node.js 在尝试访问这些资源时也可能会产生这个错误。</p></li></ol><p>要解决<code>ERR_TTY_INIT_FAILED</code>错误，你通常需要检查和确保以下几点：</p><ul><li>你有足够的权限来运行 Node.js 应用程序。</li><li>你的环境（如 Docker 容器）已正确设置了对 TTY 的支持。</li><li>你的操作系统和硬件都在正常工作且没有与 TTY 相关的问题。</li></ul><p>由于你是编程新手，你可能并不经常直接和 TTY 打交道，但如果你在使用 Node.js 的过程中遇到了<code>ERR_TTY_INIT_FAILED</code>错误，现在你知道这是关于终端初始化失败的，而且你有一个基本的起点来探究问题所在。</p><h3 id="err-unavailable-during-exit" tabindex="-1"><a class="header-anchor" href="#err-unavailable-during-exit"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unavailable_during_exit" target="_blank" rel="noopener noreferrer">ERR_UNAVAILABLE_DURING_EXIT</a></span></a></h3><p>在 Node.js 中，<code>ERR_UNAVAILABLE_DURING_EXIT</code> 是一个错误代码，其代表了一类特定的错误情况。这个错误会发生在 Node.js 进程退出时尝试执行某些操作，但是那些操作是不允许的，因为进程已经在退出流程中了。</p><p>具体来说，当 Node.js 的事件循环结束，并且准备关闭进程时，Node.js 会触发一个名为 &#39;exit&#39; 的事件。在处理这个 &#39;exit&#39; 事件的监听函数中，有些异步操作是不被允许的，例如开启新的计时器、执行 I/O 操作（比如读写文件），或者创建新的 Promise。如果你在退出时尝试做这些事情，Node.js 就会抛出 <code>ERR_UNAVAILABLE_DURING_EXIT</code> 错误。</p><p>下面我们通过一些例子来说明这个概念。</p><h3 id="示例-1-尝试在退出时设置一个计时器" tabindex="-1"><a class="header-anchor" href="#示例-1-尝试在退出时设置一个计时器"><span>示例 1：尝试在退出时设置一个计时器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">exit</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">### [ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET](https://nodejs.org/docs/latest/api/errors.html#err_uncaught_exception_capture_already_set</span><span style="color:#D8DEE9;">)</span></span>
<span class="line"><span style="color:#D8DEE9;">好的</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">让我们来谈谈Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js中的</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> 错误</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">首先</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">异常</span><span style="color:#D8DEE9FF;">（</span><span style="color:#D8DEE9;">Exception</span><span style="color:#D8DEE9FF;">）</span><span style="color:#D8DEE9;">是编程中的一个术语</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">它指的是程序运行时发生的错误或者不正常的情况</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">在Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js中</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">如果代码中出现了一个异常并且没有被捕获</span><span style="color:#D8DEE9FF;">（</span><span style="color:#D8DEE9;">即没有写代码来特别处理这个错误</span><span style="color:#D8DEE9FF;">），</span><span style="color:#D8DEE9;">通常Node</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">js会打印出错误信息</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">并停止运行当前的程序</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">这种机制叫做</span><span style="color:#D8DEE9FF;">“</span><span style="color:#D8DEE9;">未捕获的异常处理</span><span style="color:#D8DEE9FF;">”。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">但是</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">在一些特殊情况下</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">你可能想要自定义这个处理过程</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">比如记录更详细的日志</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">进行清理工作</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">或者尝试恢复服务等</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">因此</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">js提供了一个</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">process.setUncaughtExceptionCaptureCallback()</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">方法</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">允许你设置一个回调函数</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">专门用于捕获和处理这些未捕获的异常</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">然而</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">重要的一点是</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">这个回调函数只能设置一次</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">如果你尝试第二次设置它</span><span style="color:#D8DEE9FF;">，</span><span style="color:#D8DEE9;">Node</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">js就会抛出</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;">错误</span><span style="color:#D8DEE9FF;">。</span><span style="color:#D8DEE9;">这个错误的意思是</span><span style="color:#D8DEE9FF;">“</span><span style="color:#D8DEE9;">未捕获的异常捕获回调已经设置</span><span style="color:#D8DEE9FF;">”，</span><span style="color:#D8DEE9;">也就是说你不能重复设置这个回调</span><span style="color:#D8DEE9FF;">。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">让我给你举个例子</span><span style="color:#D8DEE9FF;">：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4;">```</span><span style="color:#A3BE8C;">javascript</span></span>
<span class="line"><span style="color:#A3BE8C;">// 正确的使用方式：设置一个未捕获异常的捕获回调</span></span>
<span class="line"><span style="color:#A3BE8C;">process.setUncaughtExceptionCaptureCallback((err) =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">  console.error(&#39;捕获到未处理的异常:&#39;, err);</span></span>
<span class="line"><span style="color:#A3BE8C;">  // 在这里你可以做一些清理工作或者记录日志</span></span>
<span class="line"><span style="color:#A3BE8C;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">// 模拟一个未捕获的异常</span></span>
<span class="line"><span style="color:#A3BE8C;">setTimeout(() =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">  throw new Error(&#39;Oops!&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">}, 1000);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A3BE8C;">// 尝试再次设置回调，这将导致 ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET 错误</span></span>
<span class="line"><span style="color:#A3BE8C;">process.setUncaughtExceptionCaptureCallback((err) =&gt; {</span></span>
<span class="line"><span style="color:#A3BE8C;">  console.error(&#39;这个回调不会被设置&#39;);</span></span>
<span class="line"><span style="color:#A3BE8C;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先通过<code>process.setUncaughtExceptionCaptureCallback()</code>设置了一个回调函数，这个函数会在有未捕获的异常发生时被调用。接着我们模拟了一个未捕获的异常。最后，我们尝试第二次设置未捕获异常的回调，这时 Node.js 会抛出<code>ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET</code>错误，提示我们已经设置过一次了，不能重复设置。</p><p>总结起来，<code>ERR_UNCAUGHT_EXCEPTION_CAPTURE_ALREADY_SET</code>是一个错误类型，在你尝试多次设置未捕获异常的处理回调时会遇到。为了避免这个错误，确保你的程序中只设置一次未捕获异常的回调。</p><h3 id="err-unescaped-characters" tabindex="-1"><a class="header-anchor" href="#err-unescaped-characters"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unescaped_characters" target="_blank" rel="noopener noreferrer">ERR_UNESCAPED_CHARACTERS</a></span></a></h3><p><code>ERR_UNESCAPED_CHARACTERS</code> 是一个错误类型，它在 Node.js 中会出现当你试图使用一些应该被转义（escaped）的特殊字符时。在 URL、文件路径等地方，某些字符有特殊含义或者不允许直接使用，需要通过转义来告诉系统这些字符是文字意义上的，而不是控制字符。</p><p>在 Node.js 中，这种错误通常发生在处理网络请求或处理文件时，你提供了包含非法字符的字符串作为 URL 或文件路径等。比如，在 URL 中，“空格”是一个非法字符，必须使用 <code>%20</code> 来代替；同样地，如果你在文件路径中包含了“空格”，根据操作系统的不同，可能需要进行相应的转义处理。</p><p>让我们来看一些实际的例子：</p><h3 id="例子-1-url-中的非法字符" tabindex="-1"><a class="header-anchor" href="#例子-1-url-中的非法字符"><span>例子 1：URL 中的非法字符</span></a></h3><p>假设你想要请求一个带有空格的网址：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://www.example.com/a file with spaces.html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">get</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">requestUrl</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">response</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 真正的请求处理</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">出错了: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>节点将抛出 <code>ERR_UNESCAPED_CHARACTERS</code> 错误，因为 URL 中不能直接包含空格。正确的做法是用 <code>%20</code> 替换空格：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> requestUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://www.example.com/a%20file%20with%20spaces.html</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="例子-2-http-请求头中的非法字符" tabindex="-1"><a class="header-anchor" href="#例子-2-http-请求头中的非法字符"><span>例子 2：HTTP 请求头中的非法字符</span></a></h3><p>如果你尝试在 HTTP 请求头中设置一个值，但这个值包含了某些非法字符，那么 Node.js 同样会抛出 <code>ERR_UNESCAPED_CHARACTERS</code> 的错误。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  headers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">This value has unescaped &quot;quotes&quot; and a semicolon;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理响应</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">请求遇到问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，自定义的请求头 <code>Custom-Header</code> 包含了引号和分号，这些也是需要被适当转义的字符，否则就会触发错误。</p><h3 id="例子-3-文件路径中的非法字符" tabindex="-1"><a class="header-anchor" href="#例子-3-文件路径中的非法字符"><span>例子 3：文件路径中的非法字符</span></a></h3><p>当你尝试使用 fs（文件系统）模块读写文件的时候，如果文件路径包含了一些非法字符，比如 Windows 系统下的 <code>&lt;</code>, &gt;, <code>:</code> 等符号，也会抛出 <code>ERR_UNESCAPED_CHARACTERS</code> 错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们在Windows系统下，在文件名中使用了&quot;:&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> filePath</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">C:</span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">path</span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">to</span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">your:file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">无法读取文件: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，需要确保文件路径中没有非法字符，或者对这些字符进行相应的处理。</p><p>总结起来，<code>ERR_UNESCAPED_CHARACTERS</code> 错误提示你可能在字符串中使用了某些需要转义的特殊字符，你需要检查并修正它们以确保程序能正常运行。</p><h3 id="err-unhandled-error" tabindex="-1"><a class="header-anchor" href="#err-unhandled-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unhandled_error" target="_blank" rel="noopener noreferrer">ERR_UNHANDLED_ERROR</a></span></a></h3><h3 id="err-unknown-builtin-module" tabindex="-1"><a class="header-anchor" href="#err-unknown-builtin-module"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_builtin_module" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_BUILTIN_MODULE</a></span></a></h3><p>好的，让我来解释一下 <code>ERR_UNKNOWN_BUILTIN_MODULE</code> 这个错误。</p><p>在 Node.js 中，有一些内置模块，比如 <code>fs</code> 用于文件系统操作，<code>http</code> 用于网络通信等。这些都是 Node.js 自带的，不需要通过 npm 安装新的包就可以直接使用。</p><p>当你试图在 Node.js 程序中 <code>require</code>（引入）一个不存在的内置模块时，就会遇到 <code>ERR_UNKNOWN_BUILTIN_MODULE</code> 错误。换句话说，这个错误意味着你尝试加载了一个 Node.js 核心不认识的模块。</p><p>举几个实际的例子：</p><ol><li><strong>正确引入内置模块</strong>:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确，&#39;fs&#39; 是文件系统模块</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li><strong>错误引入内置模块</strong>:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">myModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出 ERR_UNKNOWN_BUILTIN_MODULE 错误，因为 &#39;myModule&#39; 不是一个内置模块</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><strong>拼写错误导致的问题</strong>:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">htp</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 抛出 ERR_UNKNOWN_BUILTIN_MODULE 错误，因为正确的模块名应该是 &#39;http&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你碰到了 <code>ERR_UNKNOWN_BUILTIN_MODULE</code> 错误，首先要做的就是检查被 <code>require</code> 的模块名是否正确。如果模块名没有拼写错误，那么可能是因为你尝试引入的模块根本就不是一个内置模块。这种情况下，你需要确认一下该模块是否需要通过 npm 安装或者是否属于项目依赖的第三方库。</p><p>记住，如果是第三方库，你需要在项目目录下运行 <code>npm install 模块名</code> 来安装它，然后才能正常引用。例如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">npm</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> lodash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后在你的代码中：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> _</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">lodash</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 现在可以正确引入 lodash，因为它已经被安装了</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>处理这个错误的关键是：确认你要引入的模块名字是否正确，并确定它是内置模块还是需要额外安装的第三方模块。</p><h3 id="err-unknown-credential" tabindex="-1"><a class="header-anchor" href="#err-unknown-credential"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_credential" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_CREDENTIAL</a></span></a></h3><p>好的，我来解释一下 Node.js 中的<code>ERR_UNKNOWN_CREDENTIAL</code>错误。</p><p>在 Node.js 中，有很多内置的错误类型，它们帮助开发者了解程序中发生了哪些问题。<code>ERR_UNKNOWN_CREDENTIAL</code>是 Node.js 的一个错误代码，表示一个特定的问题：当你尝试使用一个未知的用户标识或凭证时，这个错误就会被触发。</p><p>举个例子来说，如果你正在编写一个 Node.js 应用，而这个应用需要与系统级别的用户账户进行交互，比如要改变文件的所有者，你可能会调用 Node.js 的某些 API 函数，并传递用户的 ID 或名称。如果你传递的用户 ID 或名称不是系统上现有的，那么 Node.js 就会抛出<code>ERR_UNKNOWN_CREDENTIAL</code>错误。</p><p>这里有个简化版的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> changeFileOwner</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> userId</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">chown</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> userId</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设userId是我们需要设置的用户ID</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_UNKNOWN_CREDENTIAL</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">提供的用户ID未识别，无法更改文件所有者。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">发生了其他错误</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">changeFileOwner</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 99999</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设99999是不存在的用户ID</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，<code>changeFileOwner</code>函数试图通过<code>fs.chown</code>方法来改变一个文件（&#39;example.txt&#39;）的所有者。我们假设用户 ID <code>99999</code>是不存在的，当这段代码运行的时候，因为<code>userId</code>不存在，将会引发<code>ERR_UNKNOWN_CREDENTIAL</code>错误，在<code>catch</code>块中我们检查错误代码并相应地打印出错误信息。</p><p>总结一下，<code>ERR_UNKNOWN_CREDENTIAL</code>是 Node.js 中一个代表&quot;未知用户凭证&quot;的错误代码。这通常意味着你试图使用一个系统中不存在的用户名称或者 ID 去执行一些操作。正确处理这类错误可以让你的应用在遇到这样的情况时更加鲁棒，给用户提供更清晰的反馈信息。</p><h3 id="err-unknown-encoding" tabindex="-1"><a class="header-anchor" href="#err-unknown-encoding"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_encoding" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_ENCODING</a></span></a></h3><p><code>ERR_UNKNOWN_ENCODING</code>是一个错误类型的标识，出现在 Node.js 中。这个错误通常是在处理文本或者数据转换时遇到了不被支持的编码格式触发的。</p><h3 id="什么是编码" tabindex="-1"><a class="header-anchor" href="#什么是编码"><span>什么是编码？</span></a></h3><p>简单来说，编码就是一种规则或方法，它将字符（如字母和数字）转换成可以由计算机存储和解析的格式。常见的编码方式有 UTF-8、ASCII 等。</p><h3 id="为什么会出现err-unknown-encoding错误" tabindex="-1"><a class="header-anchor" href="#为什么会出现err-unknown-encoding错误"><span>为什么会出现<code>ERR_UNKNOWN_ENCODING</code>错误？</span></a></h3><p>当你在 Node.js 中使用了一个不被当前版本支持的编码格式时，比如在读取文件内容或者处理网络请求的数据时指定了错误的编码，Node.js 就会抛出<code>ERR_UNKNOWN_ENCODING</code>错误。</p><h3 id="实际例子-11" tabindex="-1"><a class="header-anchor" href="#实际例子-11"><span>实际例子</span></a></h3><p>假设你想要读取一个文本文件，并且指定了编码格式。以下是一段简单的 Node.js 代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试以未知编码格式&#39;abcde&#39;读取文件内容</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">abcde</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">    // 如果有错误，可能就是编码格式不正确</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试用<code>fs.readFile()</code>函数读取名为<code>example.txt</code>的文件，并且指定了一个不存在的编码格式<code>&#39;abcde&#39;</code>。因此，代码运行时会捕获到一个错误，错误信息就会告诉我们编码格式未知，即<code>ERR_UNKNOWN_ENCODING</code>。</p><p>确保你总是使用有效和支持的编码方式，如<code>&#39;utf8&#39;</code>、<code>&#39;ascii&#39;</code>等，这样就可以避免这类错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的编码格式&#39;utf8&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 现在能够正确读取内容</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你不确定编码类型，通常最安全的选择是 UTF-8，因为它支持多语言的字符集并且被广泛使用。</p><h3 id="总结-3" tabindex="-1"><a class="header-anchor" href="#总结-3"><span>总结</span></a></h3><p><code>ERR_UNKNOWN_ENCODING</code>是 Node.js 中提示未知编码错误的标识。遇到这个错误时，检查和修正你的代码中指定的编码类型，确保它是 Node.js 所支持的。</p><h3 id="err-unknown-file-extension" tabindex="-1"><a class="header-anchor" href="#err-unknown-file-extension"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_file_extension" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_FILE_EXTENSION</a></span></a></h3><p>好的，让我来解释一下 Node.js 中的 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。这个错误是指 Node.js 遇到了一个它不认识的文件扩展名。</p><p>在 Node.js 中，当你尝试导入或者运行一个文件时，Node.js 会根据文件的扩展名来确定如何处理这个文件。比如说，<code>.js</code> 文件会被当作 JavaScript 代码来执行，<code>.json</code> 文件会被当作 JSON 数据来解析。</p><p>但是，如果 Node.js 遇到了一个它不知道如何处理的扩展名，它就会抛出 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。</p><p>让我们通过几个例子来更具体地理解这个错误：</p><ol><li><p><strong>导入未知的文件扩展名</strong></p><p>假设你有一个叫做 <code>example.xyz</code> 的文件，并且你尝试在 Node.js 程序中导入它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> data</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./example.xyz</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果 Node.js 不知道如何处理 <code>.xyz</code> 扩展名，你将会遇到 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。</p></li><li><p><strong>执行带有未知扩展名的文件</strong></p><p>当你在命令行中运行一个带有非标准扩展名的脚本时，比如 <code>node script.customext</code>，如果 Node.js 没有为 <code>.customext</code> 扩展名提供内置支持或者你没有通过配置告诉 Node.js 如何处理这种类型的文件，你也会收到 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。</p></li><li><p><strong>动态导入未支持的文件类型</strong></p><p>如果你使用动态导入（import() 表达式）来加载一个特定的文件类型，而这个文件类型是 Node.js 无法识别的，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./styles.theme</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">styles</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 使用 styles</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 Node.js 不知道如何处理 <code>.theme</code> 文件，那么在 Promise 的 catch 块中，你将会接收到 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。</p></li></ol><p>要解决这个错误，你通常有两个选择：</p><ul><li><strong>为特定扩展名注册自定义加载器</strong>：你可以在 Node.js 中注册自定义加载器来告诉 Node.js 如何处理特定的文件扩展名。</li><li><strong>使用已知的扩展名</strong>：将文件重命名为 Node.js 支持的扩展名，例如 <code>.js</code>、<code>.json</code> 等。</li></ul><p>请记住，随着 Node.js 版本的升级，支持的文件扩展名可能会发生变化。所以，如果你在使用特定版本的 Node.js 遇到了 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误，确保查看该版本的文档以了解哪些文件扩展名是受支持的。</p><h3 id="err-unknown-module-format" tabindex="-1"><a class="header-anchor" href="#err-unknown-module-format"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_module_format" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_MODULE_FORMAT</a></span></a></h3><p>当你使用 Node.js 进行编程时，可能会遇到各种错误提示，这些提示有助于你了解代码中存在的问题。<code>ERR_UNKNOWN_MODULE_FORMAT</code>是 Node.js 在处理模块导入和导出时可能抛出的一个特定错误类型。</p><p>首先，需要理解什么是模块。在 Node.js 中，一个模块就是一个包含 JavaScript 代码的文件。你可以在一个文件（模块）中写代码，并在另一个文件中通过使用<code>require</code>（CommonJS 模块系统）或<code>import</code>（ESM，即 ECMAScript 模块系统）来导入这个文件。</p><p>现在让我们深入了解<code>ERR_UNKNOWN_MODULE_FORMAT</code>错误：</p><h3 id="err-unknown-module-format错误的含义" tabindex="-1"><a class="header-anchor" href="#err-unknown-module-format错误的含义"><span><code>ERR_UNKNOWN_MODULE_FORMAT</code>错误的含义</span></a></h3><p>这个错误表示 Node.js 无法识别尝试加载的模块的格式。例如，如果你尝试使用<code>import</code>语法去导入一个非 ESM 格式的模块，或者用<code>require</code>去加载一个 ESM 格式的模块，Node.js 可能就会抛出这个错误。</p><h3 id="实际运用的例子-18" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-18"><span>实际运用的例子</span></a></h3><p>假设你有下面的 JavaScript 文件（myfile.js），它使用 CommonJS 格式导出了一个函数：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// CommonJS 格式的导出</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> sayHello</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，在另一个文件中（例如 main.js），你尝试使用 ESM 的<code>import</code>语句去导入这个模块：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 尝试使用ESM的import语法去导入CommonJS模块</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> sayHello</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myfile.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">sayHello</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，由于原始模块是 CommonJS 格式且使用了<code>module.exports</code>来导出内容，而不是 ESM 格式，所以当 Node.js 看到使用<code>import</code>语法时，它不知道如何处理这种情况，最终将抛出<code>ERR_UNKNOWN_MODULE_FORMAT</code>错误。</p><h3 id="如何解决这个错误-4" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误-4"><span>如何解决这个错误</span></a></h3><p>要解决这个错误，确保你正确地使用了与目标模块相匹配的模块系统。如果是 CommonJS 模块，应该使用<code>require</code>来导入：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 使用require来导入CommonJS模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> sayHello</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./myfile.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">sayHello</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是 ESM 模块，则使用<code>import</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// myfile.mjs 或者 myfile.js（如果package.json中指明了&quot;type&quot;: &quot;module&quot;）</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> sayHello</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在其他ESM模块中导入</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> sayHello</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myfile.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">sayHello</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总之，在使用 Node.js 时，你需要清楚自己正在使用的是哪种模块系统，并且保持导入和导出的一致性。如果 Node.js 不能根据文件扩展名或<code>package.json</code>文件中的配置来识别模块格式，就会出现<code>ERR_UNKNOWN_MODULE_FORMAT</code>错误。确保你的模块化方式正确，可以有效避免这类错误。</p><h3 id="err-unknown-signal" tabindex="-1"><a class="header-anchor" href="#err-unknown-signal"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_signal" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_SIGNAL</a></span></a></h3><p>好的，让我们来深入探讨 Node.js 中的 <code>ERR_UNKNOWN_SIGNAL</code> 错误。</p><p>首先，要明白 Node.js 是一个让你能够使用 JavaScript 构建服务器和命令行工具的平台。在 Node.js 的应用中，进程（就是正在运行的程序实例）之间可以通过所谓的信号进行通信。这些信号是操作系统层面的，它们用于告诉程序需要执行哪些操作，例如终止（SIGTERM）、停止执行（SIGSTOP）或者重新启动（SIGHUP）等等。</p><p>现在，当我们谈论 <code>ERR_UNKNOWN_SIGNAL</code> 错误时，这个错误发生的场景是：你的代码试图发送一个 Node.js 或者底层操作系统不识别的信号给某个进程。</p><h3 id="实际运用的例子-19" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-19"><span>实际运用的例子</span></a></h3><p>想象一下，你正在开发一个应用，该应用需要在特定情况下安全地关闭一些后台任务。为了做到这一点，你可能会尝试向这些任务发送一个信号，让它们知道应该清理资源并优雅地停止运行。如果你尝试发送一个不存在的信号，比如打错了信号名称，那就会遇到 <code>ERR_UNKNOWN_SIGNAL</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> process</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">process</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们有意或无意地指定了一个不存在的信号 &#39;SIGFOO&#39;</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">kill</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">pid</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">SIGFOO</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 如果捕获到 ERR_UNKNOWN_SIGNAL 错误，这里将会输出相关错误信息</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，<code>process.kill</code> 方法用于向进程发送信号。我们试图发送一个叫做 <code>&#39;SIGFOO&#39;</code> 的信号，但因为这个信号不存在，所以 Node.js 抛出了一个 <code>ERR_UNKNOWN_SIGNAL</code> 的错误。</p><h3 id="如何处理这种错误" tabindex="-1"><a class="header-anchor" href="#如何处理这种错误"><span>如何处理这种错误？</span></a></h3><p>处理 <code>ERR_UNKNOWN_SIGNAL</code> 错误的最佳方法是确保你只使用有效的、已知的信号。Node.js 的文档和你的操作系统文档都提供了可用信号的列表。如果你遇到了这个错误，最好回头检查你的代码，看看是否有拼写错误或者使用了不支持的信号。</p><p>总结一下，<code>ERR_UNKNOWN_SIGNAL</code> 是一个指示你尝试使用了一个未知或无效信号的错误。通过确保使用正确的信号，和在异常处理中捕获此类错误，可以帮助你的应用更加健壮和容错。</p><h3 id="err-unsupported-dir-import" tabindex="-1"><a class="header-anchor" href="#err-unsupported-dir-import"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unsupported_dir_import" target="_blank" rel="noopener noreferrer">ERR_UNSUPPORTED_DIR_IMPORT</a></span></a></h3><p>当你在 Node.js 中遇到 <code>ERR_UNSUPPORTED_DIR_IMPORT</code> 这个错误，它通常意味着你尝试以一种不被支持的方式导入了一个目录。在 Node.js 的早期版本中，你可以简单地通过指定一个目录来导入该目录下的 <code>index.js</code> 或通过 <code>package.json</code> 文件中的 <code>main</code> 字段指定的文件。然而，随着 ES 模块（ECMAScript Modules, 简称 ESM）的引入和发展，这种做法的规则变得更加严格。</p><h3 id="解释-1" tabindex="-1"><a class="header-anchor" href="#解释-1"><span>解释</span></a></h3><p>在使用 ESM 时，你必须明确指出要导入的文件。这意味着你不能仅仅指定一个目录来自动导入该目录下的 <code>index.js</code> 文件或 <code>package.json</code> 中指定的 <code>main</code> 文件。如果你尝试这样做，Node.js 将会抛出 <code>ERR_UNSUPPORTED_DIR_IMPORT</code> 错误，告诉你这种导入目录的方式是不被支持的。</p><h3 id="实际运用的例子-20" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-20"><span>实际运用的例子</span></a></h3><h4 id="错误示例-1" tabindex="-1"><a class="header-anchor" href="#错误示例-1"><span>错误示例</span></a></h4><p>假设你有以下的目录结构：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>myProject/</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── index.js</span></span>
<span class="line"><span>└── src/</span></span>
<span class="line"><span>    └── myModule/</span></span>
<span class="line"><span>        ├── index.js</span></span>
<span class="line"><span>        └── package.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>src/myModule/package.json</code> 中，你可能有如下内容：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">myModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">main</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">index.js</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，在 <code>myProject/index.js</code> 中，你想要导入 <code>myModule</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 这将导致 ERR_UNSUPPORTED_DIR_IMPORT 错误</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/myModule</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>因为你没有指定要导入的具体文件，只提供了目录，这将导致错误。</p><h4 id="正确示例-1" tabindex="-1"><a class="header-anchor" href="#正确示例-1"><span>正确示例</span></a></h4><p>要正确地导入 <code>myModule</code>，你应该直接指向文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 明确指定要导入的文件</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/myModule/index.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>或者，如果你的模块支持导出特定功能或对象，你也可以采取类似的方法来具体指明：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设 myFunction 是 myModule 中导出的功能之一</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> {</span><span style="color:#8FBCBB;"> myFunction</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./src/myModule/index.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结-4" tabindex="-1"><a class="header-anchor" href="#总结-4"><span>总结</span></a></h3><p>确保你总是明确指定要导入的文件路径，而不是仅仅提供一个目录路径。这不仅可以避免 <code>ERR_UNSUPPORTED_DIR_IMPORT</code> 错误，还能使你的代码更加清晰、易于维护。随着 Node.js 和 JavaScript 生态的发展，理解并适应这些最佳实践是非常重要的。</p><h3 id="err-unsupported-esm-url-scheme" tabindex="-1"><a class="header-anchor" href="#err-unsupported-esm-url-scheme"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unsupported_esm_url_scheme" target="_blank" rel="noopener noreferrer">ERR_UNSUPPORTED_ESM_URL_SCHEME</a></span></a></h3><p>当你遇到 <code>ERR_UNSUPPORTED_ESM_URL_SCHEME</code> 这个错误时，通常意味着你在使用 Node.js 的 ES 模块（ESM）功能时，尝试以 Node.js 不支持的方式来加载模块。这个错误主要和模块的 URL 方案有关。</p><p>首先，让我们理解一下什么是 ES 模块（ECMAScript Modules）。ES 模块是 ECMAScript (即 JavaScript) 的官方标准，用于在不同的 JavaScript 文件间共享代码。与 CommonJS 模块系统（Node.js 最初使用的模块系统）相比，ES 模块提供了更为现代化的语法和更好的静态分析能力，使得代码的导入和导出变得更为简单和高效。</p><p>当你在 Node.js 中使用 ES 模块时，你会通过指定模块的路径来导入需要的模块。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里的 <code>&#39;./myModule.js&#39;</code> 就是模块的路径，而 Node.js 会根据这个路径去加载对应的模块。</p><p>然而，除了常见的文件路径，模块还可以通过其他的 URL 方案来加载，最常见的就是通过 HTTP(S) 协议从远程服务器加载。但截至我的知识最后更新时（2023 年），Node.js 原生并不支持从 HTTP(S) 或其他非文件系统的 URL 方案加载 ES 模块。因此，如果你尝试这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://example.com/myModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>那么，Node.js 就会抛出 <code>ERR_UNSUPPORTED_ESM_URL_SCHEME</code> 错误，因为 <code>http://</code> 是一个不被支持的 URL 方案。</p><h3 id="实际运用的例子-21" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-21"><span>实际运用的例子</span></a></h3><ol><li><p><strong>本地模块导入：</strong> 正确的做法</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设你有一个本地模块 myLocalModule.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myLocalModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myLocalModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>从网络加载模块：</strong> 错误示范</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 尝试从网络加载模块</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myWebModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https://example.com/myWebModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将导致 ERR_UNSUPPORTED_ESM_URL_SCHEME 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>要解决这个问题，你需要确保所有导入都是通过支持的方案进行的，目前主要是基于文件系统的路径（比如从本地文件或者包管理器安装的模块）。如果你真的需要从远端加载代码，可能需要考虑其他方法，如下载代码到本地然后再进行导入，或使用特定工具或库来实现这一功能。</p><h3 id="err-unsupported-resolve-request" tabindex="-1"><a class="header-anchor" href="#err-unsupported-resolve-request"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unsupported_resolve_request" target="_blank" rel="noopener noreferrer">ERR_UNSUPPORTED_RESOLVE_REQUEST</a></span></a></h3><p>当你遇到 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code> 错误时，这通常意味着你在使用 Node.js 的模块解析系统时尝试了不被支持的操作。Node.js v21.7.1 中的这个错误是关于模块或包导入时发生的问题。为了帮助你理解，我们需要先了解一些背景知识。</p><p>在 Node.js 中，有一个名为 CommonJS 的系统用于模块的导入和导出。简单来说，你可以使用 <code>require()</code> 函数来导入模块，而使用 <code>module.exports</code> 或 <code>exports</code> 来导出模块。另外，随着 ES Modules (ESM) 的推广，Node.js 也开始支持使用 <code>import</code> 和 <code>export</code> 语法进行模块化操作。</p><h3 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h3><ul><li><strong>CommonJS</strong>：主要用于服务器端模块，使用 <code>require()</code> 导入，<code>module.exports</code> 导出。</li><li><strong>ES Modules (ESM)</strong>：新的 JavaScript 标准，旨在统一浏览器和服务器端代码模块系统，使用 <code>import</code> 和 <code>export</code>。</li></ul><h3 id="err-unsupported-resolve-request-错误出现的场景" tabindex="-1"><a class="header-anchor" href="#err-unsupported-resolve-request-错误出现的场景"><span><code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code> 错误出现的场景</span></a></h3><p>当 Node.js 在处理模块解析请求时，如果遇到了不符合规范或无法按预期处理的情况，就会抛出 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code> 错误。主要情况包括：</p><ol><li><strong>错误的模块路径</strong>：尝试导入不存在的模块或路径写错了。</li><li><strong>不兼容的模块格式</strong>：比如，在预期使用 CommonJS 模块系统的地方错误地使用了 ES Module 语法，或反之。</li><li><strong>配置问题</strong>：Node.js 项目的 <code>package.json</code> 文件中可能存在配置使得解析无法成功，例如 <code>type</code> 字段设置不正确（应为 <code>&quot;module&quot;</code> 或 <code>&quot;commonjs&quot;</code>）。</li></ol><h3 id="实际运用例子-2" tabindex="-1"><a class="header-anchor" href="#实际运用例子-2"><span>实际运用例子</span></a></h3><p>下面通过一些例子来说明可能导致 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code> 错误的情况：</p><h4 id="示例-1-错误的模块路径" tabindex="-1"><a class="header-anchor" href="#示例-1-错误的模块路径"><span>示例 1: 错误的模块路径</span></a></h4><p>假设你有一个文件 <code>app.js</code>，试图导入一个不存在的模块 <code>myModule.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myModule</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./nonexistent/myModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果 <code>./nonexistent/myModule.js</code> 路径不存在，Node.js 就可能因为无法解析该请求而抛出 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code>。</p><h4 id="示例-2-不兼容的模块格式" tabindex="-1"><a class="header-anchor" href="#示例-2-不兼容的模块格式"><span>示例 2: 不兼容的模块格式</span></a></h4><p>在一个定义为 CommonJS 的项目中（<code>package.json</code> 中没有设置 <code>&quot;type&quot;: &quot;module&quot;</code>），你尝试使用 <code>import</code> 语法：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myModule</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./myModule.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这种情况下，由于 CommonJS 项目默认不支持 <code>import</code> 语法，Node.js 可能会抛出 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code>。</p><h4 id="示例-3-配置问题" tabindex="-1"><a class="header-anchor" href="#示例-3-配置问题"><span>示例 3: 配置问题</span></a></h4><p>考虑 <code>package.json</code> 中的 <code>&quot;type&quot;</code> 字段设置错误：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">my-package</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1.0.0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">modul</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#616E88;"> // 这里有个拼写错误，正确的应该是 &quot;module&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>package.json</code> 中的配置错误，如上所示将 <code>&quot;module&quot;</code> 错误地写为 <code>&quot;modul&quot;</code>，则 Node.js 解析模块系统时可能会抛出 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code>。</p><h3 id="如何解决-1" tabindex="-1"><a class="header-anchor" href="#如何解决-1"><span>如何解决？</span></a></h3><ol><li>确保模块路径正确且模块存在。</li><li>检查 <code>package.json</code> 的配置，确保 <code>&quot;type&quot;</code> 字段正确设置为 <code>&quot;module&quot;</code>（对 ESM）或 <code>&quot;commonjs&quot;</code>（对 CommonJS）。</li><li>根据你的项目类型（CommonJS 或 ESM），使用正确的模块导入/导出语法。</li></ol><p>通过以上步骤，大多数 <code>ERR_UNSUPPORTED_RESOLVE_REQUEST</code> 错误都可以得到解决。</p><h3 id="err-use-after-close" tabindex="-1"><a class="header-anchor" href="#err-use-after-close"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_use_after_close" target="_blank" rel="noopener noreferrer">ERR_USE_AFTER_CLOSE</a></span></a></h3><p><code>ERR_USE_AFTER_CLOSE</code> 是 Node.js 中的一个错误类型，它通常出现在尝试对已经关闭（结束）的资源进行操作时。这种资源可能是文件、网络连接等。</p><p>理解这个错误，可以把它比作日常生活中的一个场景：比如你关掉了水龙头，但是还想从它那里继续接水。由于水龙头已经关闭，这显然是不可能的。在 Node.js 的世界里，类似的尝试使用已经关闭的资源也会导致 <code>ERR_USE_AFTER_CLOSE</code> 错误。</p><h3 id="实际运用例子-3" tabindex="-1"><a class="header-anchor" href="#实际运用例子-3"><span>实际运用例子</span></a></h3><p>让我们通过一些简化的代码示例来进一步理解这个概念。</p><h4 id="例-1-网络连接" tabindex="-1"><a class="header-anchor" href="#例-1-网络连接"><span>例 1：网络连接</span></a></h4><p>假设你有一个服务器和客户端之间的网络连接。当连接被关闭后，如果你试图通过这个已经关闭的连接发送数据，就会遇到 <code>ERR_USE_AFTER_CLOSE</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个服务器</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">socket</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">close</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 尝试在连接关闭后发送数据</span></span>
<span class="line"><span style="color:#81A1C1;">    try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_USE_AFTER_CLOSE</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 关闭连接</span></span>
<span class="line"><span style="color:#D8DEE9;">  socket</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server is running on port 3000</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="例-2-文件流" tabindex="-1"><a class="header-anchor" href="#例-2-文件流"><span>例 2：文件流</span></a></h4><p>假设你正在写入一个文件，如果你在关闭了文件流之后还尝试写入，同样会引发 <code>ERR_USE_AFTER_CLOSE</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可写流</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> writeStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 写入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 关闭流</span></span>
<span class="line"><span style="color:#D8DEE9;">writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次写入</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  writeStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This won&#39;t work!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会捕获到 ERR_USE_AFTER_CLOSE</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="避免该错误" tabindex="-1"><a class="header-anchor" href="#避免该错误"><span>避免该错误</span></a></h3><p>要避免 <code>ERR_USE_AFTER_CLOSE</code> 错误，最重要的是确保在资源被关闭之后不再进行任何操作。可以通过设置标志、监听关闭事件或者使用适当的控制流程（如异步编程模式中的回调函数和 Promise）来管理。</p><p>总结：<code>ERR_USE_AFTER_CLOSE</code> 错误是 Node.js 中提示开发者他们正在尝试操作一个已经关闭的资源的一种方式。通过仔细管理资源状态，可以避免此类错误。</p><h3 id="err-valid-performance-entry-type" tabindex="-1"><a class="header-anchor" href="#err-valid-performance-entry-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_valid_performance_entry_type" target="_blank" rel="noopener noreferrer">ERR_VALID_PERFORMANCE_ENTRY_TYPE</a></span></a></h3><p>好的，让我帮你理解 <code>ERR_VALID_PERFORMANCE_ENTRY_TYPE</code> 这个错误，以及它在 Node.js v21.7.1 中的含义和实际应用场景。</p><p>首先，要了解这个错误，我们得先知道 Node.js 中的 Performance API。Node.js 提供了一个性能监控的 API，允许你测量和监控你的代码的性能。这是非常有用的，比如，当你想要优化你的应用程序以更快地响应用户请求时。</p><h3 id="performance-api-简介" tabindex="-1"><a class="header-anchor" href="#performance-api-简介"><span>Performance API 简介</span></a></h3><p>Performance API 包含了一系列工具，最重要的可能就是 Performance Timeline 和 PerformanceEntry 对象了。你可以创建自定义的性能标记（performance marks），控制和测量代码执行的时间等。</p><h3 id="err-valid-performance-entry-type-错误" tabindex="-1"><a class="header-anchor" href="#err-valid-performance-entry-type-错误"><span>ERR_VALID_PERFORMANCE_ENTRY_TYPE 错误</span></a></h3><p>当你使用这些工具并且尝试添加一个性能条目到性能时间线上时，如果你提供了一个无效的类型（即该类型不被期望或不受支持），Node.js 将抛出 <code>ERR_VALID_PERFORMANCE_ENTRY_TYPE</code> 错误。简单来说，就是你尝试记录一个 Node.js 不认为是有效性能测量类型的东西。</p><h3 id="实际例子-12" tabindex="-1"><a class="header-anchor" href="#实际例子-12"><span>实际例子</span></a></h3><p>假设我们正在开发一个 Web 应用，并且想要测量处理 HTTP 请求所需的时间。我们可能会做以下操作：</p><ol><li><strong>开始测量</strong>：当接收到一个请求时，我们创建一个性能标记。</li><li><strong>处理请求</strong>：执行必要的操作来响应请求，比如查询数据库、处理数据等。</li><li><strong>结束测量</strong>：请求处理完成后，我们创建另一个性能标记并通过 Performance API 测量两个标记之间的时间差。</li></ol><p>在 Node.js 代码中，这可能看起来是这样的：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> performance</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> PerformanceObserver</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">perf_hooks</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听器，用于监听性能条目的添加</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> obs</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> PerformanceObserver</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getEntries</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">clearMarks</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">obs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">observe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> entryTypes</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">measure</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 开始测量</span></span>
<span class="line"><span style="color:#D8DEE9;">performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">start_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 模拟请求处理的异步操作</span></span>
<span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 结束测量</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">mark</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 计算并记录两个标记间的时间差异</span></span>
<span class="line"><span style="color:#D8DEE9;">  performance</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">measure</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">request_handling</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end_request</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，如果我们在 <code>observe</code> 方法中传入了一个不正确的 <code>entryTypes</code> 值，比如 <code>&#39;invalidType&#39;</code> 而不是 <code>&#39;measure&#39;</code> 或 <code>&#39;mark&#39;</code>，Node.js 就会抛出 <code>ERR_VALID_PERFORMANCE_ENTRY_TYPE</code> 错误。因为 <code>&#39;invalidType&#39;</code> 不是一个被 Performance API 支持的有效性能条目类型。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">obs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">observe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> entryTypes</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">invalidType</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">] </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这会导致 ERR_VALID_PERFORMANCE_ENTRY_TYPE 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h3><p>简而言之，<code>ERR_VALID_PERFORMANCE_ENTRY_TYPE</code> 错误告诉你，你尝试使用一个不被 Node.js 性能监控系统支持的性能条目类型。确保你使用的类型是 API 支持的，比如 <code>&#39;measure&#39;</code> 或 <code>&#39;mark&#39;</code>，以避免这种错误。这对于通过性能监控优化你的 Node.js 应用来说非常重要。</p><h3 id="err-vm-dynamic-import-callback-missing-flag" tabindex="-1"><a class="header-anchor" href="#err-vm-dynamic-import-callback-missing-flag"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_dynamic_import_callback_missing_flag" target="_blank" rel="noopener noreferrer">ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</a></span></a></h3><p>了解 <code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</code> 这个错误，我们需要先明确几个概念：Node.js、ES 模块（ECMAScript Modules）、<code>vm</code> 模块，以及动态导入。</p><h3 id="基础知识" tabindex="-1"><a class="header-anchor" href="#基础知识"><span>基础知识</span></a></h3><ol><li><strong>Node.js</strong>：一个可以让 JavaScript 运行在服务器端的环境，它让 JavaScript 能够进行文件操作、网络请求等后端操作。</li><li><strong>ES 模块</strong>：是 JavaScript 的官方标准化模块系统，允许你将大的程序拆分成小的可重用模块。使用 <code>import</code> 和 <code>export</code> 语句来导入或导出函数、对象或原始值。</li><li><strong><code>vm</code>模块</strong>：Node.js 的 <code>vm</code> 模块提供了在 V8 虚拟机中编译和运行代码的 API。它可以用于创建一个新的虚拟机上下文，使得可以在隔离的沙盒环境中执行代码。</li><li><strong>动态导入</strong>：指使用 <code>import()</code> 语法动态地加载 ES 模块。与静态导入（使用 <code>import</code> 语句）不同，动态导入可以在代码执行时根据条件导入模块。</li></ol><h3 id="错误解释" tabindex="-1"><a class="header-anchor" href="#错误解释"><span>错误解释</span></a></h3><p><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</code> 是在 Node.js 的环境中遇到的一个具体错误类型。当你尝试在使用 <code>vm</code> 模块创建的沙盒环境里动态地导入 ES 模块，但没有启用正确的标志来支持这个操作时，就会遇到这个错误。</p><p>这个错误通常意味着你需要在启动 Node.js 时加上 <code>--experimental-vm-modules</code> 标志，这个标志可以启用 <code>vm</code> 模块中对 ES 模块的实验性支持。</p><h3 id="实际例子-13" tabindex="-1"><a class="header-anchor" href="#实际例子-13"><span>实际例子</span></a></h3><p>假设你想在一个隔离的环境中动态导入一个模块，并使用其中的功能。你可能会写出类似如下的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> path</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> modulePath</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">resolve</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">some-module.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试在沙盒环境中动态导入模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> context</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Context</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> script</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Script</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">import(&#39;</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">modulePath</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&#39;)</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">script</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">runInContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">context</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在不启用 <code>--experimental-vm-modules</code> 标志的情况下执行上述代码，就会遇到 <code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</code> 错误，因为默认情况下 Node.js 的 <code>vm</code> 模块不支持动态导入 ES 模块。</p><h3 id="解决方法-6" tabindex="-1"><a class="header-anchor" href="#解决方法-6"><span>解决方法</span></a></h3><p>为了解决这个问题，你需要在启动 Node.js 程序时加上 <code>--experimental-vm-modules</code> 标志。例如，假设你的脚本名为 <code>index.js</code>，则可以在终端中这样运行你的程序：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">node</span><span style="color:#A3BE8C;"> --experimental-vm-modules</span><span style="color:#A3BE8C;"> index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样就可以在 <code>vm</code> 模块的沙盒环境中使用动态导入功能了。</p><h3 id="结论-2" tabindex="-1"><a class="header-anchor" href="#结论-2"><span>结论</span></a></h3><p>虽然 <code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</code> 错误可能一开始让人感觉有些复杂，但其背后的原理相对简单：当 Node.js 环境或某些特定功能未被正确配置以支持动态导入 ES 模块时，就会出现这个错误。通过启用相应的实验性标志，可以轻松解决这个问题。</p><h3 id="err-vm-dynamic-import-callback-missing" tabindex="-1"><a class="header-anchor" href="#err-vm-dynamic-import-callback-missing"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_dynamic_import_callback_missing" target="_blank" rel="noopener noreferrer">ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</a></span></a></h3><p>在 Node.js 中，<code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code>是一个错误类型，它会出现在特定的情况下，主要与使用<code>vm</code>模块进行动态导入时相关。首先，让我带你了解一下背景知识，然后解释这个错误以及如何避免它。</p><h3 id="背景知识" tabindex="-1"><a class="header-anchor" href="#背景知识"><span>背景知识</span></a></h3><p><strong>Node.js:</strong><br> Node.js 是一个开源、跨平台的 JavaScript 运行环境，它允许你在服务器端运行 JavaScript 代码。Node.js 非常适用于构建网络应用。</p><p><strong>ES 模块与 CommonJS:</strong><br> 在 Node.js 中，有两种主要的模块系统：CommonJS 和 ES 模块。CommonJS 是 Node.js 原生支持的模块系统，而 ES 模块则是 ECMAScript 标准中定义的模块系统，近年来 Node.js 也开始支持。</p><p><strong>动态导入:</strong><br> 在 JavaScript 中，动态导入指的是在代码执行期间（而不是一开始）导入模块。这对于按需加载模块非常有用，可以提高应用的启动速度和性能。在 ES 模块中，动态导入通过<code>import()</code>函数实现。</p><h3 id="err-vm-dynamic-import-callback-missing错误" tabindex="-1"><a class="header-anchor" href="#err-vm-dynamic-import-callback-missing错误"><span><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code>错误</span></a></h3><p>当你在 Node.js 的<code>vm</code>模块的上下文中尝试使用动态导入（<code>import()</code>）但没有正确设置动态导入的回调函数时，就会遇到<code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code>错误。<code>vm</code>模块允许你运行 JavaScript 代码在 V8 虚拟机的隔离环境中，这对于执行沙箱化的代码片段很有用。</p><h3 id="示例场景" tabindex="-1"><a class="header-anchor" href="#示例场景"><span>示例场景</span></a></h3><p>假设你正在编写一个应用程序，需要在沙箱环境中运行一些用户提供的脚本，并且你想要在这些脚本中允许动态导入模块。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的上下文沙箱</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> context</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 动态导入语句的示例代码</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> code</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">import(&#39;path&#39;).then(module =</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;"> console.log(module))</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 在沙箱中运行代码</span></span>
<span class="line"><span style="color:#D8DEE9;">  vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">runInContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> context</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你运行上述代码，就会抛出<code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code>错误，因为我们尝试在<code>vm</code>模块的上下文中使用动态导入，但没有提供用于处理动态导入的回调函数。</p><h3 id="如何避免该错误" tabindex="-1"><a class="header-anchor" href="#如何避免该错误"><span>如何避免该错误</span></a></h3><p>为了避免这个错误，你需要确保在使用<code>vm</code>模块创建沙箱环境时正确地设置了动态导入回调函数。不过，截至目前（我的知识截止日期为 2023 年），<code>vm</code>模块并不直接支持在其上下文中设置动态导入回调。解决这个限制的一种方法是通过自定义解决方案来间接实现，或者考虑使用其他具有动态导入支持的方式执行代码。</p><h3 id="结语" tabindex="-1"><a class="header-anchor" href="#结语"><span>结语</span></a></h3><p><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code>错误提示我们在使用 Node.js 的<code>vm</code>模块进行动态导入时需要特别小心，确保我们按照 Node.js 的要求正确地处理动态导入。由于<code>vm</code>模块的这些限制，我们可能需要探索其他方法或库来安全地执行带有动态导入的代码。</p><h3 id="err-vm-module-already-linked" tabindex="-1"><a class="header-anchor" href="#err-vm-module-already-linked"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_already_linked" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_ALREADY_LINKED</a></span></a></h3><p>在解释<code>ERR_VM_MODULE_ALREADY_LINKED</code>错误之前，让我们首先了解一下 Node.js 中的几个关键概念：ES Modules (ESM), Virtual Machine (VM) 模块, 和链接（Linking）过程。</p><h3 id="es-modules-esm" tabindex="-1"><a class="header-anchor" href="#es-modules-esm"><span>ES Modules（ESM）</span></a></h3><p>ES Modules 是 ECMAScript（即 JavaScript）的官方标准化模块系统。在 Node.js 中，你可以使用<code>import</code>和<code>export</code>语句来导入和导出模块。这是一种组织和重用 JavaScript 代码的方式。</p><h3 id="virtual-machine-vm-模块" tabindex="-1"><a class="header-anchor" href="#virtual-machine-vm-模块"><span>Virtual Machine（VM）模块</span></a></h3><p>Node.js 的 VM 模块允许你在 V8 虚拟机的隔离环境中运行 JavaScript 代码。你可以使用它来创建一个新的上下文环境，这个环境拥有自己的全局变量等，与主 Node.js 环境分离。</p><h3 id="链接-linking" tabindex="-1"><a class="header-anchor" href="#链接-linking"><span>链接（Linking）</span></a></h3><p>当我们谈到模块的“链接”时，我们指的是一系列的预处理步骤，使得模块及其依赖关系准备好被执行。对于 ES Modules 而言，这包括解析模块的导入和导出，确保所有必要的文件都被装载进来。</p><h3 id="err-vm-module-already-linked-错误" tabindex="-1"><a class="header-anchor" href="#err-vm-module-already-linked-错误"><span><code>ERR_VM_MODULE_ALREADY_LINKED</code> 错误</span></a></h3><p>当你尝试重复链接一个已经链接的 ES Module 时，就会触发<code>ERR_VM_MODULE_ALREADY_LINKED</code>错误。在 VM 环境中，每个模块只允许进行一次链接操作。这是因为链接步骤不仅仅是加载模块内容，还包括设置模块的各种关系和状态，如果一个模块被重复链接，它的状态和关系可能会被错误地重置或混乱。</p><h3 id="实际例子-14" tabindex="-1"><a class="header-anchor" href="#实际例子-14"><span>实际例子</span></a></h3><p>假设你在使用 VM 模块来动态执行一些导入的 ES Module 代码。你可能会这样做：</p><ol><li>创建一个新的<code>vm.Module</code>实例。</li><li>使用<code>module.link()</code>函数来链接该模块，这会加载并解析所有必要的依赖。</li><li>如果你尝试再次对相同的模块实例调用<code>module.link()</code>，就会收到<code>ERR_VM_MODULE_ALREADY_LINKED</code>错误。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的ES Module</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> code</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">export const x = &#39;Hello World&#39;;</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> module</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SourceTextModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> loadAndLinkModule</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">module</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 链接模块</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">link</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">模块已链接</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">loadAndLinkModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#8FBCBB;">module</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 成功链接模块</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试再次链接相同模块</span></span>
<span class="line"><span style="color:#88C0D0;">loadAndLinkModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#8FBCBB;">module</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_VM_MODULE_ALREADY_LINKED</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，第二次尝试链接相同的模块会触发错误，因为每个模块只能被链接一次。</p><p>理解这个概念对于使用 Node.js 的 VM 模块和处理 ES Modules 非常重要。尽管有时候这个错误看起来可能很困惑，但它帮助开发者避免了可能导致程序行为异常的操作。</p><h3 id="err-vm-module-cached-data-rejected" tabindex="-1"><a class="header-anchor" href="#err-vm-module-cached-data-rejected"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_cached_data_rejected" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_CACHED_DATA_REJECTED</a></span></a></h3><p>当你使用 Node.js 中的 <code>vm</code> 模块来创建一个新的虚拟机（VM）环境时，有时你可能想要快速地加载和执行代码。为了加速这个过程，Node.js 允许你缓存编译过的模块。但是，在某些情况下，这些缓存的数据可能会被拒绝使用，这就是 <code>ERR_VM_MODULE_CACHED_DATA_REJECTED</code> 错误的由来。</p><h3 id="什么是-vm-模块" tabindex="-1"><a class="header-anchor" href="#什么是-vm-模块"><span>什么是 VM 模块？</span></a></h3><p>首先，来简单理解一下什么是 VM 模块。在 Node.js 中，<code>vm</code> 模块提供了在 V8 虚拟机中运行代码的能力。这意味着你可以在隔离的环境中执行 JavaScript 代码，而这段代码可以有它自己的作用域，而不会影响到主应用程序的全局作用域。这非常有用，比如在动态执行不可信代码的场景中。</p><h3 id="缓存编译过的模块" tabindex="-1"><a class="header-anchor" href="#缓存编译过的模块"><span>缓存编译过的模块</span></a></h3><p>为了提高性能，Node.js 允许你缓存编译过的模块。这样，当你需要再次执行相同的代码时，Node.js 可以直接使用缓存的版本，而不是重新编译，从而减少了开销。</p><h3 id="错误-err-vm-module-cached-data-rejected" tabindex="-1"><a class="header-anchor" href="#错误-err-vm-module-cached-data-rejected"><span>错误：ERR_VM_MODULE_CACHED_DATA_REJECTED</span></a></h3><p>错误 <code>ERR_VM_MODULE_CACHED_DATA_REJECTED</code> 发生的原因是，尝试使用的缓存数据不再有效或者不适合当前的上下文。这可能是因为：</p><ul><li>缓存的模块与当前 Node.js 运行环境的版本不兼容。</li><li>缓存的数据已损坏。</li><li>代码或环境自缓存数据生成以来已发生变化，使得缓存数据不再适用。</li></ul><h3 id="实际运用的例子-22" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-22"><span>实际运用的例子</span></a></h3><p>假设你正在开发一个应用程序，该程序需要动态执行一些插件代码。为了优化性能，你决定对这些插件代码进行编译并缓存。以下是一个简化的例子：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一个插件代码文件 plugin.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> pluginCode</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">plugin.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> script</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Script</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">pluginCode</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> cachedDataProduced</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">script</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">cachedDataRejected</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">缓存的数据被拒绝，将重新编译代码。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 处理缓存数据被拒绝的情况...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果 <code>script.cachedDataRejected</code> 是 <code>true</code>，意味着尝试使用的缓存数据被拒绝，你可能需要重新编译代码或者采取其他措施。</p><p>总之，<code>ERR_VM_MODULE_CACHED_DATA_REJECTED</code> 是一个指示 Node.js 中虚拟机模块的缓存数据无法被接受的错误。处理这个错误需要确保你的环境、代码和缓存策略是最新的，并且彼此兼容。</p><h3 id="err-vm-module-cannot-create-cached-data" tabindex="-1"><a class="header-anchor" href="#err-vm-module-cannot-create-cached-data"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_cannot_create_cached_data" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</a></span></a></h3><p>好的，我们这里来讲一个在 Node.js 中可能遇到的错误：<code>ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</code>。为了理解这个错误，我们首先需要明白几个概念：Node.js、VM 模块以及缓存数据。</p><h3 id="_1-node-js-简介" tabindex="-1"><a class="header-anchor" href="#_1-node-js-简介"><span>1. Node.js 简介</span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境，它让 JavaScript 可以用来编写服务器端的软件。Node.js 特别适合处理高并发、I/O 密集型的任务。</p><h3 id="_2-vm-模块简介" tabindex="-1"><a class="header-anchor" href="#_2-vm-模块简介"><span>2. VM 模块简介</span></a></h3><p>在 Node.js 中，VM 模块允许你在 V8 虚拟机的上下文中运行代码。简单来说，你可以创建一个沙箱环境来执行一段脚本，这样做可以避免脚本直接影响到你的主应用程序。</p><h3 id="_3-缓存数据简介" tabindex="-1"><a class="header-anchor" href="#_3-缓存数据简介"><span>3. 缓存数据简介</span></a></h3><p>当我们谈到缓存数据时，我们指的是为了提高性能而存储的数据。在 Node.js 中，有时候你可能会想要缓存编译过的模块，这样在下次运行相同模块时就不需要重新编译，从而加快执行速度。</p><h3 id="错误解释-err-vm-module-cannot-create-cached-data" tabindex="-1"><a class="header-anchor" href="#错误解释-err-vm-module-cannot-create-cached-data"><span>错误解释：ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</span></a></h3><p>现在，当你遇到<code>ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</code>这个错误时，这意味着 Node.js 尝试为在 VM 模块中运行的脚本创建缓存数据，但是失败了。这种情况通常发生在尝试缓存编译后的模块代码时，但由于某些原因（如权限问题、磁盘空间不足、或是缓存策略不支持等），Node.js 无法完成此操作。</p><h3 id="实际运用例子-4" tabindex="-1"><a class="header-anchor" href="#实际运用例子-4"><span>实际运用例子：</span></a></h3><ol><li><p><strong>开发一个自定义的沙箱环境</strong>：假设你正在开发一个在线代码编辑器，需要用 VM 模块来执行用户提交的代码，以隔离主应用程序和用户代码的执行环境。你可能希望为频繁执行的代码片段创建缓存，以提高性能。如果在设置缓存时遇到了<code>ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</code>错误，那么就需要检查是否有正确的文件写入权限，或者检查磁盘空间是否足够。</p></li><li><p><strong>优化应用启动时间</strong>：如果你在自己的 Node.js 应用中使用了 VM 模块来加载一些重要的业务逻辑，并且想通过缓存编译后的代码来减少启动时间。如果碰到<code>ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</code>错误，可能需要重新考虑你的缓存策略，或是确保你的运行环境满足创建缓存所需的条件。</p></li></ol><h3 id="总结-5" tabindex="-1"><a class="header-anchor" href="#总结-5"><span>总结</span></a></h3><p>总的来说，<code>ERR_VM_MODULE_CANNOT_CREATE_CACHED_DATA</code>是一个指示 Node.js 在尝试为 VM 模块中的代码创建缓存时遇到问题的错误。面对这个错误，检查文件系统权限、磁盘空间和你的缓存策略是解决问题的关键步骤。</p><h3 id="err-vm-module-different-context" tabindex="-1"><a class="header-anchor" href="#err-vm-module-different-context"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_different_context" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_DIFFERENT_CONTEXT</a></span></a></h3><p>理解<code>ERR_VM_MODULE_DIFFERENT_CONTEXT</code>错误，首先我们需要了解几个概念：Node.js、虚拟机(VM)模块以及上下文(Context)。</p><h3 id="node-js-简介" tabindex="-1"><a class="header-anchor" href="#node-js-简介"><span>Node.js 简介</span></a></h3><p>Node.js 是一个开源且跨平台的 JavaScript 运行环境。它允许你在服务器端运行 JavaScript，而不仅仅是在浏览器中。这意味着你可以使用 JavaScript 来编写后端代码，创建网站后台、开发 API 等。</p><h3 id="vm-模块和上下文-context" tabindex="-1"><a class="header-anchor" href="#vm-模块和上下文-context"><span>VM 模块和上下文（Context）</span></a></h3><ul><li><p><strong>VM 模块</strong>：Node.js 的 VM 模块提供了在 V8 虚拟机内部执行 JavaScript 代码的 API。简单来说，它允许你运行和评估 JavaScript 代码，就像它是在一个全新的、独立于当前全局作用域的环境中执行一样。这对于隔离代码执行非常有用。</p></li><li><p><strong>上下文（Context）</strong>：当我们谈论上下文（Context）时，我们指的是执行代码时定义的变量、对象和函数的环境。每当代码在新的上下文中执行时，它就好像有了一个全新的、空白的环境，之前定义的变量或对象在这个新环境中是不可见的，除非显式地传入。</p></li></ul><h3 id="解释err-vm-module-different-context" tabindex="-1"><a class="header-anchor" href="#解释err-vm-module-different-context"><span>解释<code>ERR_VM_MODULE_DIFFERENT_CONTEXT</code></span></a></h3><p>这个错误发生在尝试使用来自一个上下文的 VM 模块（比如通过<code>vm.createContext()</code>创建的上下文）与另一个上下文互动时。简单地说，当你尝试在一个上下文中执行或者导入一个为另一个上下文创建的模块时，你会遇到<code>ERR_VM_MODULE_DIFFERENT_CONTEXT</code>错误。Node.js 期望模块的上下文与执行它们的上下文匹配，否则会抛出这个错误。</p><h3 id="实例演示-1" tabindex="-1"><a class="header-anchor" href="#实例演示-1"><span>实例演示</span></a></h3><p>假设我们有两个上下文，我们在第一个上下文中创建了一个模块，然后尝试在另一个完全不同的上下文中使用这个模块。以下是一个简化的示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建第一个上下文</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> contextA</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 在第一个上下文中评估一个模块</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> moduleInContextA</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SourceTextModule</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &#39;</span><span style="color:#A3BE8C;">export default &quot;Hello from Context A&quot;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  {</span><span style="color:#88C0D0;"> context</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> contextA</span><span style="color:#ECEFF4;"> }</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建第二个上下文</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> contextB</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试在第二个上下文中链接第一个上下文中创建的模块</span></span>
<span class="line"><span style="color:#D8DEE9;">moduleInContextA</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">link</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 这里通常你会返回待链接的模块，但问题在于我们尝试在不同的上下文中执行这一操作</span></span>
<span class="line"><span style="color:#81A1C1;">    throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">这里会失败，因为moduleInContextA是为contextA创建的，现在我们尝试在contextB中使用它</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将捕获到 ERR_VM_MODULE_DIFFERENT_CONTEXT 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们创建了两个不同的上下文，并在第一个上下文中创建和评估了一个模块。随后，我们尝试在第二个上下文中链接这个模块，这会导致<code>ERR_VM_MODULE_DIFFERENT_CONTEXT</code>错误，因为模块是针对特定上下文创建的，而我们尝试在一个不同的上下文中使用它。</p><h3 id="结论-3" tabindex="-1"><a class="header-anchor" href="#结论-3"><span>结论</span></a></h3><p>在实际应用中，正确管理和使用上下文非常重要，尤其是当涉及到 VM 模块和执行隔离代码时。确保模块和它们执行的上下文相匹配，可以避免<code>ERR_VM_MODULE_DIFFERENT_CONTEXT</code>等错误。这种机制使得 Node.js 能够安全有效地处理不同来源或需要隔离执行的代码片段。</p><h3 id="err-vm-module-link-failure" tabindex="-1"><a class="header-anchor" href="#err-vm-module-link-failure"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_link_failure" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_LINK_FAILURE</a></span></a></h3><p>要理解<code>ERR_VM_MODULE_LINK_FAILURE</code>错误，首先得知道 Node.js 中的 VM 模块和 ES Modules（ESM）是什么。</p><h3 id="vm-模块" tabindex="-1"><a class="header-anchor" href="#vm-模块"><span>VM 模块</span></a></h3><p>在 Node.js 中，VM 模块允许你编译并运行代码在一个独立的沙箱环境中。这个功能被用于在隔离的上下文中执行代码，这意味着你可以执行一些代码而不会影响到当前的全局作用域，从而避免潜在的冲突或安全问题。</p><h3 id="es-modules-esm-1" tabindex="-1"><a class="header-anchor" href="#es-modules-esm-1"><span>ES Modules（ESM）</span></a></h3><p>ES Modules 是 ECMAScript（即 JavaScript）的官方标准格式，用来组织和重用 JavaScript 代码。与传统的 CommonJS 模式相比，ES Modules 提供了更为现代化和灵活的方式来导入和导出模块。</p><h3 id="err-vm-module-link-failure错误" tabindex="-1"><a class="header-anchor" href="#err-vm-module-link-failure错误"><span><code>ERR_VM_MODULE_LINK_FAILURE</code>错误</span></a></h3><p>当你使用 Node.js 的 VM 模块来动态地编译和运行 ES Modules 代码时，如果在“链接”过程中发生错误，就会抛出<code>ERR_VM_MODULE_LINK_FAILURE</code>。所谓的“链接”，指的是解析模块间依赖关系的过程。简单来说，这个错误意味着 Node.js 试图加载或执行一个或多个 ES Modules 时失败了，可能是因为找不到模块、权限问题或其他一些无法正常导入模块的原因。</p><h3 id="实际例子-15" tabindex="-1"><a class="header-anchor" href="#实际例子-15"><span>实际例子</span></a></h3><p>假设你正在尝试在沙箱环境中动态执行一段包含 ES Module 导入的代码。考虑以下场景：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设我们有一个名为&#39;my-module.mjs&#39;的模块文件，我们想在沙箱环境中导入它</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> moduleCode</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/my-module.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 使用vm模块创建一个新的上下文，并尝试在其中运行my-module.mjs的代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> contextifiedObject</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">runInContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">moduleCode</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> contextifiedObject</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    importModuleDynamically</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>my-module.mjs</code>的依赖无法正确解析或加载，或者<code>runInContext</code>方法配置不恰当，就可能触发<code>ERR_VM_MODULE_LINK_FAILURE</code>。</p><h3 id="处理建议" tabindex="-1"><a class="header-anchor" href="#处理建议"><span>处理建议</span></a></h3><ul><li>确保所有模块及其依赖都位于正确的路径上，且对运行环境可访问。</li><li>检查模块的导入声明是否正确，没有语法或类型错误。</li><li>如果是权限问题，请确保 Node.js 进程有足够的权限去读取相关的模块文件。</li></ul><p>通过细心检查代码，并调整配置或修正路径等问题，大多数情况下可以解决这个错误。</p><h3 id="err-vm-module-not-module" tabindex="-1"><a class="header-anchor" href="#err-vm-module-not-module"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_not_module" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_NOT_MODULE</a></span></a></h3><p>了解<code>ERR_VM_MODULE_NOT_MODULE</code>错误，我们首先需要知道 Node.js 中的两个概念：VM（虚拟机）和 ESM（ECMAScript 模块）。在 Node.js 中，VM 模块允许你通过 JavaScript 代码来编译和运行其他 JavaScript 代码。而 ESM 是一种使用<code>import</code>和<code>export</code>语句来组织和复用 JavaScript 代码的标准格式。</p><p>当你尝试在 Node.js 的 VM 模块内使用<code>vm.Module</code>类来动态地创建并执行一个 ESM 时，如果你没有正确地将代码标记为一个模块，就可能会遇到<code>ERR_VM_MODULE_NOT_MODULE</code>这个错误。</p><h3 id="解释-2" tabindex="-1"><a class="header-anchor" href="#解释-2"><span>解释：</span></a></h3><p>简单来说，<code>ERR_VM_MODULE_NOT_MODULE</code>错误意味着 Node.js 预期你提供的代码是一个模块，但实际上它没有被正确地识别或处理为一个模块。这通常是因为在使用<code>vm.Module</code>或相关 API 时，代码缺少了必要的模块结构或者没按照预期声明。</p><h3 id="实际运用的例子-23" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-23"><span>实际运用的例子：</span></a></h3><p>假设你想在 Node.js 应用程序中动态执行一些模块代码。为此，你可能尝试如下操作：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试创建一个新的ES模块实例并执行它</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> code</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">export const x = &#39;hello world&#39;;</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这段代码是打算作为一个模块来执行的</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> module</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SourceTextModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 在这里，我们本意是将上面的code字符串作为一个模块执行，</span></span>
<span class="line"><span style="color:#616E88;">  // 但如果没有按照正确的方式处理，就可能抛出ERR_VM_MODULE_NOT_MODULE错误。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，我们尝试通过<code>vm.SourceTextModule</code>来创建并执行一个简单的 ES 模块。这段代码看起来很简单，但如果在一个更复杂的环境中或者因为某些配置问题，Node.js 无法正确地将<code>code</code>变量中的内容识别为模块，就会抛出<code>ERR_VM_MODULE_NOT_MODULE</code>错误。</p><h3 id="如何解决-2" tabindex="-1"><a class="header-anchor" href="#如何解决-2"><span>如何解决？</span></a></h3><p>要解决这个错误，确保你正在处理的代码确实符合 ESM 的规范，特别是如果你正在动态生成代码串来执行。此外，你还需要检查是否正确地使用了<code>vm.Module</code>相关的 API，并且提供给这些 API 的参数符合预期。通常，仔细阅读 Node.js 的官方文档，并查看相关示例代码会有很大帮助。</p><p>总之，<code>ERR_VM_MODULE_NOT_MODULE</code>错误涉及到模块识别和处理的问题，在动态执行代码时尤其需要注意代码的格式和结构，以确保它们可以被 Node.js 正确地理解为模块。</p><h3 id="err-vm-module-status" tabindex="-1"><a class="header-anchor" href="#err-vm-module-status"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_status" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_STATUS</a></span></a></h3><p>了解 Node.js 中的<code>ERR_VM_MODULE_STATUS</code>错误涉及到 Node.js 的 VM 模块和 ES Modules。我会逐步解释这些概念，并给出实际应用例子来帮你更好地理解。</p><h3 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h3><p>首先，Node.js 是一个强大的 JavaScript 运行时环境，它允许你在服务器端运行 JavaScript 代码。Node.js 支持各种模块类型，其中最常见的是 CommonJS（require/exports）和 ES Modules（import/export）。</p><h3 id="vm-模块-1" tabindex="-1"><a class="header-anchor" href="#vm-模块-1"><span>VM 模块</span></a></h3><p>在 Node.js 中，<code>vm</code>模块提供了在 V8 虚拟机中编译和运行代码的 API。它可以用于执行 JavaScript 代码字符串，这对于动态生成并执行代码、创建沙箱环境等场景非常有用。</p><h3 id="es-modules" tabindex="-1"><a class="header-anchor" href="#es-modules"><span>ES Modules</span></a></h3><p>ES Modules 是 ECMAScript 的官方标准化模块系统，采用<code>import</code>和<code>export</code>语句来导入导出模块成员。Node.js 从 v12 开始逐步增加对 ES Modules 的支持。</p><h3 id="err-vm-module-status-错误" tabindex="-1"><a class="header-anchor" href="#err-vm-module-status-错误"><span>ERR_VM_MODULE_STATUS 错误</span></a></h3><p>当你使用 vm 模块尝试执行与 ES Modules 相关的操作时，如果不满足某些条件或者操作不当，就可能遇到<code>ERR_VM_MODULE_STATUS</code>错误。这个错误意味着尝试以不正确的状态操作模块，比如尝试再次执行已经完成的模块。</p><h3 id="实际运用例子-5" tabindex="-1"><a class="header-anchor" href="#实际运用例子-5"><span>实际运用例子</span></a></h3><p>假设你正在开发一个 Node.js 应用，你想动态加载并执行一段 ES Module 代码。你可能会这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">promises</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> loadAndRunModule</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> source</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">filePath</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> encoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> module</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SourceTextModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">source</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 模块的选项</span></span>
<span class="line"><span style="color:#88C0D0;">    context</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">link</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">evaluate</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">loadAndRunModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/your/module.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个示例展示了如何使用<code>vm</code>模块加载并执行一个 ES Module 文件。过程包括读取文件、创建一个新的<code>SourceTextModule</code>实例，链接模块依赖，并执行模块。</p><p>如果在这个过程中你尝试对一个已经执行（或处于其他不允许的状态）的模块进行操作（比如重新执行<code>module.evaluate()</code>），Node.js 将抛出<code>ERR_VM_MODULE_STATUS</code>错误。这意味着你试图以错误的方式操作模块，例如重新评估一个已经评估完毕的模块。</p><h3 id="总结-6" tabindex="-1"><a class="header-anchor" href="#总结-6"><span>总结</span></a></h3><p><code>ERR_VM_MODULE_STATUS</code>错误通常表示模块状态管理方面的问题，特别是当你通过<code>vm</code>模块处理 ES Modules 时。理解 ES Modules 的工作流程和<code>vm</code>模块的使用方式有助于避免这类错误，确保代码以合理且有效的方式运行。</p><h3 id="err-wasi-already-started" tabindex="-1"><a class="header-anchor" href="#err-wasi-already-started"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_wasi_already_started" target="_blank" rel="noopener noreferrer">ERR_WASI_ALREADY_STARTED</a></span></a></h3><p>当你使用 Node.js 特别是 v21.7.1 版本，有一个错误类型你可能会遇到：<code>ERR_WASI_ALREADY_STARTED</code>。要理解这个错误，我们首先需要了解两个概念：Node.js 和 WASI。</p><p><strong>Node.js</strong> 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，允许在服务器端运行 JavaScript 代码。这意味着你可以构建服务器、访问数据库、处理文件等，全部使用 JavaScript。</p><p><strong>WASI</strong>（WebAssembly System Interface）是一种标准，旨在使 WebAssembly（一种能够让网页更快加载和执行代码的技术）能够在各种不同的系统中以一种安全且兼容的方式运行。简单来说，WASI 让 WebAssembly 代码能够像普通应用程序一样访问系统资源，比如文件系统和网络。</p><p>现在我们来解释<code>ERR_WASI_ALREADY_STARTED</code>这个错误。这个错误发生的时候，意味着你的 Node.js 应用试图初始化 WASI 实例超过了一次。在大多数情况下，WASI 只需要初始化一次，然后它就可以运行并提供服务给你的应用程序。如果尝试再次初始化，Node.js 会抛出<code>ERR_WASI_ALREADY_STARTED</code>错误，提示 WASI 已经启动。</p><h3 id="实际运用示例-1" tabindex="-1"><a class="header-anchor" href="#实际运用示例-1"><span>实际运用示例</span></a></h3><p>假设你正在开发一个 Node.js 应用，该应用需要执行一些编译为 WebAssembly 的高性能代码片段。为了这个目的，你可能会选择使用 WASI 作为与这些 WebAssembly 模块交互的接口。</p><ol><li><p><strong>初始化 WASI 实例：</strong> 在你的应用中，你首先需要创建一个 WASI 实例。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> WASI</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">wasi</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> wasi</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> WASI</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>重复初始化问题：</strong> 如果你的代码在应用的另一个部分或者由于某种原因再次尝试进行类似初始化操作，就会遇到<code>ERR_WASI_ALREADY_STARTED</code>的错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设这段代码在你的应用另一部分被意外执行了一次</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> anotherWasiInstance</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> WASI</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将会抛出 ERR_WASI_ALREADY_STARTED 错误</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>正确的处理方式：</strong> 为了避免这个错误，你需要确保整个应用中 WASI 只被初始化一次。这通常意味着将 WASI 实例的创建放在一个中心化的位置，并通过适当的应用架构确保它只被创建一次。</p></li></ol><p>通过这个例子，你可以看到<code>ERR_WASI_ALREADY_STARTED</code>错误是怎样在试图对 WASI 进行重复初始化时发生的。有效地管理 WASI 实例的创建和使用，可以帮助你避免这种错误，确保你的 Node.js 应用能够正常运行。</p><h3 id="err-wasi-not-started" tabindex="-1"><a class="header-anchor" href="#err-wasi-not-started"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_wasi_not_started" target="_blank" rel="noopener noreferrer">ERR_WASI_NOT_STARTED</a></span></a></h3><p>要理解<code>ERR_WASI_NOT_STARTED</code>这个错误，我们首先需要了解几个概念：Node.js、WASI，以及为什么会遇到这种错误。</p><p><strong>Node.js 简介</strong></p><p>Node.js 是一个开源和跨平台的 JavaScript 运行环境。它允许你在服务器端运行 JavaScript，这意味着你可以用 JavaScript 来写一些后端代码，比如处理网站的请求、访问数据库等。Node.js 特别适用于构建快速的、可扩展的网络应用程序。</p><p><strong>WASI 简介</strong></p><p>WASI 全称为 WebAssembly System Interface，是一个开放标准，旨在使 WebAssembly 能够在所有类型的计算设备和操作系统上安全地运行。简单来说，它提供了一个沙盒环境，让 WebAssembly 代码可以访问系统资源（如文件系统和网络），但又不会影响系统的稳定性和安全性。</p><p><strong>现在来谈谈<code>ERR_WASI_NOT_STARTED</code></strong></p><p>在 Node.js 中，如果你尝试在没有正确初始化 WASI 实例的情况下执行与 WASI 相关的操作，就会遇到<code>ERR_WASI_NOT_STARTED</code>错误。这意味着，你试图使用 WASI 的功能，但是在此之前并没有按照必需的步骤启动或配置 WASI 环境。</p><p><strong>举个例子</strong>：</p><p>想象你正在玩一个电子游戏，在开始游戏之前，你必须先打开游戏机。如果你未开启游戏机就试图开始游戏，显然是不行的。这里的“游戏机未开启”类似于<code>ERR_WASI_NOT_STARTED</code>——即尝试执行操作，但必要的初始化还没完成。</p><p><strong>实际运用的例子</strong>：</p><ol><li><p><strong>WebAssembly 应用开发</strong>：假设你正在 Node.js 环境下开发一个应用，该应用依赖于 WebAssembly 模块来执行某些高性能计算任务，比如图像处理或者大数据分析。你可能会创建一个 WASI 实例来启动这个 WebAssembly 模块。如果你在创建并启动 WASI 实例之前就尝试调用 WebAssembly 模块的功能，那么你就会遇到<code>ERR_WASI_NOT_STARTED</code>错误。</p></li><li><p><strong>命令行工具</strong>：你可能正在开发一个基于 Node.js 的命令行工具，该工具用 WebAssembly 进行一些复杂的加密操作。如果你在工具代码中忘记了初始化 WASI 实例，当用户尝试执行加密操作时，程序会因为<code>ERR_WASI_NOT_STARTED</code>而失败。</p></li></ol><p><strong>如何解决</strong>：</p><p>解决<code>ERR_WASI_NOT_STARTED</code>错误的关键是确保在尝试执行任何 WASI 相关操作之前，正确地初始化和启动 WASI 实例。这通常涉及到几个步骤，包括创建 WASI 实例并为其配置必要的选项（如预期的系统资源访问权限），然后启动实例。</p><p>通过理解 Node.js 和 WASI 的基础知识，以及<code>ERR_WASI_NOT_STARTED</code>错误产生的原因，你将更好地掌握在开发中如何有效地利用 WebAssembly，并且能够避免一些常见的错误。</p><h3 id="err-webassembly-response" tabindex="-1"><a class="header-anchor" href="#err-webassembly-response"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_webassembly_response" target="_blank" rel="noopener noreferrer">ERR_WEBASSEMBLY_RESPONSE</a></span></a></h3><p>Node.js 中的<code>ERR_WEBASSEMBLY_RESPONSE</code>错误是一个专门用于 WebAssembly 模块加载过程中的报错。为了更好地理解这个概念，我将先解释一些基础知识，然后再具体到这个错误本身。</p><h3 id="基础知识-1" tabindex="-1"><a class="header-anchor" href="#基础知识-1"><span>基础知识</span></a></h3><p><strong>Node.js</strong>: 它是一个开源和跨平台的 JavaScript 运行时环境，让你可以在服务器端运行 JavaScript 代码。Node.js 广泛应用于构建网络应用。</p><p><strong>WebAssembly</strong>: 简称 WASM, 是一种为网络浏览器设计的低级编程语言，它允许其他高级语言（如 C、C++、Rust 等）编写的程序被编译成二进制格式，在网页中以接近原生性能执行。</p><h3 id="err-webassembly-response错误" tabindex="-1"><a class="header-anchor" href="#err-webassembly-response错误"><span><code>ERR_WEBASSEMBLY_RESPONSE</code>错误</span></a></h3><p>当你在 Node.js 环境中尝试通过某些 API（如<code>WebAssembly.instantiateStreaming</code>）异步地加载和实例化 WebAssembly 模块时，如果遇到响应或数据流的问题，就可能会引发<code>ERR_WEBASSEMBLY_RESPONSE</code>错误。简单来说，这个错误通常意味着 Node.js 期望从一个资源（比如服务器）获取 WebAssembly 模块的过程中出现了问题。</p><h3 id="实际运用例子-6" tabindex="-1"><a class="header-anchor" href="#实际运用例子-6"><span>实际运用例子</span></a></h3><p>假设你正在开发一个 Node.js 应用，该应用需要利用 WebAssembly 模块进行图像处理。你可能会采用以下方式之一来加载这个模块：</p><ol><li><strong>直接从文件系统加载</strong>: 使用<code>fs</code>模块读取 WASM 文件内容，然后使用<code>WebAssembly.instantiate</code>同步加载和实例化模块。</li><li><strong>从网络加载</strong>: 使用<code>fetch</code>或 Node.js 的<code>http</code>/<code>https</code>模块请求 WASM 文件，然后使用<code>WebAssembly.instantiateStreaming</code>异步加载和实例化模块。</li></ol><p>如果你选择第二种方法，并且在请求 WASM 文件时，服务器响应不正确（例如，返回 404 状态码，或者内容类型（MIME type）不是期望的<code>application/wasm</code>），Node.js 则可能抛出<code>ERR_WEBASSEMBLY_RESPONSE</code>错误。</p><h3 id="解决办法-1" tabindex="-1"><a class="header-anchor" href="#解决办法-1"><span>解决办法</span></a></h3><ul><li>检查请求 URL 是否正确，并且服务器确实支持对应路径的请求。</li><li>确认服务器正确设置了 WASM 文件的内容类型为<code>application/wasm</code>。</li><li>如果问题仍然存在，考虑从文件系统直接加载 WASM 模块，或者先下载 WASM 文件再加载。</li></ul><p>通过理解这个错误及其产生的条件，你可以更有效地调试和解决与 WebAssembly 模块加载相关的问题。</p><h3 id="err-worker-init-failed" tabindex="-1"><a class="header-anchor" href="#err-worker-init-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_init_failed" target="_blank" rel="noopener noreferrer">ERR_WORKER_INIT_FAILED</a></span></a></h3><p>理解 Node.js 中的<code>ERR_WORKER_INIT_FAILED</code>错误，我们首先需要了解一些背景知识。</p><h3 id="什么是-node-js" tabindex="-1"><a class="header-anchor" href="#什么是-node-js"><span>什么是 Node.js？</span></a></h3><p>Node.js 是一个开源、跨平台的 JavaScript 运行环境，让你可以在服务器端运行 JavaScript 代码。这意味着你可以使用 JavaScript 来开发后端功能，比如与数据库交互、文件操作等，而不仅仅是在浏览器中运行 JS 来控制网页行为。</p><h3 id="node-js-中的-worker-threads" tabindex="-1"><a class="header-anchor" href="#node-js-中的-worker-threads"><span>Node.js 中的 Worker Threads</span></a></h3><p>在 Node.js 中，主要的执行线程被称为&quot;主线程&quot;。虽然 Node.js 是单线程的（即默认所有代码都在一个线程上执行），但它支持通过“工作线程（Worker Threads）”来实现多线程。这允许 Node.js 应用以并行方式处理任务，提高性能和效率，特别是对于 CPU 密集型操作。</p><h3 id="什么是err-worker-init-failed" tabindex="-1"><a class="header-anchor" href="#什么是err-worker-init-failed"><span>什么是<code>ERR_WORKER_INIT_FAILED</code>?</span></a></h3><p><code>ERR_WORKER_INIT_FAILED</code>是一个错误类型，它在 Node.js 中出现时表明创建一个新的 Worker 线程失败了。这意味着尝试分离出来运行一段代码的线程并没有像预期那样启动，这可能是因为各种原因导致的，如系统资源不足、权限问题或者是因为传给 Worker 构造函数的脚本路径有误等。</p><h3 id="实际运用的例子-24" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-24"><span>实际运用的例子</span></a></h3><p>假设你正在开发一个 Node.js 应用，该应用需要处理大量图像处理任务，这是一个 CPU 密集型的操作。为了不阻塞主线程（即保持应用的响应性），你决定使用 Worker Threads 来并行处理这些任务。以下是简化的代码示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 主线程代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">开始处理图像</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 工作线程代码</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">msg</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 这里进行图像处理</span></span>
<span class="line"><span style="color:#D8DEE9;">    parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">图像处理完成</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在尝试创建 Worker 时发生了某些错误，比如指定给 Worker 构造函数的文件路径不存在，那么就会抛出<code>ERR_WORKER_INIT_FAILED</code>错误。</p><h3 id="如何处理这个错误-5" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-5"><span>如何处理这个错误？</span></a></h3><p>处理<code>ERR_WORKER_INIT_FAILED</code>错误的方法取决于错误的具体原因。一些可能的解决方案包括：</p><ul><li>确保传给 Worker 的文件路径正确无误。</li><li>检查系统资源（如内存、CPU）是否充足。</li><li>如果是权限相关的问题，确保 Node.js 进程有足够的权限去创建线程。</li></ul><p>总之，当你遇到<code>ERR_WORKER_INIT_FAILED</code>错误时，需要仔细检查 Worker 线程创建失败的原因，并采取相应的措施解决问题。</p><h3 id="err-worker-invalid-exec-argv" tabindex="-1"><a class="header-anchor" href="#err-worker-invalid-exec-argv"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_invalid_exec_argv" target="_blank" rel="noopener noreferrer">ERR_WORKER_INVALID_EXEC_ARGV</a></span></a></h3><p>在 Node.js 中，<code>ERR_WORKER_INVALID_EXEC_ARGV</code> 是一个错误代码，它与 Workers 相关。Workers 允许你在 Node.js 应用中执行多线程操作，这是通过 <code>Worker threads</code> 模块实现的。这个错误通常发生在尝试以不恰当的方式使用或配置 Worker 线程时。</p><h3 id="解释-3" tabindex="-1"><a class="header-anchor" href="#解释-3"><span>解释</span></a></h3><p>在深入了解这个错误之前，先简要解释一下什么是 Worker 线程：</p><p>Node.js 主要是单线程的，但为了充分利用多核 CPU 的计算能力，Node.js 提供了 Worker 线程。这允许你创建多个线程，每个线程都在其自己的独立环境中运行 JavaScript 代码，使得可以并行处理任务，而不会相互干扰。</p><p><code>ERR_WORKER_INVALID_EXEC_ARGV</code> 错误发生于以下场景：</p><p>当你尝试创建一个新的 Worker 线程，并且传入的 <code>execArgv</code> 选项包含不合适的参数时，就会抛出 <code>ERR_WORKER_INVALID_EXEC_ARGV</code>。<code>execArgv</code> 通常用于指定 Node.js 进程启动时的标志（例如调试相关的标志），但如果传给 Worker 的 <code>execArgv</code> 包含了一些不能应用于 Worker 或格式错误的参数，Node.js 将无法理解这些参数，从而导致这个错误的产生。</p><h3 id="实际应用的例子" tabindex="-1"><a class="header-anchor" href="#实际应用的例子"><span>实际应用的例子</span></a></h3><p>假设你正在编写一个 Node.js 应用程序，该程序需要进行大量的数据处理工作，你决定使用 Worker 线程来并行化这些工作，以提高效率。</p><h4 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码"><span>示例代码：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 这是主线程</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">      execArgv</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">--invalid-flag</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span><span style="color:#616E88;"> // 故意放置一个无效的标志</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">创建 Worker 失败: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 如果有错误，比如 ERR_WORKER_INVALID_EXEC_ARGV，将会被捕获</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 这是 Worker 线程</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello from worker!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个示例中，我们尝试创建一个 Worker 线程来发送一条消息。注意，在创建 Worker 时，我们故意添加了一个名为 <code>--invalid-flag</code> 的无效标志到 <code>execArgv</code>。这将导致 Node.js 抛出 <code>ERR_WORKER_INVALID_EXEC_ARGV</code> 错误，因为 <code>--invalid-flag</code> 不是一个合法或者正确的 Node.js 启动标志。</p><h3 id="如何解决-3" tabindex="-1"><a class="header-anchor" href="#如何解决-3"><span>如何解决</span></a></h3><p>要解决 <code>ERR_WORKER_INVALID_EXEC_ARGV</code> 错误，确保传递给 <code>execArgv</code> 的所有参数都是有效的 Node.js 标志，且格式正确。如果你不确定某个标志是否有效，可以查阅 Node.js 文档或通过命令行使用 <code>node --help</code> 查看所有可用的 Node.js 启动标志。</p><p>通过移除无效标志或更正标志的格式，你应该能够避免这个错误，顺利地使用 Worker 线程在你的 Node.js 应用中执行多线程任务。</p><h3 id="err-worker-not-running" tabindex="-1"><a class="header-anchor" href="#err-worker-not-running"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_not_running" target="_blank" rel="noopener noreferrer">ERR_WORKER_NOT_RUNNING</a></span></a></h3><p>当我们谈论 Node.js 中的<code>ERR_WORKER_NOT_RUNNING</code>错误时，我们正在探讨与 Worker Threads 模块相关的一个特定问题。首先，让我们分步骤地解释这些概念，以便你能清楚地理解这个错误背后的含义和它在实际应用中的影响。</p><h3 id="什么是-node-js-1" tabindex="-1"><a class="header-anchor" href="#什么是-node-js-1"><span>什么是 Node.js?</span></a></h3><p>Node.js 是一个开源、跨平台的 JavaScript 运行环境，它允许开发人员使用 JavaScript 来编写服务器端代码。它以其非阻塞 I/O 模型而著称，这使得它非常适合构建高性能、需要处理大量并发连接的网络应用程序。</p><h3 id="什么是-worker-threads" tabindex="-1"><a class="header-anchor" href="#什么是-worker-threads"><span>什么是 Worker Threads?</span></a></h3><p>在 Node.js 中，JavaScript 通常在单一的主线程上执行，这意味着所有的代码都在同一个线程上运行。然而，对于需要大量计算且可能阻塞主线程的任务，这可能成为性能瓶颈。因此，Node.js 引入了 Worker Threads（工作线程），使得可以在后台线程上运行任务，从而不会干扰主线程的执行。</p><h3 id="err-worker-not-running-错误解释" tabindex="-1"><a class="header-anchor" href="#err-worker-not-running-错误解释"><span>ERR_WORKER_NOT_RUNNING 错误解释</span></a></h3><p><code>ERR_WORKER_NOT_RUNNING</code>是一个错误码，它表明尝试在一个没有运行的工作线程上进行操作。简单来说，当你尝试与已经停止或尚未启动的工作线程交互时，就会遇到这个错误。</p><h3 id="实际运用示例-2" tabindex="-1"><a class="header-anchor" href="#实际运用示例-2"><span>实际运用示例</span></a></h3><p>假设你正在构建一个 Web 应用程序，该应用程序需要处理一项复杂的数据分析任务。你决定使用 Worker Thread 来避免这个计算密集型任务阻塞主线程，提高应用性能。</p><ol><li><p><strong>创建并启动 Worker Thread</strong></p><p>首先，你创建一个新的 Worker Thread 来执行数据分析任务。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建Worker，并指定要在Worker中运行的脚本</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./data-analysis-task.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>使用 Worker 进行通信</strong></p><p>你可以使用<code>postMessage()</code>方法向 Worker 发送消息，并使用<code>on(&#39;message&#39;)</code>事件监听器接收来自 Worker 的消息。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">开始数据分析任务</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">分析结果:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>停止 Worker</strong></p><p>一旦任务完成，你可以通过调用<code>worker.terminate()</code>方法来停止 Worker。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">terminate</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Worker已停止</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>遇到 ERR_WORKER_NOT_RUNNING 错误</strong></p><p>如果你在 Worker 已被终止之后尝试再次与之通信或操作，就会遇到<code>ERR_WORKER_NOT_RUNNING</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">尝试在Worker停止后发送消息</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 这将抛出ERR_WORKER_NOT_RUNNING错误，因为Worker已经停止。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="结论-4" tabindex="-1"><a class="header-anchor" href="#结论-4"><span>结论</span></a></h3><p>通过以上示例，你可以看到<code>ERR_WORKER_NOT_RUNNING</code>错误发生在尝试与一个已停止的 Worker Thread 进行交互时。理解这一点对于构建使用 Worker Threads 的 Node.js 应用程序非常重要，因为正确管理 Worker 的生命周期是避免此类错误的关键。正确使用 Worker Threads 可以显著提升应用程序处理并发任务的能力，从而提高性能和用户体验。</p><h3 id="err-worker-out-of-memory" tabindex="-1"><a class="header-anchor" href="#err-worker-out-of-memory"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_out_of_memory" target="_blank" rel="noopener noreferrer">ERR_WORKER_OUT_OF_MEMORY</a></span></a></h3><p>理解 <code>[ERR_WORKER_OUT_OF_MEMORY]</code> 错误，在讨论 Node.js v21.7.1 版本的上下文中，首先需要知道几个基础概念：Node.js、Worker Threads（工作线程）和内存。</p><p><strong>Node.js 简介</strong>：<br> Node.js 是一种开源且跨平台的 JavaScript 运行环境，它允许你在服务器端运行 JavaScript。这意味着可以用 JavaScript 编写服务器处理逻辑，比如处理网页请求、访问数据库等。</p><p><strong>Worker Threads 简介</strong>：<br> 在 Node.js 中，Worker Threads 提供了一种将任务并行执行的方式。默认情况下，Node.js 运行在单个线程中，称为主线程。但是，有些操作可能非常耗时（比如大量计算或读写操作），这会阻塞主线程。为了避免这种情况，可以使用 Worker Threads 来在后台执行这些耗时的操作，这样主线程就可以继续处理其他事务，提高了应用的效率和响应速度。</p><p><strong>内存</strong>：<br> 当你运行一个程序时，它需要在计算机的内存中存储数据和代码。内存是有限资源，如果一个程序尝试使用超出系统分配给它的内存，那么程序就会因为内存不足而崩溃或出错。</p><p><strong>[ERR_WORKER_OUT_OF_MEMORY]</strong>：<br> 这个错误标识在 Node.js 应用中，一个 Worker Thread 尝试使用的内存超过了为其分配的最大内存限制。每个 Worker Thread 可以被分配一定量的内存，如果工作线程中的计算或者数据处理要求的内存超出了这个限制，Node.js 就会抛出 <code>ERR_WORKER_OUT_OF_MEMORY</code> 错误。</p><p><strong>实际运用例子</strong>：</p><ol><li><p><strong>图像处理</strong>：假设你正在开发一个网站，用户可以上传图片进行编辑（比如调整大小、应用滤镜等）。这种类型的任务往往非常消耗 CPU 和内存资源。你可以使用 Worker Threads 来处理图像，从而不会阻塞主线程。如果处理高分辨率图像时没有合理控制内存使用，可能会导致 <code>ERR_WORKER_OUT_OF_MEMORY</code> 错误。</p></li><li><p><strong>数据分析</strong>：在处理大规模数据集（例如，从数据库中提取大量数据进行分析和报告）的应用中，你可能选择使用 Worker Threads 来并行处理数据，以加快处理速度。如果单个 Worker Thread 处理的数据量太大，超出了内存限制，就可能遇到 <code>ERR_WORKER_OUT_OF_MEMORY</code> 错误。</p></li></ol><p><strong>如何避免</strong>：</p><ul><li>优化代码，减少不必要的内存使用。</li><li>分批处理大量数据，而不是一次性处理。</li><li>调整 Node.js 的内存限制设置，但要注意不要超出系统可用内存，以避免引起系统级别的问题。</li></ul><p>总结起来，<code>[ERR_WORKER_OUT_OF_MEMORY]</code>是一个指示 Worker Thread 因为超出其分配的内存限制而无法继续执行的错误。通过优化内存使用和正确管理 Worker Threads 的负载，可以避免这种错误。</p><h3 id="err-worker-path" tabindex="-1"><a class="header-anchor" href="#err-worker-path"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_path" target="_blank" rel="noopener noreferrer">ERR_WORKER_PATH</a></span></a></h3><p>当你使用 Node.js 开发应用时，有时你可能需要执行一些复杂或耗时的任务，比如图像处理或大量数据的计算。为了不阻塞主线程（你可以将其视为程序进行操作的主要路径），让你的应用在处理这些任务时仍然响应用户的操作，Node.js 提供了一个功能叫做“Worker Threads”。简单来说，Worker Threads 允许你创建额外的线程来执行这些复杂的任务，而主线程可以继续处理其他事情。</p><p>在使用 Worker Threads 时，你需要指定一个脚本或模块路径，这个脚本包含了应该在 Worker Thread 中运行的代码。这就是<code>ERR_WORKER_PATH</code>错误与之相关的地方。当 Node.js 尝试创建 Worker Thread，并且给定的脚本或模块路径无效、不存在或因权限问题不能被加载时，就会抛出<code>ERR_WORKER_PATH</code>错误。这意味着 Node.js 无法找到或访问你想在 Worker Thread 中运行的代码。</p><h3 id="实际例子-16" tabindex="-1"><a class="header-anchor" href="#实际例子-16"><span>实际例子</span></a></h3><p>假设你正在开发一个网站，该网站允许用户上传图片，并对这些图片进行一系列复杂的图像处理操作（比如压缩、调整大小、应用滤镜等）。处理图片是一个计算密集型任务，如果在主线程中执行，可能会导致你的网站变得卡顿，影响用户体验。</p><p>为了避免这个问题，你决定使用 Worker Threads 来处理图像操作。你创建了一个名为<code>imageProcessor.js</code>的 JavaScript 文件，里面包含了所有图像处理的逻辑。</p><p>接下来，在你的主应用程序中，你尝试创建一个新的 Worker Thread 来运行<code>imageProcessor.js</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./path/to/imageProcessor.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 设置worker通信和完成时的行为</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>./path/to/imageProcessor.js</code>是有效的，那么一切都会正常工作。但如果这个路径是错误的，或者由于某种原因文件无法被访问（例如，权限问题），Node.js 就会抛出<code>ERR_WORKER_PATH</code>错误。这意味着你需要检查并修复提供给 Worker 的路径或相关的权限问题，以确保 Worker Threads 能够正确地加载和执行你的图像处理代码。</p><p>总结起来，<code>ERR_WORKER_PATH</code>是一个告诉你：“嘿，我找不到或无法加载你想在 Worker Thread 中运行的那段代码”的错误。在实际应用中，正确处理这个错误对于确保你的应用能够有效利用多线程处理复杂任务非常重要。</p><h3 id="err-worker-unserializable-error" tabindex="-1"><a class="header-anchor" href="#err-worker-unserializable-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_unserializable_error" target="_blank" rel="noopener noreferrer">ERR_WORKER_UNSERIALIZABLE_ERROR</a></span></a></h3><p>好的，我来解释一下 Node.js 中的 <code>ERR_WORKER_UNSERIALIZABLE_ERROR</code> 这个错误，并且会通过一些例子来帮助你更好地理解。</p><p>首先，Node.js 是一个能让 JavaScript 运行在服务器端的平台。它可以用来开发服务器端的应用程序，比如网站后端服务、API 服务等。Node.js 支持多线程处理，这是通过 Worker Threads 模块实现的。Worker Threads 允许你创建多个线程来执行代码，以便进行 CPU 密集型的操作或者是并行处理任务。</p><p>在使用 Worker Threads 的过程中，主线程与工作线程之间通常需要进行数据交换。为了实现这种交换，传递给工作线程的数据需要被序列化（即转换成一种标准格式），然后在工作线程中被反序列化。不过，并不是所有类型的数据都可以轻松序列化/反序列化的。当你尝试向工作线程传递一个不能被序列化的对象时，就会抛出 <code>ERR_WORKER_UNSERIALIZABLE_ERROR</code> 错误。</p><h3 id="例子-2" tabindex="-1"><a class="header-anchor" href="#例子-2"><span>例子</span></a></h3><p>假设你有一个复杂的对象，其中包含了函数或者其他不能轻松序列化的值，你尝试将其传递到一个工作线程：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 主线程代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> workerData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    name</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Node.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    version</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">v21.7.1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">    action</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This function won&#39;t be serialized</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> workerData</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">    .</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 工作线程代码</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Working on:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> workerData</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个例子中，我们尝试将一个包含函数的对象传递给一个工作线程。由于函数无法被序列化，这段代码将会抛出 <code>ERR_WORKER_UNSERIALIZABLE_ERROR</code> 错误。</p><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><p>为了避免这个错误，确保传递给 Worker 的数据可以被序列化。这通常意味着你需要避免直接发送函数、循环引用的对象等。</p><p>如果你真的需要在主线程和工作线程之间共享复杂的状态或行为，考虑使用其他通信机制，比如使用 <code>MessageChannel</code> 或在两者之间显式地只发送简单的、可序列化的命令和数据。</p><p>通过以上解释和示例，希望你能对 <code>ERR_WORKER_UNSERIALIZABLE_ERROR</code> 有了更深入的理解。</p><h3 id="err-worker-unsupported-operation" tabindex="-1"><a class="header-anchor" href="#err-worker-unsupported-operation"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_unsupported_operation" target="_blank" rel="noopener noreferrer">ERR_WORKER_UNSUPPORTED_OPERATION</a></span></a></h3><p>好的，我们来一步步理解 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 这个错误在 Node.js 中意味着什么，并通过几个例子来具体说明。首先，我们要知道 Node.js 是一个非常强大的 JavaScript 运行环境，它让你可以在服务器端运行 JavaScript 代码，而不仅仅是在浏览器中。Node.js 引入了“工作线程（Worker Threads）”这一概念，使得执行多线程任务成为可能，进而能够提高应用程序的性能和响应能力。</p><h3 id="理解-err-worker-unsupported-operation" tabindex="-1"><a class="header-anchor" href="#理解-err-worker-unsupported-operation"><span>理解 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code></span></a></h3><p>当你在 Node.js 应用程序中使用工作线程时，有些操作可能并不被支持。如果你尝试执行一个在工作线程中不被支持的操作，Node.js 就会抛出 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 错误。简单来说，这个错误意味着：“嘿，你正在尝试做一些在当前上下文中不被允许的事情。”</p><h3 id="实际运用的例子-25" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-25"><span>实际运用的例子</span></a></h3><p>为了更好地理解，让我们来看几个实际的例子：</p><h4 id="例子-1-主线程与工作线程间通信限制" tabindex="-1"><a class="header-anchor" href="#例子-1-主线程与工作线程间通信限制"><span>例子 1：主线程与工作线程间通信限制</span></a></h4><p>假设你创建了一个工作线程来处理一些计算密集型的任务，比如图像处理或大数据分析。虽然工作线程可以提高应用的性能，但它们并不能直接访问主线程中的对象或变量。如果你尝试在工作线程中访问主线程特定的全局对象或者调用某些仅限主线程的 API，就可能遇到 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设在一个工作线程中尝试访问主线程特有的全局对象（这只是示意，实际代码可能有所不同）</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">typeof</span><span style="color:#D8DEE9;"> window</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">undefined</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_WORKER_UNSUPPORTED_OPERATION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="例子-2-不恰当地使用工作线程特有功能" tabindex="-1"><a class="header-anchor" href="#例子-2-不恰当地使用工作线程特有功能"><span>例子 2：不恰当地使用工作线程特有功能</span></a></h4><p>工作线程拥有它们自己的一套 API 和功能，比如消息传递机制。如果你在主线程中错误地尝试使用这些专为工作线程设计的功能，同样会导致 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果这段代码不在工作线程中执行，那么访问 parentPort 将会失败</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">parentPort</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ERR_WORKER_UNSUPPORTED_OPERATION</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="应对策略" tabindex="-1"><a class="header-anchor" href="#应对策略"><span>应对策略</span></a></h3><p>当你遇到 <code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 错误时，最重要的是回顾你的代码，确保你正按照设计来使用工作线程。检查是否有任何不兼容的操作，比如在不合适的上下文中使用特定的 API 或对象。确认之后，根据需要重新组织代码结构或寻找替代方案。</p><p>总结起来，<code>ERR_WORKER_UNSUPPORTED_OPERATION</code> 是 Node.js 提醒你，你尝试执行的操作在当前的工作线程上下文中是不被支持的。正确地理解和使用工作线程及其相关的 API 是避免这种错误的关键。</p><h3 id="err-zlib-initialization-failed" tabindex="-1"><a class="header-anchor" href="#err-zlib-initialization-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_zlib_initialization_failed" target="_blank" rel="noopener noreferrer">ERR_ZLIB_INITIALIZATION_FAILED</a></span></a></h3><p>Node.js 是一个让 JavaScript 运行在服务器端的平台。它能够让你使用 JavaScript 来编写后端代码，这意呴着你可以用同一种语言来编写前端和后端代码。Node.js 内置了很多模块，让开发者可以轻松地实现各种功能，而 <code>zlib</code> 就是其中之一。</p><h3 id="什么是-zlib" tabindex="-1"><a class="header-anchor" href="#什么是-zlib"><span>什么是 zlib?</span></a></h3><p><code>zlib</code> 是 Node.js 中用于压缩和解压数据的模块。在网络传输过程中，为了节省带宽和提高效率，通常会对数据进行压缩处理。例如，当你浏览网页时，服务器可能会先将网页内容压缩后再发送到你的浏览器，由浏览器解压并显示内容。<code>zlib</code> 模块就是用来做这种压缩和解压操作的。</p><h3 id="err-zlib-initialization-failed-1" tabindex="-1"><a class="header-anchor" href="#err-zlib-initialization-failed-1"><span>ERR_ZLIB_INITIALIZATION_FAILED</span></a></h3><p><code>ERR_ZLIB_INITIALIZATION_FAILED</code> 是一个错误信息，它指的是在使用 <code>zlib</code> 模块初始化压缩或解压操作时失败了。简单来说，当 Node.js 尝试使用 <code>zlib</code> 来压缩或解压数据，但由于某些原因（比如内部配置错误、资源不足等）无法完成初始化步骤时，就会抛出这个错误。</p><h3 id="实际运用的例子-26" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-26"><span>实际运用的例子</span></a></h3><p>想象一下，你正在开发一个网站，此网站需要从服务器向用户提供大量的图片或视频资料。为了提高加载速度和减少数据使用量，你决定在服务器端使用 <code>zlib</code> 对这些静态资源进行压缩，然后发送给客户端浏览器。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">zlib</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设我们有一个很大的图片文件 &quot;example.png&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> gzip</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> zlib</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createGzip</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Encoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">gzip</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 告诉浏览器内容已被压缩</span></span>
<span class="line"><span style="color:#D8DEE9;">    readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">gzip</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">res</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 读取文件、压缩、发送给客户端</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，服务器使用 <code>zlib</code> 的 <code>createGzip</code> 方法创建了一个压缩流，然后通过管道（pipe）将图片读取流连接到压缩流，最后输出到响应中。这样，只要浏览器支持 Gzip 解压（现代浏览器普遍支持），它就可以自动解压数据并呈现图片。</p><p>如果在这个过程中 <code>zlib</code> 初始化失败了，比如由于服务器资源紧张导致无法分配足够的内存给 <code>zlib</code>，那么我们的服务器代码就可能会抛出 <code>ERR_ZLIB_INITIALIZATION_FAILED</code> 错误。面对这种情况，你可能需要检查服务器的资源利用情况，或者尝试调整 Node.js 应用的内存配置来解决问题。</p><h3 id="hpe-header-overflow" tabindex="-1"><a class="header-anchor" href="#hpe-header-overflow"><span><a href="https://nodejs.org/docs/latest/api/errors.html#hpe_header_overflow" target="_blank" rel="noopener noreferrer">HPE_HEADER_OVERFLOW</a></span></a></h3><p>理解<code>HPE_HEADER_OVERFLOW</code>错误，首先需要了解一下背景知识。</p><h3 id="http-协议基础" tabindex="-1"><a class="header-anchor" href="#http-协议基础"><span>HTTP 协议基础</span></a></h3><p>在互联网通信中，HTTP（超文本传输协议）是非常关键的。它定义了客户端（比如你的浏览器）和服务器之间如何交换信息。每当你在浏览器中输入一个网址时，浏览器就会向服务器发送一个 HTTP 请求，这个请求包含了很多“头部（Headers）”，告诉服务器各种信息，比如你想请求的页面、你的浏览器类型等等。</p><h3 id="node-js-和-http" tabindex="-1"><a class="header-anchor" href="#node-js-和-http"><span>Node.js 和 HTTP</span></a></h3><p>Node.js 是一个让 JavaScript 运行在服务器端的平台，它对于处理网络请求特别有用。Node.js 可以帮助你创建一个服务器，接受并处理 HTTP 请求。</p><h3 id="头部溢出-header-overflow" tabindex="-1"><a class="header-anchor" href="#头部溢出-header-overflow"><span>头部溢出（Header Overflow）</span></a></h3><p>现在来看看什么是<code>HPE_HEADER_OVERFLOW</code>错误。这个错误与 HTTP 请求或响应中的头部信息有关。HTTP 标准规定了头部的大小限制——通常是 8KB（千字节）。这意味着所有的头部加起来不能超过这个大小。如果超过了，你就会遇到<code>HPE_HEADER_OVERFLOW</code>错误。</p><h3 id="为什么有这个错误" tabindex="-1"><a class="header-anchor" href="#为什么有这个错误"><span>为什么有这个错误？</span></a></h3><p>这个限制主要是出于安全和性能的考虑。如果没有大小限制，恶意用户可以发送巨大的头部信息尝试耗尽服务器资源，从而进行拒绝服务攻击（DoS）。限制头部大小可以保护服务器不被轻易地通过这种方式攻击。</p><h3 id="实际运用例子-7" tabindex="-1"><a class="header-anchor" href="#实际运用例子-7"><span>实际运用例子</span></a></h3><p>假设你正在运行一个 Node.js 服务器，并且你有一个页面允许用户提交表单。一个普通的用户可能只提交姓名和邮箱，头部大小远不至于超出限制。但是，如果有人故意构造一个非常大的头部信息（比如，一个非常长的 cookie 值），尝试提交给你的服务器，Node.js 将无法处理这个请求并返回<code>HPE_HEADER_OVERFLOW</code>错误。</p><h3 id="如何解决或避免这个错误" tabindex="-1"><a class="header-anchor" href="#如何解决或避免这个错误"><span>如何解决或避免这个错误？</span></a></h3><ol><li><strong>审查代码</strong>：确保你的应用或前端不会意外地创建大量的头部信息。</li><li><strong>配置服务器</strong>：在某些情况下，你可能需要接受比较大的头部。许多 Web 服务器软件（包括一些 Node.js 库）允许你配置最大头部大小。例如，在 Node.js 中，你可以使用 http(s)服务器的<code>maxHttpHeaderSize</code>选项来设置头部大小限制。</li><li><strong>安全措施</strong>：实现额外的安全检查，比如限制 cookie 的大小，或者检查请求的头部大小，防止恶意利用。</li></ol><p>总之，<code>HPE_HEADER_OVERFLOW</code>错误是 Node.js 在处理 HTTP 请求时，因为请求头部信息过大而无法处理时发生的。了解这个限制并采取措施预防，可以帮助保护你的服务器不受潜在的攻击。</p><h3 id="hpe-chunk-extensions-overflow" tabindex="-1"><a class="header-anchor" href="#hpe-chunk-extensions-overflow"><span><a href="https://nodejs.org/docs/latest/api/errors.html#hpe_chunk_extensions_overflow" target="_blank" rel="noopener noreferrer">HPE_CHUNK_EXTENSIONS_OVERFLOW</a></span></a></h3><p>当我们谈论 Node.js 中的<code>HPE_CHUNK_EXTENSIONS_OVERFLOW</code>错误，我们实际上是在探讨 HTTP 协议解析过程中发生的一个特定问题。要理解这个错误，首先让我们简单回顾下 HTTP 协议和 Node.js 中的角色。</p><h3 id="http-协议基础-1" tabindex="-1"><a class="header-anchor" href="#http-协议基础-1"><span>HTTP 协议基础</span></a></h3><p>HTTP（超文本传输协议）是互联网上应用最广泛的协议之一。它基于请求-响应模式工作。当你在浏览器中输入一个网址时，浏览器向服务器发送一个请求，服务器处理这个请求后返回响应。这些请求和响应都遵循严格的格式，包括开始行、头部字段、空行和可选的消息体。</p><p>其中，消息体可以被分成多个部分（称为“块”），每个部分都由自己的大小和可选的扩展信息描述。这种分块传输编码允许发送方动态地决定数据块的大小，并且可以在传输过程中添加额外的元信息。</p><h3 id="node-js-和-http-1" tabindex="-1"><a class="header-anchor" href="#node-js-和-http-1"><span>Node.js 和 HTTP</span></a></h3><p>Node.js 是一个运行在服务器端的 JavaScript 环境，它非常适合处理 HTTP 请求。Node.js 使用非阻塞 I/O 和事件驱动机制，使其能够处理大量并发连接，这使得 Node.js 非常适合开发需要高性能网络通信的应用程序，如 Web 服务器、实时通信应用等。</p><h3 id="hpe-chunk-extensions-overflow-错误" tabindex="-1"><a class="header-anchor" href="#hpe-chunk-extensions-overflow-错误"><span>HPE_CHUNK_EXTENSIONS_OVERFLOW 错误</span></a></h3><p>在 Node.js v21.7.1 中，<code>HPE_CHUNK_EXTENSIONS_OVERFLOW</code>是一个特定的错误类型，指的是在 HTTP 请求或响应的处理过程中，块扩展的长度超出了 Node.js 解析器设定的限制。块扩展提供有关数据块的额外信息（例如，数据的编码方式），并且它们有自己的大小限制，以确保 HTTP 消息的解析过程既安全又高效。</p><h4 id="实际运用例子-8" tabindex="-1"><a class="header-anchor" href="#实际运用例子-8"><span>实际运用例子</span></a></h4><p>假设你正在开发一个基于 Node.js 的 Web 应用程序，该程序需要接收来自客户的大文件上传。客户端可能会将大文件分割成多个数据块进行上传，每个块可能会携带额外的元信息（即块扩展），比如当前块的编号或者该块数据的一些验证信息。如果某个块的扩展信息过长（超出了 Node.js 的处理限制），Node.js 将抛出<code>HPE_CHUNK_EXTENSIONS_OVERFLOW</code>错误。</p><h3 id="应对策略-1" tabindex="-1"><a class="header-anchor" href="#应对策略-1"><span>应对策略</span></a></h3><ol><li><strong>检查客户端实现</strong>：确保客户端发送的每个数据块的扩展信息在合理的长度范围内。</li><li><strong>配置 Node.js 服务器</strong>：虽然不能直接改变 Node.js 内置的限制，但可以优化服务端处理逻辑，比如通过增加异常处理，当检测到<code>HPE_CHUNK_EXTENSIONS_OVERFLOW</code>错误时，给客户端明确的反馈，避免无限等待或错误重试。</li></ol><p>通过理解<code>HPE_CHUNK_EXTENSIONS_OVERFLOW</code>错误背后的原理及其涉及的 HTTP 协议基础，你可以更好地设计和调试基于 Node.js 的网络应用程序，确保它们能够有效地处理各种 HTTP 通信场景。</p><h3 id="hpe-unexpected-content-length" tabindex="-1"><a class="header-anchor" href="#hpe-unexpected-content-length"><span><a href="https://nodejs.org/docs/latest/api/errors.html#hpe_unexpected_content_length" target="_blank" rel="noopener noreferrer">HPE_UNEXPECTED_CONTENT_LENGTH</a></span></a></h3><p>Node.js 是一个非常流行的 JavaScript 运行环境，它允许你在服务器端运行 JavaScript 代码。在使用 Node.js 开发 Web 应用时，你可能会遇到各种各样的错误和问题，今天我们要讨论的是 <code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误。</p><h3 id="解释-4" tabindex="-1"><a class="header-anchor" href="#解释-4"><span>解释</span></a></h3><p><code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误属于 HTTP 解析错误类别。这个错误发生在 Node.js 的底层 HTTP 解析库（通常是内置的 <code>http_parser</code> 或者是更现代的 <code>llhttp</code>）尝试处理 HTTP 请求或响应时，遇到了意外的 <code>Content-Length</code> 头信息。</p><p>HTTP 协议规定，<code>Content-Length</code> 头部用于指示请求或响应体的大小，即包含多少字节。正常情况下，一个 HTTP 消息（请求或响应）只能有一个 <code>Content-Length</code> 头部，并且其值应该准确地反映消息体的长度。</p><p>如果 Node.js 的 HTTP 解析器在处理一个 HTTP 消息时遇到以下任一情况，则会抛出 <code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误：</p><ol><li><strong>存在多个 <code>Content-Length</code> 头部</strong>：即消息中包含了不止一个 <code>Content-Length</code> 头部。</li><li><strong><code>Content-Length</code> 与实际消息体的大小不匹配</strong>：例如，<code>Content-Length</code> 声称消息体是 100 字节，但实际上消息体要么大于要么小于这个数值。</li><li><strong>冲突的长度信息</strong>：有时候同时使用了 <code>Content-Length</code> 和 <code>Transfer-Encoding: chunked</code> 头部，后者是用来表示消息体是以一系列分块的形式发送，每个分块前都会标识当前块的大小。理论上，这两种方式不应同时使用，因为它们是相互冲突的。</li></ol><h3 id="实际运用的例子-27" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-27"><span>实际运用的例子</span></a></h3><p>假设你正在开发一个 Node.js 应用，该应用需要从另一个服务获取数据。你写了以下代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">problem with request: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果目标服务器 <code>example.com</code> 在返回数据时违反了 <code>Content-Length</code> 的约定，比如发送了两个 <code>Content-Length</code> 头部，或者其声明的长度与实际传输的数据长度不符，那么你的 Node.js 应用就会抛出 <code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误。</p><h3 id="如何处理这个错误-6" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-6"><span>如何处理这个错误</span></a></h3><p>遇到 <code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误时，首先应该检查是否是服务器端的问题。确认服务器在发送 HTTP 响应时是否正确且一致地设置了 <code>Content-Length</code> 头部。</p><ul><li>如果问题出在服务器端，需要修正服务器的行为，确保它正确地处理 <code>Content-Length</code>。</li><li>如果你无法控制服务器端，但确定响应数据是安全的，你可以考虑通过监听底层网络套接字的 &#39;data&#39; 事件来直接读取数据，绕过 Node.js 的 HTTP 解析器。但这种方法不推荐，因为它绕过了 Node.js 提供的安全和一致性保障。</li></ul><p>总之，<code>HPE_UNEXPECTED_CONTENT_LENGTH</code> 错误提示我们要关注 HTTP 协议中 <code>Content-Length</code> 的正确使用和实现，无论是在客户端还是服务器端。</p><h3 id="module-not-found" tabindex="-1"><a class="header-anchor" href="#module-not-found"><span><a href="https://nodejs.org/docs/latest/api/errors.html#module_not_found" target="_blank" rel="noopener noreferrer">MODULE_NOT_FOUND</a></span></a></h3><p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，它允许你在服务器端运行 JavaScript 代码。在 Node.js 中，模块是一种重要的组成部分，它们允许你将大型程序分解成可管理的单独文件或包，从而提高代码的可重用性和维护性。</p><p>当你在 Node.js 中遇到<code>MODULE_NOT_FOUND</code>错误时，这意味着 Node.js 尝试加载一个模块但未能找到。这个问题通常出现在以下几种情况：</p><ol><li><strong>拼写错误</strong>：你可能在<code>require()</code>语句中错误地拼写了模块名。</li><li><strong>路径错误</strong>：如果你正在尝试加载一个本地模块（即非 Node 内置模块，也非从 npm 安装的模块），你可能指定了错误的路径。</li><li><strong>模块未安装</strong>：如果你正在尝试使用一个第三方模块，且该模块还没有被安装到你的项目中（通过 npm 或 yarn 等包管理器）。</li></ol><h3 id="实际例子-17" tabindex="-1"><a class="header-anchor" href="#实际例子-17"><span>实际例子</span></a></h3><p>假设我们有一个简单的 Node.js 项目，我们想使用<code>express</code>框架来创建一个 web 服务器。下面是可能遇到<code>MODULE_NOT_FOUND</code>错误的几种情况：</p><h4 id="情况-1-拼写错误" tabindex="-1"><a class="header-anchor" href="#情况-1-拼写错误"><span>情况 1：拼写错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">expres</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的拼写</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里<code>express</code>被错误地拼写为<code>expres</code>，导致 Node.js 无法找到名为<code>expres</code>的模块。</p><h4 id="情况-2-路径错误" tabindex="-1"><a class="header-anchor" href="#情况-2-路径错误"><span>情况 2：路径错误</span></a></h4><p>假设我们有一个名为<code>appConfig.js</code>的配置文件位于项目的<code>config</code>目录下，正确的加载方式应该是：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> config</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./config/appConfig</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果我们错误地写成了如下形式，则会遇到<code>MODULE_NOT_FOUND</code>错误：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> config</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./configs/appConfig</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误的路径</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这是因为路径名<code>configs</code>不正确，正确的路径名应该是<code>config</code>。</p><h4 id="情况-3-模块未安装" tabindex="-1"><a class="header-anchor" href="#情况-3-模块未安装"><span>情况 3：模块未安装</span></a></h4><p>如果我们尝试加载<code>express</code>模块，但忘记先通过 npm 安装它：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> express</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">express</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>运行这段代码时，如果<code>express</code>模块尚未安装，就会出现<code>MODULE_NOT_FOUND</code>错误。</p><h3 id="解决方法-7" tabindex="-1"><a class="header-anchor" href="#解决方法-7"><span>解决方法</span></a></h3><ul><li>对于拼写错误和路径错误，仔细检查你的代码，确保所有内容都拼写正确，路径也指向正确的位置。</li><li>对于模块未安装的问题，确保你已经通过 npm 或 yarn 等包管理器安装了你需要的所有第三方模块。对于上述<code>express</code>的例子，你可以运行<code>npm install express</code>来安装它。</li></ul><p>总之，遇到<code>MODULE_NOT_FOUND</code>错误时，首先检查是否有拼写或路径错误，其次确认需要的模块是否已经正确安装。</p><h2 id="legacy-node-js-error-codes" tabindex="-1"><a class="header-anchor" href="#legacy-node-js-error-codes"><span><a href="https://nodejs.org/docs/latest/api/errors.html#legacy-nodejs-error-codes" target="_blank" rel="noopener noreferrer">Legacy Node.js error codes</a></span></a></h2><p>在 Node.js 中，错误处理是任何应用程序开发的一个核心组成部分。随着 Node.js 的发展，错误处理也经历了一些变化，包括引入了新的错误代码系统。然而，在这其中，有一部分被称为“Legacy Node.js error codes”，即“旧版 Node.js 错误代码”。这些错误代码代表了在新的错误代码系统出现之前就存在的错误类型。</p><h3 id="什么是-legacy-node-js-error-codes" tabindex="-1"><a class="header-anchor" href="#什么是-legacy-node-js-error-codes"><span>什么是 Legacy Node.js Error Codes?</span></a></h3><p>“Legacy Node.js Error Codes”是指在 Node.js 较早期版本中使用的错误代码。尽管 Node.js 随后引入了更详细和结构化的错误代码体系，这些旧的错误代码依然保留在 Node.js 的某些部分中，主要是为了向后兼容性，防止因为移除或修改它们而导致现有代码出错。</p><h3 id="为什么需要了解它们" tabindex="-1"><a class="header-anchor" href="#为什么需要了解它们"><span>为什么需要了解它们？</span></a></h3><ol><li><strong>向后兼容性</strong>：如果你正在维护或更新一个较旧的 Node.js 应用程序，了解这些错误代码对于调试和错误处理非常重要。</li><li><strong>理解错误信息</strong>：当你遇到一个含有旧版错误代码的错误时，能够识别并理解它可以帮助你更快地找到问题所在。</li></ol><h3 id="实际运用的例子-28" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-28"><span>实际运用的例子</span></a></h3><p>让我们来看几个旧版错误代码的例子及其可能的应用场景：</p><ol><li><p><strong>EACCES</strong> - 表示尝试进行的操作没有足够的权限。例如，当你尝试监听 1024 以下的端口时，通常需要管理员权限，否则会抛出 EACCES 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">http</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">  .</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">80</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to start server</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">EACCES</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: Requires elevated privileges</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server started</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ENOENT</strong> - 表示文件或目录不存在。这是在进行文件操作（如读取或删除文件）时常见的错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Failed to read file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ENOENT</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">      console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Error: File does not exist</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ECONNREFUSED</strong> - 表示尝试建立的连接被远程服务器拒绝。这在进行网络请求或数据库连接时可能遇到。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> net</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">net</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> net</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 9999</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connected to server!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ECONNREFUSED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Connection refused by server</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>了解这些旧版错误代码及其上下文不仅有助于您解决当前的问题，还能让您更好地预防未来可能遇到的问题。随着您不断地深入学习和实践，逐步建立起对 Node.js 中各种错误情形的认识将是非常有益的。</p><h3 id="err-cannot-transfer-object" tabindex="-1"><a class="header-anchor" href="#err-cannot-transfer-object"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_cannot_transfer_object" target="_blank" rel="noopener noreferrer">ERR_CANNOT_TRANSFER_OBJECT</a></span></a></h3><p>当你使用 Node.js v21.7.1 或其他版本时，可能会遇到各种错误代码，其中之一是<code>ERR_CANNOT_TRANSFER_OBJECT</code>。这个错误通常与在 Node.js 环境中工作的对象和资源的传输有关。让我尝试以简单易懂的方式解释它，并给出一些实际的例子。</p><h3 id="什么是err-cannot-transfer-object" tabindex="-1"><a class="header-anchor" href="#什么是err-cannot-transfer-object"><span>什么是<code>ERR_CANNOT_TRANSFER_OBJECT</code>？</span></a></h3><p>简而言之，<code>ERR_CANNOT_TRANSFER_OBJECT</code>是一个错误代码，表示尝试将某个对象从一个上下文或线程传输到另一个上下文或线程时遇到了问题。在多线程环境或在使用诸如 Worker 线程这样的功能时，你可能会遇到这个错误。</p><p>Node.js 允许通过使用 <code>worker_threads</code> 模块创建多线程应用程序，以便可以执行并行计算。有时，你可能希望将对象或数据从主线程传递到 Worker 线程，或者反过来。然而，并不是所有类型的对象都可以被传输。如果尝试传输无法被序列化（转换成一系列字节）的对象，或者该对象包含不能在不同线程间共享的资源，则可能会抛出<code>ERR_CANNOT_TRANSFER_OBJECT</code>错误。</p><h3 id="实际例子-18" tabindex="-1"><a class="header-anchor" href="#实际例子-18"><span>实际例子</span></a></h3><h4 id="示例-1-尝试传输不可转移的对象" tabindex="-1"><a class="header-anchor" href="#示例-1-尝试传输不可转移的对象"><span>示例 1：尝试传输不可转移的对象</span></a></h4><p>假设你有一个 Node.js 应用程序，其中使用了 Worker 线程来处理一些耗时的计算任务：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 主线程</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> untransferableObject</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  Object</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">preventExtensions</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">untransferableObject</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试传输一个不可扩展的对象</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">untransferableObject</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // Worker 线程</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理接收到的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试从主线程向 Worker 线程传输一个<code>ArrayBuffer</code>对象，但在尝试传输之前，我们调用了<code>Object.preventExtensions()</code>使其变为不可扩展。因为不可扩展的对象无法被传输，所以这会导致<code>ERR_CANNOT_TRANSFER_OBJECT</code>错误。</p><h4 id="示例-2-传输具有复杂结构的对象" tabindex="-1"><a class="header-anchor" href="#示例-2-传输具有复杂结构的对象"><span>示例 2：传输具有复杂结构的对象</span></a></h4><p>考虑另一个情况，你想要传输一个包含循环引用的复杂对象。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 主线程</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> complexObject</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  complexObject</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">self</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> complexObject</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建循环引用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试传输一个具有复杂结构的对象</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">complexObject</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // Worker 线程</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">message</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 处理接收到的消息</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">message</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于对象内部存在循环引用，它不能被有效地序列化和传输，这将导致抛出<code>ERR_CANNOT_TRANSFER_OBJECT</code>错误。</p><h3 id="解决方法-8" tabindex="-1"><a class="header-anchor" href="#解决方法-8"><span>解决方法</span></a></h3><p>要解决这个问题，确保只传输那些可以被序列化或符合<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="noopener noreferrer">Structured Clone Algorithm</a>的对象。对于那些不能直接传输的数据，你可以考虑只传输它们的表示形式或使用其他同步机制（如 SharedArrayBuffer，它允许在不同线程之间共享内存）。</p><h3 id="err-crypto-hash-digest-no-utf16" tabindex="-1"><a class="header-anchor" href="#err-crypto-hash-digest-no-utf16"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_crypto_hash_digest_no_utf16" target="_blank" rel="noopener noreferrer">ERR_CRYPTO_HASH_DIGEST_NO_UTF16</a></span></a></h3><p>当你在使用 Node.js 进行编程时，有时候你会需要对数据进行加密。Node.js 提供了一个名为<code>crypto</code>的模块，这个模块包含了很多用于加密的功能。其中，哈希（Hash）是一种常见的加密方式，它可以把任意长度的数据转换成固定长度的字符串（这个字符串通常看起来就像一串随机字符）。哈希常用于校验数据完整性、存储密码等场景。</p><p>现在，假设你正在使用<code>crypto</code>模块中的函数来计算某段数据的哈希值。如果你遇到了<code>ERR_CRYPTO_HASH_DIGEST_NO_UTF16</code>这个错误，这意味着你在尝试以<code>UTF-16</code>编码格式获取哈希值的摘要（digest），但是 Node.js 不允许以<code>UTF-16</code>编码格式来执行这一操作。换句话说，这个错误提示你在获取哈希值摘要的过程中选择了不被支持的字符编码方式。</p><h3 id="为什么会有这样的限制" tabindex="-1"><a class="header-anchor" href="#为什么会有这样的限制"><span>为什么会有这样的限制？</span></a></h3><p>编码方式定义了如何将字符转换成字节。<code>UTF-8</code>、<code>UTF-16</code>和<code>UTF-32</code>都是 Unicode 标准的一部分，它们以不同的方式存储字符。在处理哈希值时，通常使用二进制形式或者是一种更为通用的编码方式（如<code>hex</code>十六进制或<code>base64</code>）来表示这些值。由于<code>UTF-16</code>编码可能引入一些特殊的处理问题（比如字节顺序标记），因此 Node.js 选择不支持以<code>UTF-16</code>编码来生成哈希值摘要。</p><h3 id="实际的运用例子" tabindex="-1"><a class="header-anchor" href="#实际的运用例子"><span>实际的运用例子</span></a></h3><p>假设你想计算一个字符串“Hello, world!”的 SHA-256 哈希值，并以十六进制（hex）形式输出，正确的代码示例应该是：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">crypto</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个哈希实例，使用sha256算法</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> hash</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> crypto</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createHash</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sha256</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 更新哈希实例，输入数据</span></span>
<span class="line"><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">update</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 计算摘要，以十六进制形式输出</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">hash</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">digest</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hex</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你尝试将最后一行修改为<code>hash.digest(&#39;utf16&#39;)</code>，你就会遇到<code>ERR_CRYPTO_HASH_DIGEST_NO_UTF16</code>错误，因为 Node.js 不支持这样的操作。</p><h3 id="解决方案-1" tabindex="-1"><a class="header-anchor" href="#解决方案-1"><span>解决方案</span></a></h3><p>确保在调用<code>.digest()</code>方法时使用支持的编码格式，如<code>&#39;hex&#39;</code>、<code>&#39;base64&#39;</code>或者直接不传参数来得到一个 Buffer 对象（这是二进制数据的表示方式），从而避免<code>ERR_CRYPTO_HASH_DIGEST_NO_UTF16</code>错误。</p><p>通过以上解释和示例，我希望能够帮助你理解<code>ERR_CRYPTO_HASH_DIGEST_NO_UTF16</code>错误的原因及如何避免它，在进行 Node.js 编程时能够更加顺畅地使用<code>crypto</code>模块的功能。</p><h3 id="err-http2-frame-error" tabindex="-1"><a class="header-anchor" href="#err-http2-frame-error"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_frame_error" target="_blank" rel="noopener noreferrer">ERR_HTTP2_FRAME_ERROR</a></span></a></h3><p>当我们谈论 Node.js 中的<code>ERR_HTTP2_FRAME_ERROR</code>错误，我们实际上是在谈论 HTTP/2 协议中出现的一个特定问题。为了理解这个错误，我们首先需要简单了解一下 HTTP/2 协议和它如何工作。</p><h3 id="http-2-简介" tabindex="-1"><a class="header-anchor" href="#http-2-简介"><span>HTTP/2 简介</span></a></h3><p>HTTP/2 是 HTTP 协议的第二个主要版本，它旨在提高网页加载速度并改善用户体验。与 HTTP/1.x 相比，HTTP/2 引入了几项重要的改进，例如：</p><ul><li><strong>多路复用（Multiplexing）</strong>：允许多个请求在同一个 TCP 连接上同时进行，减少了建立多个连接的延迟和开销。</li><li><strong>帧（Frames）</strong>：HTTP/2 将数据分成更小的消息和帧，并对它们进行流控制。这是一个关键概念，因为数据包在 HTTP/2 中以帧的形式发送。</li></ul><h3 id="关于-err-http2-frame-error" tabindex="-1"><a class="header-anchor" href="#关于-err-http2-frame-error"><span>关于 ERR_HTTP2_FRAME_ERROR</span></a></h3><p><code>ERR_HTTP2_FRAME_ERROR</code>是一个由 Node.js 抛出的错误，表明在处理 HTTP/2 连接中的帧时遇到了问题。这个错误通常发生在以下情况：</p><ul><li>当接收到的帧无法被正确解析或处理时。</li><li>当帧违反了 HTTP/2 协议的规范时。</li></ul><p>这个错误意味着在底层的 HTTP/2 帧处理中存在问题，可能是数据损坏、协议违规或其他一些原因导致的。</p><h3 id="实际运用例子-9" tabindex="-1"><a class="header-anchor" href="#实际运用例子-9"><span>实际运用例子</span></a></h3><p>假设你正在开发一个基于 Node.js 的 Web 服务器，使用 HTTP/2 来提供服务。如果你的服务器收到了一个错误构造的 HTTP/2 帧，比如头信息（header）格式不正确，或者帧大小超过了服务器配置的最大值，那么 Node.js 可能会抛出<code>ERR_HTTP2_FRAME_ERROR</code>错误。</p><h4 id="例-1-错误配置" tabindex="-1"><a class="header-anchor" href="#例-1-错误配置"><span>例 1：错误配置</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#D8DEE9;"> console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 此处处理每个请求</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，如果有任何与 HTTP/2 帧处理相关的错误发生（如客户端发送了不合规格的帧），那么就会触发<code>server</code>的<code>error</code>事件，并且可能打印出<code>ERR_HTTP2_FRAME_ERROR</code>。</p><h4 id="例-2-错误处理" tabindex="-1"><a class="header-anchor" href="#例-2-错误处理"><span>例 2：错误处理</span></a></h4><p>理解了<code>ERR_HTTP2_FRAME_ERROR</code>可以帮助你更好地调试和处理 HTTP/2 通信中的问题。例如，你可以决定在遇到此错误时尝试关闭有问题的连接，或者记录详细的错误信息以便进一步分析。</p><h3 id="结论-5" tabindex="-1"><a class="header-anchor" href="#结论-5"><span>结论</span></a></h3><p><code>ERR_HTTP2_FRAME_ERROR</code>是处理 HTTP/2 协议时可能遇到的一个错误，它指示了在帧的处理过程中出现了问题。通过对这类错误的适当处理，可以确保你的应用或服务能够更加稳定和可靠地运行。</p><h3 id="err-http2-headers-object" tabindex="-1"><a class="header-anchor" href="#err-http2-headers-object"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_headers_object" target="_blank" rel="noopener noreferrer">ERR_HTTP2_HEADERS_OBJECT</a></span></a></h3><p>Node.js 中的<code>ERR_HTTP2_HEADERS_OBJECT</code>错误是与 HTTP/2 通信协议中处理头信息相关的一个特定类型的错误。首先，让我们了解一下背景知识，再深入到错误本身和如何避免它。</p><h3 id="背景知识-1" tabindex="-1"><a class="header-anchor" href="#背景知识-1"><span>背景知识</span></a></h3><h4 id="什么是-http-2" tabindex="-1"><a class="header-anchor" href="#什么是-http-2"><span>什么是 HTTP/2？</span></a></h4><p>HTTP/2 是互联网数据交换的第二个主要版本的 HTTP 协议。相比于 HTTP/1.x，HTTP/2 引入了多项改进，例如头信息压缩、服务器推送以及请求/响应复用等，旨在提高网络通信的效率和速度。</p><h4 id="头信息-headers" tabindex="-1"><a class="header-anchor" href="#头信息-headers"><span>头信息（Headers）</span></a></h4><p>无论是 HTTP/1.x 还是 HTTP/2，头信息都扮演着重要角色。它们在 HTTP 请求和响应中传递额外的信息，如内容类型、缓存控制、认证信息等。</p><h3 id="err-http2-headers-object-错误" tabindex="-1"><a class="header-anchor" href="#err-http2-headers-object-错误"><span>ERR_HTTP2_HEADERS_OBJECT 错误</span></a></h3><p>这个错误发生在使用 Node.js 进行 HTTP/2 通信时，如果试图发送或接收的头信息对象不符合规定的格式或标准时。</p><h4 id="常见原因" tabindex="-1"><a class="header-anchor" href="#常见原因"><span>常见原因</span></a></h4><ul><li><strong>键名非法</strong>：所有的头信息键（字段名）必须是小写字母，因为 HTTP/2 要求如此，而 HTTP/1.x 则没有这样的强制要求。</li><li><strong>值类型错误</strong>：大部分头信息的值应该是字符串或字符串数组。如果你尝试传递数字或其他非字符串类型，可能会触发这个错误。</li><li><strong>伪头信息使用不当</strong>：HTTP/2 引入了伪头信息（pseudo-header fields），它们以“:”开头（例如“:path”，“:method”）。如果伪头信息被不正确地设置或使用，也可能导致这个错误。</li></ul><h3 id="实际运用例子-10" tabindex="-1"><a class="header-anchor" href="#实际运用例子-10"><span>实际运用例子</span></a></h3><h4 id="示例-1-发送-http-2-请求时键名非法" tabindex="-1"><a class="header-anchor" href="#示例-1-发送-http-2-请求时键名非法"><span>示例 1：发送 HTTP/2 请求时键名非法</span></a></h4><p>错误的使用方式：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误，键名应该是全小写</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的使用方式：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">application/json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 正确，键名是全小写</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="示例-2-值类型错误" tabindex="-1"><a class="header-anchor" href="#示例-2-值类型错误"><span>示例 2：值类型错误</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 尝试将状态码(status code)作为头信息发送，这是错误的做法。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 错误，值类型不正确</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 HTTP/2 协议中，某些头信息，特别是伪头信息，有其特定的使用场景和约束。<code>:status</code>伪头信息是由服务器在响应中自动设置的，不应该手动设置。</p><h3 id="如何避免这个错误-4" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误-4"><span>如何避免这个错误？</span></a></h3><ul><li><strong>始终使用小写字母来表示头信息的键。</strong></li><li><strong>确保所有头信息的值都是字符串或字符串数组。</strong></li><li><strong>正确理解并使用伪头信息。</strong></li></ul><p>通过上述解释和示例，希望能帮助你更好地理解<code>ERR_HTTP2_HEADERS_OBJECT</code>错误及其解决方法。在实际编程过程中，注意细节和协议规范是非常重要的，这样可以避免很多潜在的问题。</p><h3 id="err-http2-header-required" tabindex="-1"><a class="header-anchor" href="#err-http2-header-required"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_header_required" target="_blank" rel="noopener noreferrer">ERR_HTTP2_HEADER_REQUIRED</a></span></a></h3><p>理解 <code>ERR_HTTP2_HEADER_REQUIRED</code> 错误，首先得知道这个错误是跟 HTTP/2 协议中的头部处理有关。在 Node.js v21.7.1 版本中，当你使用 HTTP/2 协议进行网络通信时，某些情况下必须发送特定的头部信息。如果这些必需的头部没有被正确发送，Node.js 就会抛出这个 <code>ERR_HTTP2_HEADER_REQUIRED</code> 错误。</p><h3 id="理解-http-2-和头部" tabindex="-1"><a class="header-anchor" href="#理解-http-2-和头部"><span>理解 HTTP/2 和头部</span></a></h3><p>HTTP/2 是一种网络通信协议，它是 HTTP 协议的第二个主要版本，旨在提高 Web 性能，通过引入头部压缩、服务器推送等特性来提升速度和效率。与 HTTP/1.x 相比，HTTP/2 对头部（即请求或响应中包含的元数据）的处理方式更加严格和高效。</p><h3 id="为什么会发生-err-http2-header-required-错误" tabindex="-1"><a class="header-anchor" href="#为什么会发生-err-http2-header-required-错误"><span>为什么会发生 ERR_HTTP2_HEADER_REQUIRED 错误？</span></a></h3><p>当你在 Node.js 中使用 HTTP/2 客户端或服务器进行编程时，如果你的请求或响应缺少 HTTP/2 协议所规定的必须包含的头部，Node.js 就会抛出 <code>ERR_HTTP2_HEADER_REQUIRED</code> 错误。这种情况通常发生在实现自定义 HTTP/2 通信时，可能由于疏忽或不完全了解 HTTP/2 协议细节导致。</p><h3 id="实际运用的例子-29" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-29"><span>实际运用的例子</span></a></h3><p>假设你正在使用 Node.js 开发一个基于 HTTP/2 的网站或 API:</p><ol><li><p><strong>服务端推送</strong>：服务端想要利用 HTTP/2 的“服务器推送”功能向客户端推送资源，但忘记添加 <code>:method</code> 和 <code>:path</code> 头部。按照 HTTP/2 协议，这两个头部是必须的。没有它们，Node.js 将抛出 <code>ERR_HTTP2_HEADER_REQUIRED</code> 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createSecureServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  key</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">密钥路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  cert</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">证书路径</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设我们忘记设置必需的头部，尝试直接推送</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pushStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{},</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">pushStream</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    pushStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">推送的数据</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 这里应该添加 &#39;:method&#39; 和 &#39;:path&#39;</span></span>
<span class="line"><span style="color:#616E88;">  // 正确的方法应该包括所有必需的伪头部</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>API 请求</strong>：你正在编写一个 HTTP/2 客户端，想要请求一个 API，但忘记设置 <code>:method</code> 或其他必需的伪头部。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://你的api域名</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2请求时缺少 :method 伪头部</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  /* 必需的伪头部应该在这里 */</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> flags</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9;"> headers</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#EBCB8B;">\n</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="解决方案-2" tabindex="-1"><a class="header-anchor" href="#解决方案-2"><span>解决方案</span></a></h3><p>避免这种错误的最佳实践是确保你完全了解 HTTP/2 协议特别是关于头部的要求，并且在编码时仔细检查你的代码，以确保所有必需的头部都被正确地设置和发送。</p><p>总之，<code>ERR_HTTP2_HEADER_REQUIRED</code> 错误是因为在使用 Node.js 进行 HTTP/2 通信时，遗漏了 HTTP/2 协议要求的必需头部。了解 HTTP/2 协议的工作原理，特别是其头部的要求，可以帮助避免这种错误。</p><h3 id="err-http2-info-headers-after-respond" tabindex="-1"><a class="header-anchor" href="#err-http2-info-headers-after-respond"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_info_headers_after_respond" target="_blank" rel="noopener noreferrer">ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</a></span></a></h3><p>了解<code>ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</code>错误及其在 Node.js 中的意义，首先需要了解一些关键概念：HTTP/2、HTTP/2 信息头（INFO HEADERS）以及如何在 Node.js 环境下处理它们。</p><h3 id="http-2-简介-1" tabindex="-1"><a class="header-anchor" href="#http-2-简介-1"><span>HTTP/2 简介</span></a></h3><p>HTTP/2 是 HTTP 协议的第二个主要版本，目的是改进网页的加载速度和效率。与 HTTP/1.x 相比，HTTP/2 引入了许多新功能，比如服务器推送、头部压缩以及多路复用，允许多个请求在一个 TCP 连接上并行传输。</p><h3 id="信息头-info-headers" tabindex="-1"><a class="header-anchor" href="#信息头-info-headers"><span>信息头（INFO HEADERS）</span></a></h3><p>HTTP/2 引入了一种特殊类型的头信息，被称为“信息头”（或非最终响应头）。这些是除了常规响应头外的额外信息，可以用于提供请求过程中的额外信息，如进度状态或警告。信息头使用<code>:status</code>代码 100 至 199。</p><h3 id="err-http2-info-headers-after-respond-错误" tabindex="-1"><a class="header-anchor" href="#err-http2-info-headers-after-respond-错误"><span>ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND 错误</span></a></h3><p>现在，我们来到了核心问题：“ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND”错误。这个错误发生在使用 Node.js 进行 HTTP/2 通信时，如果在已经发送了最终响应头后再尝试发送信息头（INFO HEADERS），就会出现这个错误。换句话说，一旦你告诉客户端“这是我的最终回答”，你就不能再添加额外的信息头了。</p><h4 id="实际运用的例子-30" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-30"><span>实际运用的例子</span></a></h4><p>假设你正在开发一个基于 Node.js 的 Web 应用，该应用通过 HTTP/2 向客户端发送文件。在某个点上，你可能希望发送一些进度信息（比如，“文件传输完成 50%”）。如果你在文件完全传输结束后仍尝试发送这样的信息，就会触发<code>ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</code>错误。</p><h5 id="示例代码-1" tabindex="-1"><a class="header-anchor" href="#示例代码-1"><span>示例代码：</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">stream</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 发送初始响应头</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">respond</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">content-type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">:status</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 200</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 正确发送响应体数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, world!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试在响应结束后发送信息头——导致错误</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">additionalHeaders</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">Custom-Info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">This should not work</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里将捕获并记录 ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 结束响应</span></span>
<span class="line"><span style="color:#D8DEE9;">  stream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个简易示例中，我们创建一个 HTTP/2 服务器，接受请求，并尝试在发送响应内容后添加额外的信息头。正如预期，这将失败并抛出<code>ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</code>错误，因为按照协议规定，在发送最终响应之后，你不能再发送任何信息头。</p><h3 id="解决方法-9" tabindex="-1"><a class="header-anchor" href="#解决方法-9"><span>解决方法</span></a></h3><p>避免<code>ERR_HTTP2_INFO_HEADERS_AFTER_RESPOND</code>错误的关键是确保所有需要的信息头都在发送最终响应头之前发送。如果你需要向客户端传达额外信息，请考虑将这些信息包含在正文中，或者重新考虑你的应用逻辑，以便在发送最终响应之前传达这些信息。</p><h3 id="err-http2-stream-closed" tabindex="-1"><a class="header-anchor" href="#err-http2-stream-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http2_stream_closed" target="_blank" rel="noopener noreferrer">ERR_HTTP2_STREAM_CLOSED</a></span></a></h3><p>当你在使用 Node.js 中的 HTTP/2 模块来构建或与 Web 服务器交互时，可能会遇到各种错误。其中一个是<code>ERR_HTTP2_STREAM_CLOSED</code>错误。我将尽力以简单易懂的方式解释这个错误，并给出一些实际的例子来帮助你更好地理解它。</p><h3 id="什么是-http-2-1" tabindex="-1"><a class="header-anchor" href="#什么是-http-2-1"><span>什么是 HTTP/2？</span></a></h3><p>在深入了解这个错误之前，先让我们简要了解一下 HTTP/2。HTTP/2 是 HTTP 协议的第二个主要版本，旨在改进 Web 性能。它引入了一些新特性，比如头部压缩、服务器推送以及允许在单个连接上多路复用请求和响应，这意味着可以同时发送多个请求和响应，而不需要等待上一个完成。</p><h3 id="err-http2-stream-closed-错误" tabindex="-1"><a class="header-anchor" href="#err-http2-stream-closed-错误"><span>ERR_HTTP2_STREAM_CLOSED 错误</span></a></h3><p><code>ERR_HTTP2_STREAM_CLOSED</code>错误发生在使用 HTTP/2 进行通信时，尝试操作一个已经关闭的流。在 HTTP/2 中，&quot;流&quot;是指在客户端和服务器之间传输数据的独立双向序列。每个请求和响应都在自己的流中进行。</p><p>这个错误通常表明你尝试对一个已经结束（或关闭）的连接进行写入、读取或监听操作。例如，如果客户端发送了一个请求并且服务器已经回复并关闭了那个特定的流，但客户端试图发送额外的数据或者再次读取响应，就可能触发这个错误。</p><h3 id="实际运用示例-3" tabindex="-1"><a class="header-anchor" href="#实际运用示例-3"><span>实际运用示例</span></a></h3><p>假设你正在编写一个使用 HTTP/2 协议的 Node.js 应用程序，该程序向某个 API 发送数据请求：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http2</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2客户端</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">connect</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">https://example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建HTTP/2请求</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">:path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">response</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">headers</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理响应头</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setEncoding</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  data</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 处理响应体数据</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 在这里，数据接收完毕</span></span>
<span class="line"><span style="color:#D8DEE9;">  client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 主动关闭客户端连接</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 如果尝试再次使用已关闭的流，会触发ERR_HTTP2_STREAM_CLOSED错误</span></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">some data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 将会失败，因为流已结束</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们创建了一个 HTTP/2 客户端，并发送了一个请求到<code>example.com</code>的根路径。在接收到响应数据并处理结束后，我们试图通过<code>.write(&#39;some data&#39;)</code>向同一个流写入数据。但由于此时流已经关闭，所以这个操作会导致<code>ERR_HTTP2_STREAM_CLOSED</code>错误。</p><h3 id="如何解决-4" tabindex="-1"><a class="header-anchor" href="#如何解决-4"><span>如何解决？</span></a></h3><p>避免这个错误的关键是确保你不在一个已经关闭的流上进行写入、读取或监听操作。你可以通过检查流的状态来决定是否安全地执行这些操作，或者通过适当的事件监听来管理流的生命周期，确保在流关闭后不再进行任何操作。</p><p>总的来说，理解 HTTP/2 的工作机制和流的概念是避免<code>ERR_HTTP2_STREAM_CLOSED</code>和其他相关错误的关键。通过合理管理每个 HTTP/2 流的生命周期，你可以有效地利用 HTTP/2 带来的性能优势，同时避免遇到类似的问题。</p><h3 id="err-http-invalid-char" tabindex="-1"><a class="header-anchor" href="#err-http-invalid-char"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_http_invalid_char" target="_blank" rel="noopener noreferrer">ERR_HTTP_INVALID_CHAR</a></span></a></h3><p>当你在使用 Node.js 构建 Web 服务或应用时，你会经常与 HTTP 请求和响应打交道。在这个过程中，有一些规则需要遵循，尤其是关于 HTTP 头部信息的内容。<code>ERR_HTTP_INVALID_CHAR</code>错误就是在这样的上下文中出现的。</p><h3 id="什么是err-http-invalid-char" tabindex="-1"><a class="header-anchor" href="#什么是err-http-invalid-char"><span>什么是<code>ERR_HTTP_INVALID_CHAR</code>？</span></a></h3><p><code>ERR_HTTP_INVALID_CHAR</code>是一个错误代码，在 Node.js 环境中表示你尝试在 HTTP 头部（Header）中使用了一个不合法的字符。HTTP 标准规定了哪些字符是允许在头部字段中出现的，如果违反了这些规定，比如尝试包含了一些非法字符，Node.js 就会抛出<code>ERR_HTTP_INVALID_CHAR</code>错误。</p><h3 id="http-头部中允许的字符" tabindex="-1"><a class="header-anchor" href="#http-头部中允许的字符"><span>HTTP 头部中允许的字符</span></a></h3><p>根据 HTTP 标准，大多数可打印的 ASCII 字符都是允许的，除了一些特殊的控制字符，例如：</p><ul><li><code>\r</code>（回车）</li><li><code>\n</code>（换行）</li><li><code>:</code>（冒号）</li></ul><p>这些特殊字符在 HTTP 头部中具有特定的意义，因此不能作为值的一部分使用。</p><h3 id="实际运用例子-11" tabindex="-1"><a class="header-anchor" href="#实际运用例子-11"><span>实际运用例子</span></a></h3><h4 id="错误使用" tabindex="-1"><a class="header-anchor" href="#错误使用"><span>错误使用</span></a></h4><p>假设你正在编写一个 Node.js 程序，需要向用户发送一个自定义的响应头。你可能会这样做：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">This value is invalid because it contains a newline</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，尝试将一个包含换行符<code>\n</code>的字符串设置为 HTTP 头部的值。这是不被允许的，因为<code>\n</code>是一个控制字符，它用于标识头部字段的结束。Node.js 会捕获这个错误并抛出<code>ERR_HTTP_INVALID_CHAR</code>。</p><h4 id="正确使用" tabindex="-1"><a class="header-anchor" href="#正确使用"><span>正确使用</span></a></h4><p>正确的做法是确保你设置的头部值不包含任何非法字符。如果需要传递可能包含这些字符的数据，应该先进行适当的编码。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> headerValue</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> encodeURIComponent</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">This string will be safely encoded to avoid invalid characters.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setHeader</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">X-Custom-Header</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> headerValue</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个修正后的例子中，使用了<code>encodeURIComponent</code>函数来确保所有特殊字符都被安全编码，这样就不会触发<code>ERR_HTTP_INVALID_CHAR</code>错误了。</p><h3 id="小结-1" tabindex="-1"><a class="header-anchor" href="#小结-1"><span>小结</span></a></h3><p><code>ERR_HTTP_INVALID_CHAR</code>是 Node.js 中的一个错误，提醒开发者他们尝试在 HTTP 头部中使用了不被允许的字符。处理这个问题的最好方法是对任何可疑的头部值进行编码，或者更加仔细地检查这些值，以确保它们不包含任何非法字符。这样可以避免该错误，并确保你的 Web 应用或服务能够平稳运行。</p><h3 id="err-index-out-of-range" tabindex="-1"><a class="header-anchor" href="#err-index-out-of-range"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_index_out_of_range" target="_blank" rel="noopener noreferrer">ERR_INDEX_OUT_OF_RANGE</a></span></a></h3><p>理解 Node.js 中的<code>ERR_INDEX_OUT_OF_RANGE</code>错误，我们可以先从它的名字入手。这个错误名称本质上表明某个指定的索引超出了允许的范围。在编程中，&quot;索引&quot;通常用来访问数组或类似集合内部的元素。当你尝试访问一个不存在的元素时（例如，尝试获取一个数组第 10 个元素，而数组只有 5 个元素），就会出现索引越界的情况。</p><p>为了更好地理解，让我们通过一些实际的例子来看看在 Node.js 中如何遇到并处理这种<code>ERR_INDEX_OUT_OF_RANGE</code>错误。</p><h3 id="例子-1-buffer-操作" tabindex="-1"><a class="header-anchor" href="#例子-1-buffer-操作"><span>例子 1：Buffer 操作</span></a></h3><p>在 Node.js 中，<code>Buffer</code>是一个用于处理二进制数据的类。想象一下，如果你尝试从一个只有 10 个字节大小的<code>Buffer</code>中读取超过其长度的数据。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello, World!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试读取超出buffer长度的数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readUInt16BE</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">100</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将抛出 ERR_INDEX_OUT_OF_RANGE 错误</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们尝试从缓冲区的第 100 个位置读取数据，但是缓冲区长度远不足 100，因此会触发<code>ERR_INDEX_OUT_OF_RANGE</code>错误。</p><h3 id="例子-2-typedarray-操作" tabindex="-1"><a class="header-anchor" href="#例子-2-typedarray-操作"><span>例子 2：TypedArray 操作</span></a></h3><p><code>TypedArray</code>是 JavaScript 的一种数据结构，用于存储固定长度的二进制数据。假设你有一个<code>Uint8Array</code>（一个只能存储 8 位无符号整数的数组）并尝试访问一个超出当前数组长度的元素。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> typedArray</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Uint8Array</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">5</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 尝试访问超出数组长度的元素</span></span>
<span class="line"><span style="color:#81A1C1;">  let</span><span style="color:#D8DEE9;"> value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> typedArray</span><span style="color:#D8DEE9FF;">[</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能不会抛出 ERR_INDEX_OUT_OF_RANGE 错误，但这是一种类似的越界操作。</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>虽然在这个简单的访问例子中 JavaScript 不会抛出<code>ERR_INDEX_OUT_OF_RANGE</code>错误（访问一个超出数组界限的元素通常会返回<code>undefined</code>），但这仍然是一种“越界”访问的例证。</p><h3 id="处理此错误" tabindex="-1"><a class="header-anchor" href="#处理此错误"><span>处理此错误</span></a></h3><p>当遭遇<code>ERR_INDEX_OUT_OF_RANGE</code>错误时，最直接的处理方式是确保你不会尝试访问超出其允许范围的索引。这通常涉及到：</p><ul><li>在访问之前检查数组或缓冲区的长度。</li><li>使用条件语句（如<code>if</code>语句）来防止潜在的越界访问。</li><li>捕获异常，并在异常处理代码中优雅地处理这种情况，比如给出错误提示，而不是让程序崩溃。</li></ul><p>通过这些方法，你可以有效避免<code>ERR_INDEX_OUT_OF_RANGE</code>错误，使你的代码更加健壮和可靠。</p><h3 id="err-invalid-opt-value" tabindex="-1"><a class="header-anchor" href="#err-invalid-opt-value"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_opt_value" target="_blank" rel="noopener noreferrer">ERR_INVALID_OPT_VALUE</a></span></a></h3><h3 id="解释-err-invalid-opt-value-错误" tabindex="-1"><a class="header-anchor" href="#解释-err-invalid-opt-value-错误"><span>解释 ERR_INVALID_OPT_VALUE 错误</span></a></h3><p>在 Node.js 的世界里，我们经常需要使用各种函数和模块来完成任务。这些函数和模块通常接受一系列的参数或选项（options），以控制它们的行为。当你提供给一个函数或模块的参数或选项的值不符合预期时，Node.js 就可能抛出一个 <code>ERR_INVALID_OPT_VALUE</code> 错误。</p><p>简单地说，<code>ERR_INVALID_OPT_VALUE</code> 错误意味着你在调用 Node.js 中的某个功能时，给了一个无效的选项值。换句话说，这个错误告诉你：“嘿，你给我的这个值是不对的，我不能用这个来工作。”</p><h3 id="实际运用的例子-31" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-31"><span>实际运用的例子</span></a></h3><p>让我们通过一些实际的例子来更好地理解 <code>ERR_INVALID_OPT_VALUE</code> 错误。</p><h4 id="例子-1-读取文件-1" tabindex="-1"><a class="header-anchor" href="#例子-1-读取文件-1"><span>例子 1: 读取文件</span></a></h4><p>假设你正在使用 Node.js 的 <code>fs.readFile</code> 方法来读取一个文件。这个方法接受一个选项对象，其中可以指定如何读取文件，比如字符编码等。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试以非法的选项值读取文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> encoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">invalidEncoding</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你传递了一个无效的编码作为 <code>encoding</code> 的值（比如上述代码中的 <code>&#39;invalidEncoding&#39;</code>），Node.js 将无法按照你的要求去读取文件，并可能抛出一个 <code>ERR_INVALID_OPT_VALUE</code> 错误，告诉你 <code>&#39;encoding&#39;</code> 的值无效。</p><h4 id="例子-2-创建服务器" tabindex="-1"><a class="header-anchor" href="#例子-2-创建服务器"><span>例子 2: 创建服务器</span></a></h4><p>考虑你正在使用 Node.js 的 <code>http.createServer</code> 方法来创建一个 HTTP 服务器。假设你想设置该服务器的超时时间，你会向 <code>server.setTimeout</code> 方法传递一个表示超时时间的数字。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> server</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createServer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">writeHead</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">200</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Content-Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">text/plain</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试设置一个无效的超时值</span></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">1000</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">server</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">listen</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">3000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Server running at http://localhost:3000/</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你尝试传递一个无效的超时值（比如 <code>-1000</code>，因为时间不能是负数），Node.js 可能会抛出 <code>ERR_INVALID_OPT_VALUE</code> 错误，提示你超时值是无效的。</p><h3 id="总结-7" tabindex="-1"><a class="header-anchor" href="#总结-7"><span>总结</span></a></h3><p><code>ERR_INVALID_OPT_VALUE</code> 错误本质上是 Node.js 告诉你，你提供的某个选项值不符合它的期望。遇到这类错误时，检查你提供的所有选项值是否符合文档描述的要求通常是一个好主意。这种类型的错误往往可以通过仔细阅读文档和验证输入值来预防。</p><h3 id="err-invalid-opt-value-encoding" tabindex="-1"><a class="header-anchor" href="#err-invalid-opt-value-encoding"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_opt_value_encoding" target="_blank" rel="noopener noreferrer">ERR_INVALID_OPT_VALUE_ENCODING</a></span></a></h3><p>要理解<code>ERR_INVALID_OPT_VALUE_ENCODING</code>错误，我们先得明白一些基础概念。</p><h3 id="基础概念" tabindex="-1"><a class="header-anchor" href="#基础概念"><span>基础概念</span></a></h3><p>在 Node.js 中，许多操作涉及到数据的处理，这些数据需要以某种形式进行编码（encoding）。编码就是将信息从一种形式或格式转换为另一种形式的过程。常见的编码类型有<code>utf-8</code>、<code>ascii</code>、<code>base64</code>等。</p><p>当你使用 Node.js 的一些 APIs 时，比如文件读写，网络通信等，你经常需要指定你希望如何编码或解码你的数据。</p><h3 id="err-invalid-opt-value-encoding-错误" tabindex="-1"><a class="header-anchor" href="#err-invalid-opt-value-encoding-错误"><span>ERR_INVALID_OPT_VALUE_ENCODING 错误</span></a></h3><p><code>ERR_INVALID_OPT_VALUE_ENCODING</code>是一个错误类型，表示你在调用一个函数时提供了一个无效的编码值作为选项参数。换句话说，这个错误告诉你：“嘿，你告诉我以某种方式处理数据，但是我不理解或不支持这种方式。”</p><h3 id="实际例子-19" tabindex="-1"><a class="header-anchor" href="#实际例子-19"><span>实际例子</span></a></h3><p>假设我们想读取一个文本文件，并且我们决定使用 Node.js 的<code>fs.readFile</code>方法。这个方法允许我们指定文件内容应该如何被编码。</p><p>正确的用法如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取文件，指定编码为utf-8</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> encoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf-8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，<code>{ encoding: &#39;utf-8&#39; }</code>告诉 Node.js 用<code>utf-8</code>编码来读取文件内容。</p><p>但如果你误将<code>encoding</code>值设置成了一个 Node.js 不支持的值，比如<code>superfast</code>, 就会抛出<code>ERR_INVALID_OPT_VALUE_ENCODING</code>错误：</p><p>错误的用法示例：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试使用Node.js不支持的编码读取文件</span></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> encoding</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">superfast</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> },</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会输出 ERR_INVALID_OPT_VALUE_ENCODING 错误</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个错误的示例中，因为<code>&#39;superfast&#39;</code>不是 Node.js 支持的一个有效编码方式，所以 Node.js 不知道如何按照<code>&#39;superfast&#39;</code>来解码文件内容，结果就会引发<code>ERR_INVALID_OPT_VALUE_ENCODING</code>错误。</p><h3 id="总结-8" tabindex="-1"><a class="header-anchor" href="#总结-8"><span>总结</span></a></h3><p>每当你看到<code>ERR_INVALID_OPT_VALUE_ENCODING</code>这个错误，就应该检查一下你是否尝试使用了一个无效的或者 Node.js 不支持的编码值。核实和纠正编码值之后，问题通常可以得到解决。</p><h3 id="err-invalid-transfer-object" tabindex="-1"><a class="header-anchor" href="#err-invalid-transfer-object"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_invalid_transfer_object" target="_blank" rel="noopener noreferrer">ERR_INVALID_TRANSFER_OBJECT</a></span></a></h3><p>要理解 <code>[ERR_INVALID_TRANSFER_OBJECT]</code> 错误，我们首先需要明白 Node.js 中的 worker 线程和数据传输的概念。</p><p>在 Node.js 中，worker 线程允许你执行 JavaScript 代码并行地运行在不同线程上，而不是传统的单线程模型。这样做的好处是可以利用现代多核 CPU 的能力，提高应用程序的性能和吞吐量。但当你想要在主线程和 worker 线程之间传递数据时，就会遇到一些挑战。</p><p>通常情况下，当你从一个线程向另一个线程发送数据时，数据需要被复制或者序列化，然后再在另一端被反序列化或复制出来。这个过程是必需的，因为每个线程有自己独立的内存空间，直接共享内存中的数据可能会导致竞争条件和其他问题。</p><p>然而，Node.js 提供了一种称为 “Transferable objects”（可转移对象）的机制，允许你直接将数据的所有权从一个线程转移到另一个线程，而不是复制数据。这种方式更高效，因为它避免了复制数据所需的开销。ArrayBuffer 对象是支持这种转移的例子之一。</p><p>当你尝试通过 <code>postMessage()</code> 方法发送数据时，如果你指定了第二个参数作为 transferList，并且列表中包含的对象不符合可转移对象的条件，就会触发 <code>[ERR_INVALID_TRANSFER_OBJECT]</code> 错误。换句话说，这个错误表明你试图转移一个无法被转移的对象。</p><h3 id="实际例子-20" tabindex="-1"><a class="header-anchor" href="#实际例子-20"><span>实际例子</span></a></h3><p>假设你在开发一个 Node.js 应用，该应用利用 worker 线程进行大量数学计算，以便不阻塞主线程。在一次更新中，你决定将计算生成的结果（一个 ArrayBuffer）从 worker 线程传回主线程。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Received: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">msg</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Worker error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里完成了一些计算，并创建了一个 ArrayBuffer 结果</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> resultBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">8</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 仅示例，实践中应基于实际计算生成</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">resultBuffer</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#D8DEE9;">resultBuffer</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">Error: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们正确地将 <code>ArrayBuffer</code> 作为一个可转移对象。如果 <code>resultBuffer</code> 不是一个 <code>ArrayBuffer</code> 或者其他任何不满足转移条件的对象，尝试执行 <code>parentPort.postMessage(resultBuffer, [resultBuffer]);</code> 就会引发 <code>[ERR_INVALID_TRANSFER_OBJECT]</code> 错误。</p><h3 id="总结-9" tabindex="-1"><a class="header-anchor" href="#总结-9"><span>总结</span></a></h3><p><code>[ERR_INVALID_TRANSFER_OBJECT]</code> 错误表示尝试将一个不支持转移的对象作为 Transferable object 来传递。确保当你使用 worker 线程并需要传递数据时，只有那些支持转移的对象才被放在 transferList 中。这样可以有效避免此类错误，并利用 Node.js 多线程的优势来提升应用性能。</p><h3 id="err-import-assertion-type-failed" tabindex="-1"><a class="header-anchor" href="#err-import-assertion-type-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_assertion_type_failed" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ASSERTION_TYPE_FAILED</a></span></a></h3><p>理解<code>ERR_IMPORT_ASSERTION_TYPE_FAILED</code>这个错误，首先得知道 Node.js 从版本 12 开始增加了对 ES 模块（ECMAScript Modules, ESM）的支持。ES 模块是 JavaScript 官方的标准模块系统，允许你通过<code>import</code>和<code>export</code>关键字来导入和导出模块。而<code>import assertions</code>是在这个体系中较新的一个特性，它允许你在导入模块时添加一些额外的声明（或者说断言），以确保你导入的内容符合预期的类型或格式。</p><p>错误<code>ERR_IMPORT_ASSERTION_TYPE_FAILED</code>直译过来是“导入断言类型失败”。这意味着当你在使用<code>import</code>语句导入模块时提供的断言信息与模块实际的类型或格式不匹配，就会抛出这个错误。</p><h3 id="实际应用示例" tabindex="-1"><a class="header-anchor" href="#实际应用示例"><span>实际应用示例</span></a></h3><p>假设我们现在有一个 JSON 文件<code>config.json</code>，里面保存着应用的配置信息：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">port</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 8080</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">mode</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">development</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了在一个 Node.js 程序中安全地导入这个 JSON 文件，我们可能会这样写：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> config</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./config.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里的<code>assert { type: &#39;json&#39; }</code>就是一个导入断言，它告诉 Node.js，我们期望导入的内容是 JSON 类型。如果<code>config.json</code>确实是一个 JSON 文件，那么这段代码将成功执行。但是，如果出于某种原因（比如文件被误修改了），<code>config.json</code>不再是一个有效的 JSON 文件，Node.js 在尝试按照 JSON 类型解析它时就会失败，并抛出<code>ERR_IMPORT_ASSERTION_TYPE_FAILED</code>错误。</p><h3 id="另一个例子-导入-css-作为构造样式表" tabindex="-1"><a class="header-anchor" href="#另一个例子-导入-css-作为构造样式表"><span>另一个例子：导入 CSS 作为构造样式表</span></a></h3><p>假设你正在使用一个现代的 Web 开发工具链，其中包含了 CSS 模块的特性，可以让你像这样导入一个 CSS 文件：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> styles</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./style.css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">css</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里，我们期望导入的是 CSS 内容，而且希望它能被当成构造样式表（Constructable Stylesheet）处理。如果你的环境或工具链不支持这种类型的导入，或者指定的文件并非 CSS 文件，同样会触发<code>ERR_IMPORT_ASSERTION_TYPE_FAILED</code>错误。</p><h3 id="小结-2" tabindex="-1"><a class="header-anchor" href="#小结-2"><span>小结</span></a></h3><p>总之，遇到<code>ERR_IMPORT_ASSERTION_TYPE_FAILED</code>错误时，你应该检查<code>import</code>语句中的断言部分是否正确描述了你试图导入的文件类型或格式。确保文件本身也符合这个期望。这个特性在管理和维护大型项目时特别有用，它能够增加代码的清晰度和安全性。</p><h3 id="err-import-assertion-type-missing" tabindex="-1"><a class="header-anchor" href="#err-import-assertion-type-missing"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_assertion_type_missing" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ASSERTION_TYPE_MISSING</a></span></a></h3><p>在 Node.js v21.7.1 中，<code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code>是一个错误类型，它与 ESM（ECMAScript 模块）的导入断言有关。这个概念可能听起来有点抽象，所以让我们一步一步地解释它。</p><h3 id="什么是-esm" tabindex="-1"><a class="header-anchor" href="#什么是-esm"><span>什么是 ESM？</span></a></h3><p>首先，ESM，即 ECMAScript Modules，是 JavaScript 的官方标准模块系统。相对于 Node.js 中早期采用的 CommonJS 模块系统，ESM 提供了更为现代和灵活的模块导入导出方式。ESM 使用<code>import</code>和<code>export</code>语法进行模块化编码。</p><h3 id="导入断言是什么" tabindex="-1"><a class="header-anchor" href="#导入断言是什么"><span>导入断言是什么？</span></a></h3><p>ESM 引入了一个新概念：导入断言（Import Assertions）。这允许你在导入模块时明确指定某些条件或特征，比如文件类型。此功能主要用于安全性和性能优化，确保导入的模块符合预期格式，避免运行时错误或安全问题。</p><h3 id="err-import-assertion-type-missing-解释" tabindex="-1"><a class="header-anchor" href="#err-import-assertion-type-missing-解释"><span><code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code> 解释</span></a></h3><p><code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code>错误发生在使用导入断言时，如果你没有正确地指定断言类型。基本上，它告诉你：“嘿，你在尝试导入一个模块并想要使用导入断言，但是你忘记告诉我你期望的模块类型是什么了。”</p><h3 id="实际例子-21" tabindex="-1"><a class="header-anchor" href="#实际例子-21"><span>实际例子</span></a></h3><p>假设你想要导入一个 JSON 文件，并且你希望使用导入断言确保你在导入过程中明确指出这个文件应该被认作 JSON。</p><p><strong>正确使用导入断言的示例：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myData</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里，我们导入了名为<code>data.json</code>的文件，并通过<code>assert { type: &#39;json&#39; }</code>明确指定了我们期待的文件类型是 JSON。这样做有助于 Node.js 理解如何正确处理这个导入，同时也提高了代码的安全性和可读性。</p><p><strong>引发<code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code>错误的示例：</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myData</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myData</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在这两种情况下，由于没有提供断言类型，Node.js 不知道如何处理<code>data.json</code>文件，因此会抛出<code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code>错误，告诉你缺少了必需的断言类型。</p><p>总之，当你看到<code>ERR_IMPORT_ASSERTION_TYPE_MISSING</code>错误时，检查你的导入语句，确保你正确使用了导入断言，并且指定了适当的类型。这将帮助你更安全、更有效地导入各种类型的模块。</p><h3 id="err-import-assertion-type-unsupported" tabindex="-1"><a class="header-anchor" href="#err-import-assertion-type-unsupported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_import_assertion_type_unsupported" target="_blank" rel="noopener noreferrer">ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</a></span></a></h3><p>在 Node.js 中，当你使用 ECMAScript 模块（ESM）进行编程时，可能会碰到各种错误之一就是 <code>ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</code>。现在，我将通过一个简单易懂的方式解释这个错误，并给出一些实际的例子。</p><h3 id="错误解释-1" tabindex="-1"><a class="header-anchor" href="#错误解释-1"><span>错误解释</span></a></h3><p>首先，让我们分解这个错误代码 <code>ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</code> 来看它是什么意思：</p><ul><li><strong>ERR</strong>：表示这是一个错误。</li><li><strong>IMPORT_ASSERTION</strong>：表示这个错误与“导入断言”有关。</li><li><strong>TYPE_UNSUPPORTED</strong>：表明遇到了不支持的类型。</li></ul><p>因此，整体来说，<code>ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</code> 指的是在尝试导入模块时，使用了 Node.js 不支持的导入断言类型。</p><h3 id="导入断言是什么-1" tabindex="-1"><a class="header-anchor" href="#导入断言是什么-1"><span>导入断言是什么？</span></a></h3><p>在 ECMAScript 模块中，导入断言允许开发者在<code>import</code>语句中指定一些额外的信息，这些信息通常用于验证模块的正确性或提供元数据。这是一个相对较新的特性，目的是为了增加模块导入的灵活性和安全性。</p><h3 id="实际运用例子-12" tabindex="-1"><a class="header-anchor" href="#实际运用例子-12"><span>实际运用例子</span></a></h3><p>假设你在尝试导入一个 JSON 模块，并希望确保它以正确的格式被导入。你可能会写出如下代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> myData</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./data.json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> assert</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">json</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里，<code>assert { type: &#39;json&#39; }</code> 就是一个导入断言，告诉 JavaScript 引擎应该把<code>data.json</code>作为 JSON 处理。</p><p>但是，如果 Node.js 不支持你指定的断言类型，比如说你尝试使用一个 Node.js 当前版本还未支持的断言类型，那么你将会遇到 <code>ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</code> 错误。</p><h3 id="解决方法-10" tabindex="-1"><a class="header-anchor" href="#解决方法-10"><span>解决方法</span></a></h3><p>解决这个问题的方法通常包括：</p><ol><li><strong>检查 Node.js 版本</strong>：确保你使用的 Node.js 版本支持你想要使用的导入断言类型。可以查阅 Node.js 的文档来获取最新的支持信息。</li><li><strong>修改导入断言</strong>：如果可能的话，尝试修改导入断言为 Node.js 所支持的类型。</li><li><strong>回退到 CommonJS</strong>：如果没有其他办法，你可能需要回退使用 CommonJS 模块系统，直到 Node.js 支持你需要的导入断言类型。</li></ol><h3 id="总结-10" tabindex="-1"><a class="header-anchor" href="#总结-10"><span>总结</span></a></h3><p>总的来说，<code>ERR_IMPORT_ASSERTION_TYPE_UNSUPPORTED</code> 是一个与导入断言相关的错误，发生在你尝试使用 Node.js 不支持的断言类型时。理解并处理这个错误需要你对导入断言有所了解，同时也需要跟进 Node.js 对相关特性的支持情况。</p><h3 id="err-missing-message-port-in-transfer-list" tabindex="-1"><a class="header-anchor" href="#err-missing-message-port-in-transfer-list"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_message_port_in_transfer_list" target="_blank" rel="noopener noreferrer">ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST</a></span></a></h3><p>当你使用 Node.js 进行编程时，有时候可能会遇到各种错误消息。<code>ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST</code> 是其中一个特定的错误类型。这个错误发生在你试图通过某种方式发送数据时，但忘记了在传输列表中包含必要的消息端口（Message Port）。</p><p>为了更好地理解，我们先来简单解释一下几个概念：</p><ol><li><p><strong>Node.js</strong>：一个让 JavaScript 运行在服务器端的平台，它允许开发者用 JavaScript 来写服务器端的代码。</p></li><li><p><strong>消息端口（Message Port）</strong>：在处理多线程或进程间通信时使用的通道，可以让不同的线程或进程之间相互发送信息。</p></li><li><p><strong>传输列表（Transfer list）</strong>：当你想通过消息端口发送复杂对象（如 ArrayBuffer 对象）时，传输列表让你能够指定哪些对象应该被转移给接收方。这样做有助于高效地传递数据，因为它避免了复制数据，而是直接将所有权从发送方转移到接收方。</p></li></ol><p>现在，回到 <code>ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST</code> 错误，这个错误意味着在尝试通过消息端口发送数据时，你没有在传输列表中正确地指定消息端口。这导致 Node.js 不知道应该如何处理这个操作，因此会抛出这个错误。</p><h3 id="实际运用的例子-32" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-32"><span>实际运用的例子</span></a></h3><p>假设你正在构建一个 Node.js 应用，该应用需要在主线程和工作线程之间进行数据交换（例如，你可能想要在后台执行一些复杂计算，并将结果发送回主线程）。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 在主线程中</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> MessageChannel</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个新的工作线程</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./worker.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个消息通道，用于两个线程间的通信</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> port1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> port2</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MessageChannel</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 发送端口给工作线程，但忘记加入传输列表</span></span>
<span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> port1</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里会抛出 ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST 错误</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 正确的做法应该是这样：</span></span>
<span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;"> port</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> port1</span><span style="color:#ECEFF4;"> },</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#D8DEE9;">port1</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的例子中，我们创建了一个消息通道，该通道包括两个端口：<code>port1</code> 和 <code>port2</code>。其中<code>port1</code> 用于主线程与工作线程之间的通信，而 <code>port2</code> 则留给工作线程使用。如果我们直接发送 <code>port1</code> 给工作线程而不在传输列表中指定它，Node.js 就会抛出 <code>ERR_MISSING_MESSAGE_PORT_IN_TRANSFER_LIST</code> 错误。正确的做法是，在 <code>postMessage</code> 方法的第二个参数中提供一个包含 <code>port1</code> 的数组，这样就明确告诉 Node.js <code>port1</code> 是需要被转移的对象，而不是简单地被复制。</p><p>通过这种方式，Node.js 可以确保消息端口被正确地传递和使用，而不会引起任何混淆或错误。这对于实现高效的数据交换和多线程/多进程通信至关重要。</p><h3 id="err-missing-transferable-in-transfer-list" tabindex="-1"><a class="header-anchor" href="#err-missing-transferable-in-transfer-list"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_missing_transferable_in_transfer_list" target="_blank" rel="noopener noreferrer">ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST</a></span></a></h3><p>当我们谈论 Node.js 中的 <code>[ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST]</code> 错误时，我们实际上是在讨论与 Web Workers 或 Worker Threads（工作线程）相关的编程模型。这个错误通常发生在我们尝试通过 <code>postMessage</code> 方法发送消息时，忘记将对象添加到 transferList 中。</p><p>首先，让我简单解释下背景知识：</p><p>在 Node.js 或 Web Worker 环境中，主线程可以创建并与工作线程通信。这种分离允许主应用程序继续运行而不会被耗时任务阻塞。为了进行这种通信，通常会使用 <code>postMessage()</code> 方法发送数据。</p><p>当你使用 <code>postMessage()</code> 发送数据时，你有两个选择：复制数据或转移数据。复制数据意味着原始数据仍然保留在发送方，但副本被创建并发送给接收方，这可能导致性能问题，特别是对于大型数据。另一方面，转移数据意味着数据从发送方移动到接收方，这样做减少了内存使用并提高了效率，但发送方将不再拥有该数据。这就是 transferList 的用途所在。</p><p>现在具体来说 <code>[ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST]</code> 错误，这个错误出现意味着你试图转移某个对象，但是却忘记在 <code>transferList</code> 参数中声明它。让我们来看一个例子：</p><p>假设你正在开发一个 Node.js 应用程序，需要在一个 worker thread 中处理一个大型的 ArrayBuffer (一种表示固定长度原始二进制数据缓冲区的类型)。你想要把这个 ArrayBuffer 从主线程传送到工作线程去处理，并且由于性能考虑，你希望“转移”它而非复制它。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> isMainThread</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> parentPort</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">isMainThread</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">  // 主线程代码</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> worker</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__filename</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> bigArrayBuffer</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ArrayBuffer</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 1024</span><span style="color:#81A1C1;"> *</span><span style="color:#B48EAD;"> 50</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 创建一个大的 ArrayBuffer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 尝试发送 bigArrayBuffer 给工作线程</span></span>
<span class="line"><span style="color:#616E88;">  // 注意这里我们忘记将 bigArrayBuffer 添加到 transferList 中，这会导致 ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST 错误。</span></span>
<span class="line"><span style="color:#D8DEE9;">  worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">bigArrayBuffer</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 工作线程代码</span></span>
<span class="line"><span style="color:#D8DEE9;">  parentPort</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">message</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Data received in worker</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 在这里处理 bigArrayBuffer 数据</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的方式是在 <code>postMessage</code> 方法的第二个参数中包含你希望转移的对象列表。修改后的代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 正确地将 bigArrayBuffer 添加到 transferList 中</span></span>
<span class="line"><span style="color:#D8DEE9;">worker</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">postMessage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">bigArrayBuffer</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#D8DEE9;">bigArrayBuffer</span><span style="color:#D8DEE9FF;">])</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过这样做，你告诉 Node.js 这个大的 ArrayBuffer 应该从主线程转移到工作线程，而不是复制它。这样不仅可以提高性能，也可以避免 <code>[ERR_MISSING_TRANSFERABLE_IN_TRANSFER_LIST]</code> 错误。</p><h3 id="err-napi-cons-prototype-object" tabindex="-1"><a class="header-anchor" href="#err-napi-cons-prototype-object"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_napi_cons_prototype_object" target="_blank" rel="noopener noreferrer">ERR_NAPI_CONS_PROTOTYPE_OBJECT</a></span></a></h3><p>要理解<code>ERR_NAPI_CONS_PROTOTYPE_OBJECT</code>这个错误，我们首先需要了解一些背景知识。</p><h3 id="背景知识-2" tabindex="-1"><a class="header-anchor" href="#背景知识-2"><span>背景知识</span></a></h3><ul><li><strong>Node.js</strong>: 一个基于 Chrome V8 引擎的 JavaScript 运行环境，让你可以在服务器端运行 JavaScript 代码。</li><li><strong>N-API</strong>: Node.js 的 API，它是一个用 C 语言编写的抽象层，允许你用 C 或 C++编写的扩展与 JavaScript 代码交互。N-API 的目的是提供一个与 Node.js 版本无关的 API，以促进模块的稳定性和向后兼容性。</li><li><strong>原型（Prototype）</strong>: JavaScript 中的一个重要概念，每个对象都有一个原型对象，对象从原型“继承”属性和方法。</li></ul><h3 id="err-napi-cons-prototype-object错误" tabindex="-1"><a class="header-anchor" href="#err-napi-cons-prototype-object错误"><span><code>ERR_NAPI_CONS_PROTOTYPE_OBJECT</code>错误</span></a></h3><p>这个特定错误发生在使用 N-API 创建原生插件时。当你尝试为一个类（通常是一个用 C 或 C++编写的原生构造函数）设置原型对象，但该操作因某种原因失败时，就会抛出<code>ERR_NAPI_CONS_PROTOTYPE_OBJECT</code>错误。换句话说，这个错误意味着 Node.js 尝试将某些功能或属性（通过原型链）分配给一个由 N-API 创建的对象时遇到了问题。</p><h3 id="实际运用的例子-33" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-33"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个 Node.js 插件，该插件需要进行图像处理，而图像处理的部分用 C++来实现以提高效率。在这个场景下，你可能会创建一个<code>ImageProcessor</code>类，在 C++中实现其核心功能，并通过 N-API 暴露给 Node.js。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" data-title="cpp" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span>##include `&lt;`napi.h&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class ImageProcessor : public Napi::ObjectWrap`&lt;`ImageProcessor&gt; {</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    static Napi::Object Init(Napi::Env env, Napi::Object exports);</span></span>
<span class="line"><span>    ImageProcessor(const Napi::CallbackInfo&amp; info);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    static Napi::FunctionReference constructor;</span></span>
<span class="line"><span>    // 假设有一个方法处理图像...</span></span>
<span class="line"><span>    Napi::Value ProcessImage(const Napi::CallbackInfo&amp; info);</span></span>
<span class="line"><span>};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来，你需要在 C++中正确设置这个类的原型，这样 JavaScript 代码就能调用<code>ProcessImage</code>方法。如果在这一步骤中，因为某种原因（比如传递给 N-API 的参数不正确），设置原型失败了，<code>ERR_NAPI_CONS_PROTOTYPE_OBJECT</code>错误就会被触发。</p><p>处理这类错误通常涉及检查用于设置原型的 N-API 调用，确保所有参数都是正确和预期的。这可能包括对照 N-API 文档仔细检查参数类型、数量等。</p><p>总结，<code>ERR_NAPI_CONS_PROTOTYPE_OBJECT</code>是一个指示在通过 N-API 设置原生对象原型时遇到问题的错误。虽然对于刚开始接触 Node.js 和 N-API 的人来说可能有点复杂，但理解和处理此类错误是开发高性能 Node.js 应用的一个重要方面。</p><h3 id="err-network-import-bad-response" tabindex="-1"><a class="header-anchor" href="#err-network-import-bad-response"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_network_import_bad_response" target="_blank" rel="noopener noreferrer">ERR_NETWORK_IMPORT_BAD_RESPONSE</a></span></a></h3><p>理解<code>ERR_NETWORK_IMPORT_BAD_RESPONSE</code>这个错误首先需要了解 Node.js 中的一个基本概念：ES 模块的网络导入功能。在 Node.js v17 版本，引入了一项新功能，允许开发者直接从网络上导入 ES 模块，这意味着你可以在你的代码中使用 URL 来引入模块，而不是仅限于从本地文件系统导入。这是一个非常强大的特性，因为它让共享和使用跨项目的 JavaScript 代码变得更加容易。</p><p>然而，当你尝试从网络导入模块时，可能会遇到各种网络相关的问题。<code>ERR_NETWORK_IMPORT_BAD_RESPONSE</code>就是其中之一，它表示当 Node.js 尝试从指定的 URL 导入 ES 模块时，收到了一个无法被正确处理的响应。通常，这个错误涉及到以下几个方面的问题：</p><ol><li><p><strong>HTTP 状态码不成功</strong>：如果服务器返回的 HTTP 状态码不是一个表示成功的状态（比如 200），那么 Node.js 就会抛出<code>ERR_NETWORK_IMPORT_BAD_RESPONSE</code>错误。例如，404（未找到）或 500（服务器内部错误）都会触发这个错误。</p></li><li><p><strong>无效的内容类型</strong>：当从网络导入模块时，Node.js 期望服务器返回的内容类型是有效的 JavaScript MIME 类型。如果响应头中的<code>Content-Type</code>不是如<code>application/javascript</code>或者其他有效的 JavaScript 类型，Node.js 将报告这个错误。</p></li><li><p><strong>空响应或无效内容</strong>：即使 HTTP 状态码是成功的，如果响应体为空，或者响应的内容不能被 Node.js 作为有效的 ES 模块解析，也会导致这个错误。</p></li></ol><h3 id="实际运用的例子-34" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-34"><span>实际运用的例子</span></a></h3><p>假设你正在构建一个 Node.js 应用，想要使用一个存放在 GitHub 上的公共库作为模块。你可以直接在你的代码中通过 URL 来导入这个库：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> someLibrary</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https://example.com/some-library.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果一切顺利，<code>someLibrary</code>模块将被成功导入，并且你可以在你的应用中自由使用它。但是，如果因为任何上述原因导入失败，Node.js 将抛出<code>ERR_NETWORK_IMPORT_BAD_RESPONSE</code>错误。</p><h3 id="如何解决这个错误-5" tabindex="-1"><a class="header-anchor" href="#如何解决这个错误-5"><span>如何解决这个错误？</span></a></h3><ol><li><strong>检查 URL 是否正确</strong>：确保你提供的 URL 是正确的，并且目标服务器能够正常响应。</li><li><strong>检查服务器状态和日志</strong>：如果你有权限，检查目标服务器以确保它正常工作，并没有返回错误码。</li><li><strong>调整内容类型</strong>：如果可能，确保服务器响应包含正确的<code>Content-Type</code>头。</li><li><strong>模块兼容性</strong>：确保远程模块是一个有效的 ES 模块，并且与你的 Node.js 版本兼容。</li></ol><p>通过以上步骤，通常可以诊断并解决<code>ERR_NETWORK_IMPORT_BAD_RESPONSE</code>错误。</p><h3 id="err-network-import-disallowed" tabindex="-1"><a class="header-anchor" href="#err-network-import-disallowed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_network_import_disallowed" target="_blank" rel="noopener noreferrer">ERR_NETWORK_IMPORT_DISALLOWED</a></span></a></h3><p>当你使用 Node.js，你可能会遇到各种错误信息，这些信息有助于你定位程序中的问题。在 Node.js v21.7.1 版本中，其中一个可能遇到的错误就是 <code>ERR_NETWORK_IMPORT_DISALLOWED</code>。让我们分解这个错误信息，并通过一些实际例子来理解它。</p><h3 id="解释-5" tabindex="-1"><a class="header-anchor" href="#解释-5"><span>解释</span></a></h3><p><code>ERR_NETWORK_IMPORT_DISALLOWED</code> 是一个错误信息，表明你试图从网络上导入模块或包（JavaScript 代码），但这个操作被 Node.js 环境禁止了。这主要是出于安全和性能的考虑。Node.js 通常期望所有必需的代码都已经下载到本地，这样可以确保运行的代码速度快且安全。从网络动态加载代码可能带来未知的安全风险和不稳定性。</p><h3 id="实际运用的例子-35" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-35"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个 Node.js 应用程序，你想要使用一个非常棒的库，该库提供了一些数据处理的功能。你在网上找到了这个库的 URL（比如<a href="https://example.com/cool-library.js%EF%BC%89%E3%80%82%E7%8E%B0%E5%9C%A8%EF%BC%8C%E4%BD%A0%E6%83%B3%E7%9B%B4%E6%8E%A5%E5%9C%A8%E4%BD%A0%E7%9A%84Node.js%E5%BA%94%E7%94%A8%E4%B8%AD%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AAURL%E5%AF%BC%E5%85%A5%E8%BF%99%E4%B8%AA%E5%BA%93%E3%80%82%E4%BD%A0%E5%8F%AF%E8%83%BD%E5%B0%9D%E8%AF%95%E5%83%8F%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%E5%86%99%E4%BB%A3%E7%A0%81%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://example.com/cool-library.js）。现在，你想直接在你的Node.js应用中通过这个URL导入这个库。你可能尝试像下面这样写代码：</a></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 尝试通过URL导入模块</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> as</span><span style="color:#8FBCBB;"> coolLibrary</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">https://example.com/cool-library.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>当你运行这段代码时，Node.js 会抛出<code>ERR_NETWORK_IMPORT_DISALLOWED</code>错误。这是因为 Node.js 环境默认不允许直接从网络导入模块。</p><h3 id="如何解决-5" tabindex="-1"><a class="header-anchor" href="#如何解决-5"><span>如何解决</span></a></h3><ul><li><p><strong>下载到本地</strong>：最简单的解决方法是下载这个库到你的本地项目中，然后通过本地路径引入它。这样既满足了安全性，也保证了程序的稳定性。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 导入本地模块</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> as</span><span style="color:#8FBCBB;"> coolLibrary</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./path/to/cool-library.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>使用包管理器</strong>：如果这个库在 npm（Node.js 的包管理器）上可用，你可以使用 npm 或 yarn 将其添加到你的项目中。例如，如果库名为<code>cool-library</code>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">npm</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> cool-library</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后在你的代码中这样导入：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> as</span><span style="color:#8FBCBB;"> coolLibrary</span><span style="color:#81A1C1;"> from</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">cool-library</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>配置代理或中间件</strong>：在某些高级场景中，如果你确实需要从网络动态加载代码，你可能需要设置特定的代理服务器或中间件，以程序化地下载这些代码，然后再由你的应用安全地使用。这通常需要较深的网络和 Node.js 知识，并且应当小心谨慎地执行。</p></li></ul><p>通过以上的解释和示例，你应该对<code>ERR_NETWORK_IMPORT_DISALLOWED</code>错误有了基本的了解，以及如何避免在 Node.js 程序开发中遇到这个问题。记住，保持代码的安全性和稳定性总是第一位的。</p><h3 id="err-no-longer-supported" tabindex="-1"><a class="header-anchor" href="#err-no-longer-supported"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_no_longer_supported" target="_blank" rel="noopener noreferrer">ERR_NO_LONGER_SUPPORTED</a></span></a></h3><p>理解<code>ERR_NO_LONGER_SUPPORTED</code>错误在 Node.js 中的含义，其实非常直接而且简单。这个错误是 Node.js 用来告诉你，你尝试使用的某个功能、API 或者方法已经不再被支持了。换句话说，这意味着 Node.js 的开发团队决定这部分代码过时了，可能因为有了更好的实现方式，或者这个功能不再适合当前的软件架构。</p><p>举几个实际的例子来帮助理解：</p><ol><li><p><strong>过时的 API</strong>：假设在一个旧版本的 Node.js 中，有一个函数<code>oldFunction()</code>被广泛使用。随着时间的推移，Node.js 推出了效率更高、安全性更强的新函数<code>newFunction()</code>。如果新版本的 Node.js 中完全移除了<code>oldFunction()</code>的支持，那么当你在代码中调用<code>oldFunction()</code>时，就会遇到<code>ERR_NO_LONGER_SUPPORTED</code>错误。这是 Node.js 告诉你：“嘿，是时候更新你的代码，使用<code>newFunction()</code>了！”</p></li><li><p><strong>废弃的特性</strong>：想象一下，有一个 Node.js 的旧特性允许直接从 URL 加载代码执行。出于安全考虑，后来的版本可能完全移除了这个能力。如果你的代码依旧尝试这样做，结果会是什么呢？对，你会遇到<code>ERR_NO_LONGER_SUPPORTED</code>错误，因为这个行为不再被 Node.js 支持了。</p></li><li><p><strong>已移除的模块</strong>：Node.js 像其他软件一样不断进化，它有自己的生态系统和模块库。有时，某个模块可能因为各种原因（如安全漏洞、更好的替代品出现等）被完全从 Node.js 中移除。如果你的应用试图引入并使用一个已经被移除的模块，Node.js 会抛出<code>ERR_NO_LONGER_SUPPORTED</code>错误，提示你需要寻找替代方案。</p></li></ol><p>处理<code>ERR_NO_LONGER_SUPPORTED</code>错误的最佳方式通常包括阅读 Node.js 的官方文档，查看变更日志，并根据推荐的做法更新你的代码。同时，参加社区讨论和追踪相关技术博客也是了解这些变化的好方法。总之，保持代码的现代性和安全性，跟上 Node.js 的发展步伐是每个 Node.js 开发者的必修课。</p><h3 id="err-operation-failed" tabindex="-1"><a class="header-anchor" href="#err-operation-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_operation_failed" target="_blank" rel="noopener noreferrer">ERR_OPERATION_FAILED</a></span></a></h3><p>在 Node.js 中，<code>ERR_OPERATION_FAILED</code>是一个错误代码，表示某个操作没有成功执行。这个错误通常是由于底层的系统或环境因素导致的，而不是因为程序逻辑本身有问题。换句话说，当 Node.js 尝试执行某项操作时，如果遇到了预料之外的障碍，就可能抛出这种错误。</p><h3 id="实际运用的例子-36" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-36"><span>实际运用的例子</span></a></h3><p>让我来给你解释一些可能会引发<code>ERR_OPERATION_FAILED</code>错误的实际场景：</p><ol><li><p><strong>文件系统操作</strong></p><p>假设你的 Node.js 应用正在尝试读取一个文件，但是由于权限不足或文件不存在，操作失败了。这可能会引发<code>ERR_OPERATION_FAILED</code>错误。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFile</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/path/to/nonexistent/file.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里可能会输出 ERR_OPERATION_FAILED</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>网络请求</strong></p><p>如果你的应用尝试与一个服务器建立连接，但是由于网络问题或服务器无响应导致连接失败，这同样可能引起<code>ERR_OPERATION_FAILED</code>。比如使用<code>http</code>模块发送请求：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> http</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">http</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> options</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">  hostname</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">www.example.com</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  port</span><span style="color:#ECEFF4;">:</span><span style="color:#B48EAD;"> 80</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  path</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/some/path</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#88C0D0;">  method</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">GET</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> req</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> http</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">request</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">状态码: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">statusCode</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">  res</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stdout</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">d</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">请求遇到问题: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这里也可能输出 ERR_OPERATION_FAILED</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">req</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>自定义操作失败</strong></p><p>在开发者自定义的一些异步操作中，当检测到某些条件不满足时，也可以手动抛出<code>ERR_OPERATION_FAILED</code>错误，以提示操作未能成功完成。虽然这不是最常见的用法，但它展示了错误代码的灵活性。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">function</span><span style="color:#88C0D0;"> myAsyncOperation</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">callback</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设这里有某种判断</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> operationSuccess</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">operationSuccess</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> error</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Operation failed due to ...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">    error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ERR_OPERATION_FAILED</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 操作成功的逻辑</span></span>
<span class="line"><span style="color:#88C0D0;">    callback</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">myAsyncOperation</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> result</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出 ERR_OPERATION_FAILED</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> else</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>以上例子说明了<code>ERR_OPERATION_FAILED</code>错误在不同情况下是如何被触发的。重要的是要记得，这类错误通常指向系统级别或环境级别的问题，而不是代码逻辑错误。当你遇到这种错误时，检查操作的外部条件和系统配置通常是解决问题的关键。</p><h3 id="err-outofmemory" tabindex="-1"><a class="header-anchor" href="#err-outofmemory"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_outofmemory" target="_blank" rel="noopener noreferrer">ERR_OUTOFMEMORY</a></span></a></h3><p>好的，让我们来解开<code>ERR_OUTOFMEMORY</code>这个错误在 Node.js 中的神秘面纱。首先，要理解这个错误的含义，就得先知道它是怎样产生的。顾名思义，<code>ERR_OUTOFMEMORY</code>指的是“内存不足”错误。这意味着 Node.js 程序在运行过程中尝试使用更多的内存资源，但是系统没有足够的内存来满足这些需求。</p><p>在 Node.js 中，这种情况可能发生在几个不同的场景中，比如处理大文件、大量数据或是进行密集计算等。下面，我将通过一些实际的例子来进一步说明。</p><h3 id="实际运用的例子-37" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-37"><span>实际运用的例子</span></a></h3><h4 id="_1-处理大文件" tabindex="-1"><a class="header-anchor" href="#_1-处理大文件"><span>1. 处理大文件</span></a></h4><p>假设你正在编写一个 Node.js 程序，该程序需要读取一个非常大的文件，并对其内容进行处理。如果你尝试一次性将整个文件载入内存，而文件的大小超过了可用内存的限制，那么就会触发<code>ERR_OUTOFMEMORY</code>错误。</p><p><strong>解决方案：</strong> 使用流（Streams）来逐片段地处理文件。这样可以避免一次性加载整个文件到内存中。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">path/to/large/file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 处理文件的一部分</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 文件读取完成</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-管理大量数据" tabindex="-1"><a class="header-anchor" href="#_2-管理大量数据"><span>2. 管理大量数据</span></a></h4><p>想象你有一个应用，它需要从数据库中获取大量数据，并对这些数据进行复杂的分析和处理。如果尝试一次性将所有数据加载到内存中，很可能会导致<code>ERR_OUTOFMEMORY</code>错误。</p><p><strong>解决方案：</strong> 分批次查询和处理数据，每次只处理一小部分数据，这样可以有效控制内存的使用。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> processDataInBatches</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> total</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> getTotal</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这个函数返回数据总量</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> batchSize</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 100</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 每批处理100条数据</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  for</span><span style="color:#D8DEE9FF;">(</span><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">&lt;</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9;"> total</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> +=</span><span style="color:#D8DEE9;"> batchSize</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> dataBatch</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> await</span><span style="color:#88C0D0;"> fetchData</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">i</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> batchSize</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 假设这个函数根据索引和批量大小获取数据</span></span>
<span class="line"><span style="color:#616E88;">    // 处理这批数据</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-密集计算" tabindex="-1"><a class="header-anchor" href="#_3-密集计算"><span>3. 密集计算</span></a></h4><p>如果你的 Node.js 应用涉及到大量的数学计算，特别是当这些计算并行执行时，也有可能消耗巨大的内存资源，导致<code>ERR_OUTOFMEMORY</code>错误。</p><p><strong>解决方案：</strong> 尝试优化算法以减少内存使用，或者分割任务为更小的部分逐个执行，以减轻内存负担。</p><h3 id="总结-11" tabindex="-1"><a class="header-anchor" href="#总结-11"><span>总结</span></a></h3><p><code>ERR_OUTOFMEMORY</code>错误是由于 Node.js 应用请求的内存资源超过了系统可用的内存限制。面对这类错误，关键在于识别出内存消耗的瓶颈所在，并通过优化代码逻辑、分批处理数据或使用流来减少内存的使用。希望这些例子能帮助你更好地理解<code>ERR_OUTOFMEMORY</code>错误以及如何处理它。</p><h3 id="err-parse-history-data" tabindex="-1"><a class="header-anchor" href="#err-parse-history-data"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_parse_history_data" target="_blank" rel="noopener noreferrer">ERR_PARSE_HISTORY_DATA</a></span></a></h3><p><code>ERR_PARSE_HISTORY_DATA</code> 是 Node.js 中的一个错误代码，用于标识在解析历史数据时发生了问题。这种错误一般出现在 Node.js 尝试读取或处理它保存的一些历史记录（例如 REPL 历史）时，遇到了数据格式不符或损坏等问题。</p><p>在详细解释之前，我们先来简单了解一下几个相关概念：</p><ul><li><strong>Node.js</strong>: 一个基于 Chrome V8 引擎的 JavaScript 运行环境，让你可以在服务器端运行 JavaScript。</li><li><strong>REPL</strong>: Read-Eval-Print Loop 的缩写，即“读取-求值-输出”循环，是一种简单的、交互式的编程环境。</li><li><strong>历史数据</strong>: 在这个上下文中，通常指的是用户在 REPL 环境中输入的命令历史。</li></ul><h3 id="解释-err-parse-history-data" tabindex="-1"><a class="header-anchor" href="#解释-err-parse-history-data"><span>解释 <code>ERR_PARSE_HISTORY_DATA</code></span></a></h3><p>当你使用 Node.js 的 REPL 功能时，为了方便用户，Node.js 会保存你输入过的命令历史，这样你就可以通过上下箭头键回看或重复执行之前的命令。这些历史记录被保存在一个特定的文件中（例如，在 UNIX 系统中可能是 <code>~/.node_repl_history</code>）。</p><p>如果 Node.js 在启动或运行过程中尝试从这个历史记录文件中读取数据，但发现数据格式不正确、损坏或无法被正常解析，它就会抛出 <code>ERR_PARSE_HISTORY_DATA</code> 错误。</p><h3 id="实际运用例子-13" tabindex="-1"><a class="header-anchor" href="#实际运用例子-13"><span>实际运用例子</span></a></h3><p>想象一个场景：你在使用 Node.js 的 REPL 模式进行日常的开发工作，随着时间推移，你累积了大量的命令历史。某一天，由于磁盘错误、程序异常退出或者手动编辑历史文件导致文件结构损坏，下次当你启动 Node.js 的 REPL 时，它尝试加载并解析这个历史文件，却发现其中的数据不完整或格式错误，于是抛出 <code>ERR_PARSE_HISTORY_DATA</code> 错误。</p><p><strong>解决方案</strong>:</p><ol><li><strong>查找并修复历史文件</strong>: 找到保存 REPL 命令历史的文件，检查并手动修复数据格式问题。然而，这可能需要对文件格式有一定了解。</li><li><strong>删除或重命名历史文件</strong>: 如果历史记录不是非常重要，最简单的方式是直接删除该文件或将其重命名。这样，Node.js 在下次启动时会创建一个新的历史文件，而你失去的只是之前的命令历史。</li></ol><p>总结来说，<code>ERR_PARSE_HISTORY_DATA</code> 是 Node.js 在处理其历史记录数据时遇到解析错误时抛出的一个错误码。面对这类错误，检查和处理历史记录文件通常是最直接的解决办法。</p><h3 id="err-socket-cannot-send" tabindex="-1"><a class="header-anchor" href="#err-socket-cannot-send"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_socket_cannot_send" target="_blank" rel="noopener noreferrer">ERR_SOCKET_CANNOT_SEND</a></span></a></h3><p>解释<code>ERR_SOCKET_CANNOT_SEND</code>这个错误，我们首先需要了解一些基本概念。</p><h3 id="基本概念-1" tabindex="-1"><a class="header-anchor" href="#基本概念-1"><span>基本概念</span></a></h3><ul><li><strong>Node.js</strong>: 一个让 JavaScript 运行在服务器端的平台。它允许开发者使用 JavaScript 来写服务器端的代码，处理网络请求，文件系统操作等。</li><li><strong>Socket</strong>: 在网络编程中，Socket 是端点之间进行数据交换的一种方式。你可以把它想象成通信的管道，一端发送数据，另一端接收数据。</li></ul><h3 id="err-socket-cannot-send-1" tabindex="-1"><a class="header-anchor" href="#err-socket-cannot-send-1"><span>ERR_SOCKET_CANNOT_SEND</span></a></h3><p>这个错误表示在尝试通过 Socket 发送数据时出现问题。具体来说，当你的 Node.js 应用程序试图通过一个网络 Socket 发送数据，但是因为某种原因（如网络问题、Socket 已关闭等）导致数据无法被送出时，就会遇到<code>ERR_SOCKET_CANNOT_SEND</code>错误。</p><h3 id="实际运用的例子-38" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-38"><span>实际运用的例子</span></a></h3><p>假设你正在开发一个聊天应用，服务器端使用 Node.js 编写。</p><ol><li><p><strong>服务器向客户端发送消息</strong></p><p>服务器上有多个客户端通过 Socket 连接。当一个用户发送消息时，服务器尝试将这条消息转发给其他所有在线用户。如果在这个过程中服务器尝试向一个已经断开连接的客户端发送数据，可能就会触发<code>ERR_SOCKET_CANNOT_SEND</code>错误。</p></li><li><p><strong>实时数据推送</strong></p><p>假设你正在开发一个股票市场的实时数据推送服务。服务器需要不停地向客户端推送最新的股票价格。如果网络出现波动，或者客户端的连接突然中断，服务器在尝试推送数据时就可能会遇到<code>ERR_SOCKET_CANNOT_SEND</code>错误。</p></li></ol><h3 id="处理方法-1" tabindex="-1"><a class="header-anchor" href="#处理方法-1"><span>处理方法</span></a></h3><p>对于<code>ERR_SOCKET_CANNOT_SEND</code>错误，常见的处理方法包括：</p><ul><li><strong>重试机制</strong>：当捕获到这个错误时，可以尝试重新发送数据。</li><li><strong>错误日志记录</strong>：记录错误详情，帮助开发者分析出现问题的原因。</li><li><strong>用户提示</strong>：如果可能的话，向用户显示错误信息或者提供反馈，比如“发送失败，请重试”。</li></ul><p>总的来说，<code>ERR_SOCKET_CANNOT_SEND</code>是一个涉及网络通信问题的错误，处理它需要仔细考虑重试策略、错误日志记录和用户体验三个方面。通过适当的错误处理，可以提升应用的稳定性和用户满意度。</p><h3 id="err-stderr-close" tabindex="-1"><a class="header-anchor" href="#err-stderr-close"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stderr_close" target="_blank" rel="noopener noreferrer">ERR_STDERR_CLOSE</a></span></a></h3><p>当你正在学习或使用 Node.js，特别是最新版本如 v21.7.1 时，遇到各种错误信息是很常见的。错误代码<code>ERR_STDERR_CLOSE</code>就是其中之一。让我来帮你详细解释这个错误以及它可能出现的场景。</p><p>首先，我们需要理解 Node.js 里面的<code>stdout</code>和<code>stderr</code>。简单来说，在 Node.js 中：</p><ul><li><code>stdout</code>（标准输出）通常用于输出正常的程序日志或结果。</li><li><code>stderr</code>（标准错误）主要用于输出错误日志或者一些警告信息。</li></ul><p>在编程时，特别是进行复杂或异步操作时，我们经常需要处理错误和日志。<code>stdout</code>和<code>stderr</code>提供了一种机制来区分“正常的输出信息”与“错误或警告信息”。</p><h3 id="错误代码-err-stderr-close" tabindex="-1"><a class="header-anchor" href="#错误代码-err-stderr-close"><span>错误代码：ERR_STDERR_CLOSE</span></a></h3><p>错误<code>ERR_STDERR_CLOSE</code>发生在尝试通过<code>stderr</code>写入数据，但是<code>stderr</code>已经关闭的情况下。这可能听起来有些抽象，让我举个实际的例子来说明。</p><p>假设你在创建一个 Node.js 应用，该应用执行一系列任务，并且在遇到错误时，你想要记录错误信息到<code>stderr</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 示例1：简单记录错误信息到stderr</span></span>
<span class="line"><span style="color:#D8DEE9;">process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stderr</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是一个错误信息</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>通常情况下，上述代码会正常运行。但是，如果在这之前<code>stderr</code>被某种原因关闭了，尝试执行这段代码就会触发<code>ERR_STDERR_CLOSE</code>错误，因为你正在尝试在一个已经关闭的流上写入数据。</p><p>现实中直接关闭<code>stderr</code>的情况比较少见，但它可能在一些复杂的应用程序中间接发生，特别是在涉及到流（Streams）管理、多线程或者进程间通信时。因此，这个错误通常暗示着程序的某部分不正确地管理了资源，或者是一个意外的同步问题。</p><h3 id="如何处理这个错误-7" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-7"><span>如何处理这个错误</span></a></h3><ol><li><strong>审查代码逻辑</strong>：确保你没有在程序的某处错误地关闭了<code>stderr</code>。</li><li><strong>异常处理</strong>：增加异常处理逻辑，尤其是在异步操作中。Try-catch 块可以帮助捕获并适当处理这类错误，避免程序崩溃。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  process</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">stderr</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">这是一个错误信息</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">尝试写入到一个已关闭的 stderr</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> e</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>合理管理流（Streams）</strong>：如果你的应用涉及到复杂的流管理，确保你正确地处理了每个流的生命周期，包括它们的打开和关闭。</li></ol><p>总结，<code>ERR_STDERR_CLOSE</code>错误是关于尝试在已关闭的<code>stderr</code>上进行写操作的提示。理解和处理这个错误需要对你的应用程序中的错误处理和流管理有所掌握。通过上述方法可以帮助预防和解决这个问题，保持你的 Node.js 应用稳定运行。</p><h3 id="err-stdout-close" tabindex="-1"><a class="header-anchor" href="#err-stdout-close"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stdout_close" target="_blank" rel="noopener noreferrer">ERR_STDOUT_CLOSE</a></span></a></h3><p>当你在使用 Node.js 进行编程时，可能会遇到各种错误和异常，它们是在代码执行过程中出现问题的信号。<code>ERR_STDOUT_CLOSE</code>就是其中一种错误类型，我们来详细解释一下这个错误，以及它在实际中可能出现的场景。</p><h3 id="什么是err-stdout-close错误" tabindex="-1"><a class="header-anchor" href="#什么是err-stdout-close错误"><span>什么是<code>ERR_STDOUT_CLOSE</code>错误？</span></a></h3><p>在 Node.js 中，<code>stdout</code>（标准输出）是一个用于将输出数据发送到控制台或其它输出流的全局对象。通常情况下，当我们需要在控制台显示信息时，会使用<code>console.log()</code>函数，它背后就是使用了<code>stdout</code>来输出信息。</p><p><code>ERR_STDOUT_CLOSE</code>错误发生时表示尝试对已经关闭的<code>stdout</code>流进行写入操作。换句话说，当 Node.js 的标准输出流（<code>stdout</code>）不可用或已经被关闭，而你的代码还尝试向其写入数据时，就会触发<code>ERR_STDOUT_CLOSE</code>错误。</p><h3 id="实际运用例子-14" tabindex="-1"><a class="header-anchor" href="#实际运用例子-14"><span>实际运用例子</span></a></h3><p>考虑以下场景：</p><ol><li><p><strong>在服务器端脚本中记录日志：</strong> 假设你正在开发一个 Node.js 应用，并且使用<code>console.log()</code>来打印日志以跟踪应用的运行状态。如果在某个时刻，由于某些原因（比如进程退出处理逻辑中关闭了<code>stdout</code>），<code>stdout</code>流被关闭了，之后所有的<code>console.log()</code>调用都会触发<code>ERR_STDOUT_CLOSE</code>错误。</p></li><li><p><strong>构建工具或 CLI 应用：</strong> 如果你正在开发一个命令行工具，该工具在执行过程中会向<code>stdout</code>输出结果。如果用户在工具执行期间重定向输出或者关闭了终端，该工具试图写入到<code>stdout</code>时可能会遇到<code>ERR_STDOUT_CLOSE</code>错误。</p></li></ol><h3 id="如何处理这个错误-8" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-8"><span>如何处理这个错误？</span></a></h3><ul><li><strong>优雅的异常处理：</strong> 代码中捕获并处理<code>ERR_STDOUT_CLOSE</code>异常，可以让你在这种情况发生时有机会进行清理工作或给出友好的错误提示。</li><li><strong>检查流状态：</strong> 在写入<code>stdout</code>前检查其是否处于开启状态，虽然这不总是可行，但在某些情况下可以避免错误。</li></ul><h3 id="总结-12" tabindex="-1"><a class="header-anchor" href="#总结-12"><span>总结</span></a></h3><p><code>ERR_STDOUT_CLOSE</code>错误是指在<code>stdout</code>流已关闭的情况下，尝试进行写入操作所引发的错误。虽然这个错误在日常开发中不太常见，但理解它有助于更好地掌握 Node.js 的 I/O 流控制，从而编写出更健壯、更稳定的应用程序。通过合理的错误处理和预防措施，可以有效避免或减轻因此类错误造成的影响。</p><h3 id="err-stream-read-not-implemented" tabindex="-1"><a class="header-anchor" href="#err-stream-read-not-implemented"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_stream_read_not_implemented" target="_blank" rel="noopener noreferrer">ERR_STREAM_READ_NOT_IMPLEMENTED</a></span></a></h3><p>理解<code>ERR_STREAM_READ_NOT_IMPLEMENTED</code>错误在 Node.js 中的含义，首先我们需要掌握几个基础概念：Node.js、Streams，以及抽象概念的实现。</p><p><strong>1. Node.js 简介：</strong><br> Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。它允许在服务器端运行 JavaScript 代码，广泛用于创建各种网络应用。</p><p><strong>2. Streams 简介：</strong><br> 在 Node.js 中，Streams 是处理读写数据的一种方式。想象一下，如果你有一款视频播放软件，用户不需要等到整个视频文件下载完成后才开始观看，而是可以边下载边观看。这就是流(Stream)的工作方式。流可以高效地处理大量数据，因为你不需要一次性将数据全部加载到内存中。</p><p>Node.js 中主要有四种类型的流：</p><ul><li>Readable（可读流）</li><li>Writable（可写流）</li><li>Duplex（双工流，即既可读又可写）</li><li>Transform（转换流，是一种特殊的双工流，可以在读写过程中修改或转换数据）</li></ul><p><strong>3. ERR_STREAM_READ_NOT_IMPLEMENTED 错误：</strong><br> 当你尝试使用一个自定义的可读流（Readable Stream）但没有实现<code>_read()</code>方法时，就会遇到<code>ERR_STREAM_READ_NOT_IMPLEMENTED</code>错误。在 Node.js 中，当你创建一个继承自<code>Readable</code>的类时，你必须提供<code>_read(size)</code>方法的实现。这个方法是 Stream API 的一部分，用于从底层资源中拉取数据。</p><p><strong>实际运用例子</strong></p><p>假设你正在开发一个应用程序，需要从某个 API 获取数据，并且这些数据量非常大，你决定使用流来处理这些数据。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Readable</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">stream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">class</span><span style="color:#8FBCBB;"> MyCustomStream</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> Readable</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  constructor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    super</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">options</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 初始化自定义流所需的其他属性</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 必须实现的 _read 方法</span></span>
<span class="line"><span style="color:#88C0D0;">  _read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">size</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 实现从底层数据源读取数据的逻辑</span></span>
<span class="line"><span style="color:#616E88;">    // 当没有更多数据时，调用this.push(null)通知流结束</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用自定义的可读流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> myStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyCustomStream</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">chunk</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">接收到数据：</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> chunk</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toString</span><span style="color:#D8DEE9FF;">())</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">myStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">on</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">没有更多数据了。</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你忘记实现<code>_read()</code>方法，然后尝试创建<code>MyCustomStream</code>的实例并读取数据，你将会得到<code>ERR_STREAM_READ_NOT_IMPLEMENTED</code>错误。</p><p>了解了这个错误和相关概念之后，当你在开发中遇到它，就会明白这是因为你需要提供自定义可读流的<code>_read()</code>方法的实现。通过正确实现这个方法，Node.js 就能从你的流中读取数据了。</p><h3 id="err-tls-renegotiation-failed" tabindex="-1"><a class="header-anchor" href="#err-tls-renegotiation-failed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_tls_renegotiation_failed" target="_blank" rel="noopener noreferrer">ERR_TLS_RENEGOTIATION_FAILED</a></span></a></h3><p>理解 <code>ERR_TLS_RENEGOTIATION_FAILED</code> 错误，首先需要了解 TLS（传输层安全协议）以及它为什么会涉及到“重新协商”（Renegotiation）的概念。Node.js 中这个错误通常发生在使用 TLS/SSL 进行加密通信时，尝试进行重新协商但失败的情况下。</p><h3 id="tls-和重新协商的基础" tabindex="-1"><a class="header-anchor" href="#tls-和重新协商的基础"><span>TLS 和重新协商的基础</span></a></h3><p><strong>TLS（Transport Layer Security)</strong> 是一种保障网络通信安全的协议，用于在两个通信应用程序之间提供加密连接。它广泛用于网页浏览器和服务器之间的安全通信（如 HTTPS）、以及其他数据传输场景中保证数据安全。</p><p>在 TLS 连接建立后，由于各种原因（例如，密钥更新、某些参数变化等），双方可能需要更改加密参数。这个过程称为<strong>重新协商</strong>。重新协商可以是安全的（即通过已建立的加密连接进行）或不安全的（未采取适当措施可能导致安全漏洞）。</p><h3 id="err-tls-renegotiation-failed-1" tabindex="-1"><a class="header-anchor" href="#err-tls-renegotiation-failed-1"><span>ERR_TLS_RENEGOTIATION_FAILED</span></a></h3><p>当 Node.js 尝试在一个 TLS 连接上执行重新协商过程，但由于一系列可能的原因（如对端不支持、网络错误、协议违规等）而失败时，就会抛出<code>ERR_TLS_RENEGOTIATION_FAILED</code>错误。</p><h3 id="实际应用示例-1" tabindex="-1"><a class="header-anchor" href="#实际应用示例-1"><span>实际应用示例</span></a></h3><p>让我们来看几个可能遇到此错误的实际场景：</p><ol><li><p><strong>动态更新 TLS 证书</strong>：假设你有一个运行在 Node.js 服务器上的 HTTPS 服务，并且想在不重启服务的情况下更换 TLS 证书。你可能会尝试对现有的 TLS 连接进行重新协商以应用新的证书。如果这个过程失败了，就可能会遇到<code>ERR_TLS_RENEGOTIATION_FAILED</code>错误。</p></li><li><p><strong>增强安全性</strong>：某些情况下，服务器可能要求在发送敏感信息前重新协商 TLS 连接以增强安全性。例如，用户刚登陆 Web 应用，执行敏感操作前，服务器可能请求重新协商来更新加密参数。若失败，则可能抛出此错误。</p></li><li><p><strong>兼容性问题</strong>：你的服务器可能正在与一个老旧的客户端通信，该客户端使用的 TLS 版本较旧，不支持或不正确实现了重新协商过程。这种情况下尝试重新协商也可能导致<code>ERR_TLS_RENEGOTIATION_FAILED</code>错误。</p></li></ol><h3 id="处理方式" tabindex="-1"><a class="header-anchor" href="#处理方式"><span>处理方式</span></a></h3><p>处理这个错误的最好方式通常是检查你的应用程序和任何依赖的库是否都已经更新到最新版本，确保 TLS 配置正确，以及确保所有通信方都支持必要的 TLS 版本和特性。此外，考虑记录详细的错误日志，以便进一步分析具体失败的原因。</p><p>了解并处理<code>ERR_TLS_RENEGOTIATION_FAILED</code>错误，需要具备对 TLS 工作机制和 Node.js 网络编程的深入理解。随着技术的发展，推荐定期更新知识和技术栈，以便更好地利用新特性，同时确保应用的安全性和稳定性。</p><h3 id="err-transferring-externalized-sharedarraybuffer" tabindex="-1"><a class="header-anchor" href="#err-transferring-externalized-sharedarraybuffer"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_transferring_externalized_sharedarraybuffer" target="_blank" rel="noopener noreferrer">ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER</a></span></a></h3><p>在解释 <code>[ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER]</code> 错误之前，让我先简单介绍一下几个关键概念：Node.js、SharedArrayBuffer 和这个错误的上下文。</p><h3 id="node-js-简介-1" tabindex="-1"><a class="header-anchor" href="#node-js-简介-1"><span>Node.js 简介</span></a></h3><p>Node.js 是一个允许在服务器端运行 JavaScript 代码的平台。它是基于 Chrome 的 V8 引擎建立的，意味着它能够提供非常高的性能。Node.js 特别适合构建网络应用程序，比如网页服务器或者 API 服务。</p><h3 id="sharedarraybuffer-简介" tabindex="-1"><a class="header-anchor" href="#sharedarraybuffer-简介"><span>SharedArrayBuffer 简介</span></a></h3><p><code>SharedArrayBuffer</code> 是一种特殊的 JavaScript 对象，它允许在多个工作线程之间共享和传输二进制数据。这使得进行复杂的、高性能的计算任务成为可能，因为你可以并行地处理数据，而不是在单一线程中顺序处理。</p><h3 id="错误-err-transferring-externalized-sharedarraybuffer" tabindex="-1"><a class="header-anchor" href="#错误-err-transferring-externalized-sharedarraybuffer"><span>错误：ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER</span></a></h3><p>现在，让我们谈谈 <code>[ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER]</code> 这个错误。这个错误发生在尝试通过某些 Node.js 的 APIs 传输一个 &quot;externalized&quot; 的 <code>SharedArrayBuffer</code> 对象时。</p><p>所谓 &quot;externalize&quot;，指的是将 <code>SharedArrayBuffer</code> 的所有权从一个执行环境（比如一个 Web Worker 或主线程）转移给另一个。当你试图通过某些不能正确处理 &quot;externalized&quot; 状态的 <code>SharedArrayBuffer</code> 的 Node.js APIs 传输这样的对象时，就会出现这个错误。</p><h4 id="实际运用举例" tabindex="-1"><a class="header-anchor" href="#实际运用举例"><span>实际运用举例</span></a></h4><ol><li><p><strong>多线程计算</strong>：<br> 假设你正在开发一个 Node.js 应用，需要进行大量数学计算，比如图像处理或大规模数据分析。你决定使用 Worker Threads（工作线程）来并行化计算过程，以提高性能。每个工作线程处理数据的一部分，并且你使用 <code>SharedArrayBuffer</code> 来存储这些数据，以便所有工作线程都可以访问和修改它。如果你在将这些 <code>SharedArrayBuffer</code> 从一个线程传输到另一个线程时错误地处理了它们的状态，就可能遇到此错误。</p></li><li><p><strong>实时游戏服务器</strong>：<br> 在一个使用 Node.js 构建的多人在线游戏服务器中，<code>SharedArrayBuffer</code> 可能被用来存储玩家的状态信息，例如位置、健康状况等，以便快速地在服务器的不同部分之间共享和更新这些信息。如果服务器尝试在处理玩家数据时将外部化的 <code>SharedArrayBuffer</code> 传输到不支持它们的 API 或服务，就可能触发这个错误。</p></li></ol><h3 id="解决方法-11" tabindex="-1"><a class="header-anchor" href="#解决方法-11"><span>解决方法</span></a></h3><p>处理这个错误的一种方法是确保你在传输 <code>SharedArrayBuffer</code> 前正确地处理它们的状态，或者避免使用那些不支持 &quot;externalized&quot; 状态的 <code>SharedArrayBuffer</code> 的 Node.js APIs。</p><p>总之，<code>[ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER]</code> 错误与尝试在 Node.js 应用中传输处于特定状态的 <code>SharedArrayBuffer</code> 相关，通常涉及多线程编程和性能优化。理解这些基本概念和避免错误的策略，对于构建高效、可靠的 Node.js 应用至关重要。</p><h3 id="err-unknown-stdin-type" tabindex="-1"><a class="header-anchor" href="#err-unknown-stdin-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_stdin_type" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_STDIN_TYPE</a></span></a></h3><p>当你使用 Node.js 编程时，有时可能会遇到各种错误和异常。在 Node.js 中，每种错误都有一个特定的错误代码，以便于识别和处理。今天，我们讨论的是<code>ERR_UNKNOWN_STDIN_TYPE</code>这个错误代码。</p><p>首先，让我们解释一下这个错误代表什么。<code>ERR_UNKNOWN_STDIN_TYPE</code>是一个错误代码，它出现在尝试读取或监听标准输入（stdin）时，但 Node.js 无法识别或不支持当前环境的 stdin 类型。简单来说，就是 Node.js 不知道如何处理程序要求的输入类型。</p><h3 id="标准输入-stdin" tabindex="-1"><a class="header-anchor" href="#标准输入-stdin"><span>标准输入（stdin）</span></a></h3><p>标准输入，通常被缩写为 stdin，是计算机程序用来接收输入数据的一种方式，比如用户通过键盘输入。在命令行界面中，我们经常使用 stdin 来与正在运行的程序交互。</p><h3 id="为什么会出现err-unknown-stdin-type错误" tabindex="-1"><a class="header-anchor" href="#为什么会出现err-unknown-stdin-type错误"><span>为什么会出现<code>ERR_UNKNOWN_STDIN_TYPE</code>错误？</span></a></h3><p><code>ERR_UNKNOWN_STDIN_TYPE</code>错误通常发生在以下情况：</p><ul><li>当 Node.js 运行在一个不常见的环境中，而这个环境的 stdin 类型没有明确定义或者与预期不符。</li><li>当尝试以非标准的方式访问或监听 stdin 时。</li></ul><p>比如，如果你在一个不支持标准输入的环境中运行 Node.js 程序，或者你的程序以某种方式破坏了对 stdin 的正常访问，这个错误就可能发生。</p><h3 id="实际例子-22" tabindex="-1"><a class="header-anchor" href="#实际例子-22"><span>实际例子</span></a></h3><p>考虑以下场景：</p><ol><li><p><strong>在不支持标准输入的环境运行 Node.js 应用</strong>：如果你的 Node.js 应用是在某种自动化工具中运行，而这个工具并不提供标准输入的功能，此时如果你的应用尝试从 stdin 读取数据，就可能触发<code>ERR_UNKNOWN_STDIN_TYPE</code>错误。</p></li><li><p><strong>错误地配置了 Node.js 环境</strong>：例如，如果你在 Docker 容器中运行 Node.js 应用，并且在容器配置中忽略了必要的选项，导致 stdin 不能正确地被容器环境支持或识别。</p></li></ol><h3 id="如何解决-6" tabindex="-1"><a class="header-anchor" href="#如何解决-6"><span>如何解决？</span></a></h3><p>解决<code>ERR_UNKNOWN_STDIN_TYPE</code>错误的方法依赖于具体的场景和原因。一些可能的解决方案包括：</p><ul><li>确保你的运行环境支持标准输入。</li><li>如果你的应用不需要从 stdin 读取数据，可以修改程序，避免不必要的 stdin 访问。</li><li>检查并调整你的环境或应用配置，确保 stdin 可以被正确识别和使用。</li></ul><h3 id="小结-3" tabindex="-1"><a class="header-anchor" href="#小结-3"><span>小结</span></a></h3><p><code>ERR_UNKNOWN_STDIN_TYPE</code>是一个相对罕见的错误，通常指出 Node.js 在当前环境中无法正确处理标准输入。理解这个错误的原因和背景，有助于你更有效地诊断和解决问题。希望这个解释对你有所帮助！</p><h3 id="err-unknown-stream-type" tabindex="-1"><a class="header-anchor" href="#err-unknown-stream-type"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_unknown_stream_type" target="_blank" rel="noopener noreferrer">ERR_UNKNOWN_STREAM_TYPE</a></span></a></h3><p>理解<code>[ERR_UNKNOWN_STREAM_TYPE]</code>这个错误，我们首先得了解 Node.js 中的“流（Streams）”概念。简单来说，流是一种处理读取和写入数据的方式，它可以让你以非常节省内存的形式处理大量数据。在 Node.js 中，流被广泛用于文件操作、网络通信等场景。</p><h3 id="流的类型" tabindex="-1"><a class="header-anchor" href="#流的类型"><span>流的类型</span></a></h3><p>Node.js 主要有四种类型的流：</p><ol><li><strong>可读流（Readable）</strong>：允许你读取数据，比如从文件读取数据。</li><li><strong>可写流（Writable）</strong>：允许你写入数据，比如写入到文件。</li><li><strong>双工流（Duplex）</strong>：既可读又可写，比如 TCP 套接字。</li><li><strong>转换流（Transform）</strong>：在读写过程中可以修改或转换数据的双工流，比如压缩数据。</li></ol><h3 id="解释-err-unknown-stream-type" tabindex="-1"><a class="header-anchor" href="#解释-err-unknown-stream-type"><span>解释 <code>ERR_UNKNOWN_STREAM_TYPE</code></span></a></h3><p>当你在使用 Node.js 进行开发时，如果你尝试创建或操作一个未知的流类型，Node.js 就会抛出<code>ERR_UNKNOWN_STREAM_TYPE</code>错误。这个错误表明 Node.js 无法识别你想要使用的流类型，原因可能是：</p><ul><li>你拼写错了流类型。</li><li>你尝试使用的流类型不被当前版本的 Node.js 支持。</li><li>你的代码中可能存在逻辑问题，导致 Node.js 无法确定正确的流类型。</li></ul><h3 id="实际运用的例子-39" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-39"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个 Node.js 应用，需要从一个文件中读取数据，并将其写入另一个文件。这里就涉及到两种流：可读流和可写流。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可读流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> readStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createReadStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./source.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个可写流</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> writeStream</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createWriteStream</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./destination.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用管道将读取的数据写入目标文件</span></span>
<span class="line"><span style="color:#D8DEE9;">readStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">pipe</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">writeStream</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们通过<code>fs.createReadStream</code>创建了一个可读流来读取<code>source.txt</code>文件的内容，然后通过<code>fs.createWriteStream</code>创建了一个可写流来将数据写入<code>destination.txt</code>。最后，我们使用<code>.pipe()</code>方法将可读流的输出直接连接到可写流的输入上，实现数据的流动。</p><p>如果在这个过程中，由于某些原因（比如错误的流类型名称），Node.js 无法识别流类型，就可能抛出<code>ERR_UNKNOWN_STREAM_TYPE</code>错误。务必确保你使用的流类型是正确且被支持的。</p><p>总结起来，理解并正确使用 Node.js 中的流对于开发高效且内存友好的应用至关重要。遇到<code>ERR_UNKNOWN_STREAM_TYPE</code>错误时，检查流的类型和使用方式是否正确。</p><h3 id="err-v8breakiterator" tabindex="-1"><a class="header-anchor" href="#err-v8breakiterator"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_v8breakiterator" target="_blank" rel="noopener noreferrer">ERR_V8BREAKITERATOR</a></span></a></h3><p>Node.js 是一个运行在服务器端的平台，它使用 JavaScript 语言。这意味着你可以用 JavaScript 来写服务端代码，正如你可能已经在浏览器中用它来编写客户端代码一样。Node.js 特别适合构建网络应用程序，因为它非常擅长处理大量并发连接，同时保持性能。</p><p>在 Node.js 中，你偶尔会遇到一些错误和异常，当你的代码或者 Node.js 环境中的某个部分行为不符合预期时就会出现。<code>ERR_V8BREAKITERATOR</code>错误是其中之一，这个错误涉及到 V8 引擎（Node.js 底层使用的 JavaScript 引擎）和国际化支持。</p><h3 id="解释err-v8breakiterator错误" tabindex="-1"><a class="header-anchor" href="#解释err-v8breakiterator错误"><span>解释<code>ERR_V8BREAKITERATOR</code>错误</span></a></h3><p><code>ERR_V8BREAKITERATOR</code>是一个特定类型的错误，与尝试使用 V8 引擎中的“BreakIterator”功能有关。<code>BreakIterator</code>是一个国际化功能，用于定位文本中的词汇边界，例如，它可以帮助确定哪里是单词、句子或段落的开始和结束。这对于处理多种语言的文本特别重要，因为不同的语言有不同的规则确定词汇边界。</p><p>然而，如果 Node.js 环境没有正确地配置国际化支持（ICU - International Components for Unicode），尝试使用<code>BreakIterator</code>时就可能抛出<code>ERR_V8BREAKITERATOR</code>错误。简单来说，这个错误意味着 Node.js 无法进行必要的国际化文本处理。</p><h3 id="实际运用的例子-40" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-40"><span>实际运用的例子</span></a></h3><p>假设你正在编写一个多语言网站或应用，并且你需要根据用户的语言偏好来断句或标记文本。例如，你可能需要按句子对用户评论进行分割以进行情感分析，或者需要对用户输入的长文本进行适当的换行处理。在这种情况下，你可能会想到使用<code>Intl.Segmenter</code>API，它背后依赖于<code>BreakIterator</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 假设我们有一段德语文本，我们想找出所有句子的起止位置。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> text</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hallo Welt! Wie geht es dir? Das ist ein Textbeispiel.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建一个Segmenter对象，指定语言和分割类型为句子。</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> segmenter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> Intl</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Segmenter</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">de</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span><span style="color:#88C0D0;"> type</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sentence</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 使用segmenter进行文本分割</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> segments</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> segmenter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">segment</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">text</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> segment</span><span style="color:#81A1C1;"> of</span><span style="color:#D8DEE9;"> segments</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">segment</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">segment</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 Node.js 环境没有正确配置国际化支持，上述代码可能会导致<code>ERR_V8BREAKITERATOR</code>错误。</p><h3 id="如何解决-7" tabindex="-1"><a class="header-anchor" href="#如何解决-7"><span>如何解决？</span></a></h3><p>解决<code>ERR_V8BREAKITERATOR</code>错误通常涉及确保你的 Node.js 环境具有完整的国际化支持。从 Node.js v13 开始，ICU（国际组件库）默认包含在 Node.js 中。</p><p>如果遇到这个错误，你可以：</p><ul><li>确认 Node.js 版本是否具备完整的 ICU 支持。</li><li>如果使用的是较旧的 Node.js 版本，可能需要自行编译 Node.js 并包含完整的 ICU 数据，或者使用命令行参数（比如<code>--with-intl=full-icu</code>）来启动 Node.js，以确保完整的国际化支持。</li></ul><p>总之，<code>ERR_V8BREAKITERATOR</code>错误通常与国际化处理有关，通过确保 Node.js 环境包含完整的 ICU 支持，可以避免这类问题。</p><h3 id="err-value-out-of-range" tabindex="-1"><a class="header-anchor" href="#err-value-out-of-range"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_value_out_of_range" target="_blank" rel="noopener noreferrer">ERR_VALUE_OUT_OF_RANGE</a></span></a></h3><p>在 Node.js 中，<code>ERR_VALUE_OUT_OF_RANGE</code>是一个错误类型，常见于当你尝试给一个函数或者方法传递一个不符合预期范围的值时。简而言之，就是当你给一个功能提供了一个它不能处理的值，因为这个值太大、太小，或者完全不在可接受的范围内。</p><h3 id="理解err-value-out-of-range" tabindex="-1"><a class="header-anchor" href="#理解err-value-out-of-range"><span>理解<code>ERR_VALUE_OUT_OF_RANGE</code></span></a></h3><p>想象一下，如果有一个机器只能接受 1 到 10 之间的数字，当你尝试给它一个 11 或者 0 时，机器就会报错，告诉你这个数字不在它能处理的范围内。在 Node.js 中，<code>ERR_VALUE_OUT_OF_RANGE</code>错误正是这样的提示，让你知道你给某个功能提供的值超出了它能处理的范围。</p><h3 id="实际例子-23" tabindex="-1"><a class="header-anchor" href="#实际例子-23"><span>实际例子</span></a></h3><ol><li><p><strong>缓冲区偏移量（Buffer Offset）</strong></p><p>当你使用 Node.js 的 Buffer 对象来操作数据时，会遇到“偏移量”这个概念。假设你要从 Buffer 中读取数据，但指定的起始偏移量超出了 Buffer 的实际长度。Node.js 将抛出<code>ERR_VALUE_OUT_OF_RANGE</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> buffer</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">from</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello World</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 假设Buffer长度是11，尝试读取从位置12开始的数据</span></span>
<span class="line"><span style="color:#D8DEE9;">  buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readUInt8</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ERR_VALUE_OUT_OF_RANGE</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>文件系统访问（File System Access）</strong></p><p>在使用 fs 模块的一些方法，比如调整文件的读写指针位置时，如果你指定了一个超出文件实际大小的位置，也会触发<code>ERR_VALUE_OUT_OF_RANGE</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">open</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">r+</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fd</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">throw</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 将读/写的位置设置得过高</span></span>
<span class="line"><span style="color:#D8DEE9;">    fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fd</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Buffer</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">alloc</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 100000</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 输出: ERR_VALUE_OUT_OF_RANGE</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">catchErr</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">catchErr</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>数值限制</strong></p><p>在使用某些 API，比如设置超时，如果超时时间不在 API 允许的范围内，也会出现<code>ERR_VALUE_OUT_OF_RANGE</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">setTimeout</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This will not run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">},</span><span style="color:#81A1C1;"> -</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 超时时间不能是负数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面这个例子里，<code>setTimeout</code>期望第二个参数（超时时间）是非负数，如果给的是负数，就会抛出错误。</p></li></ol><h3 id="如何处理" tabindex="-1"><a class="header-anchor" href="#如何处理"><span>如何处理</span></a></h3><p>当遇到<code>ERR_VALUE_OUT_OF_RANGE</code>错误时，你应该检查传递给函数或方法的值，确保它们在可接受的范围内。阅读相关文档了解这些范围限制，对于动态计算出的值，可能需要添加适当的检查以确保它们不会超出预期的范围。这样可以有效预防<code>ERR_VALUE_OUT_OF_RANGE</code>错误的发生。</p><h3 id="err-vm-module-not-linked" tabindex="-1"><a class="header-anchor" href="#err-vm-module-not-linked"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_not_linked" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_NOT_LINKED</a></span></a></h3><p>理解 Node.js 中的 <code>[ERR_VM_MODULE_NOT_LINKED]</code> 错误，我们首先需要掌握一些基础概念：Node.js、ES Modules (ESM)、以及虚拟机（VM）模块。</p><p><strong>Node.js 简介</strong></p><p>Node.js 是一个让 JavaScript 运行在服务器端的平台。它允许开发者使用 JavaScript 来编写后端代码，而不仅仅是前端。这意味着你可以使用同一种语言来编写整个网站或应用程序。</p><p><strong>ES Modules (ESM) 简介</strong></p><p>ES Modules 是 ECMAScript (即 JavaScript) 的一个模块系统，使得开发者能够更好地组织和重用代码。它通过 <code>import</code> 和 <code>export</code> 语句来导入和导出模块。</p><p><strong>虚拟机（VM）模块简介</strong></p><p>Node.js 的 VM 模块允许你编译和运行代码在 V8 虚拟机的隔离环境中。这主要用于安全性高的场景，比如运行用户提供的代码，防止影响到 Node.js 主程序的其他部分。</p><h3 id="err-vm-module-not-linked-错误" tabindex="-1"><a class="header-anchor" href="#err-vm-module-not-linked-错误"><span><code>[ERR_VM_MODULE_NOT_LINKED]</code> 错误</span></a></h3><p>当你使用 VM 模块在 Node.js 中创建并尝试运行 ECMAScript 模块时，若该模块未经链接（linking），就会遇到 <code>[ERR_VM_MODULE_NOT_LINKED]</code> 错误。链接过程是将导入的模块与其导出连接起来的步骤。如果没有正确完成这一步骤，就无法解析模块之间的依赖关系，从而导致错误。</p><p><strong>实际例子</strong></p><p>假设你想在隔离的环境中运行一段使用了 ES Modules 的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// 导入 VM 模块</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> vm</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fs</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">fs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 读取你想要运行的模块代码</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> code</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fs</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readFileSync</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">example.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">utf8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> runCode</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 创建一个新的上下文环境</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> contextifiedObject</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createContext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 使用 vm.SourceTextModule 创建一个模块实例</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> module</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#D8DEE9;"> vm</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SourceTextModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">    context</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> contextifiedObject</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#616E88;">    // 假设 example.mjs 文件位于当前目录</span></span>
<span class="line"><span style="color:#88C0D0;">    url</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">./example.mjs</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 这里是关键步骤，我们需要链接模块</span></span>
<span class="line"><span style="color:#616E88;">  // 如果缺失下面的 link 方法调用过程，则会触发 ERR_VM_MODULE_NOT_LINKED 错误</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">link</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">specifier</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> referencingModule</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 在这里进行模块的链接操作</span></span>
<span class="line"><span style="color:#616E88;">    // 根据实际情况处理模块依赖等</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 实例化并运行模块</span></span>
<span class="line"><span style="color:#81A1C1;">  await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">evaluate</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">runCode</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">catch</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上述例子中，<code>module.link()</code> 方法是关键所在，它负责处理模块间的依赖关系。如果我们没有提供这个方法的实现（或实现错误），并尝试执行 <code>module.evaluate()</code>，便会引发 <code>[ERR_VM_MODULE_NOT_LINKED]</code> 错误，因为 Node.js 无法确定模块间的依赖链。</p><p>总结，<code>[ERR_VM_MODULE_NOT_LINKED]</code> 错误通常意味着在使用 VM 模块运行 ECMAScript 模块代码时，缺失了必要的链接步骤。确保在调用 <code>module.evaluate()</code> 之前，所有模块都已经通过 <code>module.link()</code> 方法正确链接。</p><h3 id="err-vm-module-linking-errored" tabindex="-1"><a class="header-anchor" href="#err-vm-module-linking-errored"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_vm_module_linking_errored" target="_blank" rel="noopener noreferrer">ERR_VM_MODULE_LINKING_ERRORED</a></span></a></h3><p>Node.js v21.7.1 中的<code>ERR_VM_MODULE_LINKING_ERRORED</code>是一个指定类型的错误，它通常在使用 Node.js 的 VM 模块时出现。在深入解释这个错误之前，我们先来了解一下几个概念。</p><h3 id="基本概念-2" tabindex="-1"><a class="header-anchor" href="#基本概念-2"><span>基本概念</span></a></h3><ol><li><strong>Node.js</strong>: 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，让你可以在服务器端运行 JavaScript 代码。</li><li><strong>VM 模块</strong>: VM 模块提供了在 V8 虚拟机中编译和运行代码的 API。简单来说，它允许你在隔离的环境中执行 JavaScript 代码，这种环境与主 Node.js 环境是分开的，提供了一层安全保障。</li><li><strong>ES Modules (ESM)</strong>: ECMAScript 模块，是 JavaScript 的官方标准化模块系统。它允许你将大的程序拆分成小的可重用的片段。</li></ol><h3 id="什么是err-vm-module-linking-errored错误" tabindex="-1"><a class="header-anchor" href="#什么是err-vm-module-linking-errored错误"><span>什么是<code>ERR_VM_MODULE_LINKING_ERRORED</code>错误？</span></a></h3><p>当你使用 Node.js 的 VM 模块创建一个新的<code>vm.Module</code>实例，并且尝试链接其他模块时，如果链接过程出错，就会抛出<code>ERR_VM_MODULE_LINKING_ERRORED</code>错误。这个错误通常表示模块之间的依赖关系出现了问题，可能是因为以下原因之一：</p><ul><li>依赖的模块无法找到或无法加载。</li><li>模块之间的依赖关系存在循环引用。</li><li>在模块链接过程中发生了代码级的错误。</li></ul><h3 id="实际运用的例子-41" tabindex="-1"><a class="header-anchor" href="#实际运用的例子-41"><span>实际运用的例子</span></a></h3><p>假设我们有一个项目，想要在隔离的环境中执行一些用户提供的代码片段。我们可以使用 VM 模块来达成这个目的。但在链接自定义模块的过程中，如果遇到上述任何问题，就可能遇到<code>ERR_VM_MODULE_LINKING_ERRORED</code>错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> VMModule</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">vm</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">async</span><span style="color:#81A1C1;"> function</span><span style="color:#88C0D0;"> runUserCode</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> module</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> VMModule</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">    // 假设`dependency`是用户代码需要的另一个模块</span></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">link</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">specifier</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">      if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">specifier</span><span style="color:#81A1C1;"> ===</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">dependency</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> VMModule</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#ECEFF4;">          &#39;</span><span style="color:#A3BE8C;">export const usefulFunction = () =&gt; &quot;Hello, World!&quot;;</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        )</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">      }</span></span>
<span class="line"><span style="color:#81A1C1;">      throw</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Module not found</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">    await</span><span style="color:#8FBCBB;"> module</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">evaluate</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">error</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">error</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">An error occurred: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">error</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">message</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">    // 如果链接错误发生，这里会捕获到ERR_VM_MODULE_LINKING_ERRORED错误</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设用户代码尝试导入一个不存在的模块</span></span>
<span class="line"><span style="color:#88C0D0;">runUserCode</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">import { missingFunction } from &quot;missingModule&quot;;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个例子中，我们首先创建了一个新的<code>VMModule</code>实例，然后尝试链接一个称为<code>dependency</code>的依赖模块。如果用户的代码中尝试引入一个我们未处理的模块（比如&quot;missingModule&quot;），链接过程将失败，并抛出<code>ERR_VM_MODULE_LINKING_ERRORED</code>错误。</p><h3 id="结论-6" tabindex="-1"><a class="header-anchor" href="#结论-6"><span>结论</span></a></h3><p><code>ERR_VM_MODULE_LINKING_ERRORED</code>错误提示我们在使用 VM 模块进行模块链接操作时遇到了问题。处理这类错误通常涉及检查模块之间的依赖关系是否正确，并确保所有必需的模块都能被正确找到和加载。</p><h3 id="err-worker-unsupported-extension" tabindex="-1"><a class="header-anchor" href="#err-worker-unsupported-extension"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_worker_unsupported_extension" target="_blank" rel="noopener noreferrer">ERR_WORKER_UNSUPPORTED_EXTENSION</a></span></a></h3><p>在 Node.js 中，<code>ERR_WORKER_UNSUPPORTED_EXTENSION</code>是一个错误类型，用于指示在尝试使用 Workers 时，文件的扩展名不被支持。让我们一步步解开这个概念，并通过实例来进一步理解。</p><h3 id="node-js-workers" tabindex="-1"><a class="header-anchor" href="#node-js-workers"><span>Node.js Workers</span></a></h3><p>首先，理解什么是 Workers 对于掌握这个错误类型非常重要。在 Node.js 中，Worker threads 提供了一种方法，使得你可以在后台运行 JavaScript 代码而不会阻塞主线程。这对于执行耗时较长的任务特别有用，比如读写大文件、进行密集计算等。</p><h3 id="错误解释-2" tabindex="-1"><a class="header-anchor" href="#错误解释-2"><span>错误解释</span></a></h3><p>现在，当你试图创建一个新的 Worker 来运行一个脚本或者模块时，Node.js 期望这个文件具有某些特定的扩展名。通常，有效的扩展名包括<code>.js</code>和<code>.mjs</code>（对于 ES 模块）。如果你尝试加载一个不支持的文件扩展名，Node.js 就会抛出<code>ERR_WORKER_UNSUPPORTED_EXTENSION</code>错误。</p><h3 id="实际例子-24" tabindex="-1"><a class="header-anchor" href="#实际例子-24"><span>实际例子</span></a></h3><h4 id="正确的使用方式-1" tabindex="-1"><a class="header-anchor" href="#正确的使用方式-1"><span>正确的使用方式：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 假设有一个 &#39;task.js&#39; 脚本，符合扩展名要求</span></span>
<span class="line"><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./task.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个实例中，<code>task.js</code>是一个有效的 JavaScript 文件，其扩展名<code>.js</code>被 Node.js 支持用于 Workers。</p><h4 id="引发错误的情况" tabindex="-1"><a class="header-anchor" href="#引发错误的情况"><span>引发错误的情况：</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> {</span><span style="color:#D8DEE9;"> Worker</span><span style="color:#ECEFF4;"> }</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">worker_threads</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 尝试加载一个扩展名为 .txt 的文件作为Worker</span></span>
<span class="line"><span style="color:#81A1C1;">try</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">  new</span><span style="color:#88C0D0;"> Worker</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">./example.txt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;"> catch</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">  console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">code</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 这将输出 ERR_WORKER_UNSUPPORTED_EXTENSION</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个错误的实例中，尝试加载一个扩展名为<code>.txt</code>的文件作为 Worker。由于<code>.txt</code>扩展名不是 Node.js Workers 所支持的脚本格式，因此 Node.js 会抛出<code>ERR_WORKER_UNSUPPORTED_EXTENSION</code>错误。</p><h3 id="如何避免这个错误-5" tabindex="-1"><a class="header-anchor" href="#如何避免这个错误-5"><span>如何避免这个错误</span></a></h3><p>要避免这个错误，确保你尝试作为 Worker 运行的文件具有正确的扩展名（<code>.js</code>或<code>.mjs</code>）。在编写代码以使用 Worker threads 之前，预先规划和确定文件的正确格式和扩展名是很重要的。</p><p>总结：<code>ERR_WORKER_UNSUPPORTED_EXTENSION</code>是一个明确的错误，告诉你正在尝试以 Worker 的形式运行一个文件，但它的扩展名并不被支持。遵循 Node.js 关于可接受扩展名的规则，可以避免这类问题，顺利地利用 Workers 进行后台任务处理。</p><h3 id="err-zlib-binding-closed" tabindex="-1"><a class="header-anchor" href="#err-zlib-binding-closed"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_zlib_binding_closed" target="_blank" rel="noopener noreferrer">ERR_ZLIB_BINDING_CLOSED</a></span></a></h3><p>当你使用 Node.js 进行开发时，会遇到各种类型的错误信息，这些信息是为了帮助你定位和解决问题。其中，<code>ERR_ZLIB_BINDING_CLOSED</code>是一个特定的错误类型，相关于 Node.js 中处理压缩和解压数据时使用的<code>zlib</code>模块。让我们一步步分解这个概念。</p><h3 id="理解zlib" tabindex="-1"><a class="header-anchor" href="#理解zlib"><span>理解<code>zlib</code></span></a></h3><p>首先，<code>zlib</code>是一个在 Node.js 中非常有用的模块，它允许你进行数据压缩和解压缩。在网络传输或者文件存储时，压缩数据可以节省空间和提高效率。比如，当你浏览网页时，服务器可能会将网页内容压缩后发送给你的浏览器，浏览器接收到数据后解压，这样可以加快页面加载速度。</p><h3 id="err-zlib-binding-closed错误" tabindex="-1"><a class="header-anchor" href="#err-zlib-binding-closed错误"><span><code>ERR_ZLIB_BINDING_CLOSED</code>错误</span></a></h3><p>当你在使用<code>zlib</code>模块进行数据压缩或解压缩操作时，如果<code>zlib</code>的实例（或绑定）已经关闭或销毁了，但你尝试再次对其进行操作，就会遇到<code>ERR_ZLIB_BINDING_CLOSED</code>错误。</p><h3 id="实际运用示例-4" tabindex="-1"><a class="header-anchor" href="#实际运用示例-4"><span>实际运用示例</span></a></h3><p>假设你正在开发一个 Web 应用，需要从服务器获取一些压缩的数据，并在客户端进行解压显示。</p><ol><li><p><strong>正常操作流程</strong>：你创建了一个<code>zlib</code>的解压缩实例来处理从服务器接收到的压缩数据。接收到数据后，通过该实例进行解压缩，然后将数据展示给用户。</p></li><li><p><strong>遇到<code>ERR_ZLIB_BINDING_CLOSED</code>错误</strong>：如果在数据解压缩过程中，因为某些原因（比如重置代码逻辑或者程序错误），该<code>zlib</code>解压缩实例被提前关闭或销毁了。此时，如果还有数据尝试通过这个已经关闭的实例进行解压缩，就会抛出<code>ERR_ZLIB_BINDING_CLOSED</code>错误。</p></li></ol><h3 id="解决方案-3" tabindex="-1"><a class="header-anchor" href="#解决方案-3"><span>解决方案</span></a></h3><p>要避免这个错误，确保在整个数据处理流程中，<code>zlib</code>实例保持打开状态直到所有操作完成。如果必须关闭或销毁实例，确保之后不会再有任何尝试使用该实例的操作。</p><h3 id="总结-13" tabindex="-1"><a class="header-anchor" href="#总结-13"><span>总结</span></a></h3><p><code>ERR_ZLIB_BINDING_CLOSED</code>是一个与<code>zlib</code>模块操作相关的错误，指的是在对已关闭的<code>zlib</code>实例进行操作时发生。理解和避免这种错误的关键是妥善管理<code>zlib</code>实例的生命周期，确保不在实例关闭后继续使用它。</p><h3 id="err-cpu-usage" tabindex="-1"><a class="header-anchor" href="#err-cpu-usage"><span><a href="https://nodejs.org/docs/latest/api/errors.html#err_cpu_usage" target="_blank" rel="noopener noreferrer">ERR_CPU_USAGE</a></span></a></h3><p>Node.js 是一个非常强大的 JavaScript 运行时环境，它允许你将 JavaScript 用在服务器端编程中。这意味着你可以用 JavaScript 写后台代码，处理数据库交互、文件操作等任务，而不仅仅是前端浏览器脚本。但在使用 Node.js 时，也可能会遇到一些错误，其中之一就是我们今天要讲解的 <code>ERR_CPU_USAGE</code> 错误。</p><h3 id="什么是-err-cpu-usage-错误" tabindex="-1"><a class="header-anchor" href="#什么是-err-cpu-usage-错误"><span>什么是 <code>ERR_CPU_USAGE</code> 错误？</span></a></h3><p><code>ERR_CPU_USAGE</code> 是 Node.js 抛出的一个错误类型，表示程序试图获取系统 CPU 使用率失败了。在 Node.js 的版本 21.7.1 中，如果某个操作或函数调用尝试获取当前进程或系统的 CPU 使用率，但因为某些原因（比如权限问题、系统不支持等）无法完成，就会抛出这类错误。</p><h3 id="错误产生的场景" tabindex="-1"><a class="header-anchor" href="#错误产生的场景"><span>错误产生的场景</span></a></h3><p>一个典型的场景可能是你正在使用某个 Node.js 的库或方法来监控应用的性能，包括 CPU 使用率。这通常是在进行性能分析时发生的，例如，你想确定你的 Node.js 应用是否有效地利用硬件资源。</p><h3 id="例子-3" tabindex="-1"><a class="header-anchor" href="#例子-3"><span>例子：</span></a></h3><p>假设你正在使用 <code>process.cpuUsage()</code> 方法来计算你的 Node.js 应用自启动以来所消耗的 CPU 时间。代码片段可能如下所示：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> startUsage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cpuUsage</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">// 假设此处有一些复杂操作</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> endUsage</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> process</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">cpuUsage</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">startUsage</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> elapseUser</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> endUsage</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">user</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9;"> startUsage</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">user</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> elapseSystem</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> endUsage</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">system</span><span style="color:#81A1C1;"> -</span><span style="color:#D8DEE9;"> startUsage</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">system</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">CPU time spent in user mode: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">elapseUser</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">μs</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">CPU time spent in system mode: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">elapseSystem</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">μs</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果，由于任何原因，Node.js 环境不能获取 CPU 使用情况，那么这段代码可能导致抛出 <code>ERR_CPU_USAGE</code> 错误。</p><h3 id="如何处理这个错误-9" tabindex="-1"><a class="header-anchor" href="#如何处理这个错误-9"><span>如何处理这个错误？</span></a></h3><p>处理 <code>ERR_CPU_USAGE</code> 错误的方法主要取决于为什么你的环境不能获取 CPU 使用信息。以下是一些可能的解决方案：</p><ul><li><strong>检查权限</strong>：确保你的 Node.js 应用有足够的权限来访问系统级别的信息。</li><li><strong>环境支持</strong>：确认你的操作系统和 Node.js 版本都支持你尝试进行的操作。</li><li><strong>错误处理</strong>：在你的代码中添加适当的错误处理逻辑，以优雅地处理此类错误。例如，你可以捕获异常并记录错误，或者提供一个备用方案，以便在无法获取 CPU 使用信息时继续运行。</li></ul><h3 id="结论-7" tabindex="-1"><a class="header-anchor" href="#结论-7"><span>结论</span></a></h3><p>虽然 <code>ERR_CPU_USAGE</code> 错误可能看起来很专业，但基本上它只是告诉你，Node.js 在试图获取 CPU 使用信息时遇到了困难。通过理解你的系统环境、正确设置权限，并在你的代码中实现健壮的错误处理逻辑，你可以有效地管理这类错误。这将帮助你构建更可靠、更高效的 Node.js 应用。</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Domain.html" aria-label="Domain"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Domain</div></a><a class="route-link auto-link next" href="/document/node-doc/Events.html" aria-label="Events"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Events<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.be370b10.js" defer></script><script src="/assets/js/4485.e6fe7c7b.js" defer></script><script src="/assets/js/app.bf6f64e3.js" defer></script>
  </body>
</html>
