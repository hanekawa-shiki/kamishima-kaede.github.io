"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[732],{3775:(e,s,a)=>{a.r(s),a.d(s,{comp:()=>d,data:()=>c});var n=a(9034);const l=a.p+"assets/img/001.873e51dd.png",r=a.p+"assets/img/002.3e8f9cab.png",i=(0,n.Lk)("p",null,[(0,n.eW)("在"),(0,n.Lk)("code",null,"Docker"),(0,n.eW)("部署"),(0,n.Lk)("code",null,"NextCloud"),(0,n.eW)("服务，并使用"),(0,n.Lk)("code",null,"MySQL"),(0,n.eW)("和"),(0,n.Lk)("code",null,"Redis"),(0,n.eW)("做数据库。")],-1),o=(0,n.Fv)('<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p>由于最近<a href="https://github.com/boredazfcuk/docker-icloudpd" target="_blank" rel="noopener noreferrer">icloudpd</a>在国内无法正常同步<code>icloud</code>照片，遂寻找替代方案。经过一段时间时间的筛选，最后决定使用<code>NextCloud</code>项目部署服务。<a href="https://nextcloud.com/" target="_blank" rel="noopener noreferrer">NextCloud</a>是一套主打安全、合规的开源私有云存储项目。</p><p>此次的部署用的<code>Docker</code>环境，使用<code>MySQL</code>做数据库，利用<code>Redis</code>做服务缓存加速。</p><h2 id="自定义docker网络" tabindex="-1"><a class="header-anchor" href="#自定义docker网络"><span>自定义<code>Docker</code>网络</span></a></h2><p>由于后面各个容器之间需要通信，所以提前准备自定义网络。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> network</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> nextcloud</span><span style="color:#A3BE8C;"> --driver</span><span style="color:#A3BE8C;"> bridge</span></span>\n<span class="line"><span style="color:#616E88;"># nextcloud 是自定义网络名，可以随便取</span></span>\n<span class="line"><span style="color:#616E88;"># --driver 指定网络模式</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">网络模式</th><th style="text-align:left;">简介</th></tr></thead><tbody><tr><td style="text-align:left;">bridge</td><td style="text-align:left;">为每一个容器分配、设置<code>IP</code>等，并将容器连接到一个<code>docker0</code>虚拟网桥，默认为该模式。</td></tr><tr><td style="text-align:left;">host</td><td style="text-align:left;">容器将不会虚拟出自己的网卡，配置自己的<code>IP</code>等，而是使用宿主机的<code>IP</code>和端口。</td></tr><tr><td style="text-align:left;">none</td><td style="text-align:left;">容器有独立的<code>Network namespace</code>，但并没有对其进行任何网络设置，如分配<code>veth pair</code>和网桥连接，<code>IP</code>等。</td></tr><tr><td style="text-align:left;">container</td><td style="text-align:left;">新创建的容器不会创建自己的网卡和配置自己的 IP，而是和一个指定的容器共享<code>IP</code>、端口范围等。</td></tr></tbody></table><h2 id="安装mysql" tabindex="-1"><a class="header-anchor" href="#安装mysql"><span>安装<code>MySQL</code></span></a></h2><h3 id="_1-拉取镜像" tabindex="-1"><a class="header-anchor" href="#_1-拉取镜像"><span>1.拉取镜像</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> pull</span><span style="color:#A3BE8C;"> mysql:8.0.33</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-启动服务" tabindex="-1"><a class="header-anchor" href="#_2-启动服务"><span>2.启动服务</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> run</span><span style="color:#A3BE8C;"> -d</span><span style="color:#A3BE8C;"> --privileged=true</span><span style="color:#A3BE8C;"> --name</span><span style="color:#A3BE8C;"> mysql</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/mysql/data:/var/lib/mysql</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-e </span><span style="color:#A3BE8C;">MYSQL_ROOT_PASSWORD=yourMysqlPwd</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">--network </span><span style="color:#A3BE8C;">nextcloud</span><span style="color:#A3BE8C;"> -p</span><span style="color:#A3BE8C;"> 3306:3306</span><span style="color:#A3BE8C;"> mysql:8.0.33</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># --name mysql 容器名字可以随意定义，这里一定要加！后面容器间通行会用到</span></span>\n<span class="line"><span style="color:#616E88;"># /mysql/data 宿主机目录，用来做mysql容器数据持久化用</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-使用dbeaver测试数据库连接" tabindex="-1"><a class="header-anchor" href="#_3-使用dbeaver测试数据库连接"><span>3.使用<code>DBeaver</code>测试数据库连接</span></a></h3><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>设置<code>allowPublicKeyRetrieval</code>为<code>TRUE</code></p><p>点击完成测试连接。</p><h2 id="安装redis" tabindex="-1"><a class="header-anchor" href="#安装redis"><span>安装<code>Redis</code></span></a></h2><h3 id="_1-拉取镜像-1" tabindex="-1"><a class="header-anchor" href="#_1-拉取镜像-1"><span>1.拉取镜像</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> pull</span><span style="color:#A3BE8C;"> redis:7.0.11</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-启动服务-1" tabindex="-1"><a class="header-anchor" href="#_2-启动服务-1"><span>2.启动服务</span></a></h3><p>下载<code>redis</code>配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">wget</span><span style="color:#A3BE8C;"> -P</span><span style="color:#A3BE8C;"> /redis/conf</span><span style="color:#A3BE8C;"> http://download.redis.io/redis-stable/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者手动创建配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">vi</span><span style="color:#A3BE8C;"> /redis/conf/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;"># 添加以下内容到conf文件中</span></span>\n<span class="line"><span style="color:#88C0D0;">protected-mode</span><span style="color:#A3BE8C;"> no</span></span>\n<span class="line"><span style="color:#88C0D0;">appendonly</span><span style="color:#A3BE8C;"> yes</span></span>\n<span class="line"><span style="color:#88C0D0;">requirepass</span><span style="color:#A3BE8C;"> redisPwd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以配置文件形式启动</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> run</span><span style="color:#A3BE8C;"> -d</span><span style="color:#A3BE8C;"> --privileged=true</span><span style="color:#A3BE8C;"> --name</span><span style="color:#A3BE8C;"> redis</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/redis/conf:/etc/redis/conf</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/redis/data:/data</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-p </span><span style="color:#A3BE8C;">6379:6379</span><span style="color:#A3BE8C;"> redis:7.0.11</span><span style="color:#A3BE8C;"> redis-server</span><span style="color:#A3BE8C;"> /etc/redis/conf/redis.conf</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># /redis/conf 配置文件存放的本地目录</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-redis测试" tabindex="-1"><a class="header-anchor" href="#_3-redis测试"><span>3.<code>Redis</code>测试</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;"># 通过 Docker 命令进入 Redis 容器内部</span></span>\n<span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> exec</span><span style="color:#A3BE8C;"> -it</span><span style="color:#A3BE8C;"> redis</span><span style="color:#A3BE8C;"> /bin/bash</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># 进入 Redis 控制台</span></span>\n<span class="line"><span style="color:#88C0D0;">redis-cli</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># 查看当前密码</span></span>\n<span class="line"><span style="color:#88C0D0;">config</span><span style="color:#A3BE8C;"> get</span><span style="color:#A3BE8C;"> requirepass</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># 若出现(error) NOAUTH Authentication required.错误，则使用 auth 密码 来认证密码</span></span>\n<span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> 你的密码</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># 添加一个变量为 key 为 name , value 为 bella 的内容</span></span>\n<span class="line"><span style="color:#88C0D0;">set</span><span style="color:#A3BE8C;"> name</span><span style="color:#A3BE8C;"> bella</span></span>\n<span class="line"><span style="color:#616E88;"># 查看 key 为 name 的 value 值</span></span>\n<span class="line"><span style="color:#88C0D0;">get</span><span style="color:#A3BE8C;"> name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装nextcloud" tabindex="-1"><a class="header-anchor" href="#安装nextcloud"><span>安装<code>NextCloud</code></span></a></h2><h3 id="_1-拉取镜像-2" tabindex="-1"><a class="header-anchor" href="#_1-拉取镜像-2"><span>1.拉取镜像</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> pull</span><span style="color:#A3BE8C;"> nextcloud:26.0.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-启动服务-2" tabindex="-1"><a class="header-anchor" href="#_2-启动服务-2"><span>2.启动服务</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> run</span><span style="color:#A3BE8C;"> -d</span><span style="color:#A3BE8C;"> --privileged=true</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">--name </span><span style="color:#A3BE8C;">nextcloud</span><span style="color:#A3BE8C;"> --restart=always</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/Users/xxx/www/nextcloud/html:/var/www/html</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/Users/xxx/www/nextcloud/apps:/var/www/html/custom_apps</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/Users/xxx/www/nextcloud/config:/var/www/html/config</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/Users/xxx/www/nextcloud/data:/var/www/html/data</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">-v </span><span style="color:#A3BE8C;">/Users/xxx/www/nextcloud/theme:/var/www/html/themes</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">--network </span><span style="color:#A3BE8C;">nextcloud</span><span style="color:#A3BE8C;"> -p</span><span style="color:#A3BE8C;"> 8080:80</span><span style="color:#EBCB8B;"> \\</span></span>\n<span class="line"><span style="color:#D8DEE9FF;">nextcloud:26.0.1</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;"># 参数解释：</span></span>\n<span class="line"><span style="color:#616E88;"># docker run：启动容器</span></span>\n<span class="line"><span style="color:#616E88;"># -d：后台启动</span></span>\n<span class="line"><span style="color:#616E88;"># --restart=always：docker重启该容器跟着重启</span></span>\n<span class="line"><span style="color:#616E88;"># --nmae nextcloud：自定义容器名称</span></span>\n<span class="line"><span style="color:#616E88;"># -p 8080:80：将服务器的80端口映射到容器的80端口</span></span>\n<span class="line"><span style="color:#616E88;"># nextcloud:latest：选择启动的镜像和版本</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-初次访问并配置" tabindex="-1"><a class="header-anchor" href="#_3-初次访问并配置"><span>3.初次访问并配置</span></a></h3><p>本地访问：<a href="http://xn--dockerip-ch0m705ekrl24skzo:8080" target="_blank" rel="noopener noreferrer">http://docker所在宿主机ip:8080</a></p><p>按照提示创建管理员账户和密码&amp;指定数据库，这部分忘记截图了，以后想起来再补。。。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li>[1] <a href="https://www.cnblogs.com/mrhelloworld/p/docker11.html" target="_blank" rel="noopener noreferrer">Docker 网络模式详解及容器间网络通信</a></li><li>[2] <a href="https://juejin.cn/post/7165163308343885838" target="_blank" rel="noopener noreferrer">docker安装部署NextCloud私人网盘的方法步骤</a></li><li>[3] <a href="https://learnku.com/articles/44349" target="_blank" rel="noopener noreferrer">docker中MySQL备份及恢复</a></li></ul>',40),t={},d=(0,a(8538).A)(t,[["render",function(e,s){return(0,n.uX)(),(0,n.CE)("div",null,[i,(0,n.Q3)(" more "),o])}]]),c=JSON.parse('{"path":"/service/nextCloud.html","title":"Docker部署NextCloud指南","lang":"zh-CN","frontmatter":{"title":"Docker部署NextCloud指南","icon":"link","category":"service","tag":["Docker","NextCloud","MySQL","Redis"],"isOriginal":true,"timeline":true,"date":"2023-05-22T00:00:00.000Z","article":true,"description":"在Docker部署NextCloud服务，并使用MySQL和Redis做数据库。","head":[["meta",{"property":"og:url","content":"https://hanekawa.top/service/nextCloud.html"}],["meta",{"property":"og:site_name","content":"hanekawa-shiki"}],["meta",{"property":"og:title","content":"Docker部署NextCloud指南"}],["meta",{"property":"og:description","content":"在Docker部署NextCloud服务，并使用MySQL和Redis做数据库。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-05-22T07:32:19.000Z"}],["meta",{"property":"article:author","content":"hanekawa-shiki"}],["meta",{"property":"article:tag","content":"Docker"}],["meta",{"property":"article:tag","content":"NextCloud"}],["meta",{"property":"article:tag","content":"MySQL"}],["meta",{"property":"article:tag","content":"Redis"}],["meta",{"property":"article:published_time","content":"2023-05-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-05-22T07:32:19.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker部署NextCloud指南\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-05-22T00:00:00.000Z\\",\\"dateModified\\":\\"2023-05-22T07:32:19.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"hanekawa-shiki\\",\\"url\\":\\"https://hanekawa.top\\"}]}"]]},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"自定义Docker网络","slug":"自定义docker网络","link":"#自定义docker网络","children":[]},{"level":2,"title":"安装MySQL","slug":"安装mysql","link":"#安装mysql","children":[{"level":3,"title":"1.拉取镜像","slug":"_1-拉取镜像","link":"#_1-拉取镜像","children":[]},{"level":3,"title":"2.启动服务","slug":"_2-启动服务","link":"#_2-启动服务","children":[]},{"level":3,"title":"3.使用DBeaver测试数据库连接","slug":"_3-使用dbeaver测试数据库连接","link":"#_3-使用dbeaver测试数据库连接","children":[]}]},{"level":2,"title":"安装Redis","slug":"安装redis","link":"#安装redis","children":[{"level":3,"title":"1.拉取镜像","slug":"_1-拉取镜像-1","link":"#_1-拉取镜像-1","children":[]},{"level":3,"title":"2.启动服务","slug":"_2-启动服务-1","link":"#_2-启动服务-1","children":[]},{"level":3,"title":"3.Redis测试","slug":"_3-redis测试","link":"#_3-redis测试","children":[]}]},{"level":2,"title":"安装NextCloud","slug":"安装nextcloud","link":"#安装nextcloud","children":[{"level":3,"title":"1.拉取镜像","slug":"_1-拉取镜像-2","link":"#_1-拉取镜像-2","children":[]},{"level":3,"title":"2.启动服务","slug":"_2-启动服务-2","link":"#_2-启动服务-2","children":[]},{"level":3,"title":"3.初次访问并配置","slug":"_3-初次访问并配置","link":"#_3-初次访问并配置","children":[]}]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"git":{"createdTime":1682432811000,"updatedTime":1684740739000,"contributors":[{"name":"shiki ryougi","email":"shikiryougi@shikideMacBook.local","commits":3}]},"readingTime":{"minutes":2.95,"words":885},"filePathRelative":"service/nextCloud.md","localizedDate":"2023年5月22日","excerpt":"<p>在<code>Docker</code>部署<code>NextCloud</code>服务，并使用<code>MySQL</code>和<code>Redis</code>做数据库。</p>\\n","autoDesc":true}')},8538:(e,s)=>{s.A=(e,s)=>{const a=e.__vccOpts||e;for(const[e,n]of s)a[e]=n;return a}}}]);