"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[891],{6323:(i,s,e)=>{e.r(s),e.d(s,{comp:()=>p,data:()=>k});var a=e(7829);const t=e.p+"assets/img/ssl.886d58f0.png",h=(0,a.Lk)("p",null,[(0,a.eW)("本教程记录的是通过使用"),(0,a.Lk)("code",null,"acme.sh"),(0,a.eW)("申请"),(0,a.Lk)("code",null,"Let's Encrypt"),(0,a.eW)("泛域名证书,安装证书及"),(0,a.Lk)("code",null,"nginx"),(0,a.eW)("配置使用证书,并通过配置实现"),(0,a.Lk)("code",null,"ssl"),(0,a.eW)("证书自动续期")],-1),n=(0,a.Fv)('<h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><p>测试环境: <code>Ubuntu 20.04</code>、<code>nginx</code></p><p>使用到的工具:</p><ul><li><a href="https://github.com/acmesh-official/acme.sh" target="_blank" rel="noopener noreferrer">acme.sh</a></li></ul><h2 id="acme-sh安装" tabindex="-1"><a class="header-anchor" href="#acme-sh安装"><span><code>acme.sh</code>安装</span></a></h2><p>参考<a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">官方中文文档</a></p><p>安装:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://get.acme.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> email=my@example.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>默认安装到当前用户的<code>home</code>目录下<code>~/.acme.sh/</code></p><p>建议创建一个<code>shell</code>的<code>alias</code>, 例如编辑<code>.bashrc</code>并在底部添加，方便你的使用:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">alias</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> acme.sh=~/.acme.sh/acme.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>保存后<code>source ~/.bashrc</code>一下</p><p>其他安装方法: <a href="https://github.com/Neilpang/acme.sh/wiki/How-to-install" target="_blank" rel="noopener noreferrer">https://github.com/Neilpang/acme.sh/wiki/How-to-install</a></p><h2 id="使用dns-api自动申请证书" tabindex="-1"><a class="header-anchor" href="#使用dns-api自动申请证书"><span>使用<code>DNS api</code>自动申请证书</span></a></h2><p>首先申请对应<code>DNS</code>供应商的<code>DNS API KEY</code>,以下使用<code>namesilo</code>做演示,其他<code>DNS</code>供应商请自行搜索</p><p><a href="https://www.namesilo.com/account/api-manager" target="_blank" rel="noopener noreferrer">namesilo申请地址</a></p>',16),l=(0,a.Lk)("code",null,"namesilo",-1),d=(0,a.Fv)('<figure><img src="'+t+'" alt="申请namesilo dns api key" tabindex="0" loading="lazy"><figcaption>申请namesilo dns api key</figcaption></figure><p>添加变量:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> Namesilo_Key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xxxxxx&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>其他<code>DNS</code>供应商的key添加变量方法:<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener noreferrer">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><p>生成证书:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --issue</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dns</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dns_namesilo</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dnssleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 900</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www.example.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>建议将900改大为1800,因为<code>namesilo</code>解析比较慢</p><h2 id="安装证书" tabindex="-1"><a class="header-anchor" href="#安装证书"><span>安装证书</span></a></h2><p><code>nginx</code>使用以下方式:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --install-cert</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--key-file       </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/path/to/keyfile/in/nginx/key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--fullchain-file </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/path/to/fullchain/nginx/cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--reloadcmd     </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;service nginx force-reload&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他方式<a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E#3-copy%E5%AE%89%E8%A3%85-%E8%AF%81%E4%B9%A6" target="_blank" rel="noopener noreferrer">参考文档</a></p><p>如果报错需要安装<code>ecc</code>证书，用如下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --install-cert</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --ecc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--key-file       </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/path/to/keyfile/in/nginx/key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--fullchain-file </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/path/to/fullchain/nginx/cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">--reloadcmd     </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;service nginx force-reload&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动更新证书" tabindex="-1"><a class="header-anchor" href="#自动更新证书"><span>自动更新证书</span></a></h2><p><code>acme.sh</code>安装的时候会自动添加定时任务,确保你的机器上<code>crontab</code>正确安装,可以通过<code>crontab -l</code>命令参看定时任务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -l</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">24</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/root/.acme.sh&quot;/acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cron</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --home</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/root/.acme.sh&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/null</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更新acme-sh" tabindex="-1"><a class="header-anchor" href="#更新acme-sh"><span>更新<code>acme.sh</code></span></a></h2><p>目前由于<code>acme</code>协议和<code>letsencrypt CA</code>都在频繁的更新, 因此<code>acme.sh</code>也经常更新以保持同步.</p><p>升级<code>acme.sh</code>到最新版 :</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你不想手动升级, 可以开启自动升级:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --auto-upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>之后,<code>acme.sh</code>就会自动保持更新了.</p><p>你也可以随时关闭自动更新:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">acme.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --auto-upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',25),r={},p=(0,e(1305).A)(r,[["render",function(i,s){const e=(0,a.g2)("Badge");return(0,a.uX)(),(0,a.CE)("div",null,[h,(0,a.Q3)(" more "),n,(0,a.bF)(e,{text:"注意",type:"warning"}),(0,a.eW)("由于"),l,(0,a.eW)("网站更新过,网上其他教程的地址还是老地址,老地址配置是不生效的!"),d])}]]),k=JSON.parse('{"path":"/website_build/domainNameSSL.html","title":"免费泛域名证书申请安装及配置","lang":"zh-CN","frontmatter":{"title":"免费泛域名证书申请安装及配置","icon":"linux","category":"域名","tag":["SSL","Let\'s Encrypt","namesilo"],"isOriginal":true,"date":"2022-11-18T00:00:00.000Z","description":"本教程记录的是通过使用acme.sh申请Let\'s Encrypt泛域名证书,安装证书及nginx配置使用证书,并通过配置实现ssl证书自动续期","head":[["meta",{"property":"og:url","content":"https://hanekawa.top/website_build/domainNameSSL.html"}],["meta",{"property":"og:site_name","content":"hanekawa-shiki"}],["meta",{"property":"og:title","content":"免费泛域名证书申请安装及配置"}],["meta",{"property":"og:description","content":"本教程记录的是通过使用acme.sh申请Let\'s Encrypt泛域名证书,安装证书及nginx配置使用证书,并通过配置实现ssl证书自动续期"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-02-21T07:34:25.000Z"}],["meta",{"property":"article:author","content":"hanekawa-shiki"}],["meta",{"property":"article:tag","content":"SSL"}],["meta",{"property":"article:tag","content":"Let\'s Encrypt"}],["meta",{"property":"article:tag","content":"namesilo"}],["meta",{"property":"article:published_time","content":"2022-11-18T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-02-21T07:34:25.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"免费泛域名证书申请安装及配置\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-11-18T00:00:00.000Z\\",\\"dateModified\\":\\"2024-02-21T07:34:25.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"hanekawa-shiki\\",\\"url\\":\\"https://hanekawa.top\\"}]}"]]},"headers":[{"level":2,"title":"环境","slug":"环境","link":"#环境","children":[]},{"level":2,"title":"acme.sh安装","slug":"acme-sh安装","link":"#acme-sh安装","children":[]},{"level":2,"title":"使用DNS api自动申请证书","slug":"使用dns-api自动申请证书","link":"#使用dns-api自动申请证书","children":[]},{"level":2,"title":"安装证书","slug":"安装证书","link":"#安装证书","children":[]},{"level":2,"title":"自动更新证书","slug":"自动更新证书","link":"#自动更新证书","children":[]},{"level":2,"title":"更新acme.sh","slug":"更新acme-sh","link":"#更新acme-sh","children":[]}],"git":{"createdTime":1668764177000,"updatedTime":1708500865000,"contributors":[{"name":"kamishima-kaede","email":"kamiacgxu@gmail.com","commits":1},{"name":"shiki","email":"kamiacgxu@gmail.com","commits":1},{"name":"shiki ryougi","email":"shikiryougi@shikideMacBook.local","commits":1}]},"readingTime":{"minutes":2,"words":599},"filePathRelative":"website_build/domainNameSSL.md","localizedDate":"2022年11月18日","excerpt":"<p>本教程记录的是通过使用<code>acme.sh</code>申请<code>Let\'s Encrypt</code>泛域名证书,安装证书及<code>nginx</code>配置使用证书,并通过配置实现<code>ssl</code>证书自动续期</p>\\n","autoDesc":true}')},1305:(i,s)=>{s.A=(i,s)=>{const e=i.__vccOpts||i;for(const[i,a]of s)e[i]=a;return e}}}]);