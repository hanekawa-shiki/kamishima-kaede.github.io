"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[2083],{2877:(s,n,a)=>{a.r(n),a.d(n,{comp:()=>t,data:()=>c});var l=a(9034);const o=(0,l.Lk)("p",null,"在项目中经常会遇到文件的上传下载需求，在这边总结归纳一下常用的方法。",-1),p=(0,l.Fv)('<h2 id="纯前端下载模版文件" tabindex="-1"><a class="header-anchor" href="#纯前端下载模版文件"><span>纯前端下载模版文件</span></a></h2><p>有时我们会遇到偷懒的后端同事，下载简单模板类的需求不愿意写接口，直接甩给前端同事做。对于这种需求也不是很复杂。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> getTemplateFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> origin</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">location</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">origin</span></span>\n<span class="line"><span style="color:#616E88;">  // 假设下载的文件静态路径</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> templateFile</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">/template/template.doc</span><span style="color:#ECEFF4;">&#39;</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> fileUrl</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">origin</span><span style="color:#81A1C1;">}${</span><span style="color:#D8DEE9;">templateFile</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> link</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createElement</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  link</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">style</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">display</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">none</span><span style="color:#ECEFF4;">&#39;</span></span>\n<span class="line"><span style="color:#D8DEE9;">  link</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">setAttribute</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">href</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fileUrl</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  link</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">download</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">下载的文件名</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> +</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Date</span><span style="color:#D8DEE9FF;">()</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getTime</span><span style="color:#D8DEE9FF;">()</span></span>\n<span class="line"><span style="color:#D8DEE9;">  document</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">body</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendChild</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">link</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  link</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">click</span><span style="color:#D8DEE9FF;">()</span></span>\n<span class="line"><span style="color:#D8DEE9;">  document</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">body</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">removeChild</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">link</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="通过接口下载文件" tabindex="-1"><a class="header-anchor" href="#通过接口下载文件"><span>通过接口下载文件</span></a></h2><p>1.对于<code>GET</code>请求的接口，最常用的是<code>window.open(url)</code>。</p><p>2.但是对于<code>POST</code>请求就不能直接使用<code>window.open(url)</code>方法了，我们可以利用<code>Blob</code>对象下载文件，通常在项目中封装一个下载文件的方法。</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// blob 接口返回的流</span></span>\n<span class="line"><span style="color:#616E88;">// fileName 文件名</span></span>\n<span class="line"><span style="color:#616E88;">// evt 文件扩展名</span></span>\n<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#88C0D0;"> handleBlobData</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">blob</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> fileName</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> evt</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">pdf</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> a</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createElement</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">a</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  document</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">body</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">appendChild</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  a</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">style</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">display: none</span><span style="color:#ECEFF4;">&#39;</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> url</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">URL</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">createObjectURL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">blob</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#D8DEE9;">  a</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">href</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> url</span></span>\n<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> name</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fileName</span><span style="color:#81A1C1;"> ?</span><span style="color:#ECEFF4;"> `</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">fileName</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">.</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">evt</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> :</span><span style="color:#ECEFF4;"> `</span><span style="color:#81A1C1;">${</span><span style="color:#88C0D0;">dayjs</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">format</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">YYYY-MM-DD_HH:mm:ss</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">.</span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">evt</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">`</span></span>\n<span class="line"><span style="color:#D8DEE9;">  a</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">click</span><span style="color:#D8DEE9FF;">()</span></span>\n<span class="line"><span style="color:#D8DEE9;">  a</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">remove</span><span style="color:#D8DEE9FF;">()</span></span>\n<span class="line"><span style="color:#D8DEE9;">  window</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">URL</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">revokeObjectURL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">url</span><span style="color:#D8DEE9FF;">)</span></span>\n<span class="line"><span style="color:#ECEFF4;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#616E88;">// 关于文件名,一般在响应头回有返回</span></span>\n<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileNameEncode</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> res</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">headers</span><span style="color:#D8DEE9FF;">[</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">content-disposition</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">split</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">filename=</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)[</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">]</span></span>\n<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileName</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> decodeURIComponent</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">fileNameEncode</span><span style="color:#D8DEE9FF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',7),e={},t=(0,a(8538).A)(e,[["render",function(s,n){return(0,l.uX)(),(0,l.CE)("div",null,[o,(0,l.Q3)(" more "),p])}]]),c=JSON.parse('{"path":"/workRecord/fileaction.html","title":"前端上传下载文件","lang":"zh-CN","frontmatter":{"title":"前端上传下载文件","icon":"linux","category":"前端","tag":["js"],"isOriginal":true,"date":"2023-03-10T00:00:00.000Z","description":"在项目中经常会遇到文件的上传下载需求，在这边总结归纳一下常用的方法。","head":[["meta",{"property":"og:url","content":"https://hanekawa.top/workRecord/fileaction.html"}],["meta",{"property":"og:site_name","content":"hanekawa-shiki"}],["meta",{"property":"og:title","content":"前端上传下载文件"}],["meta",{"property":"og:description","content":"在项目中经常会遇到文件的上传下载需求，在这边总结归纳一下常用的方法。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-03-21T10:01:57.000Z"}],["meta",{"property":"article:author","content":"hanekawa-shiki"}],["meta",{"property":"article:tag","content":"js"}],["meta",{"property":"article:published_time","content":"2023-03-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-03-21T10:01:57.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"前端上传下载文件\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-03-10T00:00:00.000Z\\",\\"dateModified\\":\\"2023-03-21T10:01:57.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"hanekawa-shiki\\",\\"url\\":\\"https://hanekawa.top\\"}]}"]]},"headers":[{"level":2,"title":"纯前端下载模版文件","slug":"纯前端下载模版文件","link":"#纯前端下载模版文件","children":[]},{"level":2,"title":"通过接口下载文件","slug":"通过接口下载文件","link":"#通过接口下载文件","children":[]}],"git":{"createdTime":1678631080000,"updatedTime":1679392917000,"contributors":[{"name":"shiki ryougi","email":"shikiryougi@shikideMacBook.local","commits":2}]},"readingTime":{"minutes":1.09,"words":327},"filePathRelative":"workRecord/fileaction.md","localizedDate":"2023年3月10日","excerpt":"<p>在项目中经常会遇到文件的上传下载需求，在这边总结归纳一下常用的方法。</p>\\n","autoDesc":true}')},8538:(s,n)=>{n.A=(s,n)=>{const a=s.__vccOpts||s;for(const[s,l]of n)a[s]=l;return a}}}]);