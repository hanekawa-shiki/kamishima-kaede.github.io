import{ab as d,F as r,G as l,E as e,R as a,M as s,ac as c,U as o}from"./framework-d584725c.js";const t="/assets/ssl-c64d1e83.png",p={},h=c('<p>本教程目的是通过使用<code>acme.sh</code>申请<code>Let&#39;s Encrypt</code>泛域名证书,安装证书及<code>nginx</code>配置使用证书,并通过配置实现<code>ssl</code>证书自动续期</p><h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境" aria-hidden="true">#</a> 环境</h2><p>测试环境: <code>Ubuntu 20.04</code>、<code>nginx</code></p><p>使用到的工具:</p>',4),m={href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"},u=e("h2",{id:"acme-sh安装",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#acme-sh安装","aria-hidden":"true"},"#"),a(),e("code",null,"acme.sh"),a("安装")],-1),b={href:"https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},v=c(`<p>安装:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> <span class="token assign-left variable">email</span><span class="token operator">=</span>my@example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>默认安装到当前用户的<code>home</code>目录下<code>~/.acme.sh/</code></p><p>建议创建一个<code>shell</code>的<code>alias</code>, 例如编辑<code>.bashrc</code>并在底部添加，方便你的使用:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">alias</span> <span class="token assign-left variable">acme.sh</span><span class="token operator">=~</span>/.acme.sh/acme.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>保存后<code>source ~/.bashrc</code>一下</p>`,6),g={href:"https://github.com/Neilpang/acme.sh/wiki/How-to-install",target:"_blank",rel:"noopener noreferrer"},k=c('<h2 id="使用dns-api自动申请证书" tabindex="-1"><a class="header-anchor" href="#使用dns-api自动申请证书" aria-hidden="true">#</a> 使用<code>DNS api</code>自动申请证书</h2><p>首先申请对应<code>DNS</code>供应商的<code>DNS API KEY</code>,以下使用<code>namesilo</code>做演示,其他<code>DNS</code>供应商请自行搜索</p>',2),_={href:"https://www.namesilo.com/account/api-manager",target:"_blank",rel:"noopener noreferrer"},f=e("code",null,"namesilo",-1),x=c('<p><img src="'+t+`" alt="申请namesilo dns api key"></p><p>添加变量:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">Namesilo_Key</span><span class="token operator">=</span><span class="token string">&quot;xxxxxx&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),E=e("code",null,"DNS",-1),w={href:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi",target:"_blank",rel:"noopener noreferrer"},N=c(`<p>生成证书:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acme.sh <span class="token parameter variable">--issue</span> <span class="token parameter variable">--dns</span> dns_namesilo <span class="token parameter variable">--dnssleep</span> <span class="token number">900</span> <span class="token parameter variable">-d</span> example.com <span class="token parameter variable">-d</span> www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>建议将900改大为1800,因为<code>namesilo</code>解析比较慢</p><h2 id="安装证书" tabindex="-1"><a class="header-anchor" href="#安装证书" aria-hidden="true">#</a> 安装证书</h2><p><code>nginx</code>使用以下方式:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acme.sh --install-cert <span class="token parameter variable">-d</span> example.com <span class="token punctuation">\\</span>
--key-file       /path/to/keyfile/in/nginx/key.pem  <span class="token punctuation">\\</span>
--fullchain-file /path/to/fullchain/nginx/cert.pem <span class="token punctuation">\\</span>
<span class="token parameter variable">--reloadcmd</span>     <span class="token string">&quot;service nginx force-reload&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),y={href:"https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E#3-copy%E5%AE%89%E8%A3%85-%E8%AF%81%E4%B9%A6",target:"_blank",rel:"noopener noreferrer"},S=c(`<h2 id="自动更新证书" tabindex="-1"><a class="header-anchor" href="#自动更新证书" aria-hidden="true">#</a> 自动更新证书</h2><p><code>acme.sh</code>安装的时候会自动添加定时任务,确保你的机器上<code>crontab</code>正确安装,可以通过<code>crontab -l</code>命令参看定时任务</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">crontab</span>  <span class="token parameter variable">-l</span>

<span class="token number">24</span> * * * * <span class="token string">&quot;/root/.acme.sh&quot;</span>/acme.sh <span class="token parameter variable">--cron</span> <span class="token parameter variable">--home</span> <span class="token string">&quot;/root/.acme.sh&quot;</span> <span class="token operator">&gt;</span> /dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更新acme-sh" tabindex="-1"><a class="header-anchor" href="#更新acme-sh" aria-hidden="true">#</a> 更新<code>acme.sh</code></h2><p>目前由于<code>acme</code>协议和<code>letsencrypt CA</code>都在频繁的更新, 因此<code>acme.sh</code>也经常更新以保持同步.</p><p>升级<code>acme.sh</code>到最新版 :</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acme.sh <span class="token parameter variable">--upgrade</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果你不想手动升级, 可以开启自动升级:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acme.sh <span class="token parameter variable">--upgrade</span> --auto-upgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后,<code>acme.sh</code>就会自动保持更新了.</p><p>你也可以随时关闭自动更新:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acme.sh <span class="token parameter variable">--upgrade</span> --auto-upgrade  <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,12);function q(A,B){const n=o("ExternalLinkIcon"),i=o("Badge");return r(),l("div",null,[h,e("ul",null,[e("li",null,[e("a",m,[a("acme.sh"),s(n)])])]),u,e("p",null,[a("参考"),e("a",b,[a("官方中文文档"),s(n)])]),v,e("p",null,[a("其他安装方法: "),e("a",g,[a("https://github.com/Neilpang/acme.sh/wiki/How-to-install"),s(n)])]),k,e("p",null,[e("a",_,[a("namesilo申请地址"),s(n)])]),s(i,{text:"注意",type:"warning"}),a("由于"),f,a("网站更新过,网上其他教程的地址还是老地址,老地址配置是不生效的!"),x,e("p",null,[a("其他"),E,a("供应商的key添加变量方法:"),e("a",w,[a("https://github.com/acmesh-official/acme.sh/wiki/dnsapi"),s(n)])]),N,e("p",null,[a("其他方式"),e("a",y,[a("参考文档"),s(n)])]),S])}const L=d(p,[["render",q],["__file","domainNameSSL.html.vue"]]);export{L as default};
